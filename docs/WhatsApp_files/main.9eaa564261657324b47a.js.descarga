/*! Copyright (c) 2015 WhatsApp Inc.  All Rights Reserved. */
webpackJsonp([6],Array(1313).concat([function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){window.history.pushState({},"",window.location.href)}function o(){if(!Store.Conn.connected)return!1;var e=a(1499).hasText,t=Store.Msg.some(function(e){return 0===e.ack&&e.local&&e.isSentByMe}),n=Store.Chat.some(function(e){return!!e.composeContents.text});return t||n||e()}Object.defineProperty(t,"__esModule",{value:!0});var r=a(2),s=n(r),l=a(16),u=n(l),c=a(6),d=n(c),f=a(3),p=n(f),h=a(4),m=n(h),v=a(8),g=n(v),_=a(7),y=n(_);t.hasPending=o;var E=a(5),M=n(E),S=a(13),C=n(S),b=a(1536),k=n(b),T=a(163),w=n(T),N=a(248),P=n(N),A=a(1554),O=n(A),R=a(12),D=n(R),x=a(238),I=n(x),L=a(14),F=n(L),U=a(1592),j=n(U),G=a(1625),B=n(G),V=a(15),H=n(V),W=a(95),z=n(W),Y=a(61),q=n(Y),K=a(1662),Q=n(K),X=a(116),Z=n(X),J=a(1710),$=n(J),ee=a(255),te=n(ee),ae=a(1723),ne=n(ae),ie=a(78),oe=n(ie),re=a(1),se=n(re),le=a(0),ue=n(le),ce=a(1711),de=n(ce),fe=a(46),pe=n(fe),he=a(1643),me=n(he),ve=a(55),ge=n(ve),_e=a(23),ye=n(_e),Ee=a(97),Me=n(Ee),Se=a(1685),Ce=n(Se),be=a(37),ke=n(be),Te=a(240),we=n(Te),Ne=a(96),Pe=n(Ne),Ae=a(48),Oe=n(Ae),Re=a(31),De=n(Re),xe=a(463),Ie=n(xe),Le=a(1733),Fe=n(Le),Ue=a(47),je=n(Ue),Ge=a(22),Be=n(Ge),Ve=a(100);Ve&&!function(){var e=a(254),t=a(253);Store.ProfilePicThumb.on("change:tag",function(a){var n=navigator.serviceWorker;n&&!a.tag&&e.request(n.controller,t.REMOVE_PP,a.id)["catch"](function(){})})}();var He=P["default"].parseCmd,We=P["default"].Cmd,ze=[[document,"mousemove"],[document,"scroll"],[document,"keydown"],[window,"focus"],[window,"resize"]];t["default"]=(0,oe["default"])(function(e){function t(){var e,a,n,i;(0,p["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,g["default"])(this,(e=t.__proto__||(0,d["default"])(t)).call.apply(e,[this].concat(r))),n.state={drawerActive:!1},n.idleMonitor=null,n.serverPropsQueryLoop=null,n.rightDrawerOut=!1,n.onBlurTimer=new ge["default"](function(){if(document.activeElement===document.body){var e=Pe["default"].Manager.top;e&&e.uie.requestFocus()}}),n.onBlur=function(){n.onBlurTimer.debounce(10)},n.onRightDrawerIn=function(){n.rightDrawerOut=!1,D["default"].onPanesWillChange(3),n.setState({drawerActive:!0},function(){D["default"].onPanesDidChange(3)});var e=n.calculateConversationPaneScale();null!==e&&n.animateConversationPane(e)},n.onRightDrawerOut=function(){n.rightDrawerOut=!0;var e=n.calculateConversationPaneScale();null!==e&&n.animateConversationPane(e),1!==e&&(D["default"].onPanesWillChange(2),n.setState({drawerActive:!1},D["default"].onPanesDidChange.bind(D["default"],2)))},n.onRightDrawerAnimationComplete=function(){n.state.drawerActive&&n.rightDrawerOut&&n.setState({drawerActive:!1})},n.onRotateFocus=function(e){var t=1;e&&(e.stopPropagation(),e.preventDefault(),t=e.shiftKey?-1:1,Z["default"].flashFocus=Date.now());var a=[];if(pe["default"].findDOMNode(n).querySelectorAll("[data-tab]").forEach(function(e){a.push(e)}),D["default"].existsDrawerLeft(function(e){if(e){var t=pe["default"].findDOMNode(n.refs.chatlist);a=a.filter(function(e){return!t.contains(e)})}}),D["default"].existsDrawerMid(function(e){if(e){var t=pe["default"].findDOMNode(n.refs.conversation);t&&(a=a.filter(function(e){return!t.contains(e)}))}}),a.length){a=C["default"].sortBy(a,function(e){return parseInt(e.getAttribute("data-tab"),10)||0});var i=0,o=document.activeElement;o&&(i=te["default"].ring(C["default"].findIndex(a,function(e){return e.contains(o)})+t,a));var r=a[i];Z["default"].flashFocus=Date.now(),r.restoreFocus?r.restoreFocus():z["default"].focus(r)}},n.showTOS=function(){switch(Store.Conn.tos){case 1:case 2:D["default"].openModal(M["default"].createElement(Ce["default"],null),void 0,void 0,!0);break;case 3:ye["default"].logout()}},i=a,(0,g["default"])(n,i)}return(0,y["default"])(t,e),(0,m["default"])(t,[{key:"componentWillMount",value:function(){var e=this;Me["default"].uiActive=!0,Me["default"].markAvailable();var t=this.props.listeners;t.add(window,"click",function(t){var a=t.target;if(a&&"A"===a.nodeName&&a.hasAttribute("href")){var n=He(a.getAttribute("href"));e.execApiCmd(n)&&t.preventDefault()}},!0),q["default"].supportsFeature(q["default"].F.STATUS_V3_UI)&&Store.StatusV3.sync()}},{key:"componentWillReceiveProps",value:function(e){e.apiCmd&&this.execApiCmd(e.apiCmd)}},{key:"componentWillUnmount",value:function(){this.onBlurTimer.cancel(),ne["default"].trigger($["default"].Event+":"+$["default"].Events.LOGGED_OUT),Oe["default"].canMuckHistory()&&window.history.back(),Me["default"].uiActive=!1,this.clearIdleMonitor(),this.clearServerPropsQueryLoop()}},{key:"componentDidMount",value:function(){var e=this.props.listeners;if(ne["default"].trigger($["default"].Event+":"+$["default"].Events.LOGGED_IN),this.props.apiCmd&&this.execApiCmd(this.props.apiCmd),Oe["default"].canMuckHistory()&&(window.history.pushState({},"",window.location.href),e.add(window,"popstate",i)),this.beginIdleMonitor(!0),this.beginServerPropsQueryLoop(),e.addAndRun(Store.Conn,"change:tos",this.showTOS),z["default"].focus(pe["default"].findDOMNode(this)),ke["default"].isSafari){var t=De["default"].getNUX(F["default"].NUX.SAFARI_LIMITED_SUPPORT);(!t||t<t.maxViews)&&(setTimeout(function(){var e=l10n.t("whatsapp_safari_limited").replace("__chrome_homepage__",F["default"].BROWSER_LINK.CHROME).replace("__firefox_homepage__",F["default"].BROWSER_LINK.FIREFOX).replace("__opera_homepage__",F["default"].BROWSER_LINK.OPERA);D["default"].openModal(M["default"].createElement(I["default"],{onOK:D["default"].closeModal.bind(D["default"]),okText:l10n.t("ok_got_it")},M["default"].createElement("div",{dangerouslySetInnerHTML:{__html:e}})))},250),De["default"].setNUX(F["default"].NUX.SAFARI_LIMITED_SUPPORT,{views:1,maxViews:1}))}}},{key:"execApiCmd",value:function(e){var t=(0,u["default"])(e,2),a=t[0],n=t[1];se["default"].log("main:execApiCmd:"+a)(n),this.props.apiCmdHandled();var i=function(){switch(a){case We.GROUP_INVITE:var e=n;return D["default"].openModal(M["default"].createElement(Q["default"],{groupCode:e.code})),{v:!0};case We.MSG_SEND:var t=n,i=t.text,o=t.phone;if(o){var r=Be["default"].numberToWid(o);je["default"].queryExist(r).then(function(e){return 200===e.status?Store.Chat.find(e.jid):s["default"].reject("Invalid number")}).then(function(e){return e.active&&i?void D["default"].pasteChatTextInput(e,i):(i&&e.setComposeContents({text:i}),D["default"].openChatFromUnread(e).then(function(t){t&&D["default"].focusChatTextInput(e)}))})["catch"](function(e){D["default"].openModal(M["default"].createElement(I["default"],{onOK:D["default"].closeModal.bind(D["default"]),okText:l10n.t("web_ok")},l10n.t("msg_send_error")))})}else D["default"].openModal(M["default"].createElement(me["default"],{msgText:i}),"modal-flow");return{v:!0};default:return{v:!1}}}();return"object"==typeof i?i.v:void 0}},{key:"beginIdleMonitor",value:function(e){var t=this,a=e?F["default"].IDLE_TIMEOUT:0;this.idleMonitor=s["default"].loop(function(){return s["default"].delay(a).addCancelControl().then(function(){Me["default"].markUnavailable(3e4);var e=void 0,n=new s["default"](function(t){e=t});return ze.forEach(function(a){var n=(0,u["default"])(a,2),i=n[0],o=n[1];t.props.listeners.add(i,o,e)}),n.addCancelControl()["finally"](function(){ze.forEach(function(a){var n=(0,u["default"])(a,2),i=n[0],o=n[1];t.props.listeners.remove(i,o,e)})}).then(function(){document.hasFocus()&&Me["default"].markAvailable(),a=F["default"].IDLE_TIMEOUT})})})["finally"](function(){t.idleMonitor=null})["catch"](s["default"].CancellationError,function(){}).endWithControls("cancel")}},{key:"clearIdleMonitor",value:function(){this.idleMonitor&&this.idleMonitor.control.cancel()}},{key:"beginServerPropsQueryLoop",value:function(){var e=this;this.serverPropsQueryLoop=w["default"].setTimeout(function(){Store.Props.fetch()["catch"](H["default"].WapDrop,function(){}),e.beginServerPropsQueryLoop()},(0,ue["default"])().add("1","days").valueOf())}},{key:"clearServerPropsQueryLoop",value:function(){w["default"].clearTimeout(this.serverPropsQueryLoop)}},{key:"calculateConversationPaneScale",value:function(){if(!(this.refs.chatlist&&this.refs.container&&this.refs.conversation))return null;var e=pe["default"].findDOMNode(this.refs.chatlist),t=pe["default"].findDOMNode(this.refs.conversation),a=pe["default"].findDOMNode(this.refs.container);return t.clientWidth/(a.clientWidth-e.clientWidth)}},{key:"animateConversationPane",value:function(e){(0,Ie["default"])(pe["default"].findDOMNode(this.refs.conversation),{scaleX:[1,e]},{duration:300,easing:[.1,.82,.25,1]})}},{key:"render",value:function(){var e=this.state.drawerActive?"app three":"app two";this.props.animate||(e+=" no-animation");var t={tab:this.onRotateFocus,"shift+tab":this.onRotateFocus};return M["default"].createElement(we["default"],{state:we["default"].State.INACTIVE,ref:"container",displayName:"Main"},M["default"].createElement(Z["default"],{handlers:t,className:e,onBlur:this.onBlur},M["default"].createElement(de["default"],null),M["default"].createElement(k["default"],null),M["default"].createElement(Fe["default"],null),M["default"].createElement("div",{className:"drawer-manager"},M["default"].createElement(B["default"],{direction:G.Dir.LEFT}),M["default"].createElement(B["default"],{direction:G.Dir.MID}),M["default"].createElement(B["default"],{direction:G.Dir.RIGHT,ref:"rightDrawer",onDrawerIn:this.onRightDrawerIn,onDrawerOut:this.onRightDrawerOut,onDrawerAnimationComplete:this.onRightDrawerAnimationComplete})),M["default"].createElement(O["default"],{ref:"chatlist",className:"pane pane-one"}),M["default"].createElement(j["default"],{ref:"conversation",animate:this.props.animate})))}}]),t}(M["default"].Component))},function(e,t,a){"use strict";var n=a(1483),i=a(1706);e.exports={Blocklist:a(1691),Call:a(1692),Chat:a(1693),Cmd:a(1695),GroupMetadata:a(1697),Msg:a(1698),MsgInfo:a(1699),AllStarredMsgs:new n,StarredGifMsgs:new i,Mute:a(1700),Presence:a(1701),ProfilePicThumb:a(1702),Props:a(1703),RecentEmoji:a(1705),EmojiVariant:a(1696),Status:a(1707),ChatPreference:a(1694),StatusV3:a(1708),StatusV3Privacy:a(1709)}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}function o(e){return e._ProxyState$state}function r(e,t,a){function n(e){t.call(this,e)}for(var i={_ProxyState$ComponentName:{value:e},proxyBitMask:{value:(0,R.genBitMask)(t.prototype.mirrorMask,a)}},o=function(e){var t=a[e];i[t]={enumerable:!0,get:function(){return this._ProxyState$state.get(t)},set:function(e){this._ProxyState$state.set(t,e)}}},r=0;r<a.length;r++)o(r);return n.prototype=(0,S["default"])(t.prototype,i),n.prototype.constructor=n,n}Object.defineProperty(t,"__esModule",{value:!0});var s=a(62),l=i(s),u=a(162),c=i(u),d=a(6),f=i(d),p=a(8),h=i(p),m=a(7),v=i(m),g=a(3),_=i(g),y=a(4),E=i(y),M=a(83),S=i(M);t.unproxy=o,t["default"]=function(e){var t,a,n=e.name,i=e.CONCERNS,o=e.WEAK_CONCERNS;if(!i&&!o)throw new Error("StateHOC wrapping class with no concerns, check "+n);var r=[];if(i)for(var s in i)r.push(new I(n,s,i[s],!0));if(o)for(var u in o){if(i.hasOwnProperty(u))throw new Error('Component has marked "'+u+'" as both a normal and weak concern, check '+n);r.push(new I(n,u,o[u],!1))}return a=t=function(t){function a(e){(0,_["default"])(this,a);var t=(0,h["default"])(this,(a.__proto__||(0,f["default"])(a)).call(this,e));t.hasBroken=!1,t.rr=function(e,a){t.setState((0,c["default"])({},e.name,new e.whitelistedProxyClass(a)))};for(var n=t.state={},i=0;i<r.length;i++){var o=r[i],s=o.name,l=o.attachConcern(e[s],t.rr);n[s]=l,l||(t.hasBroken=!0)}return t}return(0,v["default"])(a,t),(0,E["default"])(a,[{key:"componentWillReceiveProps",value:function(e){if(!this.hasBroken){for(var t=this.props,a=null,n=0;n<r.length;n++){var i=r[n],o=i.name;if(t[o]!==e[o]){i.detachConcern(t[o],this.rr),a||(a={});var s=i.attachConcern(e[o],this.rr);a[o]=s,s||(this.hasBroken=!0)}}a&&this.setState(a)}}},{key:"componentWillUnmount",value:function(){for(var e=this.props,t=0;t<r.length;t++){var a=r[t];a.detachConcern(e[a.name],this.rr)}}},{key:"_getComponent",value:function(){return O._getComponent.call(this)}},{key:"render",value:function(){return this.hasBroken?null:b["default"].createElement(e,(0,l["default"])({ref:this.setComponent},this.props,this.state))}}]),a}(O.WrapperInterface),t.displayName="State("+(0,N["default"])(e)+")",a};var C=a(5),b=i(C),k=a(80),T=i(k),w=a(247),N=i(w),P=a(1),A=i(P),O=a(239),R=a(476),D=a(1704),x=n(D),I=function(){function e(t,a,n,i){(0,_["default"])(this,e),this.componentName=t,this.name=a,this.isStrong=i;var o=x[""+a[0].toUpperCase()+a.slice(1)+"Proxy"];if(!o)throw new Error('Unknown StateHOC concern type "'+a+'"');this.proxyClass=o,this.whitelistedProxyClass=r(t,o,n)}return(0,E["default"])(e,[{key:"getModel",value:function(e){var t=e instanceof this.proxyClass?e._ProxyState$state:e;return t?t instanceof T["default"]?t:(A["default"].assert(!1,"state-hoc-error",this.componentName+" given invalid object for "+this.name+": "+t)(),null):(A["default"].assert(!1,"state-hoc-error",this.componentName+" was not supplied the "+this.name+" model.")(),null)}},{key:"attachConcern",value:function(e,t){var a=this.getModel(e);if(!a)return null;a.incObservers(!this.isStrong);var n=new this.whitelistedProxyClass(a);return a.mirror.addListener(t,n.proxyBitMask,this,a),n}},{key:"detachConcern",value:function(e,t){var a=this.getModel(e);a&&(a.decObservers(),a.mirror.removeListener(t))}}]),e}()},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{found:!1};if(e===t)return a.found=!0,"";if(e instanceof HTMLImageElement)return e.alt;if(e.nodeType===Node.TEXT_NODE)return e.nodeValue;for(var n=_["default"].formatDelim(e)||"",o="",r=0;r<e.childNodes.length&&(o+=i(e.childNodes[r],t,a),!a.found);)r++;return n?""+n+o+n:o}function o(e,t,a,n,i,r){if(a>n)return-1;var s,l=Math.round((a+n)/2),u=e[l],c=u.offsetLeft-i;if(c>=t)s=r;else{if(c+u.clientWidth>t)return l;s=!r}return s?o(e,t,a,l-1,i,r):o(e,t,l+1,n,i,r)}function r(e,t){for(var a=0,n=e.childNodes,i=0;i<n.length;i++){var o=n[i];if(o===t)break;a+=o.clientWidth}return a}Object.defineProperty(t,"__esModule",{value:!0}),t.EMOJI_SIZE=void 0;var s=a(6),l=n(s),u=a(3),c=n(u),d=a(8),f=n(d),p=a(7),h=n(p),m=a(12),v=n(m),g=a(1462),_=n(g),y=a(21),E=n(y),M=a(466),S=n(M),C=a(78),b=n(C),k=a(5),T=n(k),w=a(46),N=n(w),P=a(117),A=n(P),O=a(37),R=a(484),D=a(118),x=t.EMOJI_SIZE={SMALL:"SMALL",LARGE:"LARGE"},I=4096,L=function(e){function t(){var e,a,n,s;(0,c["default"])(this,t);for(var u=arguments.length,d=Array(u),p=0;u>p;p++)d[p]=arguments[p];return a=n=(0,f["default"])(this,(e=t.__proto__||(0,l["default"])(t)).call.apply(e,[this].concat(d))),n.state={text:(0,D.removeFEOF)(n.props.text),ellipsified:null},n.registeredListener=!1,n.registerResizeListener=function(){n.registeredListener||(n.registeredListener=!0,n.props.listeners.add(window,"resize",n.recompute),n.props.listeners.add(v["default"],"resize",n.recompute))},n.unregisterResizeListener=function(){n.registeredListener&&(n.registeredListener=!1,n.props.listeners.remove(window,"resize",n.recompute),n.props.listeners.remove(v["default"],"resize",n.recompute))},n.containsEmoji=function(){return(0,D.containsEmoji)((n.state.text||"").substring(0,I))},n.recompute=n.props.debounce(function(){n.setState({ellipsified:null},n.ellipsify)},10),n.ellipsifyCheck=function(){return n.containsEmoji()&&n.ellipsify()},n.ellipsify=function(){var e=N["default"].findDOMNode(n);if(e){var t=e.querySelectorAll("img");if(t.length){var a=void 0,s=0;if(a=e.clientWidth){if(a===e.scrollWidth)return;s=0}else{var l=e.parentNode;if(l.clientWidth===l.scrollWidth)return;s=r(l,e),a=l.clientWidth-s}var u=l10n.isRTL()===n.props.dirMismatch,c=o(t,u?a:0,0,t.length-1,u?s:0,u);if(!(0>c)){var d=t[c],f=10;f-=Math.floor(f/4);var p=o(t,u?a-f:f,0,c,u?s:0,u);p>-1&&(d=t[p]),n.setState({ellipsified:i(e,d)})}}}},n.componentWillMount=function(){O.isWebkit&&n.props.ellipsify&&n.containsEmoji()&&n.registerResizeListener()},n.componentDidMount=function(){O.isWebkit&&n.props.ellipsify&&n.props.listeners.uiIdle(n.ellipsifyCheck)},n.componentWillReceiveProps=function(e){var t=e.text,a=(0,D.removeFEOF)(t);n.setState({text:a});var i=n.props.ellipsify;if(O.isWebkit&&i&&a!==n.state.text){var o=(a||"").substring(0,I);(0,D.containsEmoji)(o)?(n.recompute(),n.registerResizeListener()):(n.setState({ellipsified:null}),n.unregisterResizeListener())}},n.render=function(){if(!n.state.text)return null;var e=n.state.ellipsified?n.state.ellipsified:n.state.text,t="inherit"===n.props.direction?null:n.props.direction||"auto",a={className:(0,E["default"])(n.props.className,{emojitext:!n.props.className,ellipsify:!!n.props.ellipsify,"inverse-text-direction":n.props.dirMismatch,"selectable-text":n.props.selectable}),dir:t,title:n.props.titlify?n.state.text:void 0,onClick:n.props.onClick},i=n.props,o=i.element,r=i.formatters,s=n.props.textLimit?n.props.textLimit:1/0;return n.props.ellipsify&&e.length>I&&s>I&&(s=I),T["default"].createElement(o,a,(0,S["default"])(e,r,R.JSXSerializer,void 0,s),n.state.ellipsified||e.length>s?"â€¦":null)},s=a,(0,f["default"])(n,s)}return(0,h["default"])(t,e),t}(T["default"].PureComponent);L.defaultProps={element:"span",emojiSize:x.SMALL,formatters:M.Configuration.EmojiOnly(),textLimit:1/0},t["default"]=(0,b["default"])((0,A["default"])(L))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){switch(t){case"text":return e.type===f["default"].TYPE.CHAT&&"url"!==e.subtype;case"image":return e.type===f["default"].TYPE.IMAGE;case"video":return e.type===f["default"].TYPE.VIDEO&&!e.isGif;case"gif":return e.type===f["default"].TYPE.VIDEO&&e.isGif;case"audio":return e.type===f["default"].TYPE.AUDIO;case"ptt":return e.type===f["default"].TYPE.PTT;case"document":return e.type===f["default"].TYPE.DOCUMENT;case"location":return e.type===f["default"].TYPE.LOCATION;case"vcard":return e.type===f["default"].TYPE.VCARD||e.type===f["default"].TYPE.MULTI_VCARD;case"url":return e.type===f["default"].TYPE.CHAT&&"url"===e.subtype;case void 0:return!1;default:return!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.ChatProxy=void 0;var o=a(24),r=n(o),s=a(493),l=n(s),u=a(2),c=n(u),d=a(462),f=n(d),p=a(474),h=a(491),m=n(h),v=a(97),g=n(v),y=a(243),E=a(481),M=n(E),S=a(476),C=a(5),b=a(14),k=a(1),T=a(1523),w=a(1425),N=a(1482),P=a(1522),A=a(1521),O=a(1483),R=a(61),D=a(12),x=a(47),I=a(31),L=a(79),F=a(15),U=a(32),j=a(22),G=a(486),B=a(469),V=3e5,H={GROUP:"group",BROADCAST:"broadcast",CHAT:"chat"},W={Collection:"Chat",props:{id:"string",t:"number",unreadCount:{type:"number","default":0},archive:"boolean",isReadOnly:"boolean",modifyTag:"number",muteExpiration:{type:"number","default":0},name:"string",notSpam:"boolean",pin:"number"},session:{createdLocally:"boolean",pendingAction:"number",formattedTitle:"string",active:"boolean",pausedTimerId:"number",presenceResendTimerId:"number",recording:"boolean",typing:"boolean",unreadDivider:"object",colors:"object",composeContents:{type:"object","default":function(){return{}}},popupPanels:"object",popupPositionChange:"number",squelch:"number",pendingSeenCount:{type:"number","default":0},markedUnread:"boolean",trusted:"boolean",canSend:"boolean",promises:{type:"object","default":function(){return{}}},ftsCache:{type:"object","default":function(){return{}}},composeQuotedMsg:"object",groupMetadata:"object",presence:"object",mute:"object",contact:"object",ackedProps:{type:"object","default":function(){return{}}}},initialize:function(){if(T.prototype.initialize.call(this),this._addQueue=new m["default"],this._sendQueue=new m["default"],this._promises=null,this.msgs.msgLoadState.contextLoaded=!0,this.isVisible||(this.msgs.msgLoadState.noEarlierMsgs=!0),this.addChild("presence",Store.Presence.gadd(this.id)),this.addChild("mute",Store.Mute.gadd({id:this.id,expiration:this.muteExpiration})),this.addChild("contact",Store.Contact.gadd(this.id)),this.name&&!this.contact.name&&(this.contact.name=this.name),this.listenTo(this.contact,"change:name",this.updateTitle),this.isGroup&&(this.trusted=!0),this.isGroup||this.isBroadcast){var e;this.isBroadcast&&!Store.GroupMetadata.get(this.id)&&(e=!0),this.addChild("groupMetadata",Store.GroupMetadata.gadd(this.id)),this.listenTo(this.groupMetadata,"change:stale",this.updateReadOnly),this.listenTo(this.groupMetadata,"change:trusted change:stale",this.isTrusted),this.listenTo(this.groupMetadata.participants,"add remove reset",this.updateReadOnly),this.listenTo(this.groupMetadata.participants,"change:contact.formattedShortName",this.updateTitle),this.updateReadOnly();var t=this.id;this.listenTo(this,"change:isReadOnly",function(){this.isTrusted(),this.updateCanSend(),Store.ProfilePicThumb.update(t)["catch"](F.WapDrop,_.noop),Store.GroupMetadata.update(t)["catch"](F.WapDrop,_.noop)}),e&&Store.GroupMetadata.update(t)["catch"](F.WapDrop,_.noop)}else this.listenTo(this.presence,"change:isOnline",this._presenceOnlineChanged),this.listenTo(this.contact,"change:isMyContact",this.isTrusted),this.listenTo(Store.Blocklist,"add remove reset",this.updateCanSend);Store.Chat.notSpam[this.id]&&!this.notSpam&&this.sendNotSpam()["catch"](_.noop),Store.Chat.notSpam[this.id]=!!this.notSpam,this.notSpam||this.listenTo(this,"change:notSpam",this.onNotSpamChange),this.updateTitle(),this.isTrusted(),this.updateCanSend(),this.listenTo(this.msgs,"add",this.onNewMsg),this.listenTo(this.msgs,"remove_msgs",this.updateSortTime),this.listenTo(this.msgs,"bulk_add",this.addMediaMsgs),this.listenTo(this,"change:msgs",this.resetMediaMsgs),this._saveAssignedColors=_.debounce(this.saveAssignedColors,1e3),this.listenTo(this,"change:active",this.onActiveUpdate),this.pendingAction=0,this.listenTo(this,"change:pendingAction",this.onPendingActionUpdate),this.listenTo(this,"change:t change:modifyTag",this._clearFtsCache)},derived:{kind:{fn:function(){return j.isGroup(this.id)?H.GROUP:j.isBroadcast(this.id)?H.BROADCAST:j.isUser(this.id)?H.CHAT:void k.log("chat:unknown kind id:"+this.id)()}},isGroup:{fn:function(){return j.isGroup(this.id)}},isBroadcast:{fn:function(){return j.isBroadcast(this.id)}},isUser:{fn:function(){return j.isUser(this.id)}},isPSA:{fn:function(){return j.isPSA(this.id)}},hasUnread:{deps:["unreadCount"],fn:function(){return 0!==this.unreadCount}},isVisible:{deps:["createdLocally","msgs","msgsLength"],fn:function(){return this._isVisibleLatched?!0:j.isStatusV3(this.id)?!1:(this._isVisibleLatched=!this.createdLocally||this.msgs.some(function(e){return e.type!==f["default"].TYPE.E2E_NOTIFICATION}),this._isVisibleLatched)}},previewMessage:{deps:["msgs","msgsChanged"],fn:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&t.type!==f["default"].TYPE.E2E_NOTIFICATION)return t}return this.msgs.last()}}},addPendingAction:function(e){var t=this;if(e.isPending()){var a=function(){t.pendingAction--};e.then(a,a),this.pendingAction++}},addAndSendMsg:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=c["default"].resolve(e),i=this._addQueue.enqueue(n).then(function(e){var a=window.Store.Msg.add(e);return a.waitForPrep().then(function(){return t.msgs.add(a)})}),o=a?i.then(a)["return"](i):i,r=this.sendMsg(o);return[i,r]},sendMsg:function(e){return this._sendQueue.enqueue(e).then(function(e){return window.Store.Msg.send(e)})},onActiveUpdate:function(){this.isGroup&&this.active&&(this.squelch=-1),this.presence.chatActive=this.active},onPendingActionUpdate:function(){this.pendingAction<0&&(k.log("chat:onPendingActionUpdate pendingAction value is invalid")(),this.pendingAction=0)},onNotSpamChange:function(){Store.Chat.notSpam[this.id]=this.notSpam,this.isTrusted(),this.notSpam&&this.stopListening(this,"change:notSpam")},hasMaybeSentMsgToChat:function(){return _.some(this.getAllMsgs(),function(e){return e.isSentByMe})},isTrusted:function(){var e=void 0;return this.isGroup?e=R.supportsFeature(R.F.SPAM)?this.isReadOnly||this.notSpam||this.groupMetadata.isTrusted():this.groupMetadata.isTrusted():this.isBroadcast?e=!0:this.isUser&&(e=R.supportsFeature(R.F.SPAM)?this.notSpam||this.contact.isMyContact:!0),!e&&this.hasMaybeSentMsgToChat()&&(e=!0),this.trusted=e},updateTitle:function(){this.isBroadcast?this.formattedTitle=this.contact.name||this.groupMetadata.participants.map(function(e){return e.contact.formattedShortName}).join(", "):this.isUser?this.formattedTitle=this.contact.getFormattedUser():this.isGroup&&(this.formattedTitle=this.contact.name)},title:function(){return this.isGroup?this.formattedTitle||l10n.t("unknown_subject"):this.formattedTitle},sendExit:function(){var e=this;if(!this.isGroup)return c["default"].reject(new F.ActionError);if(this.promises.sendExit)return this.promises.sendExit;this.promises.sendExit=x.leaveGroup(this.id);var t=new y.ActionType(l10n.t("action_group_exiting")),a=this.promises.sendExit.then(function(e){return 200===e.status?new y.ActionType(l10n.t("action_group_exited")):e.status>=400?new y.ActionType(l10n.t("action_group_exit_failed")):void 0})["catch"](function(e){return k.error("models:chat:sendExit dropped")(e),new y.ActionType(l10n.t("action_group_exit_failed"),l10n.t("action_try_again"),this.sendExit.bind(this))});return D.openToast(C.createElement(y.ActionToast,{id:(0,y.genId)(),initialAction:t,pendingAction:a})),this.promises.sendExit.bind(this).then(function(e){200!==e.status||e._duplicate||this.exit()})["finally"](function(){e.promises.sendExit=null})},canExit:function(){return R.supportsFeature(R.F.GROUP_EXIT)},exit:function(){this.isGroup&&(this.groupMetadata.participants.remove(Store.Conn.me),this.isReadOnly=!0)},sendDelete:function(){var e=this;if(this.promises.sendDelete)return this.promises.sendDelete;var t=this.msgs.last(),a=t?t.id:void 0;this.promises.sendDelete=x.sendConversationDelete(this.id,a);var n,i=this.kind;switch(i){case H.GROUP:n=l10n.t("action_group_deleting");break;case H.BROADCAST:n=l10n.t("action_broadcast_deleting");break;case H.CHAT:n=l10n.t("action_chat_deleting")}n=new y.ActionType(n);var o=this.promises.sendDelete.bind(this).then(function(e){if(200===e.status)switch(i){case H.GROUP:return new y.ActionType(l10n.t("action_group_deleted"));case H.BROADCAST:return new y.ActionType(l10n.t("action_broadcast_deleted"));case H.CHAT:return new y.ActionType(l10n.t("action_chat_deleted"))}else if(e.status>=400)switch(i){case H.GROUP:return new y.ActionType(l10n.t("action_group_delete_failed"));case H.BROADCAST:return new y.ActionType(l10n.t("action_broadcast_delete_failed"));case H.CHAT:return new y.ActionType(l10n.t("action_chat_delete_failed"))}})["catch"](function(e){k.error("models:chat:sendDelete dropped")(e);var t=void 0;switch(i){case H.GROUP:t=l10n.t("action_group_delete_failed");break;case H.BROADCAST:t=l10n.t("action_broadcast_delete_failed");break;case H.CHAT:t=l10n.t("action_chat_delete_failed")}return new y.ActionType(t,l10n.t("action_try_again"),this.sendDelete.bind(this))});return D.openToast(C.createElement(y.ActionToast,{id:(0,y.genId)(),initialAction:n,pendingAction:o})),this.promises.sendDelete.bind(this).then(function(e){if(200===e.status&&!e._duplicate){var a=this.msgs.last();t===a?this["delete"](!0):this.deleteMsgsBeforeMsgInclusive(t)}})["finally"](function(){e.promises.sendDelete=null})},updateCanSend:function(){return this.isReadOnly?this.canSend=!1:this.isUser?this.canSend=!(this.contact.isBlocked()||this.isPSA):this.canSend=!0},canDelete:function(){return R.supportsFeature(R.F.DELETE)},canClear:function(){return R.supportsFeature(R.F.CHAT_CLEAR)},sendClear:function(e){var t=this;if(this.promises.sendClear)return this.promises.sendClear;var a=this.msgs.last(),n=a?a.id:void 0;this.promises.sendClear=x.sendConversationClear(this.id,n,!e);var i=new y.ActionType(l10n.t("action_chat_clearing")),o=this.promises.sendClear.then(function(e){return 200===e.status?new y.ActionType(l10n.t("action_chat_cleared")):e.status>=400?new y.ActionType(l10n.t("action_chat_clear_failed")):void 0})["catch"](function(a){return k.error("models:chat:sendClear dropped")(a),new y.ActionType(l10n.t("action_chat_clear_failed"),l10n.t("action_try_again"),t.sendClear.bind(t,e))});return D.openToast(C.createElement(y.ActionToast,{id:(0,y.genId)(),initialAction:i,pendingAction:o})),this.promises.sendClear.then(function(n){200!==n.status||n._duplicate||t.deleteMsgsBeforeMsgInclusive(a,e)})["finally"](function(){t.promises.sendClear=null})},"delete":function(e){T.prototype["delete"].call(this),Store.Chat.remove(this.id),this.cancelPendingPromises(),this.presence["delete"](),this.mute["delete"](),this.deleteMsgs(),D.clearChat(this),this.groupMetadata&&this.groupMetadata["delete"](),this.mediaMsgs&&this.mediaMsgs["delete"](),this.linkMsgs&&this.linkMsgs["delete"](),this.docMsgs&&this.docMsgs["delete"](),this.starredMsgs&&(this.starredMsgs["delete"](),this.starredMsgs.stopListening(),this.starredMsgs.reset())},isDirty:function(){return 0!==this.unreadCount},resetMediaMsgs:function(){this.mediaMsgs&&(this.mediaMsgs["delete"](),this.mediaMsgs.queryMedia(this)),this.linkMsgs&&(this.linkMsgs["delete"](),this.linkMsgs.queryLinks(this)),this.docMsgs&&(this.docMsgs["delete"](),this.docMsgs.queryDocs(this))},addMediaMsgs:function(e,t){if(e){var a=_.isArray(e)?e:[e],n=[],i=[],o=[];a.forEach(function(e){e.createLinks(),e.isMedia&&n.push(e),e.hasLink&&i.push(e),e.isDoc&&o.push(e)}),this.mediaMsgs&&n.length&&this.mediaMsgs.add(n,t),this.linkMsgs&&i.length&&this.linkMsgs.add(i,t),this.docMsgs&&o.length&&this.docMsgs.add(o,t)}},onNewMsg:function(e){if(e&&"i"!==e.eventType){var t={};if(t.t=e.t,this.promises.updateSortTime&&this.promises.updateSortTime.cancel(),this.archive&&(t.archive=!1),this.promises.setArchive&&this.promises.setArchive.cancel(),e.isSentByMe||(this.presence.handle({id:this.id,participant:e.author,type:"available"}),"a"!==e.eventType&&"d"!==e.eventType||(t.unreadCount=this.unreadCount+1||1)),e.isSentByMeFromWeb?this.setAndKeepPrevious(t,e.promises.sendPromise):this.set(t),!e.isSentByMe)switch(e.eventType){case"d":case"a":"d"===e.eventType&&D.alertNewMsg(e),this.msgs.length<b.MSG_PRELOAD_THRESHOLD&&this.loadEarlierMsgs()["catch"](F.E404,_.noop)["catch"](function(e){k.log("chat:onNewMsg failed")(),k.log(e)()});break;case"s":if("gp2"===e.type&&"add"===e.subtype&&_.head(e.recipients)===Store.Conn.me&&!this.contact.name)return;D.alertNewMsg(e)}}},setPin:function(e,t){var a=this;this.promises.setPin&&this.promises.setPin.cancel();var n=void 0,i=void 0;e?n=Math.round(+new Date/1e3):i=this.pin;var o=x.sendConversationPin(this.id,n,i).cancellable(),r=e?new y.ActionType(l10n.t("action_chat_pinning")):new y.ActionType(l10n.t("action_chat_unpinning"));t=t||(0,y.genId)();var s=o.then(function(n){var i=void 0;return 200===n.status?(i=e?l10n.t("action_chat_pinned"):l10n.t("action_chat_unpinned"),new y.ActionType(i,l10n.t("action_undo"),a.setPin.bind(a,!e,t))):405===n.status?new y.ActionType(l10n.t("action_chat_pin_failed_405")):n.status>=400?e?new y.ActionType(l10n.t("action_chat_pin_failed")):new y.ActionType(l10n.t("action_chat_unpin_failed")):void 0})["catch"](function(n){k.error("models:chat:setPin dropped")(n);var i=e?l10n.t("action_chat_pin_failed"):l10n.t("action_chat_unpin_failed");return new y.ActionType(i,l10n.t("action_try_again"),a.setPin.bind(a,e,t))});return D.openToast(C.createElement(y.ActionToast,{id:t,initialAction:r,pendingAction:s})),this.promises.setPin=o.bind(this).then(function(e){200!==e.status||e._duplicate||(this.pin=n)})["finally"](function(){a.promises.setPin=null})},setArchive:function q(e,t){var a=this;if(this.archive===e)return c["default"].reject(new F.ActionError);if(this.promises.setArchive)return this.promises.setArchive;var n=this.getLastMsgKeyForAction(),i=x.sendConversationArchive(this.id,e,n).cancellable(),o=e?new y.ActionType(l10n.t("action_chat_archiving")):new y.ActionType(l10n.t("action_chat_unarchiving"));
t=t||(0,y.genId)();var r=i.then(function(n){var i=void 0;return 200===n.status?(i=e?l10n.t("action_chat_archived"):l10n.t("action_chat_unarchived"),new y.ActionType(i,l10n.t("action_undo"),a.setArchive.bind(a,!e,t))):n.status>=400?e?new y.ActionType(l10n.t("action_chat_archive_failed")):new y.ActionType(l10n.t("action_chat_unarchive_failed")):void 0})["catch"](function(n){k.error("models:chat:setArchive dropped")(n);var i=e?l10n.t("action_chat_archive_failed"):l10n.t("action_chat_unarchive_failed");return new y.ActionType(i,l10n.t("action_try_again"),a.setArchive.bind(a,e,t))});D.openToast(C.createElement(y.ActionToast,{id:t,initialAction:o,pendingAction:r}));var q=this.promises.setArchive=i.bind(this).then(function(t){200!==t.status||t._duplicate||(this.archive=e)})["finally"](function(){a.promises.setArchive=null});return q.archive=e,q},canPin:function(){if(this.archive)return!1;var e=this.promises&&this.promises.setArchive;return e&&e.archive?!1:R.supportsFeature(R.F.PIN)},canArchive:function(){return this.isBroadcast?R.supportsFeature(R.F.ARCHIVE_BROADCAST):R.supportsFeature(R.F.ARCHIVE)},sendSeen:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;if(this.markedUnread||0===this.unreadCount)return c["default"].resolve();if(!g["default"].available&&e)return this.listenTo(g["default"],"change:available",this.sendSeen),c["default"].resolve();this.stopListening(g["default"],"change:available",this.sendSeen);var t=this.unreadCount-this.pendingSeenCount,a=-1===this.unreadCount&&-1===t;if(0>=t&&!a)return c["default"].resolve();this.disableUnreadAnchor=!0,this.pendingSeenCount=this.unreadCount;var n=this,i=function(){n.pendingSeenCount=n.pendingSeenCount-t,n.pendingSeenCount<0&&(k.error("models:chat:sendSeen unread "+n.unreadCount+" pending: "+n.pendingSeenCount+" delta: "+t)(),n.pendingSeenCount=0)},o=this.lastReceivedKey;return R.gte([0,4])?x.sendConversationSeen(this.id,o,t).bind(this).then(function(e){return i(),200!==e.status||e._duplicate||this.markSeen(t),e})["catch"](F.WapDrop,function(e){i(),k.error("models:chat:sendConversationSeen dropped")()}):(i(),this.markSeen(t),x.sendConversationSeen(this.id,o,t).bind(this).then(function(e){return e})["catch"](F.WapDrop,function(e){k.error("models:chat:sendConversationSeen dropped")()}))},markSeen:function(e){e&&"number"==typeof e?e>0&&e<=this.unreadCount?this.unreadCount=this.unreadCount-e:-1===e&&this.unreadCount<=0&&(this.unreadCount=0):this.unreadCount=0,this.unreadMsgAnchor=void 0,this.markedUnread=!1},markUnread:function(e,t){var a=this;if(e?this.active&&(this.markedUnread=!0):this.markedUnread=!1,this.promises.markUnread)return this.promises.markUnread;this.promises.markUnread=e?this.sendUnseen():this.sendSeen();var n=e?new y.ActionType(l10n.t("action_chat_marking_unread")):new y.ActionType(l10n.t("action_chat_marking_read"));t=t||(0,y.genId)();var i=this.promises.markUnread.then(function(n){if(200===n.status){var i=e?l10n.t("action_chat_marked_unread"):l10n.t("action_chat_marked_read");return new y.ActionType(i,l10n.t("action_undo"),a.markUnread.bind(a,!e,t))}return n.status>=400?e?new y.ActionType(l10n.t("action_chat_mark_unread_failed")):new y.ActionType(l10n.t("action_chat_mark_read_failed")):void 0})["catch"](function(n){var i=e?l10n.t("action_chat_mark_unread_failed"):l10n.t("action_chat_mark_read_failed");return new y.ActionType(i,l10n.t("action_try_again"),a.markUnread.bind(a,e,t))});return D.openToast(C.createElement(y.ActionToast,{id:t,initialAction:n,pendingAction:i})),this.promises.markUnread["finally"](function(){a.promises.markUnread=null})},canMarkUnseen:function(){return R.supportsFeature(R.F.CHAT_MARK_UNSEEN)},sendUnseen:function(){var e=this,t=this.msgs.last(),a=t?t.id:void 0;return x.sendConversationUnseen(this.id,a).then(function(t){return 200===t.status?e.markUnseen():e.markedUnread=!1,t})},markUnseen:function(){this.active&&(this.markedUnread=!0),this.unreadCount=-1},markRecording:function(){if((this.presence.isOnline||this.isGroup)&&!this.recording){var e=this.id;x.sendChatstateRecording(e).then(function(t){t.status>=400&&k.error("models:chat send presence recording error "+e)()})["catch"](F.WapDrop,_.noop),this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),b.PRESENCE_RESEND_WAIT)}this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.recording=!0,this.typing=!1},markComposing:function(){if((this.presence.isOnline||this.isGroup)&&!this.typing){var e=this.id;x.sendChatstateComposing(e).then(function(t){t.status>=400&&k.error("models:chat send presence composing error "+e)()})["catch"](F.WapDrop,_.noop),this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),b.PRESENCE_RESEND_WAIT)}this.typing=!0,this.pausedTimerId&&clearTimeout(this.pausedTimerId),this.pausedTimerId=_.delay(this.markPaused.bind(this),b.SEND_PAUSED_WAIT)},markPaused:function(){if((this.presence.isOnline||this.isGroup)&&(this.typing||this.recording)){var e=this.id;x.sendChatstatePaused(e).then(function(t){t.status>=400&&k.error("models:chat send presence paused error "+e)()})["catch"](F.WapDrop,_.noop)}this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId")),this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.typing=this.recording=!1},_resendPresence:function(){var e=this.id;if(this.recording)x.sendChatstateRecording(e).then(function(t){t.status>=400&&k.error("models:chat send presence resend recording error "+e)()})["catch"](F.WapDrop,_.noop);else{if(!this.typing)return void this.unset("presenceResendTimerId");x.sendChatstateComposing(e).then(function(t){t.status>=400&&k.error("models:chat send presence resend composing error "+e)()})["catch"](F.WapDrop,_.noop)}this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),b.PRESENCE_RESEND_WAIT)},_messageSent:function(){this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId")),this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.typing=!1},_presenceOnlineChanged:function(){this.presence.isOnline?this._resendPresence():this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId"))},handleGroupAction:function(e,t,a){var n;switch(e){case"subject":return void(this.contact.name=a.subject);case"add":case"promote":case"demote":var i="promote"===e;return n=_.map(a.participants,function(e){return{id:e,isAdmin:i}}),void this.groupMetadata.participants.add(n,{merge:!0});case"remove":return n=this.groupMetadata.participants,void _.each(a.participants,function(e){n.remove(e)});case"modify":return;case"invite":return void(a.code?this.groupMetadata.inviteCode=a.code:k.error("model:chat:handleGroupAction:invalid invite code: "+a.code+" for "+this.id)());default:return}},setComposeContents:function(e){this.composeContents=e},preload:function(){1===this.msgs.length&&this.loadEarlierMsgs()["catch"](F.E404,_.noop)["catch"](function(e){k.log("chat:preload failed")(),k.log(e)()})},onEmptyMRM:function(){k.log("models:Chat:removeMsg 0 messages left, querying...")(),this.loadEarlierMsgs()["catch"](F.E404,_.noop)["catch"](function(e){k.log("chat:onEmptyMRM failed")(),k.log(e)()})},loadEarlierMsgs:function(e){return e||(e=this.msgs),e.msgLoadState.noEarlierMsgs?c["default"].resolve():e.msgLoadState.isLoadingEarlierMsgs?e.loadEarlierPromise:this._loadMsgs("before",e).then(function(t){return _.isArray(t)&&t.length<b.PAGE_SIZE&&(e.msgLoadState.noEarlierMsgs=!0),t})},isMostRecentCMC:function(e){return this.msgs===e},loadRecentMsgs:function(e){return e||(e=this.msgs),this.isMostRecentCMC(e)?c["default"].resolve():e.msgLoadState.isLoadingRecentMsgs?e.loadRecentPromise:this._loadMsgs("after",e)},_loadMsgs:function(e,t){var a;a="after"===e?t.last():t.head();var n={};return a?n=a.id.clone():n.remote=this.id,n.count=b.PAGE_SIZE,n.direction=e,this._loadMsgsPromise(a,t,Store.Msg.findQuery(n),e)},_loadMsgsPromise:function(e,t,a,n){"after"===n?t.msgLoadState.isLoadingRecentMsgs=!0:"before"===n?t.msgLoadState.isLoadingEarlierMsgs=!0:"around"===n&&(t.msgLoadState.isLoadingAroundMsgs=!0);var i=this.regCancellablePromise(a)["finally"](function(){var a=e&&e.msgChunk!==t;t.msgLoadState.contextLoaded=!0,a&&(e.msgChunk.msgLoadState.contextLoaded=!0),"after"===n?t.msgLoadState.isLoadingRecentMsgs=!1:"before"===n?t.msgLoadState.isLoadingEarlierMsgs=!1:"around"===n&&(t.msgLoadState.isLoadingAroundMsgs=!1)})["catch"](function(e){return k.error("chat:loadMsgs:error "+e)(),404===e?c["default"].reject(new F.E404):c["default"].reject(e)});return"after"===n?t.loadRecentPromise=i:"before"===n?t.loadEarlierPromise=i:"around"===n&&(t.loadAroundPromise=i),i},getSearchContext:function(e,t){var a=this,n=void 0,i=void 0;e instanceof f["default"]?n=e:e instanceof U&&(i=e);var o=n?n.msgChunk:void 0,r=(0,l["default"])(b.PAGE_SIZE/3*2);if(!o||!o.msgLoadState.contextLoaded){o||(o=new w,this.msgChunks.push(o),n&&o.add(n));var s=n?n.id.clone():i.clone();s.count=r;var u=function(){if(n)return n.msgChunk;var e=Store.Msg.get(i);return e&&e.msgChunk?e.msgChunk:o};this._loadMsgsPromise(n,o,Store.Msg.getContext(s,u),"around").then(function(e){var t=u();t!==o&&a.notifyMsgCollectionMerge(t,o,t);var s=e[0],l=i?Store.Msg.get(i):n;l&&_.isArray(s)&&s.length<r&&(l.msgChunk.msgLoadState.noEarlierMsgs=!0,l.msgChunk!==o&&(o.msgLoadState.noEarlierMsgs=!0))})["catch"](function(){t&&(t.isQuotedMsgAvailable=!1)})}return{collection:o,msg:n,key:i,highlightMsg:!0}},sendStarMsgs:function(e,t){var a=this;return this.promises.sendStarMsgs?this.promises.sendStarMsgs:this.promises.sendStarMsgs=x.sendMessageStarred(this.id,_.map(e,function(e){return e.id}),t).then(function(a){return 200===a.status&&(_.forEach(e,function(e){e.set("star",t)}),t?Store.AllStarredMsgs.add(e):Store.AllStarredMsgs.remove(e)),a})["finally"](function(){a.promises.sendStarMsgs=null})},sendRevokeMsgs:function(e,t){var a=this;return this.promises.sendRevokeMsgs?this.promise.sendRevokeMsgs:this.promises.sendRevokeMsgs=c["default"].all(e.map(function(e){return e.sendRevoke(t)}))["finally"](function(){a.promises.sendRevokeMsgs=null})},sendNotSpam:function(e,t){var a=this;if(!R.supportsFeature(R.F.SPAM))return c["default"].resolve();if(this.notSpam)return c["default"].resolve();if(this.notSpam=!0,this.promises.sendNotSpam)return this.promises.sendNotSpam;if(this.promises.sendNotSpam=x.sendConversationNotSpam(this.id),e){var n=new y.ActionType(l10n.t("action_mark_as_not_spam"));t=t||(0,y.genId)();var i=this.promises.sendNotSpam.then(function(e){return 200===e.status?new y.ActionType(l10n.t("action_marked_as_not_spam")):e.status>=400?new y.ActionType(l10n.t("action_mark_as_not_spam_failed")):void 0})["catch"](function(n){return k.error("models:chat:sendNotSpam dropped")(n),new y.ActionType(l10n.t("action_mark_as_not_spam_failed"),l10n.t("action_try_again"),a.sendNotSpam(e,t))});D.openToast(C.createElement(y.ActionToast,{id:t,initialAction:n,pendingAction:i}))}return this.promises.sendNotSpam["finally"](function(){a.isTrusted(),a.promises.sendNotSpam=null})},sendSpamReport:function(e){var t=this;if(this.promises.sendSpamReport)return this.promises.sendSpamReport;this.promises.sendSpamReport=x.sendSpamReport(this.id);var a=new y.ActionType(l10n.t("action_spam_report"));e=e||(0,y.genId)();var n=this.promises.sendSpamReport.then(function(e){return 200===e.status?new y.ActionType(l10n.t("action_spam_reported")):e.status>=400?new y.ActionType(l10n.t("action_spam_report_failed")):void 0})["catch"](function(a){return k.error("models:chat:sendSpamReport dropped")(a),new y.ActionType(l10n.t("action_spam_report_failed"),l10n.t("action_try_again"),t.sendSpamReport.bind(t,e))});return D.openToast(C.createElement(y.ActionToast,{id:e,initialAction:a,pendingAction:n})),this.promises.sendSpamReport["finally"](function(){t.promises.sendSpamReport=null})},sendDeleteMsgs:function(e){var t=this;return this.promises.sendDeleteMsgs?this.promises.sendDeleteMsgs:this.promises.sendDeleteMsgs=x.sendMessageDelete(this.id,_.map(e,function(e){return e.id}),!0).then(function(t){return 200===t.status&&_.forEach(e,function(e){e["delete"]()}),t})["finally"](function(){t.promises.sendDeleteMsgs=null})},deleteMsgs:function(e,t){var a=this;this.getAllCMCs().forEach(function(n){n.filter(function(e){return!t||i(e,t)}).filter(function(t){return(e||!t.star)&&!t.isPersistent}).forEach(function(e){e["delete"]()}),0===n.length&&n!==a.msgs&&a.removeMsgsCollection(n)}),this.unreadCount=0},deleteMsgsOlderThan:function(e,t,a){var n=this.msgs,o=_.head(n.models);if(o&&!(o.t>=e)){if(o=_.last(n.models),o.t<e)return void this.deleteMsgs(t,a);var r=function(n){return n&&(a&&!i(n,a)||n.star&&!t||n.t>=e||n.isPersistent)};this.deleteMsgsPartial(r)}},deleteMsgsBeforeMsgInclusive:function(e,t){if(e&&this.msgs.get(e.id)){var a=this.msgs.indexOf(e),n=function(e,n){return e.msgChunk===this.msgs&&n>a||t&&e.star||e.isPersistent};this.deleteMsgsPartial(n)}},deleteMsgsPartial:function(e){var t=this,a=this.unreadCount;if(this.getAllCMCs().forEach(function(a){var n=a.filter(function(a,n,i){return!e.apply(t,[a,n,i])});a.remove(n),n.forEach(function(e){e["delete"]()})}),_.clone(this.msgChunks).forEach(function(e){0===e.length&&t.removeMsgsCollection(e)}),this.msgs.length>0){var n=a>this.msgs.length?this.msgs.length:a;this.unreadCount=n,this.msgs.msgLoadState.noEarlierMsgs=!0}},getFirstMsgWithStatus:function(){return _.find(this.msgs.models,function(e){return!e.isNotification&&(e.isSentByMe||e.type===f["default"].TYPE.PTT)})},getFirstMsgFromMe:function(){return _.find(this.msgs.models,function(e){return!e.isNotification&&e.isSentByMe})},getLastReceivedMsg:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&(!t.local||t.ack>0))return t}},getLastMsgKeyForAction:function(){var e=this.msgs.last();return e?!this.lastReceivedKey||e.id.fromMe&&e.local&&0===e.ack?e.id:this.lastReceivedKey:void 0},getLastTimestampMsg:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&"i"!==t.eventTypeFromMsgType())return t}},createMessageFromText:function(e){if(e=_.trim(e),""===e)return null;var t=this.id,a=Store.Conn.me,n=new U({from:a,to:t,id:f["default"].newTag(),participant:void 0,selfDir:"out"}),i={id:n,body:e,type:"chat",subtype:null,t:L.globalUnixTime(),from:a,to:t,self:"out",local:!0,ack:0};return new f["default"](i)},sendMessage:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments[2],n=arguments[3];if(e=_.trim(e),""===e)return c["default"].resolve();this._messageSent();var i=this.id,o=Store.Conn.me,r=new U({from:o,to:i,id:f["default"].newTag(),participant:void 0,selfDir:"out"}),s=a&&a.contextInfo(this.id),l=_.defaults({id:r,body:e,type:"chat",subtype:t&&!_.isEmpty(t)?"url":null,t:L.globalUnixTime(),from:o,to:i,self:"out",local:!0,ack:0},t,s,{mentionedJidList:n}),u=new f["default"](l),d=Store.Msg.send(u);return this.msgs.add(u),d},sendContact:function(e){var t={ack:0,body:B.fromContactModel(e).vcard,from:Store.Conn.me,id:new U({from:Store.Conn.me,to:this.id,id:f["default"].newTag(),participant:void 0,selfDir:"out"}),local:!0,self:"out",subtype:e.formattedName,t:L.globalUnixTime(),to:this.id,type:"vcard",isNewMsg:!0};this.addAndSendMsg(t)},sendContactList:function(e){var t=e.map(B.fromContactModel,B),a={ack:0,from:Store.Conn.me,id:new U({from:Store.Conn.me,to:this.id,id:f["default"].newTag(),participant:void 0,selfDir:"out"}),local:!0,self:"out",t:L.globalUnixTime(),to:this.id,type:"multi_vcard",vcardList:t,isNewMsg:!0};this.addAndSendMsg(a)},forwardMessages:function(e){var t=this,a=this.id,n=this.contact;if(n.isUser&&n.isBlocked())return c["default"].reject(new F.ContactBlocked("Forwarded to contact is blocked",n));var i=[];return c["default"].each(e,function(e){if(e.isMMS)return(0,p.forwardMediaMsg)(e,t);var n=_.omit(e.toJSON(),"quotedMsg"),i=new U({from:Store.Conn.me,to:a,id:f["default"].newTag(),participant:void 0,selfDir:"out"});return _.assign(n,{id:i,from:Store.Conn.me,t:L.globalUnixTime(),to:a,ack:0,participant:void 0,local:!0,self:"out",isNewMsg:!0,star:!1}),t.addAndSendMsg(n)})["return"](i)},updateReadOnly:function(){this.isGroup&&!this.groupMetadata.stale&&(this.isReadOnly=!this.groupMetadata.participants.get(Store.Conn.me)),this.isBroadcast&&this.updateTitle()},sortMsgs:function(e){var t=_.map(e,function(e){var t=e.msgChunk;return{msg:e,chunkT:t.models[0].t,index:t.indexOf(e)}});return _(t).orderBy(["chunkT","index"]).map("msg").value()},_updateAssignedColor:function(){if(this.colors){var e=this.groupMetadata.participants;if(0!==e.size){var t=this.colors,a=_.difference(_.keys(t),e.map("id").map(G));a.forEach(function(e){delete t[e]}),a.length&&this._saveAssignedColors()}}},loadAssignedColors:function(){return this.groupMetadata&&this.listenTo(this.groupMetadata.participants,"remove reset",this._updateAssignedColor),I.getGroupParticipantAssignedColor(this.id)||{}},saveAssignedColors:function(){var e=this.colors;e&&I.setGroupParticipantAssignedColor(this.id,e)},assignedColor:function(e){var t,a=this,n=this.colors||(this.colors=this.loadAssignedColors()),i=G(e);if(t=n[i])return t;var o=function(){var e={};_.forEach(n,function(t,a){e[t]?e[t].push(a):e[t]=[a]});for(var o=Number.POSITIVE_INFINITY,r=1;r<b.NUM_COLORS;r++){if(!e[r]){t=r;break}e[r].length<o&&(o=e[r].length,t=r)}return n[i]=t,a._saveAssignedColors(),{v:t}}();return"object"==typeof o?o.v:void 0},setSubject:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments[1];if(t=t.trim(),!t)return c["default"].reject(new F.ActionError);if(t===this.contact.name)return c["default"].reject(new F.ActionError);var n=x.changeSubject(this.id,t),i=this.contact.name,o=new y.ActionType(l10n.t("action_group_renaming"));a=a||(0,y.genId)();var r=n.then(function(n){return 200===n.status?new y.ActionType(l10n.t("action_group_renamed",{subject:t}),l10n.t("action_undo"),e.setSubject.bind(e,i,a)):n.status>=400?new y.ActionType(l10n.t("action_group_rename_failed")):void 0})["catch"](function(n){return k.error("models:chat:setSubject dropped")(n),new y.ActionType(l10n.t("action_group_rename_failed"),l10n.t("action_try_again"),e.setSubject.bind(e,t,a))});return D.openToast(C.createElement(y.ActionToast,{id:a,initialAction:o,pendingAction:r})),n.then(function(a){200!==a.status||a._duplicate||(e.contact.name=t)})},unstarAll:function(){this.getAllMsgs().forEach(function(e){e&&(e.star=!1)}),Store.AllStarredMsgs.remove(this.getAllMsgs())},constructMediaMsgs:function(e){if(!e)return this.getMediaMsgs();var t=void 0;return this.getMediaMsgs().contains(e)||e.msgChunk===this.msgs?(t=this.getMediaMsgs(),t.hasMediaAfter=!1):t=new N,t.contains(e)||(e.msgChunk?t.add(e.msgChunk.filter(function(e){return e.isMedia})):t.add(e)),t},fts:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments[2];if(1===a){var i=this.ftsCache[e];if(i)return i;var o=Store.Msg.search(e,a,n,this.id);this.ftsCache[e]=o;var r=function(){t.ftsCache[e]=null};return _.delay(r,V),o["catch"](r),o}return Store.Msg.search(e,a,n,this.id)},_clearFtsCache:function(){this.ftsCache={}},updateSortTime:function(){var e=this;this.promises.updateSortTime||(this.promises.updateSortTime=this.regCancellablePromise(c["default"].delay(0)).then(function(){var t=e.getLastTimestampMsg();return t?(e.t=t.t,c["default"].resolve()):e.msgs.msgLoadState.noEarlierMsgs?(e.t=void 0,c["default"].resolve()):e.pendingMsgs?c["default"].resolve():e.loadEarlierMsgs()}).then(function(t){if(t){var a=e.getLastTimestampMsg();e.t=a?a.t:void 0}})["catch"](_.noop)["finally"](function(){e.promises.updateSortTime=void 0}))},removeFromCollection:function(e){e.star&&this.starredMsgs&&this.starredMsgs.remove(e),e.isMedia&&this.mediaMsgs?this.mediaMsgs.remove(e):e.hasLink&&this.linkMsgs?this.linkMsgs.remove(e):e.isDoc&&this.docMsgs&&this.docMsgs.remove(e)},getMediaMsgs:function(){return this.mediaMsgs||(this.mediaMsgs=new N),this.mediaMsgs},getLinkMsgs:function(){return this.linkMsgs||(this.linkMsgs=new P),this.linkMsgs},getDocMsgs:function(){return this.docMsgs||(this.docMsgs=new A),this.docMsgs},getStarredMsgs:function(){var e=this;return this.starredMsgs||(this.starredMsgs=new O,this.starredMsgs.parent=this,this.starredMsgs.add(Store.AllStarredMsgs.filter(function(t){return t.chat===e}))),this.starredMsgs},setAndKeepPrevious:function(e,t){var a=this,n=(0,r["default"])(e);n.forEach(function(e){e in a.ackedProps||(a.ackedProps[e]=a[e])}),t["finally"](function(){n.forEach(function(e){delete a.ackedProps[e]})}),this.set(e)},getAckedPhoneProps:function(){return{wid:this.id,mute:this.mute.expiration,active:this.active,isReadOnly:this.isReadOnly,modifyTag:this.modifyTag,unreadCount:this.unreadCount,archive:"archive"in this.ackedProps?this.ackedProps.archive:this.archive,notSpam:"notSpam"in this.ackedProps?this.ackedProps.notSpam:this.notSpam,pin:"pin"in this.ackedProps?this.ackedProps.pin:this.pin}},regCancellablePromise:function(e){var t=this;return this._promises||(this._promises=[]),this._promises.push(e),e.cancellable()["finally"](function(){t._promises=_.without(t._promises,e),0===t._promises.length&&(t._promises=null)})},hasPendingPromises:function(){return this._promises&&this._promises.length>0},cancelPendingPromises:function(){this.hasPendingPromises()&&(this._promises.forEach(function(e){e.cancel()}),this._promises=null)}},z=(0,S.genMirrorMask)(W),Y=T.extend(W,{mirrorMask:z});Y.KIND=H,t["default"]=Y;t.ChatProxy=(0,M["default"])(W,z)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(e.dataTransfer){try{if(!e.dataTransfer.dropEffect)return}catch(e){return}e.dataTransfer.effectAllowed&&(e.nativeEvent.dataTransfer.dropEffect="copy")}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(6),r=n(o),s=a(3),l=n(s),u=a(4),c=n(u),d=a(8),f=n(d),p=a(7),h=n(p),m=a(21),v=n(m),g=a(5),_=n(g),y=function(e){function t(){var e,a,n,o;(0,l["default"])(this,t);for(var s=arguments.length,u=Array(s),c=0;s>c;c++)u[c]=arguments[c];return a=n=(0,f["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(u))),n.state={isDragging:!1},n.onDragOver=function(e){e.preventDefault(),n.isDragDropDrawer()&&(i(e),n.state.isDragging||(n.props.onDragOver&&n.props.onDragOver(e),n.setState({isDragging:!0})))},n.onDrop=function(e){e.preventDefault(),e.stopPropagation(),n.setState({isDragging:!1}),n.props.onDrop&&n.props.onDrop(e)},n.onDragLeave=function(e){e.preventDefault(),e.stopPropagation(),n.state.isDragging&&(n.setState({isDragging:!1}),n.props.onDragLeave&&n.props.onDragLeave(e))},o=a,(0,f["default"])(n,o)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"isDragDropDrawer",value:function(){return this.props.onDragOver&&this.props.onDragLeave&&this.props.onDrop}},{key:"render",value:function(){var e=this.props,t=e.children,a=e.className,n=this.isDragDropDrawer()?_["default"].createElement("div",{key:"mask",className:"drag-drop-mask",style:this.state.isDragging?{}:{display:"none"},onDragLeave:this.onDragLeave,onDrop:this.onDrop}):null;return _["default"].createElement("div",{className:(0,v["default"])("drawer",a),onDragOver:this.onDragOver},n,t)}}]),t}(g.PureComponent);t["default"]=y},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(62),o=n(i),r=a(98),s=n(r),l=a(5),u=n(l),c=a(21),d=n(c),f=function(e){var t=e.children,a=e.classes,n=e.info,i=e.wide,r=(0,s["default"])(e,["children","classes","info","wide"]),l=(0,d["default"])("drawer-body",a,{"drawer-body-info":n,"drawer-body-wide":i});return u["default"].createElement("div",(0,o["default"])({className:l},r),t)};t["default"]=f},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.DRAWER_HEADER_TYPE=void 0;var i=a(5),o=n(i),r=a(468),s=n(r),l=a(21),u=n(l),c=a(1440),d=a(115),f=n(d),p=t.DRAWER_HEADER_TYPE={SMALL:"small",LARGE:"large",POPUP:"popup",OFFSET:"offset"},h=function(e){var t=e.title,a=e.onBack,n=e.onCancel,i=e.type,r=e.children,l=e.menu,d=null;if(t){var h=(0,u["default"])("icon btn-close-drawer",{"icon-back":i===p.SMALL,"icon-back-light":i!==p.SMALL}),m=a?o["default"].createElement("span",{className:h,"data-a8n":s["default"].key("btn-closer-drawer"),onClick:a}):null,v=(0,u["default"])("icon btn-close-drawer",{"icon-x":i===p.SMALL,"icon-x-light":i!==p.SMALL}),g=n?o["default"].createElement("span",{className:v,"data-a8n":s["default"].key("btn-closer-drawer"),onClick:n}):null,_=(0,u["default"])("drawer-title",{"pane-header":i===p.LARGE}),y=l?o["default"].createElement("span",{className:"pane-list-controls"},o["default"].createElement(c.MenuBar,{key:"drawer-header"},o["default"].createElement(f["default"],{transitionName:"btn"},l))):null;d=o["default"].createElement("div",{className:_},o["default"].createElement("div",{className:"drawer-title-action"},m,g),o["default"].createElement("span",{"data-a8n":s["default"].key(s["default"]),className:"drawer-title-body"},t),y)}var E=(0,u["default"])({"drawer-header":i===p.LARGE,"drawer-header-small":i===p.SMALL,"drawer-header-offset":i===p.OFFSET,"drawer-header-popup":i===p.POPUP});return o["default"].createElement("header",{className:E},d,r)};t["default"]=h},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(62),o=n(i),r=a(2),s=n(r),l=a(6),u=n(l),c=a(3),d=n(c),f=a(4),p=n(f),h=a(8),m=n(h),v=a(7),g=n(v);t["default"]=function(e){var t,a;return a=t=function(t){function a(){var e,t,n,i;(0,d["default"])(this,a);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return t=n=(0,m["default"])(this,(e=a.__proto__||(0,u["default"])(a)).call.apply(e,[this].concat(r))),n.isUnmounted=!1,n.rejectOnUnmount=function(){return n.rejectPromise?n.rejectPromise:(n.rejectPromise=new s["default"](function(e,t){n.rejector=t}),n.rejectPromise["catch"](b["default"].noop),n.isUnmounted&&n.rejector(new S["default"].Unmount),n.rejectPromise)},i=t,(0,m["default"])(n,i)}return(0,g["default"])(a,t),(0,p["default"])(a,[{key:"componentWillUnmount",value:function(){this.isUnmounted=!0,this.rejectPromise&&this.rejector(new S["default"].Unmount)}},{key:"_getComponent",value:function(){return E._getComponent.call(this)}},{key:"render",value:function(){return y["default"].createElement(e,(0,o["default"])({ref:this.setComponent,rejectOnUnmount:this.rejectOnUnmount},this.props))}}]),a}(E.WrapperInterface),t.displayName="Promise("+(0,T["default"])(e)+")",a};var _=a(5),y=n(_),E=a(239),M=a(15),S=n(M),C=a(13),b=n(C),k=a(247),T=n(k)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(1423),m=n(h),v=a(1433),g=(n(v),a(161)),_=n(g),y=a(1402),E=n(y),M=a(1561),S=n(M),C=a(12),b=n(C),k=a(1478),T=n(k),w=a(21),N=a(5),P=a(22),A=a(15),O=a(244),R={SMALL:"SMALL",MEDIUM:"MEDIUM",LARGE:"LARGE",AUTO:"AUTO",NONE:"NONE"},D={LOW:"LOW",HIGH:"HIGH"},x=function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));a.state={loading:!0},a.onLoad=function(e){a.state.loading&&a.setState({loading:!1}),a.props.onLoad&&a.props.onLoad()},a.onError=function(e){e instanceof A.ServerStatusError&&a.props.profilePicThumb.onError(e.status),a.state.loading&&a.setState({loading:!1})},a.onProfilePic=function(e){a.props.profilePicThumb.imgFull&&a.props.onProfile&&e&&(e.stopPropagation(),e.preventDefault(),a.props.onProfile&&a.refs.avatar&&a.props.onProfile(a.refs.avatar))};var n=e.profilePicThumb.imgFull;return n&&O.isCached(n)&&(a.state={loading:!1}),a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.profilePicThumb,a=e.loader,n=this.state.loading,i=w("avatar-image",{"is-loaded":!n}),o=void 0;a&&n&&(t.stale||t.imgFull)&&(o=N.createElement("div",{className:"avatar-spinner-container"},N.createElement(_["default"],{size:50,stroke:3})));var r=t.imgFull?{cursor:"pointer"}:{};return N.createElement("div",{className:"avatar-body",onClick:this.onProfilePic,onMouseDown:this.onProfilePic,style:r,ref:"avatar"},N.createElement(m["default"],{src:t.imgFull,hasPrivacyChecks:!0,crossOrigin:!1,className:i,onLoad:this.onLoad,onError:this.onError}),o)}}]),t}(N.PureComponent);x.CONCERNS={profilePicThumb:["imgFull","stale"]};var I=(0,E["default"])(x),L=function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));a.state={loading:!0},a.onLoad=function(e){a.state.loading&&a.setState({loading:!1}),a.props.onLoad&&a.props.onLoad()},a.onError=function(e){e instanceof A.ServerStatusError&&a.props.profilePicThumb.onError(e.status),a.state.loading&&a.setState({loading:!1})},a.onProfilePic=function(e){a.props.profilePicThumb.img&&a.props.onProfile&&e&&(e.stopPropagation(),e.preventDefault(),a.props.onProfile&&a.refs.avatar&&a.props.onProfile(a.refs.avatar))};var n=e.profilePicThumb.img;return n&&O.isCached(n)&&(a.state={loading:!1}),a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.profilePicThumb,a=e.loader,n=this.state.loading,i=w("avatar-image",{"is-loaded":!n}),o=void 0;a&&n&&(t.stale||t.img)&&(o=N.createElement("div",{className:"avatar-spinner-container"},N.createElement(_["default"],{size:50,stroke:3})));var r=t.img?{cursor:"pointer"}:{};return N.createElement("div",{className:"avatar-body",onClick:this.onProfilePic,onMouseDown:this.onProfilePic,style:r,ref:"avatar"},N.createElement(m["default"],{src:t.img,hasPrivacyChecks:!0,crossOrigin:!1,className:i,onLoad:this.onLoad,onError:this.onError}),o)}}]),t}(N.PureComponent);L.CONCERNS={profilePicThumb:["img","stale"]};var F=(0,E["default"])(L),U=function(e){switch(e){case R.SMALL:return 49;case R.MEDIUM:return 100;case R.LARGE:return 200;case R.NONE:return;default:return e}},j=function(e){var t=e.id,a=e.size,n=e.quality,i=e.className,o=e.loader,r=e.onClick,s=e.onLoad,l=e.profileClick,u=e.quoted;a=a||R.SMALL,n=n||D.LOW;var c={height:U(a),width:U(a)};r&&(c.cursor="pointer");var d=w("avatar",i,{"icon-user-default":P.isUser(t),"icon-user-default-square":P.isUser(t)&&u,"icon-group-default":P.isGroup(t),"icon-broadcast-default":P.isBroadcast(t),"icon-psa-default":P.isPSA(t)}),f=function(e){var a=function(t){t(e)},n=Store.Contact.get(t);b["default"].openModalMedia(N.createElement(T["default"],{contact:n,profilePicThumb:n.profilePicThumb,animateBorderRadius:!0,getZoomNode:a}),"profile-viewer")},p=function(){var e=null,a=Store.ProfilePicThumb.get(t);return a&&(e=n===D.HIGH?N.createElement(I,{profilePicThumb:a,loader:o,onLoad:s,onProfile:l?f:void 0}):N.createElement(F,{profilePicThumb:a,loader:o,onLoad:s,onProfile:l?f:void 0})),N.createElement("div",{className:d,style:c,onClick:r},e)};return N.createElement(S["default"],{id:t,onComplex:p},N.createElement("div",{className:d,style:c,onClick:r}))};e.exports=j,e.exports.Size=R,e.exports.Quality=D},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1),g=n(v),_=a(13),y=n(_),E=a(115),M=n(E),S=a(21),C=n(S),b=a(96),k=n(b),T=a(240),w=n(T),N=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={_stack:[],_transition:"default",_activeKey:0},n.push=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.props.pushTransition;n.setState({_stack:n.state._stack.concat(e),_transition:t,_activeKey:++n.state._activeKey})},n.pop=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.popTransition,t=y["default"].dropRight(n.state._stack);
t.length?n.setState({_stack:t,_transition:e,_activeKey:--n.state._activeKey}):n.end()},n.end=function(e){n.context.uim.uie.requestDismiss(e)},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this,t=this.state,a=t._stack,n=t._transition,i=t._activeKey,o=y["default"].last(a);g["default"].assert(!!o,"empty-flow",o)(),o=m["default"].createElement(w["default"],{displayName:"FlowDrawer"+i,key:i,escapable:!0,requestDismiss:function(){return e.pop()}},o);var r=(0,C["default"])("flow-drawer-container");return m["default"].createElement(M["default"],{transitionName:n,className:r},this.props.removeTopDrawer?o:a)}}]),t}(h.Component);N.contextTypes={uim:m["default"].PropTypes.instanceOf(k["default"])},N.defaultProps={removeTopDrawer:!0,pushTransition:"flow-transition-drawer-push",popTransition:"flow-transition-drawer-pop"},t["default"]=N},function(e,t,a){"use strict";function n(e,t){this.list=e,this.index=-1,this.value=void 0,this.getter=t||function(e){return e}}var i=a(65);_.assign(n.prototype,i,{init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1,a=void 0,n=void 0;if(this.list=e,this.value){if(_.isEmpty(e))return void this.unset();if(a=_.indexOf(e,this.value),a>-1){if(a===this.index)return;n=!0,t=!1}else a=t&&this.index>-1?Math.min(Math.max(this.index,0),e.length-1):-1,n=a>-1;this.set(a,t,n)}},unset:function(){this.value&&this.trigger(this.getter(this.value),!1),this.value=void 0,this.index=-1},reset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;this.index<0||this.value&&this.trigger(this.getter(this.value),"focus",e)},set:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!0;if(this.list.length){var n=Math.min(Math.max(e,-1),this.list.length-1),i=this.value,o=n>-1?this.list[n]:void 0;o?(this.trigger(this.getter(o),t?"focus":"select"),this.value=o):a&&(this.value=void 0),a&&i&&i!==o&&this.trigger(this.getter(i),!1),this.index=n}},getVal:function(){return this.value},setVal:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!0,a=_.indexOf(this.list,e);a>-1?this.set(a,t):(this.unset(),this.value=e)},setFirst:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;_.isEmpty(this.list)||this.set(0,e)},setLast:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;_.isEmpty(this.list)||this.set(this.list.length-1,e)},setPrev:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;_.isEmpty(this.list)||this.set(this.prev(),e)},setNext:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;_.isEmpty(this.list)||this.set(this.next(),e)},prev:function(){return _.isEmpty(this.list)?-1:-1===this.index?-1:this.index-1},next:function(){return _.isEmpty(this.list)?-1:Math.min(this.index+1,this.list.length-1)}}),e.exports=n},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(62),o=n(i),r=a(98),s=n(r),l=a(161),u=n(l),c=a(1403),d=n(c),f=a(5),p=a(21),h=function(e){var t=e.className,a=p("empty-icon",t);return f.createElement("div",{className:"empty-icon-container"},f.createElement("span",{className:a}))},m=function(e){var t=e.icon,a=e.title,n=e.text,i=e.className,r=e.children,l=(0,s["default"])(e,["icon","title","text","className","children"]),u=a?f.createElement("div",{className:"empty-title"},a):null,c=n?f.createElement(d["default"],{element:"div",className:"empty-text",text:n}):null,h=p("empty",i);return f.createElement("div",(0,o["default"])({className:h},l),t,u,c,r)},v=function(){var e=f.createElement(h,{className:"icon-empty-blocked"});return f.createElement(m,{icon:e,title:l10n.t("blocked_empty"),text:l10n.t("add_blocked_description")})},g=function(){var e=f.createElement(h,{className:"icon-empty-archived"});return f.createElement(m,{icon:e,title:l10n.t("archived_empty")})},_=function(){return f.createElement(m,{className:"empty-top",text:l10n.t("search_no_chats_or_contacts")})},y=function(){return f.createElement(m,{className:"empty-top",text:l10n.t("searching_chats_contacts_messages")})},E=function(){return f.createElement(m,{className:"empty-top",text:l10n.t("searching_messages")})},M=function(){return f.createElement(m,{className:"empty-top",text:l10n.t("search_no_contacts")})},S=function(){return f.createElement(m,{className:"empty-top",text:l10n.t("search_no_groups")})},C=function(){return f.createElement(m,{className:"empty-top",text:l10n.t("search_no_messages")})},b=function(){return f.createElement(m,{text:l10n.t("no_chats")})},k=function(){return f.createElement(m,{text:l10n.t("no_contacts")})},T=function(){return f.createElement(m,{text:l10n.t("no_groups")})},w=function(e){return f.createElement(m,{className:"empty-top",text:l10n.t("chat_search_prompt",{chatName:e})})},N=void 0;N=function(){return f.createElement(m,{text:l10n.t("all_chats_archived")})};var P=function(){return f.createElement(m,{text:l10n.t("no_starred_messages")})},A=function(){return f.createElement(m,{text:l10n.t("no_media")})},O=function(){return f.createElement(m,{text:l10n.t("no_links")})},R=function(){return f.createElement(m,{text:l10n.t("no_docs")})},D=function(){return f.createElement(m,{text:l10n.t("image_search_prompt")})},x=function(){return f.createElement(m,{text:l10n.t("searching_images")})},I=function(){return f.createElement(m,{text:l10n.t("image_search_no_results")})},L=function(){return f.createElement(m,null,f.createElement(u["default"],{size:50,stroke:4}))},F=function(e){var t=e.text;return f.createElement(m,null,f.createElement(u["default"],{size:50,stroke:4,className:"empty-spinner",muted:!0}),f.createElement(d["default"],{element:"div",className:"empty-text",text:t}))};e.exports={Blocked:v,Archived:g,Search:_,SearchContacts:M,SearchGroups:S,SearchMessages:C,ListChats:b,ListContacts:k,ListGroups:T,AllArchived:N,StarredMsgs:P,MediaMsgs:A,LinkMsgs:O,DocMsgs:R,Loading:L,LoadingWithText:F,Searching:y,SearchingMessages:E,BeforeSearchMessages:w,BeforeImageSearch:D,SearchingImages:x,ImageSearchEmpty:I}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return t?e+" Â· "+l10n.t("status_v3"):e}Object.defineProperty(t,"__esModule",{value:!0});var o=a(6),r=n(o),s=a(3),l=n(s),u=a(4),c=n(u),d=a(8),f=n(d),p=a(7),h=n(p),m=a(5),v=n(m),g=a(1419),_=n(g),y=a(1402),E=n(y),M=a(1403),S=n(M),C=a(462),b=(n(C),a(241)),k=(n(b),a(12)),T=n(k),w=a(22),N=n(w),P=a(21),A=n(P),O=a(1),R=n(O),D=function(e){function t(){var e,a,n,i;(0,l["default"])(this,t);for(var o=arguments.length,s=Array(o),u=0;o>u;u++)s[u]=arguments[u];return a=n=(0,f["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(s))),n.onClick=function(){Store.Chat.find(n.props.msg.sender).then(function(e){T["default"].openChatFromUnread(e).then(function(t){t&&T["default"].focusChatTextInput(e)})})},i=a,(0,f["default"])(n,i)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.msg,a=e.chat,n=e.contact,o=e.quoted,r=e.disableClick,s=e.displaySelf,l=e.className,u=a||t.chat;R["default"].assert(u,"author-with-no-chat")();var c=u?u.assignedColor(t.sender):1,d=(0,A["default"])("author color-"+c,l,{"bubble-quoted-author":t.quotedMsg&&!o}),f=r?null:this.onClick,p=r?null:"text-clickable",h=void 0;return s?h=v["default"].createElement(S["default"],{text:i(l10n.t("web_you"),t.isStatusV3)}):n.name?(h=[v["default"].createElement(S["default"],{text:i(n.name,t.isStatusV3),className:(0,A["default"])("author-name",p),key:"author",onClick:f})],n.isVerified&&h.push(v["default"].createElement("span",{key:"verified",className:"icon-psa-verified"}))):(h=[v["default"].createElement("span",{className:(0,A["default"])("author-number",p),key:t.id+"-number",onClick:f},i(N["default"].formattedUser(n.id),t.isStatusV3))],t.isStatusV3||h.push(v["default"].createElement(S["default"],{className:(0,A["default"])("author-screen-name",p),key:t.id+"-push-name",onClick:f,direction:"auto",ellipsify:!0,text:n.notifyName}))),v["default"].createElement("div",{className:d},v["default"].createElement(_["default"],{className:"author-body"},h))}}]),t}(v["default"].PureComponent);D.CONCERNS={msg:["sender","chat","type","isLive","isStatusV3","id","quotedMsg"],contact:["id","name","isVerified","notifyName"]},t["default"]=(0,E["default"])(D)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1419),g=n(v),_=a(1614),y=n(_),E=a(1402),M=n(E),S=a(462),C=n(S),b=a(21),k=n(b),T=a(79),w=n(T),N=a(12),P=n(N),A=a(61),O=n(A),R=C["default"].TYPE,D=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.openInfoDrawer=function(){P["default"].msgInfoDrawer((0,E.unproxy)(n.props.msg))},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props.msg,t=void 0,a=void 0,n=e.broadcast||e.star?(e.type===R.IMAGE||e.type===R.VIDEO)&&!e.caption:null;if(e.broadcast){var i=(0,k["default"])("icon-s",{"icon-broadcast-light":n,"icon-broadcast":!n});t=m["default"].createElement("span",{className:i})}if(e.star){var o=(0,k["default"])("icon-s",{"icon-star-light":n,"icon-star":!n&&e.isSentByMe,"icon-star-in":!n&&!e.isSentByMe});a=m["default"].createElement("span",{className:o})}var r=e.isSentByMe&&e.type!==C["default"].TYPE.REVOKED?m["default"].createElement(y["default"],{msg:this.props.msg}):null,s=e.isSentByMe&&O["default"].supportsFeature(O["default"].F.MESSAGE_INFO)&&e.type!==C["default"].TYPE.REVOKED;return m["default"].createElement("div",{className:s?"message-meta text-clickable":"message-meta",onClick:s?this.openInfoDrawer:null},a,t,m["default"].createElement(g["default"],null,m["default"].createElement("span",{className:"message-datetime"},e.t?w["default"].timestampStr(e.t):null)),r)}}]),t}(m["default"].PureComponent);D.CONCERNS={msg:["t","isSentByMe","type","broadcast","star","caption"]},t["default"]=(0,M["default"])(D)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){e.preventDefault()}Object.defineProperty(t,"__esModule",{value:!0});var o=a(473),r=n(o),s=a(6),l=n(s),u=a(3),c=n(u),d=a(4),f=n(d),p=a(8),h=n(p),m=a(7),v=n(m),g=a(5),_=n(g),y=a(46),E=n(y),M=a(116),S=n(M),C=a(468),b=n(C),k=a(21),T=n(k),w=a(96),N=n(w),P=a(13),A=n(P),O=a(78),R=n(O),D=a(239),x=function(e){function t(){var e,a,n,i;(0,c["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,h["default"])(this,(e=t.__proto__||(0,l["default"])(t)).call.apply(e,[this].concat(r))),n.state={hover:!1,focus:!1},n.onWindowFocus=function(e){n.active&&n.onFilePick()},n.onMouseEnter=function(){n.setState({hover:!0})},n.onMouseLeave=function(){n.setState({hover:!1})},n.onFocus=function(){n.setState({focus:!0})},n.onBlur=function(){n.setState({focus:!1})},n.onAction=function(e){if(e.isTrusted&&!e.repeat){var t=n.props,a=t.action,i=t.mimes;if(a){var o=a(e);if(i)return void(n.active=!0);var r=n.context.uim;r&&(o===!1&&r.pop(!1,!1),r.uie.requestDismiss())}}},n.onFilePick=function(e){if(n.props.onFilePick){n.props.onFilePick(e);var t=n.context.uim;t&&t.uie.requestDismiss()}},i=a,(0,h["default"])(n,i)}return(0,v["default"])(t,e),(0,f["default"])(t,[{key:"triggerInput",value:function(){if(this.filePicker){var e=E["default"].findDOMNode(this.filePicker);e.click()}}},{key:"componentWillMount",value:function(){this.props.mimes&&this.props.listeners.add(window,"focus",this.onWindowFocus)}},{key:"render",value:function(){var e=this.props,t=e.children,a=e.tooltip,n=e.mimes,o=this.state,r=o.hover,s=o.focus,l=(r||s)&&a?a:null,u=n?_["default"].createElement("input",{accept:n,ref:(0,D.GetRef)("filePicker",this),type:"file",multiple:!0,style:{display:"none"},onClick:function(e){return e.stopPropagation()},onChange:this.props.onFilePick}):null,c=A["default"].isString(t)?_["default"].createElement("a",{className:"ellipsify",title:t},t):t,d={enter:this.onAction},f=(0,T["default"])("menu-item menu-shortcut",{"highlighted-menu-item":r||s});return _["default"].createElement(S["default"],{component:"li",className:f,handlers:d,"data-a8n":b["default"].key(this.props.a8n),onContextMenu:i,onMouseDown:i,onClick:this.onAction,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onFocus:this.onFocus,onBlur:this.onBlur},c,l,u)}}]),t}(_["default"].PureComponent);x.contextTypes={uim:_["default"].PropTypes.instanceOf(N["default"])};var I=function(e){function t(){return(0,c["default"])(this,t),(0,h["default"])(this,(t.__proto__||(0,l["default"])(t)).apply(this,arguments))}return(0,v["default"])(t,e),(0,f["default"])(t,[{key:"triggerInput",value:function(){(0,r["default"])(t.prototype.__proto__||(0,l["default"])(t.prototype),"getComponent",this).call(this).triggerInput()}}]),t}((0,R["default"])(x));t["default"]=I},function(e,t,a){"use strict";function n(e,t){this.list=e,this.selected=_.reduce(e,function(e,t,a){return e[a]=!1,e},{}),this.getter=t||function(e){return e}}var i=a(65);_.assign(n.prototype,i,{init:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!_.isEmpty(this.selected)){if(_.isEmpty(t))return void this.unsetAll();var a=_.reduce(t,function(t,a,n){var i=e.list.indexOf(a);t[n]=i>-1&&e.selected[i]},{});this.selected=a,this.list=t}},unsetAll:function(){var e=this;_.forEach(this.selected,function(t,a){t&&e.set(a,!1)})},reset:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;_.forEach(this.selected,function(a,n){a&&e.trigger(e.getter(e.list[n]),!0,!0,t)})},set:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!0;if(this.list.length){var n=Math.min(Math.max(e,-1),this.list.length-1),i=n>-1?this.list[n]:void 0;i&&(this.selected[n]&&!t||!this.selected[n]&&t)&&(this.selected[n]=t,this.trigger(this.getter(i),t,a))}},setVal:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!0,n=_.indexOf(this.list,e);-1===n&&(n=this.list.length,this.list.push(e),this.selected[n]=!1),this.set(n,t,a)},setFirst:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;_.isEmpty(this.list)||this.set(0,!0,e)},setLast:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;_.isEmpty(this.list)||this.set(this.list.length-1,!0,e)},getSelected:function(){var e=this;return _.reduce(this.list,function(t,a,n){return e.selected[n]&&t.push(a),t},[])},isSelected:function(e){return!!this.selected[this.list.indexOf(e)]}}),e.exports=n},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=t.DEFAULT_HEIGHT=void 0;var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(78),m=n(h),v=a(1533),g=n(v),_=a(5),y=a(46),E=a(21),M=a(12),S=a(13),C=a(1568),b=t.DEFAULT_HEIGHT=72,k="data-list-scroll-container",T="data-list-scroll-offset",w=function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));return a.scrollTop=0,a.offsetTop=0,a.bodyHeight=0,a.pointerEvents=!0,a.enablePointerEvents=S.debounce(function(){M.setUiBusy(!1),a.pointerEvents=!1,y.findDOMNode(a.refs.viewport).style.pointerEvents="auto",a.props.onPointerEventsOn&&a.props.onPointerEventsOn()},150),a.onScroll=function(){a.animationFrame?a.hanging=!0:(a.hanging=!1,a.animationFrame=window.requestAnimationFrame(a._onScroll))},a._onScroll=function(){var e=a.state.scrollTarget;a.disablePointerEvents(),e&&(a.scrollTop=e.scrollTop);var t=a.getPhysicalIndexes(a.props),n=t.firstPhysicalIndex,i=t.lastPhysicalIndex,o=void 0;for(o=n;i>o;o++){var r=a.props.data[o].key;if(!a.renderedItems[r])break}return o===i?(a.animationFrame=void 0,void(a.hanging&&a.onScroll())):void a.setState({firstPhysicalIndex:n,lastPhysicalIndex:i},function(){a.animationFrame=void 0,a.hanging&&a.onScroll()})},a.state={scrollTarget:void 0,firstPhysicalIndex:0,lastPhysicalIndex:0},a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillReceiveProps",value:function(e){if(void 0!==e.scrollTop&&this.state.scrollTarget&&(this.state.scrollTarget.scrollTop=e.scrollTop),this.props.scrollTarget!==e.scrollTarget||this.props.height!==e.height||this.props.data.length!==e.data.length)this.initialize(e);else{var t=this.state,a=t.firstPhysicalIndex,n=t.lastPhysicalIndex,i=this.getFirstVisibleIndex(e.height);(a>i||i>n)&&this.setState(this.getPhysicalIndexes(e))}}},{key:"componentDidMount",value:function(){var e=this;this.props.listeners.addAndRun(window,"resize",function(){return e.initialize()})}},{key:"componentWillUnmount",value:function(){this.cancelScroll(),this.enablePointerEvents.cancel()}},{key:"initialize",value:function(e){var t=e?e:this.props;if(this.cancelScroll(),this.state.scrollTarget){var a=g["default"]?{passive:!0}:void 0;this.props.listeners.remove(this.state.scrollTarget,"scroll",this.onScroll,a)}for(var n=y.findDOMNode(this),i=void 0,o=n,r=0;5>r;r++){if(o instanceof HTMLElement&&o.hasAttribute(k)){i=o;break}o=o&&o.parentNode}var s=void 0;o=n;for(var l=0;r>l;l++){if(o instanceof HTMLElement&&o.hasAttribute(T)){s=o;break}o=o&&o.parentNode}if(!i)throw new Error("list scroll container not found");var u=g["default"]?{passive:!0}:void 0;this.props.listeners.add(i,"scroll",this.onScroll,u),this.scrollTop=i.scrollTop,this.offsetTop=s?s.offsetTop:0,this.bodyHeight=i.clientHeight;var c=this.getPhysicalIndexes(t),d=c.firstPhysicalIndex,f=c.lastPhysicalIndex;return this.renderedItems={},this.setState({scrollTarget:i,firstPhysicalIndex:d,lastPhysicalIndex:f}),i}},{key:"getFirstVisibleIndex",value:function(e){return Math.floor(Math.max(this.scrollTop-this.offsetTop,0)/e)}},{key:"getPhysicalIndexes",value:function(e){var t=this.getFirstVisibleIndex(e.height),a=Math.max(this.offsetTop-this.scrollTop,0),n=Math.max(this.bodyHeight-a,0),i=Math.min(Math.ceil(n/e.height),e.data.length),o=Math.max(t-e.extraItems,0),r=Math.min(t+i+e.extraItems,e.data.length);return{firstPhysicalIndex:o,lastPhysicalIndex:r}}},{key:"cancelScroll",value:function(){this.animationFrame&&(window.cancelAnimationFrame(this.animationFrame),this.animationFrame=void 0,this.hanging=!1)}},{key:"disablePointerEvents",value:function(){this.enablePointerEvents(),this.pointerEvents||(this.props.onPointerEventsOff&&this.props.onPointerEventsOff(),y.findDOMNode(this.refs.viewport).style.pointerEvents="none",M.setUiBusy(!0),this.pointerEvents=!0)}},{key:"getComponents",value:function(){var e=this,t=this.props,a=t.height,n=t.data,i=this.state,o=i.firstPhysicalIndex,r=i.lastPhysicalIndex,s={};return S(n).forEach(function(e,t){s[e.key]=t}).slice(o,r).forEach(function(t){e.renderedItems[t.key]=t}),S.sortBy(this.renderedItems,"key").map(function(e){return _.createElement(C,{key:e.key,rowHeight:a,className:0===s[e.key]?"first":void 0,zIndex:n.length-s[e.key]-1,rowNumber:s[e.key]},e)})}},{key:"render",value:function(){var e=this.props,t=e.data,a=e.height,n=e.className,i=e.animate,o={container:{},viewport:{height:t.length*a}},r={container:E("infinite-list",n,{"infinite-list-animate":i&&!this.animationFrame}),viewport:"infinite-list-viewport"};return _.createElement("div",{className:r.container,style:o.container},_.createElement("div",{className:r.viewport,ref:"viewport",style:o.viewport},this.getComponents()))}}]),t}(_.Component);w.defaultProps={animate:!1,scrollTarget:null,className:null,data:null,height:b,extraItems:30};t.Component=w;t["default"]=(0,m["default"])(w)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,a){var n=e.clientWidth,i=e.clientHeight,o=t,r=a,s=0,l=0;return o!==n&&(r*=n/o,o=n,r>i&&(s=i/2-r/2)),i>r&&(o*=i/r,r=i,o>n&&(l=n/2-o/2)),{style:{width:o,height:r,top:s,left:l,position:"absolute"},className:(0,C["default"])("object-fit object-fit-cover")}}function o(e,t,a){var n=e.clientWidth,i=e.clientHeight,o=t,r=a,s=0,l=0,u=o/n,c=r/i;return u>c?(r*=n/o,o=n,i>r&&(s=i/2-r/2)):(o*=i/r,r=i,n>o&&(l=n/2-o/2)),{style:{width:o,height:r,top:s,left:l,position:"absolute"},className:(0,C["default"])("object-fit object-fit-contain")}}function r(e,t,a){var n=e.clientWidth,i=e.clientHeight,o=a,r=t;return o>i&&(o=i,r=t*(i/a)),r>n&&(r=n,o=a*(n/t)),{style:{width:r,height:o},className:(0,C["default"])("object-fit object-fit-scaledown")}}function s(e,t,a,n){var i=r(e,t,a).style,o=void 0;return o=n?{width:i.width,height:i.height,transition:N,transform:"translateX("+n.translateX+"px) translateY("+n.translateY+"px) scale("+n.factor+")"}:{width:i.width,height:i.height,transition:N},{style:o,className:(0,C["default"])("object-fit object-fit-scaledown object-fit-zoomin")}}Object.defineProperty(t,"__esModule",{value:!0}),t.FIT_TYPE=void 0;var l=a(6),u=n(l),c=a(3),d=n(c),f=a(4),p=n(f),h=a(8),m=n(h),v=a(7),g=n(v),_=a(5),y=n(_),E=a(46),M=n(E),S=a(21),C=n(S),b=a(78),k=n(b),T=a(1),w=n(T),N=(t.FIT_TYPE={CONTAIN:"contain",COVER:"cover",SCALE_DOWN:"scaleDown",ZOOM_IN:"zoomIn"},"transform 300ms cubic-bezier(.1,.82,.25,1)");t["default"]=(0,k["default"])(function(e){function t(e){(0,d["default"])(this,t);var a=(0,m["default"])(this,(t.__proto__||(0,u["default"])(t)).call(this,e));return a.onObjectLoad=function(){var e=a.props.onObjectLoad;e&&e(a.refs.object.firstChild)},a.state={style:{visibility:"hidden"},className:(0,C["default"])("object-fit")},a}return(0,g["default"])(t,e),(0,p["default"])(t,[{key:"componentDidMount",value:function(){var e=this;this.shouldUseNativeObjectFit()||(this.initialize(this.props),this.props.listeners.add(window,"resize",function(){e.initialize(e.props)}))}},{key:"componentWillReceiveProps",value:function(e){this.shouldUseNativeObjectFit()||this.initialize(e)}},{key:"initialize",value:function(e){var t=e.size,a=e.type;if(t){var n=M["default"].findDOMNode(this),l=void 0;switch(a){case"contain":l=o(n,t.width,t.height);break;case"cover":l=i(n,t.width,t.height);break;case"scaleDown":l=r(n,t.width,t.height);break;case"zoomIn":l=s(n,t.width,t.height,e.zoomIn);break;default:return void w["default"].assert(!1,"object-fit","unrecognized type "+a)()}this.setState(l,this.onObjectLoad)}}},{key:"shouldUseNativeObjectFit",value:function(){return!1}},{key:"render",value:function(){if(this.shouldUseNativeObjectFit())return y["default"].createElement("div",{className:"native-scale-down"},this.props.children);var e=this.props,t=this.state;return y["default"].createElement("div",{style:e.style,className:t.className},y["default"].createElement("div",{style:t.style,ref:"object"},e.children))}}]),t}(_.Component))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(62),o=n(i),r=a(98),s=n(r),l=a(5),u=n(l),c=a(21),d=n(c),f=function(e){var t=e.children,a=e.className,n=(0,s["default"])(e,["children","className"]);return u["default"].createElement("span",(0,o["default"])({className:(0,d["default"])("hidden-token",a)},n),"â â â â ",t,"â â â â â ")};e.exports=f},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=p["default"].findLast(e,function(e){return e.body&&e.mediaData&&(e.type===l["default"].TYPE.IMAGE||e.type===l["default"].TYPE.VIDEO)});return t&&t.mediaData.preview}Object.defineProperty(t,"__esModule",{value:!0}),t.StatusV3Proxy=void 0;var o=a(2),r=n(o),s=a(462),l=n(s),u=a(481),c=n(u),d=a(476),f=a(13),p=n(f),h=a(163),m=n(h),v=a(1523),g=a(14),_=a(1),y=a(47),E=86400,M={Collection:"StatusV3",props:{id:"string",t:"number",unreadCount:"number",totalCount:"number",pic:"object",_msgs:{type:"array","default":function(){return[]}}},session:{readKeys:{type:"object","default":function(){return{}}},contact:"object",expiredCount:{type:"number","default":function(){return 0}},expireTimer:"object"},derived:{renderedThumbnail:{deps:["msgsChanged","pic","totalCount"],fn:function(){return this.msgs.length===this.totalCount?i(this.msgs.models):this.pic?this.pic:i(this.msgs.models)}}},initialize:function(){var e=this;v.prototype.initialize.call(this),this.addChild("contact",Store.Contact.gadd(this.id)),this._msgs.length>0&&(Store.StatusV3.addStatusMessages(this.id,this._msgs),this._msgs=[]),this.listenTo(this.msgs,"add remove bulk_add",function(){e.msgs.length&&!e.expireTimer&&e.setupStatusExpiration()})},setupStatusExpiration:function(){if(!this.expireTimer&&this.expiredCount<this.msgs.length){var e=this.msgs.at(this.expiredCount),t=1e3*(e.t+E);this.expireTimer=m["default"].setTimeout(this.expireMsg.bind(this),t)}},expireMsg:function(){this.expiredCount++,this.totalCount-this.expiredCount<this.unreadCount&&this.unreadCount--,this.expireTimer=void 0,this.setupStatusExpiration()},"delete":function(){v.prototype["delete"].call(this),Store.StatusV3.remove(this.id)},onEmptyMRM:function(){var e=this;_.log("models:StatusV3:removeMsg 0 messages left, querying...")(),this.loadMore()["catch"](function(t){404===t&&e["delete"]()})},loadMore:function(){var e=this;return this.msgs.msgLoadState.noEarlierMsgs?r["default"].resolve():this.msgs.msgLoadState.isLoadingEarlierMsgs?this.msgs.loadEarlierPromise:Store.StatusV3.loadMore(this.id,g.PAGE_SIZE,this.msgs.last()).then(function(t){return p["default"].isArray(t)&&t.length<g.PAGE_SIZE&&(e.msgs.msgLoadState.noEarlierMsgs=!0),t})["catch"](function(t){404===t&&e["delete"]()})},handleReadStatus:function(e){this.readKeys[e]||(this.readKeys[e]=!0,this.unreadCount>0?this.unreadCount--:_.error("statusv3:"+this.id+":new read key but unreadCount 0")())},sendReadStatus:function(e,t){var a=this;return y.sendStatusSeen(e,t).then(function(t){200===t.status&&a.handleReadStatus(e)})},sendMute:function(e){var t=this;return y.sendStatusMute(this.id,e).then(function(a){200===a.status&&(t.contact.statusMute=e)})}},S=(0,d.genMirrorMask)(M),C=v.extend(M,{mirrorMask:S});t["default"]=C;t.StatusV3Proxy=(0,c["default"])(M,S)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.TowerModalType=t.BoxModalType=t.CompactModalType=void 0;var i=a(5),o=n(i),r=a(21),s=n(r),l=a(13),u=n(l),c={COMPACT:"compact",BOX:"box",TOWER:"tower"},d=function(e){var t=e.type||c.COMPACT,a=e.title?o["default"].createElement("div",{className:"popup-title"},e.title):null,n=(0,s["default"])("popup",e.className,{"popup-tower":t===c.TOWER,"popup-box":t===c.BOX}),i=u["default"].isEmpty(e.actions)?null:o["default"].createElement("div",{className:"popup-controls"},e.actions);return o["default"].createElement("div",{className:"backdrop"},o["default"].createElement("div",{className:"popup-container"},o["default"].createElement("div",{className:n},o["default"].createElement("div",{className:"popup-body"},a,o["default"].createElement("div",{className:"popup-contents"},e.children)),i)))};t.CompactModalType=c.COMPACT,t.BoxModalType=c.BOX,t.TowerModalType=c.TOWER;t["default"]=d},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=t.Type=void 0;var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(46),g=n(v),_=a(241),y=n(_),E=a(1438),M=(n(E),a(463)),S=n(M),C=a(1427),b=n(C),k=a(1409),T=n(k),w=a(1548),N=n(w),P=a(1411),A=(n(P),a(1402)),O=n(A),R=a(78),D=n(R),x=a(21),I=n(x),L=a(1403),F=n(L),U=a(1426),j=n(U),G=a(95),B=n(G),V=a(14),H=n(V),W=a(116),z=n(W),Y=a(239),q=t.Type={SMALL:"SMALL",DEFAULT:"DEFAULT"},K=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onSearch=function(){n.setState({searchText:n.props.searchQuery.trimmed})},n.onActiveChange=function(e,t){if("focus"===e){var a=g["default"].findDOMNode(n);B["default"].focus(a),t&&j["default"].scrollIntoViewIfNeeded(a)}n.setState({active:!!e})},n.onDelete=function(e){e.stopPropagation(),n.props.onDelete&&n.props.onDelete(e,n.props.contact)},n.onClick=function(e){n.props.onClick&&n.props.onClick(e,n.props.contact)},n.onMouseDown=function(e){0===e.button&&n.onClick(e)},n.onEnter=function(e){e.preventDefault(),e.stopPropagation(),n.onClick(e)},n.onContext=function(e){return n.state.contextMenu?void n.setState({contextMenu:!1}):(n.props.onContext&&n.props.onContext(e,n.props.contact,n.onContextClose),void n.setState({contextMenu:!0}))},n.onContextClose=function(){n.setState({contextMenu:!1})},n.indicateFocus=function(e){if(!(Date.now()-(z["default"].flashFocus||0)>200)){var t=g["default"].findDOMNode(n.cell);t&&((0,S["default"])(t,"stop"),(0,S["default"])(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:n.onBlur}))}},n.onBlur=function(e){var t=g["default"].findDOMNode(n.cell);t&&((0,S["default"])(t,"stop"),t.style.backgroundColor="")},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.setState({contextMenu:!1}),this.initListeners(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.initListeners(e,this.props)}},{key:"initListeners",value:function(e,t){var a=e.listeners,n=e.active,i=e.contact,o=e.searchQuery;t&&t.searchQuery&&t.searchQuery!==o&&a.remove(o,E.SEARCH_EVENT,this.onSearch),!o||t&&o===t.searchQuery||a.add(o,E.SEARCH_EVENT,this.onSearch);var r=t&&t.contact.id;i.id!==r&&(t&&t.active&&a.remove(t.active,t.contact.id,this.onActiveChange),n&&a.add(n,i.id,this.onActiveChange));var s=n&&n.value instanceof y["default"]&&n.value===i;this.setState({searchText:o?o.trimmed:"",active:s})}},{key:"contextEnabled",value:function(){return!1}},{key:"render",value:function(){var e=this.props,t=e.contact,a=e.secondary,n=e.onContext,i=e.onDelete,o=e.contextEnabled,r=e.contextMenu,s=e.admin,l=e.showNotifyName,u=e.className,c=(0,I["default"])("contact",u,{active:!!this.state.active}),d=void 0,f=void 0,p=void 0;if(!t.name&&l&&t.notifyName&&(p=m["default"].createElement("span",{className:"ellipsify screen-name"},m["default"].createElement(F["default"],{className:"screen-name-text",direction:"auto",text:t.notifyName}))),s&&(f=m["default"].createElement("div",{className:"chat-marker chat-marker-admin"},l10n.t("web_group_admin"))),i){var h=(0,I["default"])("icon",{"icon-x-alt-small":this.props.type===q.SMALL,"icon-x-alt":this.props.type!==q.SMALL});d=m["default"].createElement("div",{className:"chat-controls"},m["default"].createElement("button",{className:h,onClick:this.onDelete}))}var v=a;H["default"].STATUS_V2&&(v=m["default"].createElement(N["default"],{status:t.status}));var g=void 0;n&&(g=this.onContext);var _=this.props.type===q.SMALL?26:T["default"].Size.SMALL,y={enter:this.onEnter},E=this.props.mouseDownAsClick;return m["default"].createElement(z["default"],{handlers:y,onFocus:this.indicateFocus,onBlur:this.onBlur},m["default"].createElement(b["default"],{id:t.id,ref:(0,Y.GetRef)("cell",this),className:c,contextEnabled:o||this.contextEnabled,contextMenu:r,pendingAction:t.pendingAction,detail:d,image:m["default"].createElement(T["default"],{id:t.id,size:_,profileClick:this.props.profileClick}),primary:t.formattedName,searchText:this.state.searchText,primaryDetail:f,secondary:v,secondaryDetail:p,onClick:E?null:this.onClick,onMouseDown:E?this.onMouseDown:null,onContext:g}))}}]),t}(m["default"].Component);K.CONCERNS={contact:["id","status","formattedName","pendingAction","notifyName","name"]};t.Component=K;t["default"]=(0,D["default"])((0,O["default"])(K))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,a,n){this.key=e,
this.src=t,this.crossOrigin=a,this.noXHR=n,this.isHttp="/"===t[0]||O.isHttp(t),this.hasPrivacyChecks=!0,this.promise=null,this.retainCount=0,this.generation=0}function o(e){var t=e.src,a=e.crossOrigin,n=e.noXHR,o=e.hasPrivacyChecks;a=!!a,n=!!n;var r="CO:"+(a?"y":"n")+",XHR:"+(n?"y":"n")+","+t,l=F[r];if(l)return l.retainCount++,l.generation=0,o||(l.hasPrivacyChecks=!1),l;var c=new i(r,t,a,n);return F[r]=c,c.retainCount++,c.promise=u["default"].loop(function(e){var a=c.generation++;if(a>L)throw new A.GaveUpRetry("Too many image retries "+c.src);return R.expDelaySec(a,60,0).then(function(){return c.hasPrivacyChecks&&!M["default"].phoneActive&&a>0?(C["default"].log("ImageTag wait for phoneActive")(),N.waitForBBEvent(M["default"],"change:phoneActive",I.matches({phoneActive:!0}))):w.waitForOnline}).cancellable().then(function(){return 0===a||!c.isHttp||c.noXHR?!0:P.get(t).timeout(3e4,"imageTagRetryTimeout").then(function(e){var t=e.status;if(t>=200&&400>t)return!0;if(t>=500)return!1;throw new A.ServerStatusError(null,c.src,t)},function(){return!1})}).then(function(t){return t?x.loadImage(c.src,c.crossOrigin).then(function(t){t.src="",e()})["catch"](function(){if(!c.isHttp)throw new A.ImageError("Invalid Data URI",c.src)}):void 0})}).cancellable()["finally"](function(){s(c)}),c.promise["catch"](function(e){C["default"].log("ImageTag:retainQuery for "+r+" failed because: "+e)(e)}),c}function r(e){--e.retainCount<=0&&(s(e),e.promise.cancel())}function s(e){e===F[e.key]&&delete F[e.key]}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var l=a(2),u=n(l),c=a(6),d=n(c),f=a(3),p=n(f),h=a(4),m=n(h),v=a(8),g=n(v),_=a(7),y=n(_),E=a(97),M=n(E),S=a(1),C=n(S),b=a(1408),k=n(b),T=a(5),w=a(82),N=a(42),P=a(99),A=a(15),O=a(48),R=a(56),D=a(14),x=a(244),I=a(13),L=10,F={},U=function(e){function t(e){(0,p["default"])(this,t);var a=(0,g["default"])(this,(t.__proto__||(0,d["default"])(t)).call(this,e));return a.state=a._initSrc(e),a}return(0,y["default"])(t,e),(0,m["default"])(t,[{key:"componentWillReceiveProps",value:function(e){this.props.src!==e.src&&this.setState(this._initSrc(e))}},{key:"_initSrc",value:function(e){var t=e.src;if(t){if(x.isCached(t))return{src:t};this.ensureLoaded(e)}return{src:null}}},{key:"componentWillUnmount",value:function(){this.ensureLoadedQuery&&r(this.ensureLoadedQuery)}},{key:"ensureLoaded",value:function(e){var t=this,a=this.ensureLoadedQuery,n=this.ensureLoadedQuery=o(e);a&&r(a),a!==n&&n.promise.checkpoint(this.props.rejectOnUnmount()).then(function(){n===t.ensureLoadedQuery&&(t.setState({src:t.props.src}),t.props.onLoaded&&t.props.onLoaded())})["catch"](A.ImageError,A.ServerStatusError,A.GaveUpRetry,function(e){n===t.ensureLoadedQuery&&(t.props.rejectOnUnmount().isRejected()||t.props.onError&&t.props.onError(e))})["catch"](A.Unmount,u["default"].CancellationError,I.noop)}},{key:"render",value:function(){var e=this.state.src,t=this.props,a=t.onLoad,n=t.alt,i=t.onClick,o=t.onMouseMove,r=t.style,s=t.className,l=t.draggable;return e||(e=D.ONE_BY_ONE_TRANS_GIF,a=void 0),l=!!l,T.createElement("img",{src:e,alt:n,onLoad:a,onClick:i,onMouseMove:o,style:r,draggable:l,className:s})}}]),t}(T.Component);U.defaultProps={crossOrigin:!0};t.Component=U;t["default"]=(0,k["default"])(U)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(12),y=n(_),E=a(238),M=n(E),S=a(160),C=n(S),b=a(462),k=n(b),T=a(1402),w=n(T);t["default"]=(0,w["default"])((o=i=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=void 0,t=void 0;switch(this.props.msg.type){case k["default"].TYPE.VIDEO:this.props.msg.isGif?(e=C["default"].t("missing_gif_title"),t=C["default"].t("missing_gif_text")):(e=C["default"].t("missing_video_title"),t=C["default"].t("missing_video_text"));break;case k["default"].TYPE.AUDIO:e=C["default"].t("missing_audio_title"),t=C["default"].t("missing_audio_text");break;case k["default"].TYPE.IMAGE:e=C["default"].t("missing_photo_title"),t=C["default"].t("missing_photo_text");break;case k["default"].TYPE.DOCUMENT:e=C["default"].t("missing_document_title"),t=C["default"].t("missing_document_text")}return g["default"].createElement(M["default"],{title:e,onOK:function(){y["default"].closeModal()},okText:C["default"].t("web_ok")},t)}}]),t}(g["default"].PureComponent),i.CONCERNS={msg:["type","isGif"]},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(462),o=n(i),r=a(80),s=a(464),l=(0,r.defineState)("MsgLoad",{props:{noEarlierMsgs:"boolean",isLoadingEarlierMsgs:"boolean",isLoadingRecentMsgs:"boolean",isLoadingAroundMsgs:"boolean",contextLoaded:"boolean"}}),u=l.MsgLoad,c=l.MsgLoadProxy,d=s.extend({model:o["default"],initialize:function(){s.prototype.initialize.call(this),this.msgLoadState=new u({noEarlierMsgs:!1,isLoadingEarlierMsgs:!1,isLoadingRecentMsgs:!1,isLoadingAroundMsgs:!1,contextLoaded:!1}),this.listenTo(this,"add remove reset sort",this.triggerChangeLast)},"delete":function(){this.stopListening(),s.prototype["delete"].call(this),this.msgLoadState["delete"]()},triggerChangeLast:function(){var e=this.last();this._last!==e&&(this._last=e,this.trigger("change:last",e))},add:function(e,t){var a=this,n=s.prototype.add.apply(this,arguments),i=Store.Msg.add(n,t);return _.isArray(i)?i.forEach(function(e){a.isModel(e)&&(e.msgChunk=a)}):this.isModel(i)&&(i.msgChunk=this),n&&this.trigger("bulk_add",n,t),n},remove:function(e,t){var a=s.prototype.remove.apply(this,arguments),n=t?t.silent:!1;if(a&&!n){var i=_.isArray(a)?a:[a];this.trigger("remove_msgs",i,t)}return a},replace:function(e){var t=this;this.msgLoadState=e.msgLoadState,this.loadRecentPromise=e.loadRecentPromise,this.loadEarlierPromise=e.loadEarlierPromise,this.loadAroundPromise=e.loadAroundPromise,this.set(e.models,{silent:!0,merge:!1}),e.models.forEach(function(e){t.isModel(e)&&(e.msgChunk=t)}),this.trigger("bulk_add",e.models)}});d.MsgLoad=u,d.MsgLoadProxy=c,e.exports=d},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(463),s=n(r),l={scrollIntoViewIfNeeded:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!0,a=arguments[2];if(_.isFunction(e.scrollIntoViewIfNeeded))return e.scrollIntoViewIfNeeded(t);a=a||e.parentNode;var n=window.getComputedStyle(a,null),i=parseInt(n.getPropertyValue("border-top-width")),o=e.offsetTop-a.offsetTop<a.scrollTop,r=e.offsetTop-a.offsetTop+e.clientHeight-i>a.scrollTop+a.clientHeight,s=o&&!r;return(o||r)&&t&&(a.scrollTop=e.offsetTop-a.offsetTop-a.clientHeight/2-i+e.clientHeight/2),!o&&!r||t||e.scrollIntoView(s),!(o||r)},scrollIntoView:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!0,a=arguments[2];a=a||e.parentNode;var n=window.getComputedStyle(a,null),i=parseInt(n.getPropertyValue("border-top-width")),o=e.offsetTop-a.offsetTop<a.scrollTop,r=e.offsetTop-a.offsetTop+e.clientHeight-i>a.scrollTop+a.clientHeight,s=o&&!r;return t?a.scrollTop=e.offsetTop-a.offsetTop-a.clientHeight/2-i+e.clientHeight/2:e.scrollIntoView(s),!(o||r)},scrollAt:function(e,t,a){a=a||{};var n=a.pos||"center",i=a.duration||1e3;t=t||e.offsetParent;var r=a.offset||0;switch(n){case"top":return t.scrollTop=e.offsetTop+r,o["default"].resolve();case"bottom":return t.scrollTop=e.offsetTop+e.clientHeight-t.clientHeight,o["default"].resolve();case"center":return a.animate?((0,s["default"])(e,"stop"),(0,s["default"])(t,"stop"),(0,s["default"])(e,"scroll",{duration:i,container:t,offset:(e.clientHeight-t.clientHeight)/2,easing:a.easing})):(t.scrollTop=e.offsetTop+e.clientHeight/2-t.clientHeight/2,o["default"].resolve());case"offset":return a.animate?((0,s["default"])(e,"stop"),(0,s["default"])(t,"stop"),(0,s["default"])(e,"scroll",{duration:i,container:t,offset:-r,easing:a.easing})):(t.scrollTop=e.offsetTop-r,o["default"].resolve())}return o["default"].resolve()}};e.exports=l},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(21),m=n(h),v=a(1403),g=n(v),_=a(5),y=n(_),E=a(115),M=n(E),S=a(161),C=n(S),b=a(466),k=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={hover:!1,contextMenu:!1},n.onMenuClick=function(e){var t=n.props,a=t.contextEnabled,i=t.onContext;a()&&(e.stopPropagation(),e.preventDefault(),i&&i({anchor:e.target}))},n.onContextMenu=function(e){var t=n.props,a=t.contextEnabled,i=t.onContext;a()&&(e.stopPropagation(),e.preventDefault(),i&&i({event:e}))},n.openContextMenu=function(){n.props.contextEnabled()&&n.setState({contextMenu:!0},function(){n.refs.context.click()})},n.mouseOver=function(){n.state.hover||n.props.contextMenu||!n.props.contextEnabled()||n.setState({hover:!0})},n.mouseEnter=function(){n.state.hover||n.props.contextMenu||!n.props.contextEnabled()||n.setState({hover:!0})},n.mouseLeave=function(){n.state.hover&&n.setState({hover:!1})},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillUpdate",value:function(e){this.props.contextMenu&&this.state.contextMenu&&!e.contextMenu&&this.setState({contextMenu:!1})}},{key:"onMenuMouseDown",value:function(e){e.stopPropagation()}},{key:"render",value:function(){var e=this.props.contextMenu||this.state.contextMenu,t=e||this.state.hover,a=(0,m["default"])(this.props.className,{chat:!0,hover:t}),n=null,i=null;this.props.pendingAction?i=y["default"].createElement("div",{className:"btn-context icon-spinner"},y["default"].createElement(C["default"],{size:18,stroke:6})):t&&(n=y["default"].createElement("span",{className:"icon icon-down btn-context",key:"icon-context",ref:"context",onMouseDown:this.onMenuMouseDown,onClick:this.onMenuClick}));var o=this.props.detail?y["default"].createElement("div",{className:"chat-body chat-detail"},this.props.detail):null,r=null,s="chat-title";this.props.isVerified&&(r=y["default"].createElement("span",{className:"icon-psa-verified"}),s+=" chat-title-verified");var l=this.props.primary?y["default"].createElement("div",{className:s},y["default"].createElement(g["default"],{text:this.props.primary,direction:"auto",formatters:b.Configuration.Highlight(this.props.searchText?[this.props.searchText]:[]),titlify:!0,ellipsify:!0}),r):null,u=y["default"].createElement(M["default"],{transitionName:"pop"},i),c=y["default"].createElement(M["default"],{transitionName:"pop-fast-chat",className:"context-container"},t?n:null),d=void 0,f=void 0,p=this.props.primaryDetail?y["default"].createElement("div",{className:"chat-meta"},this.props.primaryDetail):null;this.props.secondary?(d=y["default"].createElement("div",{className:"chat-main"},l,p),f=y["default"].createElement("div",{className:"chat-secondary"},this.props.secondary,y["default"].createElement("div",{className:"chat-meta"},this.props.secondaryDetail,u,c))):(d=y["default"].createElement("div",{className:"chat-main"},l,p,u,c),f=this.props.secondaryDetail?y["default"].createElement("div",{className:"chat-secondary"},y["default"].createElement("div",{className:"chat-status"}),y["default"].createElement("div",{className:"chat-meta"},this.props.secondaryDetail)):null);var h=void 0;return this.props.image&&(h=this.props.customImage?this.props.image:y["default"].createElement("div",{className:"chat-avatar"},this.props.image)),y["default"].createElement("div",{className:a,style:this.props.style,onClick:this.props.onClick,onMouseDown:this.props.onMouseDown,onContextMenu:this.props.contextEnabled()?this.onContextMenu:null,onMouseEnter:this.state.hover?null:this.mouseEnter,onMouseOver:this.state.hover?null:this.mouseOver,onMouseLeave:this.state.hover?this.mouseLeave:null},h,y["default"].createElement("div",{className:"chat-body"},d,f),o)}}]),t}(y["default"].PureComponent);e.exports=k},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(21),g=n(v),_=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onToggle=function(e){e&&e.stopPropagation(),n.props.onChange()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=(0,g["default"])("checkbox",{checked:this.props.checked,unchecked:!this.props.checked,disabled:this.props.disabled});return m["default"].createElement("div",{className:"checkbox-container",onClick:this.onToggle},m["default"].createElement("div",{className:e,ref:"checkbox"},m["default"].createElement("div",{className:"checkmark"})))}}]),t}(m["default"].Component);t["default"]=_},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(62),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(12),g=n(v),_=a(5),y=n(_),E=a(96),M=n(E),S=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentDidMount",value:function(){var e=this,t=(0,o["default"])({},this.props.contextMenu,{uim:this.context.uim});g["default"].openContextMenu(t,function(t){return e.element=t})}},{key:"componentWillUnmount",value:function(){g["default"].closeContextMenu(this.context.uim)}},{key:"getElement",value:function(){return this.element}},{key:"render",value:function(){return null}}]),t}(_.Component);S.contextTypes={uim:y["default"].PropTypes.instanceOf(M["default"])},t["default"]=S},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(5),o=n(i),r=a(21),s=n(r),l=a(468),u=n(l),c=function(e){var t=e.children,a=e.onClick,n=e.iconClass,i=e.className,r=n?o["default"].createElement("div",{className:"chat-avatar"},o["default"].createElement("div",{className:"avatar"},o["default"].createElement("span",{className:(0,s["default"])("icon",n)}))):null;return o["default"].createElement("div",{className:(0,s["default"])("chat",i),"data-ignore-capture":"any"},o["default"].createElement("div",{className:"chat-cell",onClick:a,"data-a8n":u["default"].key(e.a8n)},r,o["default"].createElement("div",{className:"chat-body"},o["default"].createElement("div",{className:"chat-main"},o["default"].createElement("div",{className:"chat-title"},o["default"].createElement("span",{className:"emojitext ellipsify",dir:"auto"},t))))))};t["default"]=c},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(5),o=n(i),r=a(468),s=n(r),l=a(1469),u=n(l),c=a(21),d=n(c),f=function(e){var t=e.children,a=e.title,n=e.subtitle,i=e.footer,r=e.classes,l=e.onMouseDown,c=e.noContainer,f=e.titleOnClick,p=e.a8n,h=(0,d["default"])(r,"drawer-section",{well:a});if(!a)return o["default"].createElement("div",{className:h,onMouseDown:l},t);var m=n?n:null,v=t;return!c&&v&&(v=o["default"].createElement("div",{className:"drawer-section-body"},t)),o["default"].createElement("div",{className:h,onMouseDown:l},o["default"].createElement(u["default"],{classes:"drawer-section-title",side:m,ellipsify:!0,"data-a8n":s["default"].key(p),onClick:f},a),v,i)};t["default"]=f},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(12),y=n(_),E=a(238),M=n(E),S=a(160),C=n(S),b=a(462),k=n(b),T=a(1402),w=n(T);t["default"]=(0,w["default"])((o=i=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=void 0,t=void 0;switch(this.props.msg.type){case k["default"].TYPE.IMAGE:e=C["default"].t("retry_upload_photo_title"),t=C["default"].t("retry_upload_photo_text");break;case k["default"].TYPE.VIDEO:e=C["default"].t("retry_upload_video_title"),t=C["default"].t("retry_upload_video_text");break;case k["default"].TYPE.AUDIO:case k["default"].TYPE.PTT:e=C["default"].t("retry_upload_audio_title"),t=C["default"].t("retry_upload_audio_text");break;case k["default"].TYPE.DOCUMENT:e=C["default"].t("retry_upload_doc_title"),t=C["default"].t("retry_upload_doc_text");break;default:e=C["default"].t("retry_upload_media_title"),t=C["default"].t("retry_upload_media_text")}return g["default"].createElement(M["default"],{title:e,onOK:function(){y["default"].closeModal()},okText:C["default"].t("web_ok")},t)}}]),t}(g["default"].PureComponent),i.CONCERNS={msg:["type"]},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ProfilePicThumbProxy=t["default"]=void 0;var i=a(2),o=n(i),r=a(80),s=a(243),l=a(5),u=a(14),c=a(1),d=a(47),f=a(61),p=a(15),h=a(48),m=a(22),v=a(12),g=a(100),_=a(31),y={SINGLE:"SINGLE",GROUP:"GROUP"},E=(0,r.defineState)("ProfilePicThumb",{Collection:"ProfilePicThumb",props:{id:"string",tag:"string",raw:"string",eurl:"string"},session:{stale:["boolean",!1,!0]},derived:{img:{deps:["tag","raw","stale","eurl"],fn:function(){if(this.raw)return"data:image/jpeg;base64,"+this.raw;if(!this.tag&&this.stale)return null;if(this.tag)return this.generateUrl("s")}},imgFull:{deps:["tag","raw","stale","eurl"],fn:function(){if((this.raw||!this.tag)&&this.stale)return null;if(!this.raw&&this.tag)return this.generateUrl("l")}},fallbackType:{deps:["id"],fn:function(){return m.isUser(this.id)?y.SINGLE:m.isGroup(this.id)?y.GROUP:y.GROUP}}},onError:function(e){switch(e){case 410:this.update()}},generateUrl:function(e){var t={t:e,u:this.id,i:this.tag};return g&&(this.eurl&&(t.e=this.eurl),t.ref=_.ref,t.tok=_.tok),h.build(u.PP_URL,t)},canSet:function(){return m.isGroup(this.id)&&f.supportsFeature(f.F.GROUP_SET_PIC)?!0:!(!m.isUser(this.id)||this.id!==Store.Conn.me||!f.supportsFeature(f.F.SET_PROFILE_PIC))},setPicture:function(e,t,a){var n=this;if(!this.canSet())return o["default"].reject(new p.ActionError);var i=d.sendSetPicture(this.id,e,t),r=this.id===Store.Conn.me?new s.ActionType(l10n.t("action_profile_setting")):new s.ActionType(l10n.t("action_group_icon_setting"));a=a||(0,s.genId)();var u=i["catch"](function(e){throw c.error("models:ProfilePicThumb:setPicture dropped")(e),n.id===Store.Conn.me?new s.ActionType(l10n.t("action_profile_set_failed")):new s.ActionType(l10n.t("action_group_icon_set_failed"))}).then(function(i){if(200===i.status)return n.id===Store.Conn.me?new s.ActionType(l10n.t("action_profile_set")):new s.ActionType(l10n.t("action_group_icon_set"));if(i.status>=400){var o=n.id===Store.Conn.me?l10n.t("action_profile_set_failed"):l10n.t("action_group_icon_set_failed");return new s.ActionType(o,l10n.t("action_try_again"),n.setPicture.bind(n,e,t,a))}});return v.openToast(l.createElement(s.ActionToast,{id:a,initialAction:r,pendingAction:u})),i.bind(this).then(function(e){200!==e.status||e._duplicate||(this.tag=e.tag)})},canDelete:function(){return m.isGroup(this.id)&&f.supportsFeature(f.F.GROUP_SET_PIC)&&this.tag?!0:!!(m.isUser(this.id)&&this.id===Store.Conn.me&&f.supportsFeature(f.F.SET_PROFILE_PIC)&&this.tag)},deletePicture:function(e){var t=this;if(!this.canDelete())return o["default"].reject(new p.ActionError);var a=d.deletePicture(this.id),n=this.id===Store.Conn.me?new s.ActionType(l10n.t("action_profile_removing")):new s.ActionType(l10n.t("action_group_icon_removing"));e=e||(0,s.genId)();var i=a["catch"](function(e){throw c.error("models:ProfilePicThumb:deletePicture dropped")(e),t.id===Store.Conn.me?new s.ActionType(l10n.t("action_profile_remove_failed")):new s.ActionType(l10n.t("action_group_icon_remove_failed"))}).then(function(a){if(200===a.status)return t.id===Store.Conn.me?new s.ActionType(l10n.t("action_profile_removed")):new s.ActionType(l10n.t("action_group_icon_removed"));if(a.status>=400){var n=t.id===Store.Conn.me?l10n.t("action_profile_remove_failed"):l10n.t("action_group_icon_remove_failed");return new s.ActionType(n,l10n.t("action_try_again"),t.deletePicture.bind(t,e))}});return v.openToast(l.createElement(s.ActionToast,{id:e,initialAction:n,pendingAction:i})),a.bind(this).then(function(e){200!==e.status||e._duplicate||(this.tag=void 0)})}}),M=E.ProfilePicThumb,S=E.ProfilePicThumbProxy;M.FALLBACK=y,t["default"]=M,t.ProfilePicThumbProxy=S},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(473),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(46),y=n(_),E=a(117),M=n(E),S=a(161),C=n(S),b=a(240),k=n(b),T=a(95),w=n(T),N=a(160),P=n(N),A=a(21),O=n(A),R=a(115),D=n(R),x=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(r))),n.state={searchText:"",isSearching:!1},n.onBlur=function(){n.props.setTimeout(function(){n.state.searchText||n.onCancel()},0)},n.onChange=function(e){e.target instanceof HTMLInputElement&&!function(){var t=e.target.value;n.setState({searchText:t},function(){n.props.onSearch(t)})}()},n.onCancel=function(){n.refs.input&&(n.refs.input.blur(),n.setState({searchText:"",isSearching:!1}),n.props.onSearch(""))},n.onReset=function(e){e.stopPropagation(),n.focus(),n.setState({searchText:""}),n.props.onSearch("")},n.onSearchOn=function(){n.setState({isSearching:!0}),n.props.setTimeout(n.focus,0)},n.focus=function(){w["default"].focus(n.refs.input)},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillReceiveProps",value:function(e){this.state.isSearching&&!this.state.searchText&&(y["default"].findDOMNode(this).contains(document.activeElement)||this.onCancel())}},{key:"componentWillUnmount",value:function(){this.onCancel()}},{key:"isAtBeginning",value:function(){var e=this.refs.input;return 0===e.selectionStart&&0===e.selectionEnd}},{key:"isAtEnd",value:function(){var e=this.refs.input,t=e.value.length;return e.selectionStart===t&&e.selectionEnd===t}},{key:"render",value:function(){var e=this.props,t=e.loading,a=e.placeholder,n=e.spellCheck,i=this.state,o=i.isSearching,r=i.searchText,s=null;o&&(t?s=g["default"].createElement("button",{className:"btn-context icon-spinner icon-x-alt",key:"icon-clear-search",onClick:this.onReset},g["default"].createElement(C["default"],{size:20,stroke:5})):r.length&&(s=g["default"].createElement("button",{className:"icon icon-x-alt",key:"icon-clear-search",onClick:this.onReset})));var l=void 0;o&&(l=g["default"].createElement(k["default"],{displayName:"ListSearch",escapable:!0,requestDismiss:this.onCancel,requestFocus:this.focus}));var u=a||P["default"].t("search_or_start_new_chat"),c=o?this.onCancel:this.onSearchOn,d=(0,O["default"])("list-search",{active:o});return g["default"].createElement("div",{className:d},g["default"].createElement("button",{className:"icon icon-search-morph",onMouseDown:c},g["default"].createElement("div",{className:"icon icon-back-blue"}),g["default"].createElement("div",{className:"icon icon-search"})),g["default"].createElement(D["default"],{transitionName:"pop"},s),g["default"].createElement("div",{className:"input-placeholder"},r?null:u),g["default"].createElement("label",{htmlFor:"input-chatlist-search",className:"cont-input-search"},g["default"].createElement("input",{type:"text",ref:"input",className:"input-search","data-tab":2,dir:"auto",spellCheck:n,title:u,value:r,onBlur:this.onBlur,onFocus:o?null:this.onSearchOn,onChange:o?this.onChange:null})),l)}}]),t}(g["default"].Component),I=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"focus",value:function(){(0,o["default"])(t.prototype.__proto__||(0,s["default"])(t.prototype),"getComponent",this).call(this).focus()}},{key:"isAtEnd",value:function(){return(0,o["default"])(t.prototype.__proto__||(0,s["default"])(t.prototype),"getComponent",this).call(this).isAtEnd()}},{key:"setState",value:function(e,a){(0,o["default"])(t.prototype.__proto__||(0,s["default"])(t.prototype),"getComponent",this).call(this).setState(e,a)}}]),t}((0,M["default"])(x));t["default"]=I},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(21),m=n(h),v=a(1506),g=n(v),_=a(1475),y=n(_),E=a(116),M=n(E),S=a(5),C=n(S),b=a(115),k=n(b),T=a(161),w=n(T),N=a(1449),P=n(N),A=a(240),O=n(A),R=a(1429),D=n(R),x=a(472),I=a(239),L=a(1447),F=(n(L),function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={active:!1,locked:!!n.props.lockable,emojiPicker:null},n.onEmojiPicker=function(e){e&&(e.preventDefault(),e.stopPropagation());var t=C["default"].createElement(y["default"],{onEmoji:n.onEmoji,onFocusRelease:n.restoreFocus});n.setState({emojiPicker:{menu:t,dirY:x.DirY.TOP,type:"emoji_picker",anchor:e.target}}),n.restoreFocus()},n.onEmojiPickerClose=function(){n.setState({emojiPicker:null})},n.onRestoreEmojiPickerFocus=function(){n.refs.emojiPickerUIE&&n.refs.emojiPickerUIE.getRef()&&n.refs.emojiPickerUIE.getRef().getElement()&&n.refs.emojiPickerUIE.getRef().getElement().component.restoreFocus()},n.onEmoji=function(e){n.inputLine&&(n.inputLine.restoreFocus(!1),n.inputLine.replaceSelection(e))},n.onEnter=function(e){n.props.lockable&&n.onSaveAndLock(),n.props.onEnter&&!n.props.multiline&&(e.persist(),n.props.onEnter(e))},n.onChange=function(e){n.props.onChange&&n.props.onChange(e)},n.restoreFocus=function(){n.inputLine&&n.inputLine.restoreFocus()},n.onBlur=function(e){n.state.active&&n.setState({active:!1}),n.props.onBlur&&n.props.onBlur(e)},n.onFocus=function(e){e.stopPropagation(),n.state.active||n.setState({active:!0}),n.props.onFocus&&n.props.onFocus(e)},n.onUnlock=function(){n.props.onBeginEdit&&n.props.onBeginEdit(),n.setState({locked:!1})},n.onSaveAndLock=function(){var e=!(!n.props.lowProfile&&n.props.error);n.props.validate&&e&&(e=n.props.validate(n.props.value)),e?(n.props.onSave&&n.props.onSave(),n.setState({locked:!0})):n.props.onError&&n.props.onError()},n.onCancel=function(){n.props.onCancel&&n.props.onCancel(),n.setState({locked:!0})},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){this.props.focusOnMount&&this.restoreFocus()}},{key:"render",value:function(){var e=this.props.maxLength||t.defaultProps.maxLength,a=this.props.editable&&!this.state.locked,n=a&&!!this.props.error&&!this.props.lowProfile,i=P["default"].multibyteLength(this.props.value||""),o=50>e-i&&a,r={container:(0,m["default"])("text-input",this.props.className,{"no-placeholder":!this.props.placeholder,active:a}),label:(0,m["default"])("label-text",{"label-text-float":!!this.props.value}),inputWrapper:(0,m["default"])("input-wrapper",{"input-text-error":n,"input-text-active":this.state.active,locked:this.state.locked}),infoWrapper:(0,m["default"])("input-info-strip",{"input-text-error":n,"input-text-active":this.state.active})},s=this.props.showRemaining?C["default"].createElement("div",{className:"control-button-container char-counter"},C["default"].createElement("div",{className:"char-counter"},o?e-i:null)):null,l=a&&this.props.supportsEmoji?C["default"].createElement("button",{className:"icon icon-emoji icon-emoji-input",onClick:this.onEmojiPicker}):void 0,u=void 0;this.props.lockable&&(this.props.pending?u=C["default"].createElement("div",{className:"icon icon-spinner"},C["default"].createElement(w["default"],{size:18,stroke:6})):this.state.locked?this.props.editable&&(u=C["default"].createElement("span",{className:"lock-icon icon icon-pencil",onClick:this.onUnlock,key:"btn-edit",title:l10n.t("edit_button")})):u=C["default"].createElement("span",{className:"lock-icon icon icon-checkmark",onClick:this.onSaveAndLock,key:"btn-done",title:l10n.t("click_to_save_esc_to_cancel")}),u=C["default"].createElement(k["default"],{transitionName:"pop",component:"div",className:"control-button-container"},u));var c=this.props.lowProfile?null:C["default"].createElement("div",{className:r.infoWrapper},C["default"].createElement("div",{className:"error-text"},n?this.props.error:null)),d=void 0;if(this.props.lockable&&!this.state.locked){var f=void 0;this.state.emojiPicker&&(f=C["default"].createElement(O["default"],{displayName:"EmojiPicker",escapable:!0,popable:!0,ref:"emojiPickerUIE",requestDismiss:this.onEmojiPickerClose,requestFocus:this.onRestoreEmojiPickerFocus},C["default"].createElement(D["default"],{contextMenu:this.state.emojiPicker}))),d=C["default"].createElement(O["default"],{displayName:"TextInput",escapable:!0,requestFocus:this.restoreFocus,requestDismiss:this.onCancel},C["default"].createElement("div",null,f))}else!this.props.lockable&&this.state.emojiPicker&&(d=C["default"].createElement(O["default"],{displayName:"EmojiPicker",escapable:!0,popable:!0,ref:"emojiPickerUIE",requestDismiss:this.onEmojiPickerClose,requestFocus:this.onRestoreEmojiPickerFocus},C["default"].createElement(D["default"],{contextMenu:this.state.emojiPicker})));return C["default"].createElement(M["default"],{className:r.container,onFocus:this.restoreFocus},C["default"].createElement("span",{className:r.label},this.props.placeholder),C["default"].createElement("div",{className:"input-spacer"}),C["default"].createElement("div",{className:r.inputWrapper,"data-trump-dominateparent":"click"},C["default"].createElement(g["default"],{ref:(0,I.GetRef)("inputLine",this),value:this.props.value,className:"input-text",multiline:this.props.multiline,onChange:this.onChange,onFocus:this.onFocus,onBlur:this.onBlur,onEnter:this.onEnter,onFiles:this.props.onFiles,focusOnChange:!1,spellCheck:this.props.spellCheck,maxLength:this.props.maxLength,showRemaining:this.props.showRemaining,editable:this.props.editable&&!this.state.locked}),C["default"].createElement("div",{className:"textinput-controls"},u,C["default"].createElement(k["default"],{transitionName:"pop",component:"div",className:"control-button-container"},l),s)),c,d)}}]),t}(S.Component));F.defaultProps={maxLength:25,editable:!0},t["default"]=F},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(14),g=n(v),_=a(238),y=n(_),E=a(12),M=n(E),S=a(37),C=n(S),b={GUIDE_ALLOW:"guide-allow",GUIDE_UNBLOCK:"guide-unblock",GUIDE_NONE:"guide-none"},k={CHROME_MEDIA_ERROR:"__chrome_media_error__",FIREFOX_LOCK:"__firefox_lock__",OPERA_MEDIA:"__opera_media__"},T=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.getDescription=function(){var e=n.props.desc+"_"+C["default"].browser;return n.props.browserPrefixDesc&&l10n.hasT(e)?l10n.t(e):l10n.t(n.props.desc);
},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){var e=this.getDescription(),t=this.refs.description;e.indexOf(k.CHROME_MEDIA_ERROR)>-1&&(t.innerHTML=t.innerHTML.replace(k.CHROME_MEDIA_ERROR,'<span class="chrome-media-icon"></span>')),e.indexOf(k.FIREFOX_LOCK)>-1&&(t.innerHTML=t.innerHTML.replace(k.FIREFOX_LOCK,'<span class="firefox-lock-icon"></span>')),e.indexOf(k.OPERA_MEDIA)>-1&&(t.innerHTML=t.innerHTML.replace(k.OPERA_MEDIA,'<span class="opera-media-icon"></span>'))}},{key:"render",value:function(){var e="popup-guide";if(C["default"].browser===g["default"].BROWSER_TYPE.CHROME)switch(C["default"].os){case g["default"].OS_TYPE.MAC:e+=" popup-guide-mac";break;case g["default"].OS_TYPE.CHROMEOS:e+=" popup-guide-chrome";break;case g["default"].OS_TYPE.WINDOWS:}var t=null;this.props.type!==b.GUIDE_NONE&&C["default"].browser===g["default"].BROWSER_TYPE.CHROME&&(t=m["default"].createElement("div",{className:"round"},m["default"].createElement("div",{className:"round-body "+this.props.type})));var a=this.props.onCancel?l10n.t("learn_more"):void 0;return m["default"].createElement(y["default"],{title:l10n.t(this.props.title),classes:e,onOK:this.props.onConfirm,okText:l10n.t("ok_got_it"),onCancel:this.props.onCancel,cancelText:a},t,m["default"].createElement("div",{className:"text text-tip",ref:"description"},this.getDescription()))}}]),t}(m["default"].Component);T.TYPE=b,T.defaultProps={browserPrefixDesc:!0,type:b.GUIDE_NONE,onConfirm:M["default"].closeModal.bind(M["default"])},t["default"]=T},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=t.Mode=void 0;var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(463),m=n(h),v=a(1404),g=n(v),_=a(1470),y=n(_),E=a(1545),M=n(E),S=a(1402),C=n(S),b=a(78),k=n(b),T=a(116),w=n(T),N=a(1465),P=n(N),A=a(1542),O=n(A),R=a(239),D=a(13),x=n(D),I=a(1411),L=(n(I),a(238)),F=n(L),U=a(1438),j=(n(U),a(5)),G=n(j),B=a(46),V=n(B),H=a(1427),W=n(H),z=a(1409),Y=n(z),q=a(1495),K=n(q),Q=a(1556),X=n(Q),Z=a(1491),J=n(Z),$=a(1569),ee=n($),te=a(1571),ae=n(te),ne=a(1492),ie=a(14),oe=n(ie),re=a(12),se=n(re),le=a(21),ue=n(le),ce=a(1426),de=n(ce),fe=a(1530),pe=n(fe),he=a(15),me=n(he),ve=a(1429),ge=n(ve),_e=a(240),ye=n(_e),Ee=a(95),Me=n(Ee),Se=a(160),Ce=n(Se),be=t.Mode={LAST:"LAST",INFO:"INFO"},ke=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.hoverCounter=0,n.onSearch=function(){n.setState({searchText:n.props.searchQuery.trimmed})},n.onActiveChange=function(e,t){if("focus"===e){var a=V["default"].findDOMNode(n);Me["default"].focus(a),t&&de["default"].scrollIntoViewIfNeeded(a)}n.setState({active:!!e})},n.contextEnabled=function(){var e=n.props,t=e.chat,a=e.noContext;return!a&&(t.mute.canMute()||t.canArchive()||t.canDelete()||t.canExit())},n.onMenu=function(e){if(n.state.contextMenu)return void n.setState({contextMenu:void 0});var t=n.props.chat,a=[];t.canArchive()&&a.push(G["default"].createElement(X["default"],{key:"archive",onArchive:n.onArchive,chat:t._ProxyState$state})),t.mute.canMute()&&a.push(G["default"].createElement(K["default"],{key:"mute",onMute:n.onMute,mute:t.mute})),t.canDelete()&&a.push(G["default"].createElement(J["default"],{key:"delete",onDeleteOrExit:n.onDeleteOrExit,chat:t._ProxyState$state})),t.canPin()&&a.push(G["default"].createElement(ae["default"],{key:"pin",onPinOrUnpin:n.onPinOrUnpin,chat:t})),t.canMarkUnseen()&&a.push(G["default"].createElement(ee["default"],{key:"mark_unread",onMarkUnread:n.onMarkUnread,chat:t._ProxyState$state})),e.event&&e.event.persist(),n.setState({contextMenu:{menu:a,event:e.event,anchor:e.anchor}})},n.removeContext=function(){n.setState({contextMenu:void 0})},n.onMute=function(e){se["default"].muteChat(Store.Chat.get(n.props.chat.id),e,n)},n.onArchive=function(e){se["default"].archiveChat(Store.Chat.get(n.props.chat.id),e)},n.onDeleteOrExit=function(){se["default"].deleteOrExitChat(Store.Chat.get(n.props.chat.id),n)},n.onPinOrUnpin=function(e){!e||Store.Chat.filter(function(e){return e.pin}).length<3?se["default"].pinChat(Store.Chat.get(n.props.chat.id),e):se["default"].openModal(G["default"].createElement(F["default"],{onOK:se["default"].closeModal.bind(se["default"]),okText:Ce["default"].t("web_ok")},Ce["default"].t("action_chat_pin_failed_405")))},n.onMarkUnread=function(e){se["default"].markChatUnread(Store.Chat.get(n.props.chat.id),e)},n.onClick=function(e){x["default"].isFunction(n.props.onClick)&&n.props.onClick(e,Store.Chat.get(n.props.chat.id))},n.onMouseDown=function(e){0===e.button&&n.onClick(e)},n.onEnter=function(e){e.preventDefault(),e.stopPropagation(),w["default"].flashFocus=Date.now(),n.onClick(e)},n.onDragEnter=function(e){if(n.props.chat.canSend){var t=e.dataTransfer;x["default"].includes(t.types,oe["default"].DRAG_TYPE_FILE)&&(0===n.hoverCounter&&n.setState({dragging:!0}),n.hoverCounter+=1)}},n.onDragLeave=function(e){if(n.props.chat.canSend){var t=e.dataTransfer;x["default"].includes(t.types,oe["default"].DRAG_TYPE_FILE)&&(n.hoverCounter-=1,0===n.hoverCounter&&n.setState({dragging:!1}))}},n.onDrop=function(e){var t=n.props.chat;if(t.canSend){n.setState({dragging:!1});var a=e.dataTransfer;(x["default"].includes(a.types,oe["default"].DRAG_TYPE_FILE)||x["default"].includes(a.types,"text/uri-list")||x["default"].includes(a.types,"text/html"))&&pe["default"].getFiles(e,0).then(function(e){se["default"].openChatFromUnread(Store.Chat.get(t.id)).then(function(a){a&&se["default"].attachMediaDrawer(Store.Chat.get(t.id),e)})})["catch"](me["default"].MediaDragDropError,function(e){se["default"].openChatFromUnread(Store.Chat.get(t.id)).then(function(a){a&&se["default"].pasteChatTextInput(Store.Chat.get(t.id),e.src)})})}},n.indicateFocus=function(e){if(!(Date.now()-(w["default"].flashFocus||0)>200)){var t=V["default"].findDOMNode(n.cell);(0,m["default"])(t,"stop"),(0,m["default"])(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:n.onBlur})}},n.onBlur=function(e){var t=V["default"].findDOMNode(n.cell);t&&((0,m["default"])(t,"stop"),t.style.backgroundColor="")},n.openContextMenu=function(){n.cell.openContextMenu()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.initListeners(this.props),this.setState({dragging:!1,contextMenu:void 0})}},{key:"componentWillReceiveProps",value:function(e){this.initListeners(e,this.props)}},{key:"initListeners",value:function(e,t){var a=e.listeners,n=e.active,i=e.chat,o=e.searchQuery;t&&t.searchQuery&&t.searchQuery!==o&&a.remove(o,U.SEARCH_EVENT,this.onSearch),!o||t&&o===t.searchQuery||a.add(o,U.SEARCH_EVENT,this.onSearch);var r=t&&t.chat.id;i.id!==r&&(t&&t.active&&a.remove(t.active,t.chat.id,this.onActiveChange),n&&a.add(n,i.id,this.onActiveChange));var s=n&&n.value instanceof g["default"]&&n.value.id===i.id;this.setState({searchText:o?o.trimmed:"",active:s})}},{key:"render",value:function(){var e=this.props,t=e.chat,a=e.contact,n=e.mode,i=e.secondary,o=e.className;o=(0,ue["default"])(o,{unread:t.hasUnread,active:!!this.state.active,"chat-drag":this.state.dragging});var r=void 0,s=void 0,l=void 0;switch(n){case be.LAST:r=G["default"].createElement(P["default"],{chat:t}),i||(i=G["default"].createElement(O["default"],{chat:t}),s=G["default"].createElement(M["default"],{chat:t,mute:t.mute})),l={enter:this.onEnter},l[Ce["default"].LR("right","left")]=this.openContextMenu;break;case be.INFO:i||(i=t.isGroup?G["default"].createElement(ne.ParticipantsList,{groupMetadata:t.groupMetadata}):G["default"].createElement(y["default"],{presence:t.presence,chatstate:t.presence.chatstate,location:"list"})),l={enter:this.onEnter}}var u=G["default"].createElement(Y["default"],{id:t.id,size:Y["default"].Size.NONE,profileClick:this.props.profileClick}),c=this.props.mouseDownAsClick,d=void 0;return this.state.contextMenu&&(d=G["default"].createElement(ye["default"],{displayName:"ChatContextMenu",escapable:!0,popable:!0,requestDismiss:this.removeContext},G["default"].createElement(ge["default"],{contextMenu:this.state.contextMenu}))),G["default"].createElement(w["default"],{handlers:l,onFocus:this.indicateFocus,onBlur:this.onBlur,className:"chat-drag-cover",onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDrop:this.onDrop},G["default"].createElement(W["default"],{id:t.id,ref:(0,R.GetRef)("cell",this),className:o,contextEnabled:this.contextEnabled,pendingAction:t.pendingAction,contextMenu:!!this.state.contextMenu,image:u,primary:t.title(),searchText:this.state.searchText,primaryDetail:r,secondary:i,secondaryDetail:s,isVerified:t.isPSA||a.isVerified,onClick:c?void 0:this.onClick,onMouseDown:c?this.onMouseDown:void 0,onContext:this.onMenu}),d)}}]),t}(G["default"].PureComponent);ke.CONCERNS={chat:["id","formattedTitle","hasUnread","isReadOnly","isGroup","pendingAction","canSend","isPSA","contact","presence","groupMetadata","mute"],contact:["isVerified"]},ke.defaultProps={mode:be.LAST};t.Component=ke;t["default"]=(0,k["default"])((0,C["default"])(ke))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.SEARCH_EVENT=void 0;var i=a(121),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(65),g=n(v),_=a(1722),y=n(_),E=a(13),M=n(E),S=t.SEARCH_EVENT="SEARCH_EVENT",C=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(r))),n.query="",i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"updateQuery",value:function(e){var t=this.query;this.query=e,M["default"].trim(e)!==t&&this.trigger(S)}},{key:"clear",value:function(){this.updateQuery("")}},{key:"trimmed",get:function(){return M["default"].trim(this.query)}},{key:"highlighted",get:function(){var e=this.trimmed.toLowerCase().split(" ");return M["default"].uniq(M["default"].compact(e))}}]),t}(y["default"]);t["default"]=C,(0,o["default"])(C.prototype,g["default"])},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){return f["default"].createElement("div",{className:"media-state-controls"},f["default"].createElement("button",{className:"icon-media icon-media-disabled"},f["default"].createElement(v["default"],{size:50,stroke:3})))}function o(){return f["default"].createElement("div",{className:"media-state-controls"},f["default"].createElement("button",{className:"icon-xl icon-media-cancel"},f["default"].createElement(v["default"],{size:50,stroke:3})))}function r(){return f["default"].createElement("div",{className:"media-state-controls"},f["default"].createElement("button",{className:"icon-xl icon-media-download"}))}function s(e){var t=e.filesize,a=void 0===t?0:t,n=e.onClick;return a>0?f["default"].createElement("div",{className:"media-state-controls"},f["default"].createElement("button",{className:"btn-meta",onClick:n},f["default"].createElement("span",{className:"icon-xl icon-media-download-noborder"}),f["default"].createElement(h["default"],null,l10n.filesize(a)))):f["default"].createElement("div",{className:"media-state-controls"},f["default"].createElement("button",{className:"icon-xl icon-media-download",onClick:n}))}function l(e){var t=e.filesize,a=void 0===t?0:t;return a>0?f["default"].createElement("div",{className:"media-state-controls"},f["default"].createElement("button",{className:"btn-meta"},f["default"].createElement("span",{className:"icon-xl icon-media-upload-noborder"}),f["default"].createElement(h["default"],null,l10n.filesize(a)))):f["default"].createElement("div",{className:"media-state-controls"},f["default"].createElement("button",{className:"icon-xl icon-media-upload"}))}function u(){return f["default"].createElement("div",{className:"media-state-controls"},f["default"].createElement("button",{className:"icon-xl icon-media-play"}))}function c(e){var t=e.type,a=void 0;switch(t){case"image":a=l10n.t("missing_photo_title");break;case"video":a=l10n.t("missing_video_title");break;case"audio":a=l10n.t("missing_audio_title");break;default:a=l10n.t("missing_media_title")}return f["default"].createElement("div",{className:"media-state-controls"},f["default"].createElement("button",{className:"btn-meta missing-text"},a))}Object.defineProperty(t,"__esModule",{value:!0}),t.Pending=i,t.PendingCancel=o,t.Cancel=r,t.Download=s,t.Upload=l,t.Play=u,t.Missing=c;var d=a(5),f=n(d),p=a(1419),h=n(p),m=a(161),v=n(m)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=e.children;return v["default"].createElement("div",{className:"menu menu-horizontal"},t)}Object.defineProperty(t,"__esModule",{value:!0}),t.MenuBarItem=void 0;var o=a(6),r=n(o),s=a(3),l=n(s),u=a(4),c=n(u),d=a(8),f=n(d),p=a(7),h=n(p);t.MenuBar=i;var m=a(5),v=n(m),g=a(115),_=n(g),y=a(468),E=n(y),M=a(21),S=n(M),C=a(240),b=n(C),k=t.MenuBarItem=function(e){function t(e){(0,l["default"])(this,t);var a=(0,f["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this,e));return a.onClose=function(){a.setState({active:!1})},a.handleClick=function(e){a.props.onClick&&a.props.onClick(e),e.isDefaultPrevented()||a.state.active||a.onOpen(e)},a.state={active:!1},a}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"onOpen",value:function(){this.setState({active:!0})}},{key:"render",value:function(){var e=this.props,t=e.children,a=e.icon,n=e.transitionName,i=e.title,o=this.state.active,r=t&&o?v["default"].createElement(b["default"],{displayName:"MenuBarMenuItem",escapable:!0,popable:!0,requestDismiss:this.onClose},v["default"].Children.only(t)):null;return v["default"].createElement("div",{"data-a8n":E["default"].key(this.props.a8n),className:(0,S["default"])("menu-item",{active:o})},v["default"].createElement("button",{className:(0,S["default"])("icon",a),onMouseDown:this.handleClick,title:i}),v["default"].createElement(_["default"],{transitionName:n},r))}}]),t}(v["default"].PureComponent);k.defaultProps={transitionName:"dropdown"}},function(e,t){"use strict";e.exports=function(e){return!e.getModifierState("Shift")&&!e.getModifierState("Alt")&&!e.getModifierState("Control")}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){switch(l["default"].SHOW_GIF_SEARCH){case"giphy":return c;case"tenor":default:return d}}Object.defineProperty(t,"__esModule",{value:!0}),t.GIPHY_LOCALES=t.BRAND_NAMES=t.GifInfo=t.TENOR=t.GIPHY=t.GAP_SIZE=t.TARGET_GIF_HEIGHT=void 0;var o=a(3),r=n(o);t.gifProvider=i;var s=a(14),l=n(s),u=t.TARGET_GIF_HEIGHT=130,c=(t.GAP_SIZE=6,t.GIPHY="giphy"),d=t.TENOR="tenor",f=0;t.GifInfo=function p(e,t,a,n,i,o,s){(0,r["default"])(this,p),this.rank=e,this.gifId=++f,this.url=t,this.previewUrl=a||t,this.nonVideoUrl=n,this.width=i,this.widthStr=i+"px",this.ratioStr=Math.ceil(100*u/i)+"%",this.attribution=o,this.trending=s},t.BRAND_NAMES={giphy:"GIPHY",tenor:"Tenor"},t.GIPHY_LOCALES=["es","pt","id","fr","ar","tr","th","vi","de","it","ja","zh-CN","zh-TW","ru","ko","pl","nl","ro","hu","sv","cs","hi","bn","da","fa","tl","fi","iw","ms","no","uk"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.GroupMetadataProxy=t["default"]=void 0;var i=a(2),o=n(i),r=a(241),s=n(r),l=a(80),u=n(l),c=a(243),d=a(465),f=n(d),p=a(5),h=a(1),m=a(245),v=a(480),g=a(47),_=a(12),y=a(61),E=a(15),M=a(14),S=(0,l.defineState)("Participant",{props:{id:"string",isAdmin:"boolean"},session:{contact:"object"},initialize:function(){u["default"].prototype.initialize.call(this),this.addChild("contact",Store.Contact.gadd(this.id))},"delete":function(){u["default"].prototype["delete"].call(this)}}),C=S.Participant,b=m.extend(v,{model:C,comparator:function(e,t){return s["default"].Comparator(e.contact,t.contact)},initialize:function(){this.listenTo(this,"change:contact.name",this.sort),this.listenTo(_,"locale_change",this.sort)},"delete":function(){this.invokeMap("delete"),this.stopListening(),this.reset()},addParticipant:function(e,t){var a=this;if(this.get(e.id))return _.openToast(p.createElement(f["default"],{id:f["default"].genId(),msg:l10n.t("action_participant_failed_already_added",{participant:e.formattedShortName})})),o["default"].reject(new E.ActionError);if(!this.canAdd())return o["default"].reject(new E.ActionError);var n=g.addParticipant(this.parent.id,e.id),i=new c.ActionType(l10n.t("action_participant_adding",{participant:e.formattedShortName}));t=t||(0,c.genId)();var r=n.then(function(t){return 200===t.status?new c.ActionType(l10n.t("action_participant_added",{participant:e.formattedShortName})):404===t.status?new c.ActionType(l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_404")):401===t.status?new c.ActionType(l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_401")):403===t.status?new c.ActionType(l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_403")):void 0})["catch"](function(n){return h.error("models:groupMetadata:participantCollection:addParticipant dropped")(n),new c.ActionType(l10n.t("action_participant_add_failed"),l10n.t("action_try_again"),a.addParticipant.bind(a,e,t))});return _.openToast(p.createElement(c.ActionToast,{id:t,initialAction:i,pendingAction:r})),n},removeParticipant:function(e,t){var a=this;if(!this.canRemove(e))return o["default"].reject(new E.ActionError);var n=g.removeParticipant(this.parent.id,e.id),i=new c.ActionType(l10n.t("action_participant_removing",{participant:e.contact.formattedShortName}));t=t||(0,c.genId)();var r=n.then(function(t){return 200===t.status?new c.ActionType(l10n.t("action_participant_removed",{participant:e.contact.formattedShortName})):404===t.status?new c.ActionType(l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_404")):401===t.status?new c.ActionType(l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_401")):403===t.status?new c.ActionType(l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_403")):void 0})["catch"](function(n){return h.error("models:groupMetadata:participantCollection:removeParticipant dropped")(n),new c.ActionType(l10n.t("action_participant_remove_failed"),l10n.t("action_try_again"),a.removeParticipant.bind(a,e,t))});return _.openToast(p.createElement(c.ActionToast,{id:t,initialAction:i,pendingAction:r})),n},promoteParticipant:function(e,t){var a=this;if(!this.canPromote(e))return o["default"].reject(new E.ActionError);var n=g.promoteParticipant(this.parent.id,e.id),i=new c.ActionType(l10n.t("action_participant_promoting",{participant:e.contact.formattedShortName}));t=t||(0,c.genId)();var r=n.then(function(t){return 200===t.status?new c.ActionType(l10n.t("action_participant_promoted",{participant:e.contact.formattedShortName})):404===t.status?new c.ActionType(l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_404")):401===t.status?new c.ActionType(l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_401")):403===t.status?new c.ActionType(l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_403")):void 0})["catch"](function(n){return h.error("models:groupMetadata:participantCollection:removeParticipant dropped")(n),new c.ActionType(l10n.t("action_participant_promote_failed"),l10n.t("action_try_again"),a.promoteParticipant.bind(a,e,t))});return _.openToast(p.createElement(c.ActionToast,{id:t,initialAction:i,pendingAction:r})),n},canAdd:function(){return y.supportsFeature(y.F.GROUP_ADD_PARTICIPANT)?!!this.iAmAdmin():!1},canPromote:function(e){return y.supportsFeature(y.F.GROUP_PROMOTE_PARTICIPANT)&&e?Store.Conn.me===e.id?!1:this.iAmAdmin()?!e.isAdmin:!1:!1},canRemove:function(e){return y.supportsFeature(y.F.GROUP_REMOVE_PARTICIPANT)&&e?Store.Conn.me===e.id?!1:!!this.iAmAdmin():!1},canVerifyIdentity:function(e){return y.supportsFeature(y.F.QUERY_IDENTITY)&&e?Store.Conn.me===e.id?!1:!!e.contact.plaintextDisabled:!1},iAmMember:function(){return 1===this.where({id:Store.Conn.me}).length},iAmAdmin:function(){return 1===this.where({id:Store.Conn.me,isAdmin:!0}).length}}),k=(0,l.defineState)("GroupMetadata",{Collection:"GroupMetadata",props:{id:"string",creation:"number",owner:"string"},session:{stale:["boolean",!1,!0],trusted:["boolean",!1,!0],inviteCode:"string",promises:{type:"object","default":function(){return{}}}},derived:{groupInviteLink:{deps:["inviteCode"],fn:function(){return this.inviteCode?""+M.GROUP_INVITE_LINK_URL+this.inviteCode:null}}},collections:{participants:b},"delete":function(){u["default"].prototype["delete"].call(this),Store.GroupMetadata.remove(this.id),this.participants["delete"]()},canSetSubject:function(){return y.supportsFeature(y.F.GROUP_SET_SUBJECT)?!!this.participants.iAmMember():!1},initialize:function(){u["default"].prototype.initialize.call(this),this.listenTo(this.participants,"change:isAdmin change:contact.isMyContact sort remove reset",this.isTrusted),this.listenTo(this,"change:owner",this.isTrusted),this.isTrusted(),this.listenTo(this.participants,"add remove reset",this.onParticipantChange)},isTrusted:function(){if(this.stale)return this.trusted;if(!this.owner)return this.trusted=!1;if(this.owner===Store.Conn.me)return this.trusted=!0;var e=Store.Contact.get(this.owner);if(e&&e.isMyContact)return this.trusted=!0;for(var t=this.participants.models,a=0,n=t.length;n>a;++a){var i=t[a];if(i.isAdmin&&i.id!==Store.Conn.me&&i.contact.isMyContact)return this.trusted=!0}return this.trusted=!1},onParticipantChange:function(){Store.Contact.get(this.id).unset("_capabilities"),Store.GroupMetadata.trigger("group_participant_change",this.id)},groupInviteCode:function(){var e=this;return this.promises.groupInviteCode?this.promises.groupInviteCode:this.promises.groupInviteCode=g.groupInviteCode(this.id).then(function(t){var a=t.status,n=t.code;return 200===a&&(e.inviteCode=n),a})["finally"](function(){e.promises.groupInviteCode=null})},revokeGroupInvite:function(){var e=this;return this.promises.revokeGroupInvite?this.promises.revokeGroupInvite:this.promises.revokeGroupInvite=g.revokeGroupInvite(this.id).then(function(t){var a=t.status,n=t.code;return 200===a&&(e.inviteCode=n),a})["finally"](function(){e.promises.revokeGroupInvite=null})}}),T=k.GroupMetadata,w=k.GroupMetadataProxy;t["default"]=T,t.GroupMetadataProxy=w},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MsgInfoProxy=t["default"]=t.MsgInfoParticipantProxy=t.MsgInfoParticipant=void 0;var i=a(80),o=n(i),r=a(241),s=n(r),l=a(490),u=a(245),c=a(480),d=(0,i.defineState)("MsgInfoParticipant",{props:{id:"string",t:"number"},session:{contact:"object"},initialize:function(){o["default"].prototype.initialize.call(this),this.addChild("contact",Store.Contact.gadd(this.id))},getCollection:function(){return this.collection}}),f=d.MsgInfoParticipant,p=d.MsgInfoParticipantProxy,h=u.extend(c,{model:f,comparator:function(e,t){return s["default"].Comparator(e.contact,t.contact)},isStateStale:function(e){var t=this.get(e);return t&&t.stale}}),m=(0,i.defineState)("MsgInfo",{Collection:"MsgInfo",props:{id:"msgKey",isPTT:"boolean",playedRemaining:{type:"number","default":0},readRemaining:{type:"number","default":0},deliveryRemaining:{type:"number","default":0}},collections:{played:h,read:h,delivery:h},derived:{settled:{deps:["isPTT","playedRemaining","readRemaining"],fn:function(){return this.isPTT?!this.playedRemaining:!this.readRemaining}}}},l),v=m.MsgInfo,g=m.MsgInfoProxy;t.MsgInfoParticipant=f,t.MsgInfoParticipantProxy=p,t["default"]=v,t.MsgInfoProxy=g},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MuteProxy=t["default"]=void 0;var i=a(2),o=n(i),r=a(80),s=n(r),l=a(243),u=a(5),c=a(1),d=a(22),f=a(47),p=a(12),h=a(61),m=a(15),v=a(163),g=a(0),y=(0,r.defineState)("Mute",{props:{id:"string",expiration:{type:"number","default":0}},session:{_unmuteTimer:"string",promises:{type:"object","default":function(){return{}}}},derived:{isMuted:{deps:["expiration"],fn:function(){return!!this.expiration}}},initialize:function(){s["default"].prototype.initialize.call(this),this.expiration&&this.mute(this.expiration)},setMute:function(e,t){(e||this.expiration)&&e!==this.expiration&&(e?this.mute(e,t):this.unmute(t))},mute:function S(e,t,a){var n=this;if(!_.isNumber(e))return c.log("models:Mute:mute called with invalid expiration "+e)(),o["default"].reject(new m.ActionError);e=Math.round(e),e>2e9&&c.log("models:Mute:mute called with wrong units?"+this.id+" exp:"+e)();var S=function(){this.isMuted&&this._clearUnmuteTimer();var t=e-g().unix();c.log("models:Mute:mute "+this.id+" duration:"+t)(),this._unmuteTimer=v.setTimeout(this.unmute.bind(this),1e3*e),this.set({expiration:e})}.bind(this),i=d.isGroup(this.id);if(t){if(this.promises.mute)return this.promises.mute;this.promises.mute=f.sendConversationMute(this.id,e,this.expiration);var r=i?new l.ActionType(l10n.t("action_group_muting")):new l.ActionType(l10n.t("action_chat_muting"));a=a||(0,l.genId)();var s=this.promises.mute["catch"](function(o){c.error("models:Mute:mute dropped")(o);var r=i?l10n.t("action_group_mute_failed"):l10n.t("action_chat_mute_failed");throw new l.ActionType(r,l10n.t("action_try_again"),n.mute.bind(n,e,t,a))}).then(function(e){if(200===e.status){var o=i?l10n.t("action_group_muted"):l10n.t("action_chat_muted");return new l.ActionType(o,l10n.t("action_undo"),n.unmute.bind(n,t,a))}if(e.status>=400)throw i?new l.ActionType(l10n.t("action_group_mute_failed")):new l.ActionType(l10n.t("action_chat_mute_failed"))});return p.openToast(u.createElement(l.ActionToast,{id:a,initialAction:r,pendingAction:s})),this.promises.mute.then(function(e){200!==e.status||e._duplicate||S()})["finally"](function(){n.promises.mute=null})}return S(),o["default"].resolve()},canMute:function(){return h.supportsFeature(h.F.MUTE)&&d.isGroup(this.id)||h.supportsFeature(h.F.MUTE_1_1)&&d.isUser(this.id)},_clearUnmuteTimer:function(){v.clearTimeout(this._unmuteTimer),this.unset("_unmuteTimer"),this.expiration=0},unmute:function C(e,t){var a=this,C=function(){c.log("models:Mute:unmute "+this.id)(),this._clearUnmuteTimer()}.bind(this),n=d.isGroup(this.id);if(e){if(this.promises.unmute)return this.promises.unmute;this.promises.unmute=f.sendConversationMute(this.id,!1,this.expiration);var i=n?new l.ActionType(l10n.t("action_group_unmuting")):new l.ActionType(l10n.t("action_chat_unmuting"));t=t||(0,l.genId)();var r=this.promises.unmute["catch"](function(i){c.error("models:Mute:unmute dropped")(i);var r=n?l10n.t("action_group_unmute_failed"):l10n.t("action_chat_unmute_failed");return o["default"].reject(new l.ActionType(r,l10n.t("action_try_again"),a.unmute.bind(a,e,t)))}).then(function(e){if(200===e.status)return n?new l.ActionType(l10n.t("action_group_unmuted")):new l.ActionType(l10n.t("action_chat_unmuted"));if(e.status>=400)throw n?new l.ActionType(l10n.t("action_group_unmute_failed")):new l.ActionType(l10n.t("action_chat_unmute_failed"))});return p.openToast(u.createElement(l.ActionToast,{id:t,initialAction:i,pendingAction:r})),this.promises.unmute.then(function(e){200!==e.status||e._duplicate||C()})["finally"](function(){a.promises.unmute=null})}return C(),o["default"].resolve()},"delete":function(){s["default"].prototype["delete"].call(this),Store.Mute.remove(this.id),this._clearUnmuteTimer()}}),E=y.Mute,M=y.MuteProxy;t["default"]=E,t.MuteProxy=M},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusProxy=t["default"]=void 0;var n=a(80),i=(0,n.defineState)("Status",{Collection:"Status",props:{id:"string",status:"string"},session:{stale:["boolean",!1,!0]}}),o=i.Status,r=i.StatusProxy;t["default"]=o,t.StatusProxy=r},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){for(var a=0,n=e[a];a<e.length;n=e[++a])if(n.type===t)return n;return null}var o=a(2),r=n(o),s=a(3),l=n(s),u=a(4),c=n(u),d=/\r\n/g,f=function(){function e(t){var a=this;(0,l["default"])(this,e),this.hasText=function(){return a.hasType("text/plain")},this.hasType=function(e){return-1!==a.types.indexOf(e)},this.data=t,this.types=t.types?Array.prototype.slice.call(t.types):[]}return(0,c["default"])(e,[{key:"getItems",value:function(){var e=this;if(this.data.items)return Array.prototype.slice.call(this.data.items);var t=this._getFileTypes();return this.types.map(function(a){return{type:a,data:e.data.getData(a),kind:t.indexOf(a)>=0?"string":"file"}})}},{key:"_getFileTypes",value:function(){return Array.prototype.slice.call(this.data.files).map(function(e){var t=e.type;return t})}},{key:"getText",value:function(){return this._getText().then(function(e){return e?e.replace(d,"\n"):null})}},{key:"_getText",value:function(){var e=this.data;if(e.getData)return r["default"].resolve(e.getData("text/plain"));var t=this.data.items,a=i(t,"text/plain");return a?new r["default"](function(e){return a.getAsString(e)}):r["default"].resolve()}},{key:"getFiles",value:function(){return this.data.items?Array.prototype.slice.call(this.data.items).filter(function(e){var t=e.kind;return"file"===t}).map(function(e){return e.getAsFile()}).filter(function(e){return!!e}):Array.prototype.slice.call(this.data.files||[])}},{key:"getData",value:function(e){return this.data.getData(e)}},{key:"hasFiles",value:function(){return this.data.items?Array.prototype.slice.call(this.data.items).some(function(e){var t=e.kind;return"file"===t}):!!Array.prototype.slice.call(this.data.files||[]).length}}]),e}();e.exports=f},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=!1,a=0;return l["default"].resolve().then(function(){var n="camera"===e?{video:!0,audio:!0}:{audio:!0},i=void 0;if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)i=navigator.mediaDevices.getUserMedia(n);else{if(!navigator.getUserMedia)throw new Error("MediaCapture:start no ability to capture media");i=new l["default"](function(e,t){window.navigator.getUserMedia(n,e,t)})}return a=setTimeout(function(){r(e),t=!0},1e3),i["catch"](function(e){var t=e&&e.name||e,a=p.GUM[t]||p.GUM.GUMError;return l["default"].reject(new a)})})["finally"](function(){t&&f["default"].closeModal(),a&&clearTimeout(a)})}function o(e){if("function"==typeof e.stop)e.stop();else for(var t=e.getTracks(),a=0;a<t.length;a++)t[a].stop()}function r(e){"camera"===e?f["default"].openModal(c["default"].createElement(m["default"],{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_description",type:m["default"].TYPE.GUIDE_ALLOW})):f["default"].openModal(c["default"].createElement(m["default"],{title:"guide_desktop_mic_title",desc:"guide_desktop_mic_description",type:m["default"].TYPE.GUIDE_ALLOW}))}Object.defineProperty(t,"__esModule",{value:!0});var s=a(2),l=n(s);t.start=i,t.stop=o;var u=a(5),c=n(u),d=a(12),f=n(d),p=a(15),h=a(1436),m=n(h)},function(e,t,a){"use strict";var n=a(478),i={multibyteLength:function(e){return n.ucs2.decode(e).length},multibyteSubstr:function(e,t,a){var i=n.ucs2.decode(e);if("undefined"==typeof a)i=i.slice(t);else{if(0>=a)return"";i=i.slice(t,t+a)}return n.ucs2.encode(i)}};e.exports=i},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(21),g=n(v),_=a(1),y=n(_),E=a(462),M=n(E),S=a(1402),C=n(S),b=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,
o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"getClasses",value:function(){var e=this.props.msg;switch(e.type){case"location":case"video":case"audio":case"vcard":case"document":case"ciphertext":case"unknown":case"image":return"icon-status-"+(e.isGif?"gif":e.type);case M["default"].TYPE.CALL_LOG:return"miss_video"===e.subtype?"icon-status-miss_video":"icon-status-miss";case"ptt":var t=4===e.ack?"blue":e.isSentByMe?"gray":"green";return"icon-status-"+e.type+"-"+t;default:y["default"].log('chat:getClasses Invalid msg type:"'+e.type+'"')()}return""}},{key:"render",value:function(){return m["default"].createElement("span",{className:(0,g["default"])("icon","msg-symbol",this.getClasses())})}}]),t}(m["default"].PureComponent);b.CONCERNS={msg:["ack","isGif","type","subtype","isSentByMe"]},t["default"]=(0,C["default"])(b)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(78),m=n(h),v=a(1404),g=(n(v),a(462)),_=(n(g),a(1482)),y=(n(_),a(1424)),E=n(y),M=a(161),S=n(M),C=a(239),b=a(5),k=a(14),T=a(13),w=a(21),N=a(242),P=a(12),A=a(1494),O=a(1412),R=(a(1416),a(160)),D=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onScroll=function(e){n.handleScroll(e.target)},n.handleScroll=T.throttle(function(e){var t=n.props.mediaMsgs;t.hasMediaBefore&&e.scrollTop+k.SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&n.queryMedia(T.head(t.models))},100),i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.props.mediaMsgs.hasMediaBefore&&this.queryMedia()}},{key:"componentDidMount",value:function(){this.props.listeners.add(this.props.mediaMsgs,"add remove reset"),this.props.listeners.add(this.props.mediaMsgs,"query_media_before")}},{key:"componentWillUnmount",value:function(){this.handleScroll.cancel()}},{key:"queryMedia",value:function(e){var t=this,a=this.props.mediaMsgs;a.hasMediaBefore&&this.props.listeners.uiIdle(function(){a.queryMedia(t.props.chat,e)})}},{key:"render",value:function(){var e=this,t=this.props.mediaMsgs,a=this.props,n=a.fullCollection,i=a.selectedMessages,o=t.map(function(a,o){var r=null;return!e.props.fullCollection&&o>=t.length-6&&o<=t.length-4&&(r="media-canvas-second-row"),b.createElement(L,{msg:a,hoverEvent:n,selectable:e.props.selectable,selectedMessages:i,onMessageSelect:e.props.onMessageSelect,className:r,key:a.id})});o.reverse(),n||(o=T.slice(o,0,6));var r=w("media-gallery",{"drawer-media-gallery":n,"media-gallery-empty":0===t.length});if(t.queryMediaBefore&&(n||o.length<6)){var s=w("more","media-canvas-component",{"media-canvas-second-row":!n&&o.length>=3,"media-canvas-first":0===t.length});o.push(b.createElement("div",{className:s,key:"spinner"},b.createElement(S["default"],{stroke:6,size:24,className:"spinner-muted"})))}if(0===t.length){if(n)return t.queryMediaBefore?b.createElement("div",{className:"drawer-media-gallery drawer-body"},b.createElement(O.Loading,null)):b.createElement(O.MediaMsgs,null);t.queryMediaBefore||t.hasMediaBefore||(r=w(r,"media-gallery-empty"),o=[R.t("no_media")])}else for(var l=0;6>l;l++)o.push(b.createElement("div",{className:"media-canvas-empty",key:"empty"+l}));return b.createElement("div",{onScroll:this.onScroll,className:r},o)}}]),t}(b.Component),x=function(e){function t(){(0,s["default"])(this,t);var e=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments));I.call(e);var a=e.props,n=a.msg,i=a.selectedMessages;return e.state={selected:!(!i||!i.isSelected(n))},e}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){this.props.selectedMessages&&this.props.listeners.add(this.props.selectedMessages,this.props.msg.id.toString(),this.onSelectChange)}},{key:"render",value:function(){var e=this.props.msg,t=e.mediaData,a=t.type===N.TYPE.IMAGE&&t.renderableUrl?this.onDragStart:null,n=w(this.props.className);return b.createElement(A,{classes:n,onClick:this.onClick,hoverEvent:this.props.hoverEvent,selectable:this.props.selectable,selected:this.state.selected,onMessageSelect:this.props.onMessageSelect,onDragStart:a,msg:e,imgRef:(0,C.GetRef)("img",this)})}}]),t}(b.Component),I=function(){var e=this;this.onSelectChange=function(t){e.state.selected!==t&&e.setState({selected:t})},this.onClick=function(t){var a=e.props,n=a.msg,i=a.selectable,o=a.onMessageSelect,r=n.mediaData;if(i&&o)return void o(n,!e.state.selected);if(r.mediaStage===N.STAGE.ERROR_MISSING)return void P.openModal(b.createElement(E["default"],{msg:n}));t&&t.stopPropagation();var s=void 0,l=n.id;r.type===N.TYPE.IMAGE&&!function(){var t=e.img;s=function(e){return l.equals(e)&&t?t:null}}(),P.mediaViewerModal(n,s)},this.onDragStart=function(t){t.nativeEvent.dataTransfer.setData(k.DRAG_TYPE_LOCAL_IMAGE,!0),t.nativeEvent.dataTransfer.setData("text/uri-list",e.props.msg.mediaData.renderableUrl)}},L=(0,m["default"])(x);e.exports=(0,m["default"])(D)},function(e,t){"use strict";e.exports=function(e,t){for(var a=e.childNodes,n=0;n<a.length;++n)if(a[n]===t)return n;return-1}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(1484),o=n(i),r=(0,o["default"])({FORWARD:void 0,BACKWARD:void 0});e.exports=function(e,t){var a=window.getSelection();if(!a||!a.rangeCount)return null;var n=a.getRangeAt(0);if(!n.collapsed)return null;var i=n.startContainer,o=n.startOffset;if(i===e){var s=i.childNodes,l=s.length;if(t===r.FORWARD&&o>l||t===r.BACKWARD&&!o)return null;var u=t===r.BACKWARD?1:0,c=s[o-u];return c instanceof Element?c:null}var d=i.length===o;if(t===r.BACKWARD&&o)return null;if(t===r.FORWARD&&!d)return null;var f=t===r.BACKWARD?"previousSibling":"nextSibling",p=i[f];return p instanceof Element?p:null},e.exports.Direction=r},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(62),o=n(i),r=a(98),s=n(r),l=a(5),u=n(l),c=a(21),d=n(c);t["default"]=function(e){var t=e.header,a=(0,s["default"])(e,["header"]);return u["default"].createElement("div",(0,o["default"])({className:(0,d["default"])("section-header")},a),t)}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(78),g=n(v),_=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n._videoRef=null,n.setVideoRef=function(e){n._videoRef&&n.props.listeners.remove(n._videoRef,"playing",n.onPlay),n._videoRef=e,e&&n.props.listeners.add(e,"playing",n.onPlay)},n.onPlay=function(e){var t=n._videoRef;t&&(t.videoHeight&&t.videoWidth||(t.pause(),t.play()),t.videoHeight&&t.videoWidth&&n.props.onPlay&&n.props.onPlay(t))},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"underlyingVideo",value:function(){return this._videoRef}},{key:"play",value:function(){var e=this._videoRef;e&&e.paused&&e.play()}},{key:"pauseAndReset",value:function(){var e=this._videoRef;e&&(e.currentTime=0,e.paused||e.pause())}},{key:"render",value:function(){var e=this.props;return m["default"].createElement("video",{ref:this.setVideoRef,src:e.src,className:e.className,autoPlay:e.autoPlay,muted:e.muted,width:e.width,height:e.height,loop:e.loop,onClick:e.onClick,onEnded:e.onEnded},e.children)}}]),t}(h.PureComponent);t.Component=_;t["default"]=(0,g["default"])(_)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1409),g=n(v),_=a(21),y=n(_),E=a(48),M=n(E),S=a(78),C=n(S),b=a(13),k=n(b),T=function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));return a.promise=null,a._clearPromise=function(){a.promise=null},a._handleImageChange=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.setState({img:e.img})},a.state={img:null},a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){var e=this,t=this.props.waid;t&&(this.promise=Store.ProfilePicThumb.find(t).then(function(t){e.props.listeners.add(t,"change:img",e._handleImageChange),e._handleImageChange(t)})["catch"](k["default"].noop)["finally"](this._clearPromise))}},{key:"componentWillUnmount",value:function(){this.promise&&this.promise.cancel()}},{key:"render",value:function(){if(this.state.img&&this.props.waid)return m["default"].createElement(g["default"],{id:this.props.waid,className:this.props.className,quoted:this.props.quoted,size:this.props.size});var e=(0,y["default"])("preview","icon-user-default",this.props.className,{"preview-vcard":!this.props.thumb,"no-image":!this.props.thumb,"icon-user-default-square":!!this.props.quoted});return m["default"].createElement("div",{className:e},m["default"].createElement("div",{className:"preview-image",style:M["default"].thumbAsBackgroundImage(this.props.thumb)}),m["default"].createElement("span",{className:"meta meta-audio"}))}}]),t}(m["default"].PureComponent);t["default"]=(0,C["default"])(T)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){switch(e.type){case ie["default"].TYPE.NOTIFICATION:return"message-notification";case ie["default"].TYPE.GROUP_NOTIFICATION:return"message-group_notification";case ie["default"].TYPE.GP2:return"message-gp2";case ie["default"].TYPE.BROADCAST_NOTIFICATION:return"message-broadcast_notification";case ie["default"].TYPE.E2E_NOTIFICATION:return"message-e2e_notification";case ie["default"].TYPE.CALL_LOG:return"message-call_log";case ie["default"].TYPE.PROTOCOL:return"message-protocol";case ie["default"].TYPE.CHAT:return"message-chat";case ie["default"].TYPE.LOCATION:return"message-location";case ie["default"].TYPE.VCARD:return"message-vcard";case ie["default"].TYPE.CIPHERTEXT:return"message-ciphertext";case ie["default"].TYPE.MULTI_VCARD:return"message-multi_vcard";case ie["default"].TYPE.REVOKED:return"message-revoked";case ie["default"].TYPE.IMAGE:return"message-image";case ie["default"].TYPE.VIDEO:return e.mediaData.isGif?"message-image":"message-video";case ie["default"].TYPE.AUDIO:return"message-audio";case ie["default"].TYPE.PTT:return"message-ptt";case ie["default"].TYPE.DOCUMENT:return"message-document";case ie["default"].TYPE.UNKNOWN:return"message-unknown";default:return}}function o(e){e.stopPropagation()}function r(){}Object.defineProperty(t,"__esModule",{value:!0}),t.Wrapper=t.MsgPosition=void 0;var s,l,u=a(2),c=n(u),d=a(6),f=n(d),p=a(3),h=n(p),m=a(4),v=n(m),g=a(8),_=n(g),y=a(7),E=n(y),M=a(5),S=n(M),C=a(1428),b=n(C),k=a(12),T=n(k),w=a(1726),N=n(w),P=a(238),A=n(P),O=a(14),R=n(O),D=a(21),x=n(D),I=a(1426),L=n(I),F=a(471),U=n(F),j=a(1403),G=n(j),B=a(1600),V=n(B),H=a(1476),W=n(H),z=a(61),Y=n(z),q=a(78),K=n(q),Q=a(1),X=n(Q),Z=a(242),J=n(Z),$=a(1606),ee=n($),te=a(1415),ae=n(te),ne=a(462),ie=n(ne),oe=a(1504),re=n(oe),se=a(1416),le=(n(se),a(1473)),ue=n(le),ce=a(115),de=n(ce),fe=a(46),pe=n(fe),he=a(1432),me=n(he),ve=a(1517),ge=n(ve),_e=a(1402),ye=n(_e),Ee=a(240),Me=n(Ee),Se=a(1429),Ce=n(Se),be=a(463),ke=n(be),Te=a(239),we=t.MsgPosition={FRONT:"FRONT",MID:"MID",END:"END",SINGLE:"SINGLE"},Ne=new N["default"],Pe=(0,K["default"])(function(e){function t(){var e,a,n,i;(0,h["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,_["default"])(this,(e=t.__proto__||(0,f["default"])(t)).call.apply(e,[this].concat(r))),n.scrollMsg=function(e,t){n.props.parent.scrollMsg(e,t)},n.flashFocusedMsg=function(e){n.props.parent.highlight(e)},i=a,(0,_["default"])(n,i)}return(0,E["default"])(t,e),(0,v["default"])(t,[{key:"componentWillMount",value:function(){this.props.listeners.add(T["default"],"scroll_to_focused_msg",this.scrollMsg),this.props.listeners.add(T["default"],"flash_focused_msg",this.flashFocusedMsg)}},{key:"render",value:function(){return null}}]),t}(S["default"].PureComponent)),Ae=(0,K["default"])(function(e){function t(){var e,a,n,i;(0,h["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,_["default"])(this,(e=t.__proto__||(0,f["default"])(t)).call.apply(e,[this].concat(r))),n.onSelectChange=function(e){n.props.parent.onSelectChange(e)},i=a,(0,_["default"])(n,i)}return(0,E["default"])(t,e),(0,v["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.listeners,a=e.msgId,n=e.selectedMessages;t.add(n,a,this.onSelectChange)}},{key:"componentDidUpdate",value:function(e){var t=this.props,a=t.listeners,n=t.msgId,i=t.selectedMessages;e.selectedMessages!==i&&(a.remove(e.selectedMessages,n,this.onSelectChange),a.add(i,n,this.onSelectChange))}},{key:"render",value:function(){return null}}]),t}(S["default"].PureComponent)),Oe=(0,ye["default"])((l=s=function(e){function t(){return(0,h["default"])(this,t),(0,_["default"])(this,(t.__proto__||(0,f["default"])(t)).apply(this,arguments))}return(0,E["default"])(t,e),(0,v["default"])(t,[{key:"componentDidUpdate",value:function(){this.props.parent.forceUpdate()}},{key:"render",value:function(){return null}}]),t}(S["default"].PureComponent),s.CONCERNS={mediaData:["mediaStage","isGif"]},l)),Re=t.Wrapper=function(e){function t(e){(0,h["default"])(this,t);var a=(0,_["default"])(this,(t.__proto__||(0,f["default"])(t)).call(this,e));return a.didCancel=!1,a.highlightAnimation=null,a.refMsgComponent=null,a.mouseEnter=function(e){e.buttons||a.state.hover||!a.contextEnabled()||a.setState({hover:!0})},a.mouseLeave=function(){a.state.hover&&a.contextEnabled()&&a.setState({hover:!1})},a.mouseDown=function(){a.state.hover&&a.setState({hover:!1})},a.onDoubleClick=function(e){var t=(0,_e.unproxy)(a.props.msg);if(t.canReply()&&!a.props.selectable){var n=function(e,t){for(var a=t;a;){if(a===e)return!0;a=a.parentNode}return!1};n(a.refs.bubble,e.target)||(t.chat.composeQuotedMsg=t,T["default"].focusChatTextInput(t.chat),a.highlight())}},a.state={contextMenu:!1,hover:!1,highlighting:!1,selected:e.selectedMessages?e.selectedMessages.isSelected((0,_e.unproxy)(e.msg)):!1},a}return(0,E["default"])(t,e),(0,v["default"])(t,[{key:"componentWillUnmount",value:function(){var e=pe["default"].findDOMNode(this.refs.bubble);e&&(0,ke["default"])(e,"finish",!0)}},{key:"scrollMsg",value:function(e,t){X["default"].info("scroll msg")(),X["default"].info(t)();var a=pe["default"].findDOMNode(this);a?X["default"].info("node found")():X["default"].info("node not found!")(),X["default"].info("calling DOM.scrollAt ")(),L["default"].scrollAt(a,null,t).then(e)}},{key:"highlight",value:function(e){var t=this,a=this.refs.highlightTail,n=this.refs.bubble;if(a&&n){this.setState({highlighting:!0}),this.highlightAnimation&&(this.didCancel=!0,this.highlightAnimation.cancel());var i=pe["default"].findDOMNode(a),o=pe["default"].findDOMNode(n);this.highlightAnimation=(this.highlightAnimation||c["default"].resolve()).then(function(){var e=250,a=250,n=(0,ke["default"])(i,{opacity:[1,0]},{duration:e}),r=(0,ke["default"])(i,{opacity:[0,1]},{duration:e,delay:a}),s=void 0,l=void 0;t.props.msg.isNotification?(s="#e1f2fb",l="#b6c9d2"):(s=t.props.msg.isSentByMe?"#dcf8c6":"#ffffff",l=t.props.msg.isSentByMe?"#b3cba1":"#cccccc");var u=(0,ke["default"])(o,{backgroundColor:[l,s]},{duration:e}),d=(0,ke["default"])(o,{backgroundColor:[s,l]},{duration:e,delay:a});return c["default"].all([n,r,u,d])}).cancellable().then(function(){t.onHighlightComplete(e)})["catch"](c["default"].CancellationError,function(){(0,ke["default"])(i,"stop",!0),(0,ke["default"])(o,"stop",!0)})["finally"](function(){t.didCancel?t.didCancel=!1:t.highlightAnimation=null})}}},{key:"onHighlightComplete",value:function(e){this.setState({highlighting:!1},function(){e&&e()})}},{key:"resend",value:function(){var e=this.props.msg;e.isMMS&&!Y["default"].supportsFeature(Y["default"].F.MEDIA_RETRY)?T["default"].openModal(S["default"].createElement(me["default"],{msg:e})):e.resend()["catch"](function(e){X["default"].log("wrapper:resend failure: "+e)()})}},{key:"openForwardFlow",value:function(e){var t,a=this.props.msg;if(a.type===ie["default"].TYPE.CIPHERTEXT?t=l10n.t("err_unsent_forward_text_decrypting"):a.type===ie["default"].TYPE.REVOKED?t=l10n.t("err_unsent_forward_text_revoked"):a.isUnsentMedia&&(t=l10n.t("err_unsent_forward_text")),t)T["default"].openModal(S["default"].createElement(A["default"],{title:l10n.t("err_unsent_forward_title"),onOK:T["default"].closeModal.bind(T["default"]),okText:l10n.t("web_ok")},t));else{if(e&&this.props.displayType===R["default"].DISP_TYPE.CONVERSATION)return void this.onSelectClick();T["default"].openModal(S["default"].createElement(W["default"],{msgs:[(0,_e.unproxy)(a)]}),"modal-flow")}}},{key:"openInfoDrawer",value:function(){T["default"].msgInfoDrawer((0,_e.unproxy)(this.props.msg))}},{key:"openContactChat",value:function(){Store.Chat.find(this.props.msg.author).then(function(e){T["default"].openChatFromUnread(e).then(function(t){t&&T["default"].focusChatTextInput(e)})})}},{key:"contextEnabled",value:function(){return!this.props.msg.isNotification}},{key:"onDeleteMessage",value:function(){var e=this,t=function(){var t=(0,_e.unproxy)(e.props.msg);T["default"].closeModal(),T["default"].sendDeleteMsgs(t.chat,[t])},a=l10n.t("delete_message_confirmation");T["default"].openModal(S["default"].createElement(A["default"],{onOK:t,okText:l10n.t("web_delete"),onCancel:T["default"].closeModal.bind(T["default"]),cancelText:l10n.t("web_cancel")},S["default"].createElement(G["default"],{text:a})))}},{key:"onRevokeMessage",value:function(){var e=(0,_e.unproxy)(this.props.msg);T["default"].openModal(S["default"].createElement(ge["default"],{chat:e.chat,msgList:[e]}))}},{key:"onReplyMessage",value:function(){var e=(0,_e.unproxy)(this.props.msg),t=e.chat;t.composeQuotedMsg=e,T["default"].focusChatTextInput(t)}},{key:"onPrivateReplyMessage",value:function(){var e=(0,_e.unproxy)(this.props.msg);Store.Chat.find(e.sender).then(function(e){return c["default"].props({ok:T["default"].openChatBottom(e),chat:e})}).then(function(t){var a=t.ok,n=t.chat;a&&(n.composeQuotedMsg=e,T["default"].focusChatTextInput(n))})}},{key:"onDownload",value:function(){U["default"].initDownload((0,_e.unproxy)(this.props.msg))}},{key:"onStarMessage",value:function(){var e=(0,_e.unproxy)(this.props.msg);T["default"].sendStarMsgs(e.chat,[e])}},{key:"onUnstarMessage",value:function(){var e=(0,_e.unproxy)(this.props.msg);T["default"].sendUnstarMsgs(e.chat,[e])}},{key:"onMenu",value:function(e){var t=this;if(e.stopPropagation(),e.preventDefault(),e.isTrusted&&this.state.contextMenu)return void this.setState({contextMenu:!1});var a=(0,_e.unproxy)(this.props.msg),n=[];a.isSentByMe&&Y["default"].supportsFeature(Y["default"].F.MESSAGE_INFO)&&this.props.displayType!==R["default"].DISP_TYPE.MSG_INFO&&n.push(S["default"].createElement(ae["default"],{key:"info",a8n:"mi-msg-info",action:function(){t.openInfoDrawer()}},l10n.t("message_info"))),a.canReply()&&n.push(S["default"].createElement(ae["default"],{key:"reply",a8n:"mi-msg-reply",action:function(){t.onReplyMessage()}},l10n.t("reply"))),a.mediaData&&a.mediaData.renderableUrl&&n.push(S["default"].createElement(ae["default"],{key:"download",a8n:"mi-msg-download",action:function(){t.onDownload()}},l10n.t("web_button_download"))),a.canForward()&&n.push(S["default"].createElement(ae["default"],{key:"forward",a8n:"mi-msg-forward",action:function(){t.openForwardFlow(!0)}},l10n.t("forward_message"))),a.canStar()&&(a.star?n.push(S["default"].createElement(ae["default"],{key:"star",a8n:"mi-msg-unstar",action:function(){t.onUnstarMessage()}},l10n.t("unstar_message"))):n.push(S["default"].createElement(ae["default"],{key:"star",a8n:"mi-msg-star",action:function(){t.onStarMessage()}},l10n.t("star_message")))),Y["default"].supportsFeature(Y["default"].F.MESSAGE_DELETE)&&n.push(S["default"].createElement(ae["default"],{key:"delete",a8n:"mi-msg-delete",action:function(){t.onDeleteMessage()}},l10n.t("delete_message"))),a.isGroupMsg&&a.author&&!a.isSentByMe&&n.push(S["default"].createElement(ae["default"],{key:"author",a8n:"mi-msg-author",action:function(){t.openContactChat()}},l10n.t("message_author",{author:a.displayName()}))),a.canRevoke()&&n.push(S["default"].createElement(ae["default"],{key:"revoke",a8n:"mi-msg-revoke",action:function(){t.onRevokeMessage()}},l10n.t("revoke_message"))),this.setState({contextMenu:{menu:n,anchor:e.target,className:"dropdown-compact"}})}},{key:"contextOpen",value:function(){this.context&&this.context.click()}},{key:"contextClose",value:function(){this.setState({contextMenu:!1})}},{key:"getMsgComponent",value:function(){var e=this.props,t=e.msg,a=e.position,n=e.displayType,i=e.isMsgVisible,o=n!==R["default"].DISP_TYPE.STARRED_MSGS&&!!t.quotedMsg||!(a===we.MID||a===we.END),r=void 0;if(Y["default"].supportsFeature(Y["default"].F.REPLIES_IN)){var s=t.quotedMsgObj();s&&(r=S["default"].createElement(ue["default"],{msg:s,key:s.id.toString(),rootMsg:(0,_e.unproxy)(t),displayType:n,chat:t.chat}))}return S["default"].createElement(re["default"],{msg:t,ref:(0,Te.GetRef)("refMsgComponent",this),quotedMsg:r,displayAuthor:o,isMsgVisible:i})}},{key:"onSelectClick",value:function(e){e&&e.stopPropagation();var t=this.props.onMessageSelect;t?t((0,_e.unproxy)(this.props.msg),!this.state.selected):X["default"].assert(!1,"wrapper-onSelectClick","no onMessageSelect")()}},{key:"onSelectChange",value:function(e){this.state.selected!==e&&this.setState({selected:e})}},{key:"render",value:function(){var e,t=this,a=this.props,n=a.msg,s=a.position,l=a.displayType,u=l===R["default"].DISP_TYPE.CONVERSATION;(this.state.hover&&!this.state.highlighting||this.props.current||this.state.contextMenu)&&n.type!==ie["default"].TYPE.REVOKED&&(e=S["default"].createElement(ee["default"],{msg:n,position:s,key:"icon-context",ref:(0,Te.GetRef)("context",this),onClick:function(e){return t.onMenu(e)}}));var c,d=n.mediaData,f=d?d.mediaStage:"NA";n.isFailed&&f===J["default"].STAGE.ERROR_MISSING?c=S["default"].createElement(V["default"],{onResend:r,errMsg:l10n.t("unsent_media_not_on_phone")}):n.type===ie["default"].TYPE.PTT&&n.isFailed&&f===J["default"].STAGE.PREPARING?c=S["default"].createElement(V["default"],{onResend:r,errMsg:l10n.t("ptt_failed")}):Y["default"].supportsFeature(Y["default"].F.RESEND_ICON)&&u&&n.isFailed&&f!==J["default"].STAGE.REMOTE_UPLOADING?c=S["default"].createElement(V["default"],{onResend:function(){return t.resend()},errMsg:l10n.t("resend_message")}):!n.isUnsentMedia||f!==J["default"].STAGE.ERROR_MISSING&&f!==J["default"].STAGE.ERROR_UNSUPPORTED||(c=S["default"].createElement(V["default"],{onResend:r,errMsg:l10n.t("send_failed")}));var p=null;if(!n.isNotification&&this.props.selectable){var h=function(e){t.onSelectClick(e)};p=S["default"].createElement("div",{className:"msg-select",onClick:h},S["default"].createElement(b["default"],{onChange:h,checked:this.state.selected}))}var m=s===we.MID||s===we.END,v=!1;if(n.type===ie["default"].TYPE.CHAT){var g=Ne.match(n.body);v=1===g.length&&g[0][0].length===n.body.length}var _=n.type,y=_===ie["default"].TYPE.CIPHERTEXT||_===ie["default"].TYPE.REVOKED||_===ie["default"].TYPE.UNKNOWN,E=_===ie["default"].TYPE.CHAT&&!n.linkPreview,M=n.chat&&n.chat.isPSA,C=(0,x["default"])("msg",{"msg-continuation":s===we.FRONT||s===we.MID,"msg-group":n.isGroupMsg&&!m,"msg-psa":l!==R["default"].DISP_TYPE.STARRED_MSGS&&M,selected:this.state.selected,"msg-system":n.isNotification}),k=(0,x["default"])("message",i(n),{"message-system":n.isNotification,"message-out":!n.isNotification&&n.isSentByMe,"message-in":!n.isNotification&&!n.isSentByMe,hover:this.state.contextMenu||this.state.hover,tail:!(M||this.props.tailOverride||s!==we.FRONT&&s!==we.SINGLE),"tail-override-left":"left"===this.props.tailOverride,"tail-override-right":"right"===this.props.tailOverride,"message-chat":E||y,"message-code":v,"message-placeholder":y}),T=void 0;T=this.state.contextMenu?"none":"rtl"===n.dir||void 0===n.dir&&l10n.isRTL()?"pop-fast-reverse":"pop-fast";var w=S["default"].createElement("span",{className:"tail-container highlight",ref:"highlightTail"}),N=void 0;this.state.contextMenu&&(N=S["default"].createElement(Me["default"],{displayName:"MsgContextMenu",escapable:!0,popable:!0,requestDismiss:function(){return t.contextClose()}},S["default"].createElement(Ce["default"],{contextMenu:this.state.contextMenu})));var P=void 0;this.props.isFocusedMsg&&(P=S["default"].createElement(Pe,{parent:this}));var A=void 0;this.props.selectedMessages&&(A=S["default"].createElement(Ae,{parent:this,msgId:n.id.toString(),selectedMessages:this.props.selectedMessages}));var O=void 0;u&&!this.props.selectable&&n.canForward()&&(n.isMMS||n.linkPreview||n.type===ie["default"].TYPE.LOCATION)&&(O=S["default"].createElement("div",{className:"icon icon-forward-chat btn-forward-chat",onClick:function(){return t.openForwardFlow(!1)}}));var D=void 0;n.mediaData&&(D=S["default"].createElement(Oe,{parent:this,mediaData:n.mediaData}));var I=o;return S["default"].createElement("div",{className:C,onDoubleClick:this.onDoubleClick},S["default"].createElement(de["default"],{transitionName:"delay-leave"},p),S["default"].createElement("div",{className:k,ref:"bubble"},S["default"].createElement("div",{onContextMenu:I,onMouseOver:this.mouseEnter,onMouseEnter:this.mouseEnter,onMouseDown:this.mouseDown,onMouseUp:this.mouseEnter,onMouseLeave:this.mouseLeave},S["default"].createElement("span",{className:"tail-container"}),"  ",w,"                      ",c,this.getMsgComponent(),S["default"].createElement(de["default"],{transitionName:T},e)),O),N,P,A,D)}}]),t}(S["default"].PureComponent);Re.defaultProps={displayType:R["default"].DISP_TYPE.CONVERSATION},Re.CONCERNS={msg:["author","body","chat","dir","id","isFailed","isGroupMsg","isMedia","isMMS","isNotification","isSentByMe","isUnsentMedia","linkPreview","mediaData","quotedMsg","sender","star","type"]},t["default"]=(0,ye["default"])(Re)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(463),g=n(v),_=a(1421),y=n(_),E=a(1405),M=n(E),S=a(1407),C=n(S),b=a(1406),k=n(b),T=a(1434),w=n(T),N=a(1486),P=n(N),A=a(1404),O=(n(A),a(241)),R=n(O),D=a(1417),x=n(D),I=a(1454),L=n(I),F=a(1550),U=n(F),j=a(116),G=n(j),B=a(5),V=a(46),H=a(13),W=window.Store,z=a(12),Y=a(1412),q=a(1411),K=a(1416),Q=a(95),X=a(160),Z=a(61),J=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),n.filteredData=null,n.setSearch=function(e){return n.search=e},n.state={searchText:""},n.handleSelect=function(e,t){n.selectedChats.setVal(e,t),n.active.setVal(e)},n.onCancelSelection=function(){n.selectedChats.unsetAll()},n.onSearch=function(e){n.filteredData=null,n.setState({searchText:e})},n.onFocusList=function(e){e.preventDefault(),e.stopPropagation(),G["default"].flashFocus=Date.now(),n.active.setFirst()},n.indicateSearchFocus=function(e){if(n.active.unset(),!(Date.now()-(G["default"].flashFocus||0)>200)&&n.search){var t=V.findDOMNode(n.search);(0,g["default"])(t,"stop"),(0,g["default"])(t,{backgroundColor:["#fbfbfb","#D9F3FF"]},{duration:1600,easing:[.19,.69,.01,.99]})}},n.onNext=function(e){e.preventDefault(),e.stopPropagation(),n.active.setNext()},n.onPrev=function(e){e.stopPropagation(),e.preventDefault();var t=n.active.prev();t>-1?n.active.setPrev():(n.active.unset(),G["default"].flashFocus=Date.now(),Q.focus(n.search))},n.onChat=function(){o["default"].map(n.selectedChats.getSelected(),function(e){return e instanceof R["default"]?W.Chat.find(e.id):e}).then(function(e){n.props.onChat(e)})},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){var e=this;this.active=new q(this.getData(),function(e){return e.id}),this.selectedChats=new K([],function(e){return e.id}),this.props.getInitialItems&&H.forEach(this.props.getInitialItems(),function(t){return e.selectedChats.setVal(t,!0)})}},{key:"getFrequentContacts",value:function(){var e=this.state.searchText;return e||!Z.supportsFeature(Z.F.FREQUENT_CONTACTS)?[]:W.Contact.frequentContacts(null,this.props.excludeChat)}},{key:"getFilteredChats",value:function(){var e=this.state.searchText;return e?(e=X.accentFold(e),W.Chat.filter(function(t){return t.canSend&&t.isVisible&&t.contact.searchMatch(e)})):W.Chat.filter(function(e){return e.canSend&&e.isVisible})}},{key:"getFilteredContacts",value:function(){var e=W.Contact.getFilteredContacts(),t=this.state.searchText;return t?(t=X.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e}},{key:"getFilteredData",value:function(){if(this.filteredData)return this.filteredData;var e={},t=H.compact(H.map(this.getFrequentContacts(),function(t){var a=t.isGroup?W.Chat.get(t.id):t;return a&&(e[a.id]=!0),a})),a=H.compact(H.map(this.getFilteredChats(),function(t){var a=t.isGroup?t:t.contact;return e[a.id]?null:(e[a.id]=!0,a)})),n=H.compact(H.map(this.getFilteredContacts(),function(t){return e[t.id]?null:t}));return this.filteredData={frequentContactsData:t,chatsData:a,contactsData:n},this.filteredData}},{key:"getFilteredItems",value:function(){var e=this,t=[],a=this.getFilteredData(),n=a.frequentContactsData,i=a.chatsData,o=a.contactsData;return n.length&&t.push(B.createElement(L["default"],{key:"frequent-contacts-header",header:X.t("web_frequent_contacts")})),H.forEach(n,function(a){t.push(B.createElement(P["default"],{key:a.id,chat:a,active:e.active,selections:e.selectedChats,onSelect:e.handleSelect}))}),i.length&&t.push(B.createElement(L["default"],{key:"chat-header",header:X.t("web_recent_chats")})),H.forEach(i,function(a){t.push(B.createElement(P["default"],{key:a.id,chat:a,active:e.active,selections:e.selectedChats,onSelect:e.handleSelect}))}),o.length&&t.length&&t.push(B.createElement(L["default"],{key:"contact-header",header:X.t("web_other_contacts")})),H.forEach(o,function(a){t.push(B.createElement(P["default"],{key:a.id,chat:a,active:e.active,selections:e.selectedChats,onSelect:e.handleSelect}))}),t}},{key:"getData",value:function(){var e=this.getFilteredData(),t=e.frequentContactsData,a=e.chatsData,n=e.contactsData;return H.concat(t,a,n)}},{key:"getList",value:function(){var e=this.getFilteredItems();return 0===e.length?null:B.createElement(x["default"],{data:e,height:72,extraItems:4})}},{key:"onCancel",value:function(){z.closeModal()}},{key:"render",value:function(){var e=this.getList();this.active.init(this.getData()),e||(e=this.state.searchText?B.createElement(Y.Search,null):B.createElement(Y.ListChats,null));var t={down:this.onFocusList},a={down:this.onNext,up:this.onPrev},n=this.props.getInitialItems?0!==this.props.getInitialItems().length:!1;return B.createElement(y["default"],{type:_.TowerModalType},B.createElement(M["default"],{key:"chat-modal",onCancel:this.onCancel},B.createElement(C["default"],{title:this.props.title,type:S.DRAWER_HEADER_TYPE.POPUP,onCancel:this.onCancel}),B.createElement(G["default"],{handlers:t,onFocus:this.indicateSearchFocus},B.createElement(w["default"],{ref:this.setSearch,onSearch:this.onSearch,placeholder:X.t("search")})),B.createElement(k["default"],{"data-list-scroll-container":!0},B.createElement(G["default"],{handlers:a,className:"column"},B.createElement("div",{className:"chatlist column"},e))),B.createElement(U["default"],{selections:this.selectedChats,onForward:this.onChat,
startActive:n})))}}]),t}(B.Component);e.exports=J},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(5),o=n(i),r=a(21),s=n(r),l=function(e){var t=e.children,a=e.className;return o["default"].createElement("div",{className:(0,s["default"])("drawer-action-list chatlist list-icons",a)},t)};t["default"]=l},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatPreferenceProxy=t["default"]=void 0;var n=a(80),i=(0,n.defineState)("ChatPreference",{Collection:"ChatPreference",props:{id:"string",wallpaperColor:"string"}}),o=i.ChatPreference,r=i.ChatPreferenceProxy;t["default"]=o,t.ChatPreferenceProxy=r},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.PresenceProxy=t["default"]=t.ChatstateProxy=t.Chatstate=void 0;var i=a(2),o=n(i),r=a(80),s=n(r),l=a(14),u=a(1),c=a(22),d=a(245),f=a(47),p=a(79),h=1500,m=2e3,v=(0,r.defineState)("Chatstate",{props:{id:"string",type:{type:"string",values:["available","unavailable","composing","recording"]},t:{type:"number",allowNull:!0},deny:"boolean"},session:{updateTime:"number",_expireTimerId:["number",!1,0]}}),g=v.Chatstate,y=v.ChatstateProxy;t.Chatstate=g,t.ChatstateProxy=y;var E=d.extend({model:g}),M=(0,r.defineState)("Presence",{Collection:"Presence",props:{id:"string"},session:{isOnline:"boolean",stale:["boolean",!1,!0],hasData:["boolean",!1,!1],isSubscribed:["boolean",!1,!1],withholdDisplay:["boolean",!1,!0],forceDisplay:["boolean",!1,!1],chatActive:["boolean",!1,!1],withholdDisplayTimer:"number",forceDisplayTimer:"number",chatstate:"object"},collections:{chatstates:E},derived:{isGroup:{fn:function(){return c.isGroup(this.id)}},isUser:{fn:function(){return c.isUser(this.id)}}},initialize:function(){s["default"].prototype.initialize.call(this);var e=this.isGroup?{id:"",type:"unavailable"}:{id:this.id};this.addChild("chatstate",new g(e)),this.isGroup?this.listenTo(this.chatstates,"add change",_.debounce(function(){var e,t=!1;this.chatstates.forEach(function(a){"composing"!==a.type&&"recording"!==a.type||e&&!(e.updateTime<a.updateTime)||(e=a),t=t||"unavailable"!==a.type}),this.set({isOnline:t}),this.chatstate.set({id:e?e.id:"",type:e?e.type:"unavailable"})})):this.listenTo(this.chatstate,"change:type",function(){this.isOnline="unavailable"!==this.chatstate.type}),this.listenTo(this,"change:chatActive",this.onChatActiveChange)},"delete":function(){s["default"].prototype["delete"].call(this),Store.Presence.remove(this.id),this.chatstate["delete"](),this.chatstates.forEach(function(e){e["delete"]()})},handle:function(e){"undefined"==typeof e.type?e.type=this.chatstate.type||"unavailable":"paused"===e.type&&(e.type="available"),this.isGroup&&"available"!==e.type&&(e.updateTime=Date.now());var t;if(this.isGroup){if(e.id=e.participant,e.participant=void 0,!e.id)return;t=this.chatstates.add(e,{merge:!0})}else t=this.chatstate.set(e);t._expireTimerId&&clearTimeout(t._expireTimerId),"composing"===t.type||"recording"===t.type?t._expireTimerId=_.delay(this._expireComposing,l.PRESENCE_COMPOSING_TIMEOUT,t):t._expireTimerId=0;var a=this.forceDisplay||this.isOnline||this.isUser&&!this.chatstate.deny;this.set({hasData:!0,forceDisplay:a})},_expireComposing:function(e){var t=e.type;"composing"===t||"recording"===t?e.type="available":u.error("models:presence:expireComposing "+t)()},reset:function(){this.hasData=!1,this.isGroup?this.chatstates.forEach(function(e){e.type="unavailable"}):this.isUser&&(this.chatstate.unset("t"),this.chatstate.unset("deny")),this.chatstate.set({id:this.isGroup?"":this.id,type:"unavailable",t:void 0,deny:void 0})},isActive:function(){var e=this.chatstate.type;return this.hasData&&("composing"===e||"recording"===e)},getFormattedString:function(){if(!this.hasData)return null;if(this.isGroup){var e=this.chatstate.id;if(!e)return null;var t=Store.Contact.get(e);if(!t)return null;var a=t.formattedShortName;return"composing"===this.chatstate.type?l10n.t("web_conversation_name_is_composing",{participant:a}):l10n.t("web_conversation_name_is_recording",{participant:a})}if(!this.isUser)return null;var n=this.chatstate;switch(n.type){case"available":return l10n.t("web_conversation_contact_online");case"composing":return l10n.t("web_conversation_is_composing");case"recording":return l10n.t("web_conversation_is_recording");case"unavailable":return n.deny||!n.t?null:p.lastSeenStr(n.t)}},onChatActiveChange:function(){var e=this.chatActive;e?(this.hasData?this.withholdDisplay=!1:this.withholdDisplayTimer=_.delay(function(e){e.set({withholdDisplay:!1,withholdDisplayTimer:0})},h,this),this.forceDisplayTimer=_.delay(function(e){e.set({forceDisplay:!0,forceDisplayTimer:0})},m,this)):(this.withholdDisplayTimer&&(clearTimeout(this.withholdDisplayTimer),this.withholdDisplayTimer=0),this.forceDisplayTimer&&(clearTimeout(this.forceDisplayTimer),this.forceDisplayTimer=0))},subscribe:function(){return this.isSubscribed?o["default"].resolve():this.isUser?this.update():this.isGroup?(this.isSubscribed=!0,o["default"].all([this.update(),f.presenceSubscribe(this.id)]).bind(this)["catch"](function(e){return this.isSubscribed=!1,o["default"].reject(e)})):o["default"].resolve()}}),S=M.Presence,C=M.PresenceProxy;t["default"]=S,t.PresenceProxy=C},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(e=e.replace(E,""),e=e.replace(A,""),e=e.replace(x,"$1"),e=e.replace(I,"$1"),!R.test(e)&&O.test(e)){for(var a,n=t.getRangeAt(0).startContainer,i=0;5>i&&!(a=n.getAttribute&&n.getAttribute("data-id"));i++)n=n.parentNode;var o=Store.Msg.get(a);if(o){var r="["+v.timeStr(o.t)+"]",s=o.senderObj.formattedUser;e=b+r+" "+s+": "+k+e}}e=e.replace(D,"");var l=e.match(O);return l&&1===l.length&&(e=e.replace(O,"")),e=e.replace(O,"\n$1"),"\n"===e.charAt(0)&&(e=e.slice(1)),e}function o(e){var t=_.range(e.rangeCount).map(function(t){return e.getRangeAt(t).cloneContents()}).map(l).join("");return i(t,e)}function r(e){var t={},a=_.range(e.rangeCount).map(function(t){return e.getRangeAt(t).cloneContents()}).map(function(e){return u(e,t)}).join("");return(0,p["default"])({text:i(a,e),jids:t})}function s(e){var t=_.range(e.rangeCount).map(function(t){return e.getRangeAt(t).cloneContents()}).map(l).join("");if(t.indexOf(M)>-1){var a=_.compact(t.match(C));if(a.length)return a.join("\n").replace(S,"")}return t}function l(e){return e instanceof HTMLImageElement?e.alt:e.nodeType===Node.TEXT_NODE?e.nodeValue:_.map(e.childNodes,l).join("")}function u(e,t){if(e instanceof HTMLImageElement)return e.alt;if(e.nodeType===Node.TEXT_NODE)return e.nodeValue;if(d(e)){var a=e.getAttribute("data-jid");return t[a]=!0,"@"+h.user(a)}var n=c(e)||"",i=_.map(e.childNodes,function(e){return u(e,t)}).join("");return n?""+n+i+n:i}function c(e){switch(e.tagName){case"CODE":return"```";case"STRONG":return"*";case"EM":return"_";case"DEL":return"~";default:return""}}function d(e){return e&&e instanceof HTMLSpanElement&&e.hasAttribute("data-jid")&&e.getAttribute("data-display")===m.NodeToEmoji(e)}var f=a(27),p=n(f),h=a(22),m=a(118),v=a(79),g="â€‹",y="â ",E=new RegExp(g,"g"),M=""+g+y+g,S=new RegExp(""+M),C=new RegExp("(?:"+M+"|^)(.+?)(?:"+M+"|$)","g"),b=y+y,k=y+y+y,T=b+"([^"+y+"]+)"+k,w=y+y+y+y,N=y+y+y+y+y,P=w+"[^"+y+"]+"+N,A=new RegExp(P,"g"),O=new RegExp(T,"g"),R=new RegExp("^"+T),D=new RegExp(T+"$"),x=new RegExp("^[^"+y+"]+"+N+"(.*)","g"),I=new RegExp("(.*)"+w+"[^"+y+"]+$","g");e.exports={asPlainText:o,asRichText:r,formatDelim:c,extractIsolatedBlocks:s}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=e.mimeType,a=e.filename,n=(0,l["default"])("icon-doc",f[t]?f[t].icon:null);return r["default"].createElement("div",{className:"attach-file media-element-container"},r["default"].createElement("div",{className:"media-element"},r["default"].createElement("div",{className:"media-document"},r["default"].createElement("div",{className:n}),r["default"].createElement("div",{className:"media-document-text"},a))))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i;var o=a(5),r=n(o),s=a(21),l=n(s),u=a(13),c=n(u),d=a(119),f=c["default"].pickBy(d.MIMETYPES,function(e){return"document"===e.msgType})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(462),g=(n(v),a(21)),_=n(g),y=a(1402),E=n(y),M=a(470),S=n(M),C=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props.msg.ack,t=(0,_["default"])("icon icon-ack",{"icon-status-time":1>e,"icon-status-check":1===e,"icon-status-dblcheck":2===e,"icon-status-dblcheck-ack":e>2}),a=void 0;return a=1>e?"status-time":1===e?"status-check":2===e?"status-dblcheck":"status-dblcheck-ack",m["default"].createElement(S["default"],{name:a,className:t})}}]),t}(m["default"].PureComponent);C.CONCERNS={msg:["ack"]},t["default"]=(0,E["default"])(C)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1404),g=(n(v),a(462)),_=(n(g),a(79)),y=n(_),E=a(0),M=n(E),S=a(78),C=n(S),b=a(1402),k=n(b),T=a(12),w=n(T),N=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={updater:!1},n.listening=!1,n.rerender=function(){n.setState({updater:!n.state.updater})},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.maybeRegMidnight()}},{key:"componentWillReceiveProps",value:function(){this.maybeRegMidnight()}},{key:"maybeRegMidnight",value:function(){var e=this.props,t=e.listeners,a=e.msg,n=(0,M["default"])().startOf("day").subtract(7,"day");a.t>=n.unix()?this.listening||(this.listening=!0,t.add(w["default"],"midnight",this.rerender)):this.listening&&(this.listening=!1,t.remove(w["default"],"midnight",this.rerender))}},{key:"render",value:function(){return m["default"].createElement("span",{className:"timestamp"},y["default"].relativeStr(this.props.msg.t))}}]),t}(m["default"].PureComponent);N.CONCERNS={msg:["t"]};var P=(0,C["default"])((0,k["default"])(N)),A=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props.chat;return e.previewMessage?m["default"].createElement(P,{msg:e.previewMessage}):null}}]),t}(m["default"].PureComponent);A.CONCERNS={chat:["previewMessage"]};var O=(0,k["default"])(A);t["default"]=function(e){var t=e.chat,a=e.msg;return t?m["default"].createElement(O,{chat:t}):a?m["default"].createElement(P,{msg:a}):void 0}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Type=void 0;var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(13),m=n(h),v=a(468),g=n(v),_=a(12),y=n(_),E=a(238),M=n(E),S=a(14),C=n(S),b=a(21),k=n(b),T=a(1636),w=n(T),N=a(61),P=n(N),A=a(1638),O=n(A),R=a(1423),D=n(R),x=a(1),I=n(x),L=a(250),F=n(L),U=a(1415),j=n(U),G=a(1421),B=n(G),V=a(1418),H=n(V),W=a(1478),z=n(W),Y=a(5),q=n(Y),K=a(115),Q=n(K),X=a(161),Z=n(X),J=a(1590),$=n(J),ee=a(240),te=n(ee),ae=a(1429),ne=n(ae),ie=t.Type={GROUP:"GROUP",PROFILE:"PROFILE"},oe=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={img:n.props.startImage,hover:!1},n.onUpload=function(e){var t=n.refs.imageInput;return t.click(),!0},n.removeImage=function(){n.props.onImageSet(),y["default"].closeModal()},n.onRemove=function(e){var t=n.props.type===ie.GROUP?l10n.t("remove_group_icon"):l10n.t("remove_profile_photo");y["default"].openModal(q["default"].createElement(M["default"],{onOK:n.removeImage,okText:l10n.t("remove"),onCancel:y["default"].closeModal.bind(y["default"]),cancelText:l10n.t("web_cancel")},t))},n.onView=function(){var e=n.refs.imageContainer,t=function(t){t(e)},a=Store.Contact.get(n.props.id);y["default"].openModalMedia(q["default"].createElement(z["default"],{contact:a,profilePicThumb:a.profilePicThumb,animateBorderRadius:!0,getZoomNode:t}),"profile-viewer")},n.onImageReceived=function(e,t){return e?void F["default"].loadImage(e).then(function(a){n.setState({img:e}),n.props.onImageSet(e,t)})["catch"](function(e){I["default"].error("PhotoPicker:onImageReceived failed to load image: "+e)();var t=n.props.type===ie.GROUP?l10n.t("action_group_icon_set_failed"):l10n.t("action_profile_set_failed");y["default"].openModal(q["default"].createElement(M["default"],{onOK:y["default"].closeModal.bind(y["default"])},t))}):void n.setState({img:void 0,imageSize:void 0})},n.onSearch=function(){y["default"].openModal(q["default"].createElement(B["default"],{type:G.BoxModalType},q["default"].createElement(O["default"],{onFinished:n.onImageReceived})))},n.onImagePick=function(e){n.contextClose();var t=e.target.files[0];if(!t)return!1;var a=URL.createObjectURL(t);F["default"].loadImage(a).then(function(e){e.width<C["default"].MIN_PIC_SIDE||e.height<C["default"].MIN_PIC_SIDE?y["default"].openModal(q["default"].createElement(M["default"],{onOK:y["default"].closeModal.bind(y["default"])},l10n.t("profile_or_group_image_too_small",{size:C["default"].MIN_PIC_SIDE,_plural:C["default"].MIN_PIC_SIDE}))):y["default"].openModal(q["default"].createElement(B["default"],{type:G.BoxModalType},q["default"].createElement(w["default"],{img:t,onFinished:n.onImageReceived,onRetake:n.onUpload})))})["catch"](function(e){var t=n.props.type===ie.GROUP?l10n.t("action_group_icon_set_failed"):l10n.t("action_profile_set_failed");y["default"].openModal(q["default"].createElement(M["default"],{onOK:y["default"].closeModal.bind(y["default"])},t))})["finally"](function(){URL.revokeObjectURL(a)}),e.target.value=""},n.onImageClick=function(e){if(n.props.readOnly)return void(n.state.img&&n.onView());e.stopPropagation(),e.preventDefault();var t=[];n.props.id&&n.state.img&&t.push(q["default"].createElement(j["default"],{a8n:"mi-view-photo",key:"view",action:n.onView},l10n.t("view_photo"))),navigator.getUserMedia&&t.push(q["default"].createElement($["default"],{key:"take",onImageTake:n.onImageReceived})),t.push(q["default"].createElement(j["default"],{a8n:"mi-upload-photo",key:"upload",action:n.onUpload},l10n.t("upload_photo"))),P["default"].supportsFeature(P["default"].F.BING_IMAGE_SEARCH)&&n.props.type===ie.GROUP&&t.push(q["default"].createElement(j["default"],{a8n:"mi-search-photo",key:"search",action:n.onSearch},l10n.t("web_search_menu_item"))),n.state.img&&t.push(q["default"].createElement(j["default"],{a8n:"mi-remove-photo",key:"remove",action:n.onRemove},l10n.t("remove_photo"))),e.persist(),n.setState({contextMenu:{menu:t,event:e}})},n.contextClose=function(){n.setState({contextMenu:void 0})},n.onMouseOver=function(e){n.state.hover||n.setState({hover:!0})},n.onMouseEnter=function(e){n.state.hover||n.setState({hover:!0})},n.onMouseLeave=function(e){n.state.hover&&n.setState({hover:!1})},n.onLoad=function(e){var t=e.target.clientWidth,a=e.target.clientHeight;n.setState({imageSize:{width:t,height:a}})},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillReceiveProps",value:function(e){e.startImage&&this.props.startImage!==e.startImage?this.setState({img:e.startImage}):this.props.startImage!==e.startImage&&this.setState({img:e.startImage,imageSize:void 0})}},{key:"render",value:function(){var e=void 0;this.state.img&&(e=q["default"].createElement(H["default"],{type:V.FIT_TYPE.COVER,size:this.state.imageSize},q["default"].createElement(D["default"],{src:this.state.img,crossOrigin:!1,style:{height:"100%",width:"100%"},onLoad:this.onLoad})));var t=void 0;(this.props.pending||this.state.img&&!this.state.imageSize)&&(t=q["default"].createElement("div",{className:"avatar-spinner-container"},q["default"].createElement(Z["default"],{size:50,stroke:3})));var a=null;if(!this.props.pending&&!this.props.readOnly&&(!this.state.img||this.state.imageSize)&&(!this.state.img||this.state.contextMenu||this.state.hover)){var n=void 0;switch(this.props.type){case ie.GROUP:n=this.state.img?l10n.t("change_group_icon"):l10n.t("add_group_icon");break;case ie.PROFILE:n=this.state.img?l10n.t("change_profile_photo"):l10n.t("add_profile_photo")}a=q["default"].createElement("div",{className:"avatar-overlay",key:"avatar-overlay"},q["default"].createElement("span",{className:"icon icon-camera-light"}),q["default"].createElement("div",{"data-a8n":g["default"].key("avatar-text"),className:"avatar-overlay-text"},n))}var i=(0,k["default"])("avatar","avatar-l","draggable-container",{"icon-group-default":this.props.type!==ie.PROFILE,"icon-user-default":this.props.type===ie.PROFILE}),o=this.props.readOnly||this.props.pending||!this.state.imageSize&&this.state.img?m["default"].noop:this.onImageClick,r=void 0;this.state.contextMenu&&(r=q["default"].createElement(te["default"],{displayName:"PhotoPickerContextMenu",escapable:!0,popable:!0,requestDismiss:this.contextClose},q["default"].createElement(ne["default"],{contextMenu:this.state.contextMenu})));var s=(0,k["default"])("avatar-picker",this.props.className);return q["default"].createElement("div",{className:s},q["default"].createElement("div",{className:i,onClick:o,onMouseOver:this.onMouseOver,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,ref:"imageContainer",dir:"ltr"},q["default"].createElement("div",{className:"avatar-body"},e),q["default"].createElement(Q["default"],{transitionName:"fade"},t,a)),q["default"].createElement("input",{ref:"imageInput",type:"file",accept:"image/gif,image/jpeg,image/jpg,image/png",style:{display:"none"},onChange:this.onImagePick}),r)}}]),t}(q["default"].Component);t["default"]=oe},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(81),o=n(i),r=a(120),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=function(){},p=function(){function e(){(0,u["default"])(this,e),this.internalHandlers=new s["default"]}return(0,d["default"])(e,[{key:"initialize",value:function(e){this.ctx=e}},{key:"registerHandler",value:function(e,t){this.internalHandlers.set(e,t)}},{key:"unregisterHandler",value:function(e){this.internalHandlers["delete"](e)}},{key:"handle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return(this.internalHandlers.get(e)||f).apply(void 0,(0,o["default"])(t))}}]),e}();e.exports=p},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(1484),o=n(i);e.exports=(0,o["default"])({CHANGE:void 0,MOUNT:void 0})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(5),o=n(i),r=a(21),s=n(r),l=function(e){var t=e.children,a=e.side,n=e.ellipsify,i=e.classes,r=e.onClick,l=(0,s["default"])("row",i,{clickable:r}),u=(0,s["default"])("row-main",{ellipsify:n}),c=a?o["default"].createElement("div",{className:"row-side"},a):null;return o["default"].createElement("div",{className:l,onClick:r},o["default"].createElement("div",{className:"row-body"},o["default"].createElement("div",{className:u},t),c))};t["default"]=l},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1403),g=n(v),_=a(1402),y=n(_),E=a(1461),M=(n(E),function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props.presence,t=void 0;return"list"===this.props.location?(t=e.getFormattedString(),t?m["default"].createElement(g["default"],{ellipsify:!0,titlify:!0,text:t}):null):(t=e.withholdDisplay?this.props.placeholder:e.getFormattedString()||(e.forceDisplay?"":this.props.placeholder),t?m["default"].createElement("div",{className:this.props.className},m["default"].createElement(g["default"],{ellipsify:!0,titlify:!0,text:t})):null)}}]),t}(m["default"].PureComponent));M.CONCERNS={presence:["withholdDisplay","forceDisplay","hasData"],chatstate:["type","deny","t"]},t["default"]=(0,y["default"])(M)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){return O["default"].isGecko||O["default"].isSafari}Object.defineProperty(t,"__esModule",{value:!0});var o,r,s=a(6),l=n(s),u=a(3),c=n(u),d=a(4),f=n(d),p=a(8),h=n(p),m=a(7),v=n(m),g=a(5),_=n(g),y=a(13),E=a(12),M=n(E),S=a(14),C=n(S),b=a(78),k=n(b),T=a(23),w=n(T),N=a(1402),P=n(N),A=a(37),O=n(A),R=a(31),D=n(R),x=(0,y.debounce)(function(e,t){D["default"].setVideoVolumeSettings(e,t)},500);t["default"]=(0,k["default"])((0,P["default"])((r=o=function(e){function t(){var e,a,n,o;(0,c["default"])(this,t);for(var r=arguments.length,s=Array(r),u=0;r>u;u++)s[u]=arguments[u];return a=n=(0,h["default"])(this,(e=t.__proto__||(0,l["default"])(t)).call.apply(e,[this].concat(s))),n.state={hasSentPlayed:!1},n.checkIteration=0,n.checkForSuccessInterval=0,n.hasCalledPlaying=!1,n.videoRef=null,n.setVideoRef=function(e){if(n.videoRef!==e&&(n.videoRef=e,e)){var t=D["default"].getVideoVolumeSettings();t&&(void 0!==t.volume&&(e.volume=t.volume),void 0!==t.muted&&(e.muted=t.muted)),i()&&n.props.autoPlay&&n.startCheckForSuccess()}},n.onVolumeChange=function(){var e=n.videoRef;e&&x(e.volume,e.muted)},n.onTimeUpdate=function(){var e=n.videoRef;e&&(e.currentTime/e.duration>.5||e.currentTime>10)&&(n.props.msg.sendPlayed(),n.setState({hasSentPlayed:!0}))},n.startCheckForSuccess=function(){n.checkIteration=0,n.checkForSuccessInterval||(n.checkForSuccessInterval=setInterval(n.checkForSuccess,250))},n.clearCheckForSuccess=function(){n.checkForSuccessInterval&&(clearInterval(n.checkForSuccessInterval),n.checkIteration=0,n.checkForSuccessInterval=0)},n.checkForSuccess=function(){if(w["default"].state===w["default"].STATE.CONNECTED){n.checkIteration++;var e=n.videoRef&&n.videoRef.buffered;e&&e.length&&e.end(0)>0?n.onPlaying({target:n.videoRef}):n.checkIteration>240&&n.clearCheckForSuccess()}},n.onPlayerError=function(){n.clearCheckForSuccess()},n.onOtherPlaying=function(e){e!==n&&n.videoRef&&n.videoRef.pause()},n.onPlaying=function(){n.clearCheckForSuccess(),M["default"].mediaPlaying(n)},n.setStartTime=function(){n.props.startTime&&n.videoRef&&(n.videoRef.currentTime=n.props.startTime)},o=a,(0,h["default"])(n,o)}return(0,v["default"])(t,e),(0,f["default"])(t,[{key:"componentDidMount",value:function(){this.props.listeners.add(M["default"],"mediaPlaying",this.onOtherPlaying)}},{key:"componentWillUnmount",value:function(){x.flush(),this.clearCheckForSuccess()}},{key:"componentDidUpdate",value:function(e){e.startTime!==this.props.startTime&&this.setStartTime()}},{key:"render",value:function(){var e=this.props,t=e.msg,a=e.mediaData,n=a.streamable&&!a.renderableUrl?C["default"].VIDEO_STREAM_URL+"?key="+this.props.msg.id.toString():a.renderableUrl,o=!this.state.hasSentPlayed&&t.canSendPlayed()?this.onTimeUpdate:void 0,r=e.startTime?this.setStartTime:void 0,s=i()&&!e.autoPlay?this.startCheckForSuccess:void 0;return _["default"].createElement("video",{ref:this.setVideoRef,src:n,poster:e.poster,className:e.className,controls:e.controls,autoPlay:e.autoPlay,onClick:e.onClick,onVolumeChange:this.onVolumeChange,onLoadedMetadata:r,onPlay:s,onPlaying:this.onPlaying,onTimeUpdate:o,onError:this.clearCheckForSuccess},e.children)}}]),t}(_["default"].Component),o.CONCERNS={msg:["id","isSentByMe","ack","type","isGif"],mediaData:["renderableUrl","streamable"]},r)))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1402),g=n(v),_=a(1403),y=n(_),E=a(1502),M=n(E),S=a(462),C=(n(S),a(466)),b=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.msg,a=e.contact,n=t.mentionMap(),i=C.Configuration.TrustedConversation(n);return m["default"].createElement("div",{className:"image-caption message-text","data-id":t.id},m["default"].createElement(M["default"],{t:t.t,name:a.formattedUser}),m["default"].createElement(y["default"],{direction:t.dir,dirMismatch:!(!t.dir||t.rtl===l10n.isRTL()),selectable:!0,text:t.caption,formatters:i}))}}]),t}(m["default"].PureComponent);b.CONCERNS={msg:["t","id","dir","rtl","caption"],contact:["formattedUser"]},t["default"]=(0,g["default"])(b)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1413),g=n(v),_=a(1404),y=(n(_),a(79)),E=n(y),M=a(12),S=n(M),C=a(14),b=n(C),k=a(21),T=n(k),w=a(1403),N=n(w),P=a(467),A=n(P),O=a(1419),R=n(O),D=a(1605),x=n(D),I=a(462),L=n(I),F=a(1504),U=n(F),j=a(1450),G=n(j),B=a(1409),V=n(B),H=a(1456),W=n(H),z=a(115),Y=n(z),q=a(240),K=n(q),Q=a(469),X=n(Q),Z=a(466),J=L["default"].TYPE,$=J.CHAT,ee=J.IMAGE,te=J.VIDEO,ae=J.LOCATION,ne=J.DOCUMENT,ie=J.VCARD,oe=J.AUDIO,re=J.MULTI_VCARD,se=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={hover:!1,quotedMsgPreview:!1},n.onClick=function(){var e=n.props,t=e.rootMsg,a=e.msg;if(!a.isStatusV3){if(t&&!t.isQuotedMsgAvailable)return void n.setState({quotedMsgPreview:!0});var i=a.id,o=a.chat,r=o.getSearchContext(Store.Msg.get(i)||i,t);r&&(r.slideToMsg=!0),S["default"].openChatAt(o,r)}},n.onMouseOver=function(e){n.hoverable()&&n.setState({hover:!0})},n.onMouseEnter=function(e){n.hoverable()&&n.setState({hover:!0})},n.onMouseLeave=function(e){n.state.hover&&n.setState({hover:!1})},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"hoverable",value:function(){return!this.state.hover&&!!this.props.rootMsg&&!this.props.msg.isStatusV3}},{key:"render",value:function(){var e=this,t=this.props,a=t.msg,n=t.displayType,i=t.chat,o=i.assignedColor(a.sender),r=n===b["default"].DISP_TYPE.CONVERSATION,s=m["default"].createElement(g["default"],{msg:a,contact:a.senderObj,className:"quoted-msg-author",chat:i,quoted:!0,displaySelf:a.sender===Store.Conn.me,disableClick:!0}),l=[];a.hasSymbol()&&l.push(m["default"].createElement(G["default"],{msg:a,key:"msg-symbol"})),[te,oe].indexOf(a.type)>-1&&!a.isGif&&!a.caption&&l.push(E["default"].durationStr(a.duration)+" "),[ee,te,$].indexOf(a.type)>-1?l.push(m["default"].createElement(N["default"],{formatters:Z.Configuration.Format(a.mentionMap()),text:A["default"].msgText(a,!1),direction:"auto",key:"status"})):l.push(m["default"].createElement(N["default"],{formatters:Z.Configuration.Format(a.mentionMap()),text:A["default"].msgText(a),direction:"auto",key:"status"}));var u=null,c=this.props.rootMsg;if(this.state.quotedMsgPreview&&c){var d=(0,T["default"])("quoted-msg-preview",c.isSentByMe?"right":"left",{"chat-msg":a.type===$});u=m["default"].createElement(K["default"],{displayName:"QuotedMsgPreview",escapable:!0,popable:!0,requestDismiss:function(){return e.setState({quotedMsgPreview:!1})}},m["default"].createElement("div",{className:d},m["default"].createElement(U["default"],{msg:a}),m["default"].createElement("div",{className:"nib-wrapper"},m["default"].createElement("div",{className:"nib"}))))}var f=void 0,p="quoted-msg-image";switch(a.type){case ee:case te:case ne:f=m["default"].createElement(x["default"],{mediaData:a.mediaData,className:p});break;case ae:a.body&&(f=m["default"].createElement("div",{style:{backgroundImage:"url(data:image/jpeg;base64,"+a.body+")"},className:p}));break;case $:a.thumbnail&&(f=m["default"].createElement("div",{style:{backgroundImage:'url("data:image/jpeg;base64,'+a.thumbnail+'")'},className:p}));break;case ie:f=m["default"].createElement(W["default"],{waid:a.getVCardThumbnailWAid(),thumb:a.body&&X["default"].thumbnail(a.body),quoted:!0,size:V["default"].Size.NONE,className:p});break;case re:f=m["default"].createElement(W["default"],{className:p,size:V["default"].Size.SMALL,quoted:!0})}var h=(0,T["default"])("quoted-msg",{"quoted-msg-hover":this.state.hover}),v=this.props.onOmit?m["default"].createElement("div",{style:{display:"flex",flex:"0 0 auto"}},f,m["default"].createElement("div",{className:"btn-background"},m["default"].createElement("button",{className:"icon icon-x",onClick:this.props.onOmit}))):f&&m["default"].createElement("div",{className:"quoted-msg-image-wrapper"},f);return m["default"].createElement("div",{onMouseOver:r?this.onMouseOver:null,onMouseEnter:r?this.onMouseEnter:null,onMouseLeave:r?this.onMouseLeave:null},m["default"].createElement(Y["default"],{transitionName:"quoted-msg-preview",className:"quoted-msg-preview-wrapper"},u),m["default"].createElement("div",{className:h,onClick:r?this.onClick:null},m["default"].createElement("div",{className:"quoted-msg-status"},m["default"].createElement("span",{className:"bg-color-"+o+" quoted-msg-color-bar"}),m["default"].createElement("div",{className:"quoted-msg-info"},m["default"].createElement("div",null,s,m["default"].createElement("div",{className:"message-text quoted-msg-text"},m["default"].createElement(R["default"],null,l))))),v))}}]),t}(m["default"].PureComponent);t["default"]=se},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(46),g=n(v),_=a(79),y=n(_),E=a(14),M=n(E),S=a(21),C=n(S),b=a(1409),k=n(b),T=a(1426),w=n(T),N=a(1403),P=n(N),A=a(95),O=n(A),R=a(116),D=n(R),x=a(78),I=n(x),L=a(462),F=(n(L),a(1416)),U=(n(F),a(1411)),j=(n(U),a(463)),G=n(j),B=a(22),V=n(B),H=a(1457),W=n(H),z=a(239);t["default"]=(0,I["default"])(function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));a.wrapper=null,a.onSelectionChange=function(e,t){var n="focus"===e;if(n){var i=g["default"].findDOMNode(a);O["default"].focus(i),t&&w["default"].scrollIntoViewIfNeeded(i)}a.setState({current:n})},a.onActiveChange=function(e){if("focus"===e){var t=g["default"].findDOMNode(a);O["default"].focus(t),w["default"].scrollIntoViewIfNeeded(t)}a.setState({active:!!e})},a.mouseOver=function(){a.state.hover||a.setState({hover:!0})},a.mouseEnter=function(){a.state.hover||a.setState({hover:!0})},a.mouseLeave=function(){a.state.hover&&a.setState({hover:!1})},a.onEnter=function(e){e.stopPropagation(),e.preventDefault(),a.props.onClickMsg(a.props.msg)},a.openContextMenu=function(){a.wrapper&&a.wrapper.contextOpen()},a.onFocus=function(e){a.setState({focus:!0}),a.indicateFocus(e)},a.onBlur=function(e){a.finishFocusIndication(e),a.setState({focus:!1})},a.indicateFocus=function(){if(!(Date.now()-(D["default"].flashFocus||0)>200)){var e=a.row;if(e){var t=a.state.active?"#d6d7d8":"#e2e3e3";(0,G["default"])(e,"stop"),(0,G["default"])(e,{backgroundColor:[t,"#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:a.finishFocusIndication
})}}},a.finishFocusIndication=function(){var e=a.row;e&&((0,G["default"])(e,"stop"),e.style.backgroundColor="")};var n=e.currSelection,i=e.activeSelection,r=e.msg;return a.state={hover:!1,current:n?n.value===r:!1,active:i?i.value===r:!1,focus:!1},a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.msg,a=e.currSelection,n=e.activeSelection,i=e.listeners;a&&i.add(a,t.id.toString(),this.onSelectionChange),n&&i.add(n,t.id.toString(),this.onActiveChange)}},{key:"render",value:function(){var e=this,t=this.props,a=t.msg,n=t.selectedMessages,i=a.senderObj.formattedName,o=a.chat.isUser?Store.Contact.get(a.to).formattedName?Store.Contact.get(a.to).formattedName:V["default"].formattedUser(a.to):a.chat.title(),r=(0,C["default"])("starred-msg-wrapper",{hover:this.state.hover,current:this.state.current&&this.state.focus,active:this.state.active}),s=this.props.multiMedia?null:m["default"].createElement("div",{className:"starred-msg-title"},m["default"].createElement("div",{className:"starred-title-main"},m["default"].createElement(k["default"],{id:a.senderObj.id,size:26}),m["default"].createElement(P["default"],{className:"starred-msg-author",text:i,direction:"auto",ellipsify:!0,titlify:!0}),m["default"].createElement("span",{className:"starred-title-divider"}),m["default"].createElement(P["default"],{className:"starred-msg-chat",text:o,direction:"auto",ellipsify:!0,titlify:!0})),m["default"].createElement("div",{className:"starred-title-meta"},y["default"].relativeStr(a.t)),m["default"].createElement("div",{className:"icon icon-chevron-right-alt"})),l={enter:this.onEnter};l[l10n.LR("right","left")]=this.openContextMenu;var u=this.props.selectable||this.state.hover&&this.props.multiMedia;return m["default"].createElement(D["default"],{handlers:l,onFocus:this.onFocus,onBlur:this.onBlur},m["default"].createElement("div",{ref:(0,z.GetRef)("row",this),className:r,onClick:function(){return e.props.onClickMsg(a,n&&!n.isSelected(a))},onMouseEnter:this.state.hover?null:this.mouseEnter,onMouseOver:this.state.hover?null:this.mouseOver,onMouseLeave:this.state.hover?this.mouseLeave:null},s,m["default"].createElement(W["default"],{msg:a,key:a.id,ref:(0,z.GetRef)("wrapper",this),current:this.state.current&&this.state.focus,displayType:M["default"].DISP_TYPE.STARRED_MSGS,isMsgVisible:this.props.isMsgVisible,selectable:u,selectedMessages:n,onMessageSelect:this.props.onMessageSelect,position:H.MsgPosition.END,tailOverride:"left"})))}}]),t}(m["default"].Component))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.EmojiPanel=void 0;var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(46),g=n(v),_=a(21),y=n(_),E=a(13),M=n(E),S=a(31),C=n(S),b=a(463),k=n(b),T=a(115),w=n(T),N=a(1400),P=n(N),A=a(43),O=n(A),R=a(1627),D=n(R),x=a(1508),I=a(95),L=a(1426),F=n(L),U=a(118),j=n(U),G=a(1626),B=n(G),V=a(483),H=n(V),W=a(116),z=n(W),Y=a(1721),q=n(Y),K=a(1442),Q=a(78),X=n(Q),Z=a(239),J=1e3,$=100,ee=85,te=62,ae=27,ne=62,ie=33,oe=5,re=15,se=.7*ne,le=1.5*ne,ue=t.EmojiPanel=function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));a.lastScrollTop=0,a.fastScroll=!1,a.lastClickTime=0,a.emojiTabRefs={},a.emojiTabContainerRefs={},a.getCurrentShownTabs=function(){return a.state.isPreview?M["default"].slice(x.TabsOrdered,0,2):x.TabsOrdered},a.getCurrentTabFromScroll=function(e){var t=a.getCurrentShownTabs();return M["default"].findLast(t,function(t){var n=g["default"].findDOMNode(a.emojiTabContainerRefs[t.key]);return e.scrollTop+ee>=n.offsetTop})},a.onScroll=function(){a.handleScroll()},a._handleScroll=function(){if(!(a.state.selected!==x.Tab.GIFS&&a.state.searchText||Date.now()-a.lastClickTime<J)){var e={};if(a.state.isPreview&&(e.isPreview=!1),a.scrollContainer){var t=a.scrollContainer,n=a.state.selected===x.Tab.GIFS?x.Tab.GIFS:a.getCurrentTabFromScroll(t);n!==a.state.selected&&(e.selected=n,a.lastFocusedSection=null);var i=t.scrollTop,o=0>=i;o!==a.state.scrolledToTop&&(e.scrolledToTop=o);var r=a.lastScrollTop-i,s=Math.abs(r)>oe;a.fastScroll=Math.abs(r)>re,0>r?a.state.showSearchInput&&(i>se&&s||a.lastScrollTop<se&&i>=se)&&(e.showSearchInput=!1):a.state.showSearchInput||(s||le>i)&&(e.showSearchInput=!0),a.state.selected===x.Tab.GIFS&&a.gifPanel&&a.gifPanel.animateOnScroll(t),a.lastScrollTop=i,M["default"].isEmpty(e)||a.setState(e)}}},a.setEmojiTabRef=function(e,t){t?a.emojiTabRefs[e]=t:delete a.emojiTabRefs[e]},a.setEmojiTabContainerRef=function(e,t){t?a.emojiTabContainerRefs[e]=t:delete a.emojiTabContainerRefs[e]},a.scrollToPanel=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=a.emojiTabContainerRefs[e.key];if(i){var o=g["default"].findDOMNode(i);t?(F["default"].scrollAt(o,o.parentNode,{pos:"offset",duration:300,animate:!0,easing:[.99,.13,.13,.99],offset:n}),a.lastScrollTop=o.offsetTop):F["default"].scrollAt(o,o.parentNode,{pos:"offset",offset:n})}},a.onSelectTab=function(e){a.lastClickTime=Date.now();var t=a.state.tabs.indexOf(a.state.selected),n=a.state.tabs.indexOf(e),i=t>=n||!!a.state.searchText||e===x.Tab.GIFS,o=a.state.searchText,r=a.state.searchResults;n!==t&&e!==x.Tab.GIFS&&(o=null,r=null),a.lastFocusedSection=null,a.setState({selected:e,showSearchInput:i,searchText:o,searchResults:r,isPreview:!1})},a.onEmoji=function(e){a.props.onEmoji(e),Store.RecentEmoji.increment(e)},a.restoreFocus=function(){a.lastFocusedSection?a.lastFocusedSection.restoreFocus():a.searchInput&&a.state.showSearchInput&&a.focusSearchInput()},a.onRotateFocus=function(e){var t=!1;e&&(a.stopEvent(e),t=!!e.shiftKey,z["default"].flashFocus=Date.now()),a.searchInputHasFocus()?a.state.selected===x.Tab.GIFS?t?a.onSelectTab(x.Tab.RECENT):a.props.onFocusRelease():t?a.props.onFocusRelease():a.onSelectTab(x.Tab.GIFS):a.focusSearchInput()},a.getPanelContent=function(){if(a.state.selected===x.Tab.GIFS)return m["default"].createElement(D["default"],{ref:(0,Z.GetRef)("gifPanel",a),onGif:a.props.onGif,searchText:a.state.searchText});if(a.state.searchResults){var e=a.state.searchResults;return m["default"].createElement("div",{className:"emoji-panel-section",key:x.Tab.SEARCH_RESULT.key,ref:(0,Z.refWrapper)(function(e){return a.setEmojiTabContainerRef(x.Tab.SEARCH_RESULT.key,e)})},m["default"].createElement(B["default"],{tab:x.Tab.SEARCH_RESULT,ref:(0,Z.refWrapper)(function(e){return a.setEmojiTabRef("emojiTab-SEARCH_RESULT",e)}),key:a.state.searchText,emojiList:e,focusPrevSection:a.focusPrevSection,onFocusRelease:a.props.onFocusRelease,scrollEmojiIntoViewIfNeeded:a.scrollEmojiIntoViewIfNeeded,onEmoji:a.onEmoji}))}var t=a.getCurrentShownTabs();return M["default"].map(t,function(e){var t=e===x.Tab.RECENT?a.state.recentEmojis||[]:H["default"][e.key];return m["default"].createElement("div",{className:"emoji-panel-section",key:e.key,ref:(0,Z.refWrapper)(function(t){return a.setEmojiTabContainerRef(e.key,t)})},m["default"].createElement(B["default"],{tab:e,ref:(0,Z.refWrapper)(function(t){return a.setEmojiTabRef("emojiTab-"+e.key,t)}),emojiList:t,onEmoji:a.onEmoji,scrollEmojiIntoViewIfNeeded:a.scrollEmojiIntoViewIfNeeded,focusPrevSection:a.focusPrevSection,focusNextSection:a.focusNextSection,onFocusRelease:a.props.onFocusRelease}))})},a.stopEvent=function(e){e&&(e.preventDefault(),e.stopPropagation())},a.searchInputHasFocus=function(){var e=document.activeElement;return e?e===a.searchInput:!1},a.focusSearchInput=function(){if(a.searchInput&&!a.searchInputHasFocus()&&((0,I.focus)(a.searchInput),!(Date.now()-(z["default"].flashFocus||0)>200)&&a.searchContainer)){var e=g["default"].findDOMNode(a.searchContainer);(0,k["default"])(e,"stop"),(0,k["default"])(e,{backgroundColor:["#e0e1e2","#d9f3ff"]},{duration:1300,easing:[.24,.91,.01,.99]})}},a.onSearchDown=function(){var e=a.getSectionToFocus();e.focusRow(a.getEmojiRowNumberToFocus(e)),a.lastFocusedSection=e},a.getEmojiRowNumberToFocus=function(e){var t=g["default"].findDOMNode(e);if(!a.scrollContainer)return 0;var n=a.scrollContainer.scrollTop-t.offsetTop-ae;return a.state.showSearchInput&&(n=n+ne+ie),0>n?0:Math.floor(n/x.EMOJI_HEIGHT)},a.onSearchEnter=function(e){var t=a.getSectionToFocus();t.keyboardSelectRow(e,a.getEmojiRowNumberToFocus(t)),a.lastFocusedSection=t},a.getSectionToFocus=function(){return a.state.searchText?a.emojiTabRefs["emojiTab-SEARCH_RESULT"]:a.state.selected===x.Tab.RECENT?a.getFirstSectionWithEmoji():a.emojiTabRefs["emojiTab-"+a.state.selected.key]},a.getFirstSectionWithEmoji=function(){if(a.state.searchText)return a.emojiTabRefs["emojiTab-SEARCH_RESULT"];var e=a.emojiTabRefs["emojiTab-RECENT"];return a.state.recentEmojis?e:a.emojiTabRefs["emojiTab-SMILEYS_PEOPLE"]},a.scrollEmojiIntoViewIfNeeded=function(e){a.scrollContainer&&e.offsetTop-a.scrollContainer.scrollTop<ne&&F["default"].scrollIntoView(e,!0,a.scrollContainer)},a.focusPrevSection=function(e,t){var n=M["default"].findIndex(a.state.tabs,e);if(n--,n>=0){var i=a.state.tabs[n],o=a.emojiTabRefs["emojiTab-"+i.key],r=i===x.Tab.RECENT&&a.state.recentEmojis,s=i===x.Tab.SEARCH_RESULT&&a.state.searchResults,l=i!==x.Tab.RECENT&&i!==x.Tab.SEARCH_RESULT;r||s||l?(o&&o.focusLastRow(t),a.lastFocusedSection=o):(z["default"].flashFocus=Date.now(),a.focusSearchInput())}else z["default"].flashFocus=Date.now(),a.focusSearchInput()},a.focusNextSection=function(e,t){var n=M["default"].findIndex(a.state.tabs,e);if(n++,n<a.state.tabs.length){var i=a.state.tabs[n],o=a.emojiTabRefs["emojiTab-"+i.key];o&&o.focusFirstRow(t),a.lastFocusedSection=o}},a.clearSearchText=function(){a.setState({searchText:null,searchResults:null})},a.getSearchBox=function(){var e=void 0;if(a.state.showSearchInput){var t=void 0,n=void 0;a.state.selected===x.Tab.GIFS?(t=l10n.t("search_gifs",{service:K.BRAND_NAMES[(0,K.gifProvider)()]}),n={}):(t=l10n.t("search_emoji"),n={enter:a.onSearchEnter,down:a.onSearchDown});var i=null;a.state.searchText&&(i=m["default"].createElement("span",{className:"icon icon-x-alt-small",onClick:a.clearSearchText}));var o=(0,y["default"])("emoji-search-row",{"emoji-search-row-shade":!a.state.scrolledToTop});e=m["default"].createElement(z["default"],{handlers:n,"data-tab":4,className:o,key:a.state.showSearchInput,onFocus:a.focusSearchInput},m["default"].createElement("label",{ref:(0,Z.GetRef)("searchContainer",a),className:"emoji-search-row-input"},m["default"].createElement("div",{className:"input-container"},m["default"].createElement("input",{ref:(0,Z.GetRef)("searchInput",a),className:"input input-emoji-search",type:"text",dir:"auto",value:a.state.searchText||"",title:t,placeholder:t,onMouseDown:function(e){e.stopPropagation()},onChange:a.onSearch}),i)))}else e=null;var r=a.fastScroll?"emoji-search-slide-away-fast":"emoji-search-slide-away";return m["default"].createElement(w["default"],{transitionName:r},e)},a.onSearch=function(e){a.stopEvent(e);var t=void 0,n=e.target.value;0===n.length?(n=null,t=null):t=(0,q["default"])(n),null===a.state.searchText&&(a.scrollTopBeforeSearch=a.scrollContainer&&a.scrollContainer.scrollTop),a.setState({searchText:n,searchResults:t})},a.preventBlur=function(e){a.stopEvent(e),a.restoreFocus()};var n=a.props.onGif?x.ExtendedTabs:x.TabsOrdered,i=void 0;i=a.props.onGif&&x.Tab[C["default"].getLastEmojiTab()]===x.Tab.GIFS?x.Tab.GIFS:x.Tab.RECENT;var r=M["default"].uniq(M["default"].filter(Store.RecentEmoji.models.map(function(e){return j["default"].emojiMap[e["char"]]})));return r.length||(r=null),a.state={tabs:n,isPreview:!0,selected:i,recentEmojis:r,searchText:null,searchResults:null,showSearchInput:!0,scrolledToTop:!0},a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.handleScroll=M["default"].throttle(this._handleScroll,$)}},{key:"componentDidMount",value:function(){var e=this,t=this.state.selected.key;this.props.listeners.uiIdle(function(){e.restoreFocus(),new O["default"].WebcEmojiOpen({webcEmojiOpenTab:t}).commit(),e.setState({isPreview:!1})})}},{key:"componentWillUnmount",value:function(){C["default"].setLastEmojiTab(this.state.selected.key),this.handleScroll.cancel()}},{key:"shouldComponentUpdate",value:function(e,t){return(0,P["default"])(this,e,t)}},{key:"componentDidUpdate",value:function(e,t){var a=t.selected!==this.state.selected,n=t.searchText!==this.state.searchText,i=Date.now()-this.lastClickTime>=J;if(a){if(this.state.selected!==x.Tab.GIFS&&!i){var o=0;this.state.showSearchInput&&(o=te),this.scrollToPanel(this.state.selected,!0,o),this.restoreFocus()}}else if(n){if(!this.scrollContainer)return;this.state.searchText?this.scrollContainer.scrollTop=0:this.scrollTopBeforeSearch&&(this.scrollContainer.scrollTop=this.scrollTopBeforeSearch)}else!i&&this.state.showSearchInput&&this.scrollToPanel(this.state.selected,!0,te),this.restoreFocus()}},{key:"render",value:function(){var e=this,t=this.state.tabs,a=t.indexOf(this.state.selected),n=t.map(function(t){var a=(0,y["default"])("menu-tab",{active:e.state.selected===t});return m["default"].createElement("button",{className:a,onClick:function(){return e.onSelectTab(t)},key:t.key,title:t.title()},m["default"].createElement("span",{className:"icon "+t.css}))}),i=l10n.isRTL()?-1:1,o={width:100/n.length+"%",transform:"translateX("+100*a*i+"%)"},r=this.getSearchBox(),s=this.getPanelContent(),l=(0,y["default"])("emoji-panel-body-container",{hasSearchBox:!!r}),u={tab:this.onRotateFocus,"shift+tab":this.onRotateFocus};return m["default"].createElement(z["default"],{handlers:u},m["default"].createElement("div",{className:"emoji-panel k"},m["default"].createElement("div",{className:"menu-tabs menu-tabs-emoji emoji-panel-header","data-active-tab":this.state.selected.key},m["default"].createElement("div",{style:o,className:"menu-tabs-marker"}),n),m["default"].createElement("div",{className:l,onMouseDown:this.preventBlur},r,m["default"].createElement("div",{className:"emoji-panel-body",onScroll:this.onScroll,ref:(0,Z.GetRef)("scrollContainer",this)},s))))}}]),t}(m["default"].Component);t["default"]=(0,X["default"])(ue)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(13),g=n(v),_=a(1458),y=n(_),E=a(12),M=n(E),S=a(238),C=n(S),b=a(15),k=n(b),T=a(1410),w=n(T),N=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onForwardConfirmed=function(e){Store.Chat.forwardMessagesToChats(n.props.msgs,e)["catch"](k["default"].ForwardError,function(e){n.showMediaSendError(e.reasons)}),n.end(),g["default"].isFunction(n.props.onForward)&&n.props.onForward(n.props.msgs),M["default"].openChatFromUnread(g["default"].head(e))},n.showMediaSendError=function(e){var t=e.map(function(e){var t=e.chat,a=e.reason;return m["default"].createElement("p",{key:t.id},t.formattedTitle," : ",a)});M["default"].openModal(m["default"].createElement(C["default"],{onOK:M["default"].closeModal.bind(M["default"]),okText:l10n.t("web_ok")},t),void 0)},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){var e=l10n.t("forward_message_to",{_plural:this.props.msgs.length||1}),t=g["default"].head(this.props.msgs)&&g["default"].head(this.props.msgs).chat;this.push(m["default"].createElement(y["default"],{onChat:this.onForwardConfirmed,excludeChat:t,title:e}))}}]),t}(w["default"]);t["default"]=N},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.RETRY_OPTIONS=void 0;var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(13),g=n(v),_=a(1570),y=n(_),E=a(1405),M=n(E),S=a(1407),C=n(S),b=a(1406),k=n(b),T=a(1418),w=n(T),N=a(115),P=n(N),A=a(48),O=n(A),R=361,D=500,x=t.RETRY_OPTIONS={RETAKE:"retake",RESTART:"restart"},I=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={img:n.props.img,doneEditing:!1,loaded:!1,editorSize:{width:D,height:R}},n.onDoneEditing=function(){n.setState({doneEditing:!0})},n.onObjectLoad=function(e){if(e){var t={};!n.state.editorSize||n.state.editorSize.width===e.clientWidth&&n.state.editorSize.height===e.clientHeight||(t.editorSize={width:e.clientWidth,height:e.clientHeight}),n.state.loaded||(t.loaded=!0),g["default"].isEmpty(t)||n.setState(t)}},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e,t=this.props,a=t.attributionUrl,n=t.noContainer,i=t.onCancel,o=t.onFinished,r=t.onRetake,s=t.retryText,l=this.state.loaded?m["default"].createElement("div",{className:"drawer-controls-right btn-send",key:"btn-send"},m["default"].createElement("button",{className:"btn btn-round btn-l",onClick:this.onDoneEditing},m["default"].createElement("span",{className:"icon icon-checkmark-light-l"}))):null,u=n?S.DRAWER_HEADER_TYPE.POPUP:S.DRAWER_HEADER_TYPE.OFFSET,c=m["default"].createElement(y["default"],{img:this.state.img,onImageSet:o,doneEditing:this.state.doneEditing,size:this.state.editorSize});if(r){var d;switch(s){case x.RETAKE:d=l10n.t("retake");break;case x.RESTART:default:d=l10n.t("retry")}e=m["default"].createElement("div",{className:"drawer-header-action",onClick:r},m["default"].createElement("span",{className:"icon icon-refresh-light"}),d)}var f="https://www.whatsapp.com/legal/";f=O["default"].build(f,{lg:l10n.getLocale()});var p=a?m["default"].createElement("div",{className:"edit-image-drawer-attribution"},m["default"].createElement("a",{className:"edit-image-drawer-attribution-link ellipsify",href:a,target:"_blank"},O["default"].hostname(a)),m["default"].createElement("span",null,l10n.t("image_search_copyright_disclaimer"),"Â ",m["default"].createElement("a",{href:f,target:"_blank"},l10n.t("image_search_tos_link")))):null,h=m["default"].createElement("div",{className:"capture-footer"},m["default"].createElement(P["default"],{transitionName:"btn"},l),p),v=this.props.imageSize?this.props.imageSize:{width:D,height:R};return m["default"].createElement(M["default"],{key:"attach-edit-modal",className:"drawer-edit",variant:"noheader"},m["default"].createElement(C["default"],{title:l10n.t("adjust_image"),type:u,onCancel:i},e),m["default"].createElement(k["default"],null,m["default"].createElement("div",{className:"media-body"},m["default"].createElement("div",{className:"media-body-container-background"},m["default"].createElement(P["default"],{transitionName:"capture"},m["default"].createElement(w["default"],{type:T.FIT_TYPE.COVER,size:v,onObjectLoad:this.onObjectLoad},c)))),h))}}]),t}(m["default"].Component);t["default"]=I},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(21),g=n(v),_=a(463),y=n(_),E=a(1423),M=n(E),S=a(1409),C=n(S),b=a(1403),k=n(b),T=a(1418),w=n(T),N=a(241),P=(n(N),a(1433)),A=(n(P),a(12)),O=n(A),R=a(240),D=n(R),x=a(1402),I=n(x),L=a(160),F=n(L),U=500,j=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={style:{visibility:"hidden"}},n.onScroll=function(e){Math.abs(e.deltaY)>3&&n.onClose()},n.onClose=function(){if(!n.closing){n.closing=!0;var e=void 0;if(n.props.getZoomNode(function(t){e=t}),!e)return O["default"].closeModalMedia();var t=n.refs.image,a=t.getBoundingClientRect(),i=e.getBoundingClientRect(),o=i.top-a.top,r=i.left-a.left,s=e.clientWidth/t.clientWidth;(0,y["default"])(t,{translateX:[r,0],translateY:[o,0],scale:[s,1]},{duration:200,easing:[.1,.82,.25,1]}).then(function(){O["default"].closeModalMedia()})}},n.onImageLoad=function(e){var t=e.target;n.setState({size:{width:t.naturalWidth,height:t.naturalHeight}},function(){n.props.getZoomNode(function(e){var a=t.getBoundingClientRect(),i=e.getBoundingClientRect(),o=i.top-a.top,r=i.left-a.left,s=e.clientWidth/t.clientWidth,l={visibility:"hidden",transform:"translateX("+r+"px) translateY("+o+"px) scale("+s+")",transition:"transform 0s",borderRadius:void 0};n.props.animateBorderRadius&&(l.borderRadius="50%"),n.setState({style:l},function(){var e={transform:"translateX(0px) translateY(0px) scale(1)",transition:"transform "+U+"ms cubic-bezier(.1,.82,.25,1)"};n.props.animateBorderRadius&&(e={transform:"translateX(0px) translateY(0px) scale(1)",borderRadius:"0%",transition:"transform "+U+"ms cubic-bezier(.1,.82,.25,1),\n                                         border-radius "+U+"ms cubic-bezier(.1,.82,.25,1)"}),n.setState({style:e})})})})},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"shouldComponentUpdate",value:function(e,t){return e.profilePicThumb.imgFull?!0:(this.onClose(),!1)}},{key:"render",value:function(){var e=this.props,t=e.contact,a=e.profilePicThumb,n=(0,g["default"])("media-viewer","media-viewer-animate"),i=(0,g["default"])("media-panel-header",{});return m["default"].createElement(D["default"],{displayName:"PhotoViewer",escapable:!0,requestDismiss:this.onClose},m["default"].createElement("div",{className:n,onWheel:this.onScroll,onClick:this.onClose},m["default"].createElement("div",{className:i},m["default"].createElement("div",{className:"chat media-chat"},m["default"].createElement("div",{className:"chat-avatar"},m["default"].createElement(C["default"],{id:t.id})),m["default"].createElement("div",{className:"chat-body"},m["default"].createElement("div",{className:"chat-main"},m["default"].createElement(k["default"],{text:t.formattedUser})))),m["default"].createElement("div",{className:"menu menu-horizontal media-panel-tools"},m["default"].createElement("div",{className:"menu-item"},m["default"].createElement("button",{className:"icon icon-x-viewer",title:F["default"].t("web_close"),onClick:this.onClose})))),m["default"].createElement("div",{className:"media-content",dir:"ltr",ref:"container"},m["default"].createElement("div",{className:"media"},m["default"].createElement(w["default"],{type:T.FIT_TYPE.SCALE_DOWN,size:this.state.size},m["default"].createElement("div",{className:"profile-viewer",ref:"image",style:this.state.style},m["default"].createElement(M["default"],{src:a.imgFull,hasPrivacyChecks:!0,onLoad:this.onImageLoad,className:"profile-viewer-img"})))))))}}]),t}(m["default"].Component);j.CONCERNS={contact:["formattedUser","id"],profilePicThumb:["imgFull"]},t["default"]=(0,I["default"])(j)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=document.createElement("a");t.href=e,t.target="_blank",t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function o(e){return e.join(" ")}Object.defineProperty(t,"__esModule",{value:!0});var r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(13),y=n(_),E=a(1427),M=n(E),S=a(12),C=n(S),b=a(1513),k=n(b),T=a(160),w=n(T),N=a(1409),P=n(N),A=a(1456),O=n(A),R=a(469),D=n(R),x=a(22),I=n(x),L=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"openChat",value:function(e){C["default"].closeModal(),Store.Chat.find(I["default"].numberToWid(e)).then(function(e){C["default"].openChatFromUnread(e).then(function(t){t&&C["default"].focusChatTextInput(e)})})}},{key:"sendEmail",value:function(e){var t="mailto:"+e;i(t)}},{key:"openLocation",value:function(e){var t=y["default"].map(y["default"].filter(e),encodeURIComponent).join(", "),a="https://maps.google.com/maps/search/"+t+"?hl="+w["default"].getLocale();i(a)}},{key:"getHeader",value:function(){var e=this.props.parsedVCard,t=D["default"].vcardWAids(e),a=D["default"].getNameFromParsedVCard(e),n=D["default"].getOrganizationString(e),i=g["default"].createElement(O["default"],{thumb:this.props.thumbnail,size:P["default"].Size.SMALL,waid:D["default"].thumbnailWAid(t)});return g["default"].createElement("div",{className:"chatlist chatlist-plain"},g["default"].createElement(M["default"],{id:t[0],contextEnabled:function(){return!1},image:i,primary:a,secondary:n}))}},{key:"render",value:function(){var e=this,t=this.props.parsedVCard,a=y["default"].filter(t.TEL,function(e){return e.properties.waid}),n=y["default"].filter(t.TEL,function(e){return!e.properties.waid}),i=y["default"].map(a,function(t){var a=y["default"].first(t.properties.waid),n=function(){return e.openChat(a)},i=g["default"].createElement("span",{onClick:n,className:"icon icon-chat clickable"}),o=g["default"].createElement("span",{className:"selectable-text"},I["default"].formattedUser(a));return g["default"].createElement(k["default"],{title:o,icon:i,key:"vCard-"+t.index},D["default"].getType(t))}),r=y["default"].map(t.EMAIL,function(t){return g["default"].createElement(k["default"],{title:t.value,onClick:function(){return e.sendEmail(t.value)},key:"vCard-"+t.index},D["default"].getType(t))}),s=y["default"].map(t.ADR,function(t){var a=o(t.value);return g["default"].createElement(k["default"],{title:a,onClick:function(){return e.openLocation(t.value)},key:"vCard-"+t.index},D["default"].getType(t))}),l=y["default"].map(n,function(e){return g["default"].createElement(k["default"],{title:e.value,key:"vCard-"+e.index},D["default"].getType(e))}),u=y["default"].map(t.SERVICE,function(e){return g["default"].createElement(k["default"],{title:e.value,key:"vCard-"+e.index},D["default"].getType(e))}),c=y["default"].map(t.BDAY,function(e){return g["default"].createElement(k["default"],{title:D["default"].getDate(e.value),key:"vCard-"+e.index},w["default"].t("vcard_birthday"))}),d=y["default"].map(t.NICKNAME,function(e){return g["default"].createElement(k["default"],{title:e.value,key:"vCard-"+e.index},w["default"].t("vcard_nickname"))}),f=this.getHeader();return g["default"].createElement("div",{className:this.props.className},g["default"].createElement("div",null,f,g["default"].createElement("div",{className:"drawer-item-container-compact"},i,r,s,l,c,d,u)))}}]),t}(v.Component);L.defaultProps={className:""},t["default"]=L},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(80),s=n(r),l=a(64),u=n(l),c=a(63),d=a(474).prepRawMedia,f=a(1720),p=a(15),h={READY:"ready",PROCESSING:"processing",ERROR:"error"},m=(0,r.defineState)("AttachMedia",{props:{id:"number",file:"object",uiProcessed:"boolean"},session:{state:{type:"string",values:_.values(h)},media:"object",mediaPrep:"object",url:"string",name:"string",preview:"string",processPromise:"object",exception:"object",chat:"object",caption:"string",original:"object",generatedPreview:"object"},initialize:function(){s["default"].prototype.initialize.call(this),this.processFile(this.file)},processFile:function(e){var t=this;return this.state=h.PROCESSING,this.processPromise=o["default"].resolve(e).then(function(e){var a=void 0;a=e.isGifHackDoNotUse?{asGif:!0,gifAttribution:e.gifAttributionHackDoNotUse}:{};var n=u["default"].createFromData(e,e.type),i=d(n,a);return i.waitForPrep().then(function(e){return f.enrich(e)}).then(function(e){var a=e.media,n=e.documentPreview;t.set({media:a,mediaPrep:i,url:window.URL.createObjectURL(a.mediaBlob),name:a.filename,preview:a.preview,state:h.READY,generatedPreview:n})})})["catch"](p.MediaFileTooLarge,p.InvalidMediaFileType,p.MediaFileFailedLoad,p.MediaFileEmpty,function(e){return t.set({exception:e,state:h.ERROR}),t})["catch"](function(e){return t.set({exception:new p.InvalidMediaFileType,state:h.ERROR}),t})},getFileType:function(){return c.typeFromMimetype(this.file.type)},editImage:function(e){return this.getFileType()!==c.FILETYPE.IMAGE?null:(window.URL.revokeObjectURL(this.url),e.original=this.original||new v(this.toJSON()),this.set(e),void this.initialize())},revertImage:function(){if(this.getFileType()!==c.FILETYPE.IMAGE)return null;if(!this.original)return this;window.URL.revokeObjectURL(this.url);var e=this.original.toJSON();return e.original=null,this.set(e),this.initialize(),this}}),v=m.AttachMedia;v.STATE=h,e.exports=v},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(464),s=a(1480),l=a(63),u=a(14),c=a(15),d=s.STATE,f=d.READY,p=d.ERROR,h=l.FILETYPE,m=h.IMAGE,v=h.VIDEO,g=h.DOCUMENT,_=h.AUDIO,y=1,E=r.extend({model:s,initialize:function(){this.errorMsgs=null,this.ignored=0,r.prototype.initialize.call(this)},removeSingleton:function(e,t){e.url&&window.URL.revokeObjectURL(e.url),e.original&&e.original.url&&window.URL.revokeObjectURL(e.original.url)},remove:function(e,t){var a=this;Array.isArray(e)?e.forEach(function(e){return a.removeSingleton(e,t)}):this.removeSingleton(e,t),r.prototype.remove.call(this,e,t)},"delete":function(){var e=this;this.models.forEach(function(t){return e.removeSingleton(t)}),r.prototype["delete"].call(this)},contains:function(e){return this.indexOf(e)>-1},getValidMedias:function(){return this.filter({state:f})},getAfter:function(e){var t=this.getValidMedias(),a=t.indexOf(e);return 0>a||a===t.length-1?null:t[a+1]},getBefore:function(e){var t=this.getValidMedias(),a=t.indexOf(e);return 0>=a?null:t[a-1]},processFiles:function(e,t){var a=this,n=this.getValidMedias().length,i=e.length+n>u.MAX_FILES?Math.max(u.MAX_FILES-n,0):e.length,r=e.length-i;0===i?r&&this.trigger("max_upload_limit",r):this.ignore(r);var l=e.slice(0,i).map(function(e){var n=y++,i=new s({id:n,file:e,chat:t,uiProcessed:!1});return a.add(i)});return o["default"].map(l,function(e){return e.processPromise})},ignore:function(e){e>0&&(this.ignored+=e)},uiProcessMsgs:function(){var e=[],t=void 0,a=void 0,n=0,i=0,o=0,r=0,s=0,l=0,d=0,h=0,y=0,E=!1,M=u.MAX_MEDIA_UPLOAD_SIZE/1024/1024;if(this.forEach(function(e){if(!e.uiProcessed&&(e.uiProcessed=!0,t||e.state!==f||(t=e),e.state===p))if(e.exception instanceof c.MediaFileTooLarge)switch(e.getFileType()){case m:n+=1;break;case v:i+=1;break;case _:o+=1;break;case g:r+=1}else if(e.exception instanceof c.MediaFileEmpty)switch(e.getFileType()){case m:s+=1;break;case v:l+=1;break;case _:d+=1;break;case g:h+=1}else e.exception instanceof c.MediaFileFailedLoad?E=!0:y+=1}),n>0&&e.push(l10n.t("image_too_big",{number:n,_plural:n,maxSize:M+"MB"})),i>0&&e.push(l10n.t("video_too_big",{number:i,_plural:i,maxSize:M+"MB"})),o>0&&e.push(l10n.t("audio_too_big",{number:o,_plural:o,maxSize:M+"MB"})),r>0&&e.push(l10n.t("document_too_big",{number:r,_plural:r,maxSize:M+"MB"})),s>0&&e.push(l10n.t("image_empty",{number:s,_plural:s})),l>0&&e.push(l10n.t("video_empty",{number:l,_plural:l})),d>0&&e.push(l10n.t("audio_empty",{number:d,_plural:d})),h>0&&e.push(l10n.t("document_empty",{number:h,_plural:h})),y>0&&e.push(l10n.t("files_not_supported",{number:y,_plural:y})),E&&(e=[],e.push(l10n.t("media_failed_load"))),e.length>1){e=[];var S=n+i+o+r,C=s+l+d+h,b=S+C+y;0===y?(0!==S&&e.push(l10n.t("files_too_big",{number:S,_plural:S,maxSize:M+"MB"})),0!==C&&e.push(l10n.t("files_empty",{number:C,_plural:C}))):e.push(l10n.t("files_not_added",{number:b,_plural:b}))}return this.errorMsgs=e.join(" "),this.ignore(this.getValidMedias().length-u.MAX_FILES),a=this.ignored,this.ignored=0,a&&this.trigger("max_upload_limit",a),{activeMedia:t,errorMsgs:this.errorMsgs}}});e.exports=E},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(462),s=n(r),l=a(464),u=a(14),c=a(15),d={before:"before",after:"after"},f=l.extend({model:s["default"],
initialize:function(){l.prototype.initialize.call(this),this.hasMediaBefore=!0,this.hasMediaAfter=!0},"delete":function(){l.prototype["delete"].call(this),this.stopListening()},contains:function(e){return this.models.indexOf(e)>-1},getAfter:function(e){var t=this.models.indexOf(e);return 0>t||t===this.models.length-1?null:this.models[t+1]},getBefore:function(e){var t=this.models.indexOf(e);return 0>=t?null:this.models[t-1]},loadEarlierMedias:function(){var e=this.head();e&&this.queryMedia(null,e)},loadRecentMedias:function(){var e=this.last();e&&this.queryMedia(null,e,d.after)},loadMoreAroundIfNeeded:function(e){if(e){var t=this.models.indexOf(e);20>t&&this.hasMediaBefore&&this.loadEarlierMedias(),this.models.length-t<20&&this.hasMediaAfter&&this.loadRecentMedias()}},queryMedia:function(e,t){var a=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.before;if(!t){var i=e.msgs.models;if(!i||0===i.length)return this.hasMediaBefore=!1,new o["default"](function(e){e({eof:!0})});this.add(i.filter(function(e){return e.isMedia}),{at:0});var r=this.models;if(this.downloadMedias(r),r.length<=2*u.MEDIA_QUERY_LIMIT){var s=0===r.length?_.head(i):_.head(r);return this.queryMedia(e,s)}return new o["default"](function(e){e({eof:!1})})}return n===d.before?this.queryMediaBefore?this.queryMediaBefore:(this.queryMediaBefore=Store.Msg.queryMedia(t.id.remote,u.MEDIA_QUERY_LIMIT,n,t.isMedia?t.id:void 0).then(function(e){var t=e.messages;(!t||t.length<u.MEDIA_QUERY_LIMIT)&&(a.hasMediaBefore=!1);var n=[];return t&&t.length>0&&(n=t.filter(function(e){return e.isMedia}),a.downloadMedias(n)),a.add(n,{at:0}),{length:n.length}})["catch"](c.WapDrop,404,_.noop)["finally"](function(){a.queryMediaBefore=null,a.trigger("query_media_before")}),this.trigger("query_media_before"),this.queryMediaBefore):n===d.after?this.queryMediaAfter?this.queryMediaAfter:this.queryMediaAfter=Store.Msg.queryMedia(t.id.remote,u.MEDIA_QUERY_LIMIT,n,t.id).then(function(e){var t=e.messages;(!t||t.length<u.MEDIA_QUERY_LIMIT)&&(a.hasMediaAfter=!1);var n=[];return t&&t.length>0&&(n=t.filter(function(e){return e.isMedia}),a.downloadMedias(n)),a.add(n),{length:n.length}})["catch"](c.WapDrop,404,_.noop)["finally"](function(){a.queryMediaAfter=null,a.trigger("query_media_after")}):void 0},downloadMedias:function(e){_.forEach(e,function(e){e.downloadMedia()})}});e.exports=f},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(462),s=n(r),l=a(464),u=a(23),c=a(61),d=a(1),f=a(14),p=l.extend({model:s["default"],initialize:function(){var e=this;l.prototype.initialize.call(this),this.isSynced=!1,this.syncPromise=null,this.listenTo(u,"change:stream",function(){u.stream===u.STREAM.DISCONNECTED?e.isSynced=!1:u.stream===u.STREAM.CONNECTED&&e["delete"]()})},comparator:function(e,t){return t.t-e.t},process:function(e,t,a,n){n?this["delete"]():this.update(e,t,a)},sync:function(e){if(this.isSynced)return o["default"].resolve();if(this.syncPromise)return this.syncPromise;if(!c.supportsFeature(c.F.FULL_TEXT_SEARCH))return o["default"].resolve();var t=this;if(c.supportsFeature(c.F.STARRED_PAGINATION)){var a=this.last()&&this.last().id;this.syncPromise=Store.Msg.getStarred(e,f.PAGE_SIZE,a).then(function(e){e.length&&t.add(e,{silent:!0}),e.length<f.PAGE_SIZE&&(t.isSynced=!0),t.trigger("sync")})["catch"](function(e){d.error("starred msg sync error: ",e)()})["finally"](function(){t.syncPromise=null})}else this.syncPromise=Store.Msg.getStarred().then(function(e){t.set(e),t.synced=!0,t.trigger("sync")})["catch"](function(e){d.error("starred msg sync error: ",e)()})["finally"](function(){t.syncPromise=null});return this.trigger("sync"),this.syncPromise},update:function(e,t,a){var n=this;if(this.isSynced){var i=this.syncPromise||o["default"].resolve();this.syncPromise=i.then(function(){if(e){var i=t.length>0?Store.Msg.incrementalStarredUpdate(t):o["default"].resolve([]);return i.then(function(e){n.add(e.concat(a),{silent:!0}),_.forEach(t,function(e){e.chat.starredMsgs&&e.chat.starredMsgs.add(e)}),n.trigger("sync")})["catch"](function(e){d.error("models:starred:update:error: ",e)()})}return n.filter(function(e){return!e.star}).forEach(function(e){n.remove(e.id),e.chat.starredMsgs&&e.chat.starredMsgs.remove(e.id)}),o["default"].resolve()})["finally"](function(){n.syncPromise=null})}},add:function(e,t){this.isModel(e)&&this.get(e)||(l.prototype.add.call(this,e,t),!this.parent&&e&&(Array.isArray(e)?_.forEach(e,function(e){return e.chat.starredMsgs&&e.chat.starredMsgs.add(e)}):e.chat.starredMsgs&&e.chat.starredMsgs.add(e)),Store.StarredGifMsgs.add(e))},remove:function(e,t){this.isModel(e)&&!this.get(e)||(l.prototype.remove.call(this,e,t),this.parent?Store.AllStarredMsgs.remove(e,t):e&&(Array.isArray(e)?_.forEach(e,function(e){return e.chat.starredMsgs&&e.chat.starredMsgs.remove(e)}):e.chat.starredMsgs&&e.chat.starredMsgs.remove(e)),Store.StarredGifMsgs.remove(e))},"delete":function(){this.synced=!1,l.prototype["delete"].call(this)}});e.exports=p},function(e,t){"use strict";function a(e){var t={};for(var a in e)e.hasOwnProperty(a)&&(t[a]=a);return t}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a},,function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(78),g=n(v),_=a(1416),y=(n(_),a(1404)),E=n(y),M=a(241),S=(n(M),a(1411)),C=(n(S),a(1437)),b=n(C),k=a(1422),T=n(k),w=a(1428),N=n(w),P=a(160),A=n(P);t["default"]=(0,g["default"])(function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={selected:n.props.selections.isSelected(n.props.chat)},n.onSelectChange=function(e){n.state.selected!==e&&n.setState({selected:e})},n.onSelect=function(){n.props.onSelect(n.props.chat,!n.state.selected)},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.props.listeners.add(this.props.selections,this.props.chat.id.toString(),this.onSelectChange)}},{key:"render",value:function(){var e=this.props,t=e.chat,a=e.active,n=void 0;return n=t instanceof E["default"]?m["default"].createElement(b["default"],{className:"chat-container",active:a,chat:t,contact:t.contact,mode:C.Mode.INFO,noContext:!0,onClick:this.onSelect}):m["default"].createElement(T["default"],{className:"chat-container",active:a,contact:t,onClick:this.onSelect,secondary:t.isBlocked()?A["default"].t("confirm_unblock_contact_and_forward_text"):null}),m["default"].createElement("div",{className:"checkbox-chat-wrapper"},m["default"].createElement("div",{className:"checkbox-container-wrapper"},m["default"].createElement(N["default"],{onChange:this.onSelect,checked:this.state.selected})),n)}}]),t}(h.Component))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.SenderElement=void 0;var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(21),y=n(_),E=a(241),M=(n(E),a(1403)),S=n(M),C=a(1402),b=n(C);t["default"]=(0,b["default"])((o=i=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.contact,a=e.className;return g["default"].createElement(k,{text:t.formattedShortName,isNumber:!t.name,className:a})}}]),t}(g["default"].PureComponent),i.CONCERNS={contact:["formattedShortName","name"]},o));var k=t.SenderElement=function(e){var t=e.text,a=e.className,n=e.isNumber;return g["default"].createElement("span",{className:(0,y["default"])("sender",a)},g["default"].createElement(S["default"],{text:t,direction:n?"ltr":"auto"}),g["default"].createElement("span",null,":"))}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(62),o=n(i),r=a(98),s=n(r),l=a(5),u=n(l),c=a(21),d=n(c),f=a(160),p=n(f);t["default"]=function(e){var t=e.count,a=e.className,n=(0,s["default"])(e,["count","className"]);return u["default"].createElement("span",(0,o["default"])({className:(0,d["default"])("unread-count",a)},n),t>0?p["default"].n(t):null)}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(46),g=n(v),_=a(1422),y=n(_),E=a(116),M=n(E),S=a(1417),C=n(S),b=a(1454),k=n(b),T=a(1411),w=n(T),N=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onFocusGain=function(e){e.target===g["default"].findDOMNode(n)&&(n.selection.index<0?n.focusFirst():n.selection.reset())},n.focusFirst=function(){n.selection.setFirst()},n.onNextContact=function(e){e.preventDefault(),e.stopPropagation(),n.selection.setNext()},n.onPrevContact=function(e){e.preventDefault(),e.stopPropagation();var t=n.selection.prev();t>-1?n.selection.setPrev():(n.selection.unset(),n.props.onFocusSearch(e))},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.selection=new w["default"](this.props.contacts,function(e){return e.id})}},{key:"componentWillReceiveProps",value:function(e){this.selection.init(e.contacts)}},{key:"render",value:function(){for(var e,t=this.props.contacts,a=[],n=t.length>10,i="XXX",o=0;o<t.length;o++){var r=t[o];if(e=null,n){var s=r.header;o<t.length-1&&s!==t[o+1].header&&(e="last"),s!==i&&(a.push(m["default"].createElement(k["default"],{key:s,header:s})),i=s)}var l=r.id,u=void 0;r.isBlocked()&&(u=l10n.t("contact_list_blocked_contact")),a.push(m["default"].createElement(y["default"],{contact:r,active:this.selection,className:e,onClick:this.props.onClick,secondary:u,key:l,profileClick:this.props.profileClick}))}var c={down:this.onNextContact,up:this.onPrevContact};return m["default"].createElement(M["default"],{handlers:c,onFocus:this.onFocusGain,"data-tab":3},m["default"].createElement(C["default"],{className:"chatlist",data:a,height:72,extraItems:4}))}}]),t}(m["default"].PureComponent);t["default"]=N},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(46),g=n(v),_=a(23),y=n(_),E=a(12),M=n(E),S=a(37),C=n(S),b=a(78),k=n(b),T=a(117),w=n(T),N=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.startCheckForSuccess=function(){n.checkIteration=0,n.checkForSuccessInterval=n.props.setInterval(n.checkForSuccess,250)},n.clearCheckForSuccess=function(){n.checkForSuccessInterval&&(n.props.clearInterval(n.checkForSuccessInterval),delete n.checkForSuccessInterval,delete n.checkIteration)},n.checkForSuccess=function(){if(y["default"].state===y["default"].STATE.CONNECTED){n.checkIteration++;var e=n.props.url;if(n.checkIteration>40)return void n.onPlayerError({target:{src:e,error:{code:window.MediaError.MEDIA_ERR_NETWORK}}});var t=g["default"].findDOMNode(n),a=t.buffered;a&&a.length&&a.end(0)>0&&n.onPlaying({target:t})}},n.onPlayerError=function(e){n.clearCheckForSuccess(),n.props.onError&&n.props.onError(e.target.src)},n.onOtherPlaying=function(e){e!==n&&g["default"].findDOMNode(n).pause()},n.onPlaying=function(e){n.clearCheckForSuccess(),M["default"].mediaPlaying(n),n.props.onPlay&&n.props.onPlay(e)},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){var e=this.props.listeners,t=g["default"].findDOMNode(this);e.add(t,"error",this.onPlayerError,!0),e.add(t,"playing",this.onPlaying),e.add(M["default"],"mediaPlaying",this.onOtherPlaying),(C["default"].isGecko||C["default"].isSafari)&&(this.props.autoPlay?(this.checkIteration=0,this.checkForSuccessInterval=this.props.setInterval(this.checkForSuccess,250)):this.props.autoPlay?this.startCheckForSuccess():e.add(t,"play",this.startCheckForSuccess))}},{key:"render",value:function(){return m["default"].createElement("audio",{src:this.props.url,className:this.props.className,onClick:this.props.onClick,controls:this.props.controls,preload:this.props.preload,type:this.props.type,autoPlay:this.props.autoPlay},this.props.children)}}]),t}(m["default"].Component);t["default"]=(0,k["default"])((0,w["default"])(N))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(1404),y=n(_),E=a(1415),M=n(E),S=a(1402),C=n(S);t["default"]=(0,C["default"])((o=i=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=void 0;switch(this.props.chat.kind){case y["default"].KIND.GROUP:e=this.props.chat.isReadOnly?l10n.t("web_delete_group"):l10n.t("web_exit_group");break;case y["default"].KIND.BROADCAST:e=l10n.t("web_delete_list");break;case y["default"].KIND.CHAT:e=l10n.t("delete_chat")}return g["default"].createElement(M["default"],{a8n:"mi-delete",action:this.props.onDeleteOrExit,shortcut:"x"},e)}}]),t}(g["default"].PureComponent),i.CONCERNS={chat:["isReadOnly","kind"]},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return e.map(function(e){return e.contact.formattedShortNameWithNonBreakingSpaces})}Object.defineProperty(t,"__esModule",{value:!0}),t.ParticipantsList=void 0;var o,r,s,l,u=a(6),c=n(u),d=a(3),f=n(d),p=a(4),h=n(p),m=a(8),v=n(m),g=a(7),_=n(g),y=a(5),E=n(y),M=a(1403),S=n(M),C=a(1443),b=(n(C),a(78)),k=n(b),T=a(55),w=n(T),N=a(1402),P=n(N),A="sort remove reset",O=t.ParticipantsList=(0,k["default"])((0,P["default"])((r=o=function(e){function t(e){(0,f["default"])(this,t);var a=(0,v["default"])(this,(t.__proto__||(0,c["default"])(t)).call(this,e));a.onParticipantsUpdate=function(){a.recalculateParticipantsTimer.debounce(100)},a.recalculateParticipantsTimer=new w["default"](function(){a.setState({participants:i(a.props.groupMetadata.participants)})});var n=e.listeners,o=e.groupMetadata.participants;return a.state={participants:i(o)},n.add(o,A,a.onParticipantsUpdate),a}return(0,_["default"])(t,e),(0,h["default"])(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.groupMetadata.participants,a=e.groupMetadata.participants;if(a!==t){var n=e.listeners;n.remove(t,A,this.onParticipantsUpdate),n.add(a,A,this.onParticipantsUpdate),this.recalculateParticipantsTimer.cancel(),this.setState({participants:i(a)})}}},{key:"componentWillUnmount",value:function(){this.recalculateParticipantsTimer.cancel()}},{key:"render",value:function(){var e=this.props.overridingText||this.state.participants.join(l10n.t("enumeration_comma"))||this.props.placeholder;return e?E["default"].createElement("div",{className:this.props.className},E["default"].createElement(S["default"],{ellipsify:!0,titlify:!0,direction:"inherit",text:e})):null}}]),t}(y.PureComponent),o.CONCERNS={groupMetadata:["participants"]},r)));t["default"]=(0,P["default"])((l=s=function(e){function t(){return(0,f["default"])(this,t),(0,v["default"])(this,(t.__proto__||(0,c["default"])(t)).apply(this,arguments))}return(0,_["default"])(t,e),(0,h["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.presence.withholdDisplay?e.placeholder:e.presence.getFormattedString();return E["default"].createElement(O,{groupMetadata:e.groupMetadata,overridingText:t,placeholder:e.placeholder,className:this.props.className})}}]),t}(y.PureComponent),s.CONCERNS={chatstate:["id","type","deny","t"],groupMetadata:[],presence:["forceDisplay","withholdDisplay"]},l))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_NUM_SECTIONS=t.DEFAULT_EXTRA_ITEMS=t.DEFAULT_SCROLL_TOP=t.DEFAULT_SECTION_HEIGHT=t.DEFAULT_ITEM_HEIGHT=t.SCROLL_OFFSET_ATTR=t.SCROLL_ATTR=void 0;var i=a(494),o=n(i),r=a(120),s=n(r),l=a(6),u=n(l),c=a(3),d=n(c),f=a(4),p=n(f),h=a(8),m=n(h),v=a(7),g=n(v),_=a(5),y=n(_),E=a(46),M=n(E),S=a(21),C=n(S),b=a(13),k=n(b),T=a(78),w=n(T),N=a(1533),P=n(N),A=a(1566),O=n(A),R=a(1567),D=n(R),x=a(477),I=n(x),L=t.SCROLL_ATTR="data-list-scroll-container",F=t.SCROLL_OFFSET_ATTR="data-list-scroll-offset",U=t.DEFAULT_ITEM_HEIGHT=72,j=t.DEFAULT_SECTION_HEIGHT=72,G=(t.DEFAULT_SCROLL_TOP=0,t.DEFAULT_EXTRA_ITEMS=5),B=(t.DEFAULT_NUM_SECTIONS=0,new O["default"](0,0)),V=function(e){function t(){var e,a,n,i;(0,d["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,m["default"])(this,(e=t.__proto__||(0,u["default"])(t)).call.apply(e,[this].concat(r))),n.state={firstPhysicalIndexPath:B,lastPhysicalIndexPath:B},n.scrollTop=0,n.offsetTop=0,n.bodyHeight=0,n.listHeight=0,n.pointerEvents=!0,n.metaMap={},n.prevMetaMap={},n.enablePointerEvents=k["default"].debounce(function(){return n.animationFrame?n.enablePointerEvents():(I["default"].clearBusy(n.busyId),delete n.busyId,n.props.onPointerEventsOn&&n.props.onPointerEventsOn(),M["default"].findDOMNode(n.refs.viewport).style.pointerEvents="auto",void(n.pointerEvents=!1))},150),n.onScroll=function(){n.animationFrame?n.hanging=!0:(n.hanging=!1,n.animationFrame=window.requestAnimationFrame(n._onScroll))},n._onScroll=function(){n.disablePointerEvents(),n.scrollTarget&&(n.scrollTop=n.scrollTarget.scrollTop);var e=n.getPhysicalIndexPaths(n.props),t=e.firstPhysicalIndexPath,a=e.lastPhysicalIndexPath;return t.equals(n.state.firstPhysicalIndexPath)&&a.equals(n.state.lastPhysicalIndexPath)?n._onFinishScroll():void n.setState({firstPhysicalIndexPath:t,lastPhysicalIndexPath:a},n._onFinishScroll)},n._onFinishScroll=function(){n.animationFrame=void 0,n.enablePointerEvents(),n.hanging&&n.onScroll()},i=a,(0,m["default"])(n,i)}return(0,g["default"])(t,e),(0,p["default"])(t,[{key:"componentWillReceiveProps",value:function(e){void 0!==e.scrollTop&&this.scrollTarget&&(this.scrollTarget.scrollTop=e.scrollTop),this.props.scrollTarget===e.scrollTarget&&this.initialize()}},{key:"componentDidUpdate",value:function(e,t){var a=this.state,n=a.firstPhysicalIndexPath,i=a.lastPhysicalIndexPath;n.equals(t.firstPhysicalIndexPath)&&i.equals(t.lastPhysicalIndexPath)&&this.componentDidReceiveProps(e)}},{key:"componentDidReceiveProps",value:function(e){this.props.scrollTarget!==e.scrollTarget&&(this.getTargets(this.props),this.initialize())}},{key:"componentDidMount",value:function(){var e=this;this.getTargets(this.props),this.initialize(this.props),this.props.listeners.add(window,"resize",function(){if(!e.scrollTarget)throw new Error("Invalid ScrollTarget!");e.bodyHeight=e.scrollTarget.clientHeight,e.initialize(e.props)})}},{key:"componentWillUnmount",value:function(){this.cancelScroll(),this.enablePointerEvents.cancel()}},{key:"getTargets",value:function(e){if(this.scrollTarget){var t=P["default"]?{passive:!0}:void 0;this.props.listeners.remove(this.scrollTarget,"scroll",this.onScroll,t)}for(var a=M["default"].findDOMNode(this),n=void 0,i=a,o=0;5>o;o++){if(i instanceof HTMLElement&&i.hasAttribute(L)){n=i;break}i=i&&i.parentNode}if(!n)throw new Error("Invalid ScrollTarget!");var r=P["default"]?{passive:!0}:void 0;this.props.listeners.add(n,"scroll",this.onScroll,r),this.scrollTarget=n,this.scrollTop=this.scrollTarget.scrollTop,this.bodyHeight=this.scrollTarget.clientHeight;var s=void 0;i=a;for(var l=0;o>l;l++){if(i instanceof HTMLElement&&i.hasAttribute(F)){s=i;break}i=i&&i.parentNode}this.offsetTarget=s,this.offsetTop=s?s.offsetTop:0}},{key:"initialize",value:function(e){var t=this,a=e?e:this.props;this.cancelScroll(),this.setMetaMap(a),this.setState(this.getPhysicalIndexPaths(a),function(){t.prevMetaMap={}})}},{key:"setMetaMap",value:function(e){var t=e.heightForItem,a=e.heightForSection,n=e.sectionForSection,i=e.numberOfSections,o=e.numberOfRowsInSection,r=e.keyForRowAtIndexPath;this.prevMetaMap=this.metaMap,this.metaMap={};for(var s=0,l=0,u=i(),c=0;u>c;c++){n(c)&&(this.metaMap["section_"+c]={indexPath:c,globalOffset:s,globalIndex:l},s+=a(c),l++);for(var d=0;d<o(c);d++){var f=new O["default"](d,c),p=r(f);this.metaMap[p]={indexPath:f,globalIndex:l,globalOffset:s},s+="number"==typeof t?t:t(f),l++,c===u-1&&d===o(c)-1&&(this.listHeight=s)}}}},{key:"numberOfItems",value:function(){var e=this.props,t=e.numberOfSections,a=e.numberOfRowsInSection,n=e.keyForRowAtIndexPath,i=t()-1,o=a(i)-1,r=new O["default"](o,i);return this.metaMap[n(r)].globalIndex+1}},{key:"getIndexPathAtIndexPathWithOffset",value:function(e,t,a,n){for(var i=n.keyForRowAtIndexPath,o=O["default"].indexPathIterator(n,e),r=this.metaMap[i(e)].globalOffset,s=void 0,l=void 0;s=o.next();){var u=i(s);if(this.metaMap[u].globalOffset-r>=t)return a?l||s:o.next()||s;l=s}if(!l)throw new Error("getIndexPathAtIndexPathWithOffset");return l}},{key:"getFirstVisibleIndexPath",value:function(e){var t=Math.max(this.scrollTop-this.offsetTop,0),a=new O["default"](0,0);return this.getIndexPathAtIndexPathWithOffset(a,t,!0,e)}},{key:"getLastVisibleIndexPath",value:function(e,t){var a=Math.min(this.bodyHeight,this.listHeight);return this.getIndexPathAtIndexPathWithOffset(e,a,!1,t)}},{key:"getPhysicalIndexPaths",value:function(e){for(var t=this.getFirstVisibleIndexPath(e),a=this.getLastVisibleIndexPath(t,e),n=O["default"].indexPathIterator(e,t),i=O["default"].indexPathIterator(e,a),o=void 0,r=void 0,s=e.extraItems;s--;){var l=n.prev();l&&(o=l),l=i.next(),l&&(r=l)}return{firstPhysicalIndexPath:o,lastPhysicalIndexPath:r}}},{key:"cancelScroll",value:function(){this.animationFrame&&(window.cancelAnimationFrame(this.animationFrame),this.animationFrame=void 0,this.hanging=!1)}},{key:"disablePointerEvents",value:function(){this.busyId=I["default"].setBusy(this.busyId),this.pointerEvents||(this.props.onPointerEventsOff&&this.props.onPointerEventsOff(),M["default"].findDOMNode(this.refs.viewport).style.pointerEvents="none",this.pointerEvents=!0)}},{key:"getHeight",value:function(e){var t=this.props,a=t.heightForItem,n=t.heightForSection,i=this.metaMap[e],o=i.indexPath instanceof O["default"]?a:n;return"number"==typeof o?o:o(i.indexPath)}},{key:"boundGlobalOffset",value:function(e,t,a){return e&&t&&a?Math.min(t.globalOffset,Math.max(e.globalOffset,a.globalOffset)):void 0}},{key:"getAndUpdateRctKey",value:function(e,t,a){var n=this.prevMetaMap[e],i=this.metaMap[e],o=void 0;if(n&&"rctKey"in n){if(o=n.rctKey,"number"!=typeof o)throw new Error("List:rctKey must be defined.")}else if("rctKey"in i)o=i.rctKey;else{if(!(t.length>0))throw new Error("No free keys!");if(o=t.shift(),"number"!=typeof o)throw new Error("List:rctKey must be defined.")}return i.rctKey=o}},{key:"getComponents",value:function(){var e=this,t=this.props,a=t.itemForRowAtIndexPath,n=t.keyForRowAtIndexPath,i=t.sectionForSection;if(k["default"].size(this.metaMap)){for(var r=this.state,l=r.firstPhysicalIndexPath,u=r.lastPhysicalIndexPath,c=void 0,d=O["default"].indexPathIterator(this.props,l,u),f=new s["default"];c=d.next();){if(0===c.row){var p="section_"+c.section;p in this.metaMap&&f.set(p,i(c.section))}var h=n(c);h in f||f.set(h,a(c))}for(var m=k["default"].isEmpty(this.prevMetaMap)?this.metaMap:this.prevMetaMap,v={},g=0;g<f.size;g++)v[g]=g;for(var _ in m){var E=m[_];"rctKey"in E&&(f.has(_)?delete v[E.rctKey]:delete E.rctKey)}var M=(0,o["default"])(v),S=new Array(f.size),C=this.numberOfItems(),b=this.metaMap[n(l)],T=this.metaMap[n(u)];return f.forEach(function(t,a){var n=e.metaMap[a],i=e.getAndUpdateRctKey(a,M,f.size),o=e.boundGlobalOffset(b,T,e.prevMetaMap[a]);S[i]=y["default"].createElement(D["default"],{key:i,dataKey:a,rowHeight:e.getHeight(a),className:0===n.globalIndex?"first":void 0,zIndex:C-n.globalIndex-1,rowOffset:n.globalOffset,prevRowOffset:o},t)}),S}}},{key:"render",value:function(){var e=this.props.className,t={viewport:{height:this.listHeight}},a={container:(0,C["default"])(e,"infinite-list"),viewport:"infinite-list-viewport"};return y["default"].createElement("div",{className:a.container},y["default"].createElement("div",{className:a.viewport,ref:"viewport",style:t.viewport},this.getComponents()))}}]),t}(y["default"].Component);V.defaultProps={extraItems:G,animate:!1,numberOfSections:function(){return 1},heightForItem:U,heightForSection:function(e){return j},stickyHeaders:!1},t["default"]=(0,w["default"])(V)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=e.duration,a=C.durationStr(t);return a?M.createElement("span",{className:"media-canvas-duration"},a):null}var o=a(6),r=n(o),s=a(3),l=n(s),u=a(4),c=n(u),d=a(8),f=n(d),p=a(7),h=n(p),m=a(462),v=(n(m),a(1557)),g=n(v),_=a(78),y=n(_),E=a(239),M=a(5),S=a(242),C=a(79),b=a(21),k=function(e){function t(){(0,l["default"])(this,t);var e=(0,f["default"])(this,(t.__proto__||(0,r["default"])(t)).apply(this,arguments));return e.onSelectClick=function(t){e.props.onMessageSelect&&e.props.onMessageSelect(e.props.msg,!e.props.selected)},e.onMouseOver=function(t){e.state.hover||e.setState({hover:!0})},e.onMouseEnter=function(t){e.state.hover||e.setState({hover:!0})},e.onMouseLeave=function(t){e.state.hover&&e.setState({hover:!1})},e.state={hover:!1},e}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentDidMount",value:function(){this.props.listeners.add(this.props.msg.mediaData,"change:preview"),this.props.listeners.add(this.props.msg,"change:star"),this.props.imgRef&&this.props.imgRef(this.img)}},{key:"componentWillUnmount",value:function(){this.props.imgRef&&this.props.imgRef(null)}},{key:"render",value:function(){var e=this.props,t=e.msg.mediaData,a=e.selected,n=e.selectable,o=void 0,r=null,s=null,l=null,u=null,c=null;switch(this.props.msg.star&&(t.type!==S.TYPE.AUDIO&&(s=M.createElement("div",{className:"media-canvas-shade"})),c=M.createElement("span",{className:"media-canvas-icon-star icon-s icon-star-light"})),t.type){case S.TYPE.AUDIO:o="media-canvas attach-media-audio-thumb",l=M.createElement("span",{className:"media-canvas-icon-type icon-s icon-msg-audio-light"}),u=M.createElement(i,{duration:t.duration});break;case S.TYPE.VIDEO:s=M.createElement("div",{className:"media-canvas-shade"}),t.isGif?(o=t.preview?"media-canvas":"media-canvas media-video-thumb",l=M.createElement("span",{className:"media-canvas-icon-type icon-s icon-msg-gif-light"})):(o="media-canvas",l=M.createElement("span",{className:"media-canvas-icon-type icon-s icon-msg-video-light"}),u=M.createElement(i,{duration:t.duration})),t.preview&&(r={backgroundImage:'url("'+t.preview.url()+'")'});break;case S.TYPE.IMAGE:o="media-canvas",t.renderableUrl?r={backgroundImage:"url("+t.renderableUrl+")"}:t.preview&&(r={backgroundImage:'url("'+t.preview.url()+'")'})}var d=void 0;d=this.props.onDragStart?M.createElement("div",{className:o,style:r,onClick:this.props.onClick||null,ref:(0,E.GetRef)("img",this),onDragStart:this.props.onDragStart,draggable:!0},s):M.createElement("div",{className:o,style:r,onClick:this.props.onClick||null,ref:(0,E.GetRef)("img",this)},s);var f=void 0;if(n||this.state.hover){var p=b("media-select-checkbox",{"checkbox-passive":n&&!this.state.hover});f=M.createElement("div",{className:"media-select",onClick:this.onSelectClick},M.createElement("div",{className:"media-canvas-shade-top"}),M.createElement(g["default"],{onChange:this.onSelectClick,className:p,hover:this.state.hover,checked:a}))}var h=null,m=null,v=null;this.props.hoverEvent&&(h=this.onMouseOver,m=this.onMouseEnter,v=this.onMouseLeave);var _=b(this.props.classes,"media-canvas-component",{"media-canvas-selected":a});return M.createElement("div",{className:_,onMouseOver:h,onMouseEnter:m,onMouseLeave:v},f,M.createElement("div",{className:"media-canvas-body"},l,u,c),d)}}]),t}(M.Component);e.exports=(0,y["default"])(k)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(1415),y=n(_),E=a(1402),M=n(E);t["default"]=(0,M["default"])((o=i=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props.mute,t=this.props.onMute.bind(null,!e.isMuted),a=e.isMuted?l10n.t("web_menuitem_mute_off"):l10n.t("web_menuitem_mute");return g["default"].createElement(y["default"],{action:t,shortcut:"m",a8n:"mi-mute"},a)}}]),t}(g["default"].PureComponent),i.CONCERNS={mute:["isMuted"]},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(1404),y=(n(_),a(1428)),E=n(y),M=a(12),S=n(M),C=a(238),b=n(C),k=a(1445),T=(n(k),a(1469)),w=n(T),N=a(1402),P=n(N);t["default"]=(0,P["default"])((o=i=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(r))),n.onMute=function(e){S["default"].muteChat((0,N.unproxy)(n.props.chat),e,n)},n.onUnmute=function(){var e=n.props.chat.isGroup?l10n.t("confirm_unmute_group"):l10n.t("confirm_unmute_chat");S["default"].openModal(g["default"].createElement(b["default"],{onOK:n.unmute,okText:l10n.t("action_chat_unmute"),onCancel:function(){return S["default"].closeModal()},cancelText:l10n.t("web_cancel")},e))},n.unmute=function(){n.onMute(!1),S["default"].closeModal()},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this,t=this.props.mute.isMuted,a=t?this.onUnmute:function(){e.onMute(!0)},n=g["default"].createElement(E["default"],{checked:t,onChange:a}),i=t?l10n.t("web_chat_muted"):l10n.t("web_menuitem_mute");return g["default"].createElement(w["default"],{classes:"row-drawer-item",side:n,onClick:a,ellipsify:!0},g["default"].createElement("span",{className:"title"},i))}}]),t}(g["default"].PureComponent),i.CONCERNS={chat:["isGroup"],mute:["isMuted"]},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(1484),o=n(i);e.exports=(0,o["default"])({SEARCH:void 0,INACTIVE:void 0,ENTER:void 0,TAB:void 0,DOWN:void 0,UP:void 0})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(5),o=n(i),r=a(21),s=n(r),l=function(e){var t=e.children,a=e.className,n=e.direction;return o["default"].createElement("div",{className:(0,s["default"])("tooltip",a,n)},t)};t["default"]=l},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){return Oe}function o(e){e&&(e.preventDefault(),e.stopPropagation())}function r(e){for(var t=A["default"].TEXTSIZE_CLASS_MAP,a=0;a<t.length;a++)if(t[a].scale===e)return t[a].classname}function s(){return W["default"].supportsFeature(W["default"].F.LINK_PREVIEW)||!1}Object.defineProperty(t,"__esModule",{value:!0});var l=a(2),u=n(l),c=a(6),d=n(c),f=a(3),p=n(f),h=a(4),m=n(h),v=a(8),g=n(v),_=a(7),y=n(_);t.hasText=i;var E=a(5),M=n(E),S=a(1555),C=n(S),b=a(1404),k=(n(b),a(12)),T=n(k),w=a(238),N=n(w),P=a(14),A=n(P),O=a(21),R=n(O),D=a(15),x=n(D),I=a(1475),L=n(I),F=a(63),U=n(F),j=a(95),G=n(j),B=a(466),V=n(B),H=a(61),W=n(H),z=a(116),Y=n(z),q=a(249),K=n(q),Q=a(1500),X=n(Q),Z=a(1531),J=n(Z),$=a(1),ee=n($),te=a(78),ae=n(te),ne=a(1579),ie=n(ne),oe=a(462),re=n(oe),se=a(1622),le=n(se),ue=a(1473),ce=n(ue),de=a(46),fe=n(de),pe=a(55),he=n(pe),me=a(1623),ve=n(me),ge=a(1402),_e=n(ge),ye=a(470),Ee=n(ye),Me=a(240),Se=n(Me),Ce=a(463),be=n(Ce),ke=a(99),Te=n(ke),we=a(239),Ne=a(484),Pe=B.Configuration.ComposeBox(),Ae=/^https?:\/\/media\.giphy\.com\/media\/([a-zA-Z0-9]+)/,Oe=!1,Re=function(e){
function t(e){(0,p["default"])(this,t);var a=(0,g["default"])(this,(t.__proto__||(0,d["default"])(t)).call(this,e));a.height=0,a.pendingLinkPreviewPromises=[],a.onMaxPasteExceeded=function(){T["default"].openModal(M["default"].createElement(N["default"],{title:l10n.t("message_too_large_title"),onOK:function(){T["default"].closeModal()},okText:l10n.t("web_ok")},l10n.t("message_too_large_text")))},a.restoreFocus=function(){a.refs.input&&a.refs.input.focus()},a.omitLinkPreview=function(e){e!==!0&&a.state.linkPreview&&(a.omittedURL=a.preview,a.setState({linkPreview:null}))},a.omitQuotedPreview=function(e){e!==!0&&(a.props.chat.composeQuotedMsg=null)},a.scanForLinksTimer=new he["default"](function(){if(!a.state.hasText)return void a.clearLinkPreview();var e=a._findFirstWebLink();if(!e)return void a.clearLinkPreview();var t=e.url;if(!a.preview||a.preview!==t){a.preview=t,a.omittedURL=null;var n=(0,J["default"])(t).cancellable().tap(function(e){e&&a.preview&&a.preview===e.url&&e.data&&(e.data.title||e.data.description)&&a.setState({linkPreview:e})});a.pendingLinkPreviewPromises.push(n),n["catch"](x["default"].Unmount,x["default"].WapDrop,u["default"].CancellationError,function(){})}}),a.indicateFocus=function(e){var t=a.refs.container;if(t&&t.activate(),!(Date.now()-(Y["default"].flashFocus||0)>200)){var n=fe["default"].findDOMNode(a.refs.input_hotkey);(0,be["default"])(n,"stop"),(0,be["default"])(n,{backgroundColor:["#ffffff","#D9F3FF"],borderColor:["#ffffff","#CBE4EF"]},{duration:1300,easing:[.24,.91,.01,.99]}),a.refs.input.focus(!1)}},a.onEmojiButtonFocus=function(){var e=fe["default"].findDOMNode(a.refs.emojiButton);G["default"].focus(e)},a.onPageUpDown=function(e){a.props.onPageUpDown&&(e.stopPropagation(),a.props.onPageUpDown(e),a.restoreFocusTimer.debounce(0))},a.restoreFocusTimer=new he["default"](function(){a.refs.input&&a.refs.input.focus(!0)}),a.handleEmoji=function(e){a.refs.input.replaceSelection(e)},a.handleGif=function(e,t){var n=Te["default"].get(e,Te["default"].RESP_TYPE.BLOB,{Accept:"video/mp4"}).then(function(e){var a=e.response;return a.isGifHackDoNotUse=!0,a.gifAttributionHackDoNotUse=t,a})["catch"](function(e){throw ee["default"].error("failed loading gif ("+e+")")(),new x["default"].MediaFileFailedLoad});T["default"].attachMediaDrawer(a.props.chat,[n],function(e){e&&a.closeEmojiPanel()})},a.openEmojiPanel=function(){a.setState({emojiExpanded:!0})},a.closeEmojiPanel=function(){a.setState({emojiExpanded:!1})},a.onPTTRecState=function(e){a.setState({recording:e})},a.preventBlur=function(e){var t=e.target,n=fe["default"].findDOMNode(a.refs.input),i=fe["default"].findDOMNode(a.refs.container);do if(t===n)return;while(t!==i&&(t=t.parentNode));o(e),a.refs.input.focus(!1)},a.onChange=function(e){var t=fe["default"].findDOMNode(a.refs.composeBlock),n=t.clientHeight,i=n-a.height;i&&a.props.onComposeHeightChange({input:i},!1),a.height=n;var o=a.hasText();a.text=e;var r=a.hasText();if(r!==o&&a.setState({hasText:r}),r?(a.props.chat.presence.subscribe()["catch"](x["default"].WapDrop,function(){}),a.props.chat.markComposing()):a.props.chat.markPaused(),s()){var l=a._findFirstWebLink();(!l&&a.preview||l&&l.url!==a.preview)&&a.clearLinkPreview(),a.scanForLinks()}},a._restoreEmojiPanelFocus=function(){a.emojiPanel&&a.emojiPanel.restoreFocus()},a.onHeightChange=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1;a.props.onComposeHeightChange({overlay:e},t)},a.onFiles=function(e){var t=e.getFiles().filter(function(e){var t=U["default"].typeFromMimetype(e.type);return"image"===t||"video"===t});if(e.hasType("text/html")){var n=e.getData("text/html");if(n&&-1!==n.indexOf("microsoft"))return!1}return t.length?(T["default"].attachMediaDrawer(a.props.chat,t),!0):void 0},a.onTextPaste=function(e){var t=Ae.exec(e);if(t){var n="https://media.giphy.com/media/"+t[1]+"/200w.mp4";return a.handleGif(n,re["default"].GIF_ATTRIBUTION.GIPHY),!0}return!1},a.onSelectionChange=function(e){a.selection=e},a.onEnter=function(e){e&&e.repeat||a.onSendText()},a.onSendText=function(){var e=a.refs.input.serialize(),t=[e[0].trim(),e[1]],n=t[0],i=t[1];if(n.length){var o=(0,V["default"])(n,Pe,Ne.TextSerializer);a.props.chat.sendMessage(o,a.state.linkPreview&&a.state.linkPreview.data,a.props.chat.composeQuotedMsg,i.mentionedJidList||[]),a.cancelPendingLinkPreviews(),a.setState({emojiExpanded:!1,hasText:!1,linkPreview:null}),a.props.chat.composeQuotedMsg=null,a.props.chat.setComposeContents({}),a.refs.input.reset(),a.text="",a.hasText()}},a.handleEmojiButtonClick=function(e){return o(e),a.state.emojiExpanded?a.closeEmojiPanel():a.openEmojiPanel()},a.handleTab=function(e){a.state.emojiExpanded&&(Y["default"].flashFocus=Date.now(),a.emojiPanel&&a.emojiPanel.focusSearchInput(),o(e))};var n=e.chat,i=n.composeContents;a.text=i.text||"",a.selection=i.selection,a.preview=a.omittedURL=i.omittedURL;var r;return r=0,a.state={hasText:!!a.text,emojiExpanded:!1,recording:!1,linkPreview:null,textsize:r},a}return(0,y["default"])(t,e),(0,m["default"])(t,[{key:"componentWillMount",value:function(){this.props.chat.setComposeContents({})}},{key:"componentDidMount",value:function(){this.height=fe["default"].findDOMNode(this.refs.composeBlock).clientHeight,s()&&this.scanForLinks()}},{key:"componentWillUnmount",value:function(){this.scanForLinksTimer.cancel(),this.restoreFocusTimer.cancel(),this.props.chat.setComposeContents({text:this.text,selection:this.selection,omittedURL:this.omittedURL})}},{key:"onTextSizeChange",value:function(e){this.setState({textsize:e})}},{key:"pasteEmojiInput",value:function(e){return" "!==e||this.hasText()?void(this.refs.input&&(this.refs.input.focus(!0),this.refs.input.replaceSelection(e))):T["default"].scrollMessages()}},{key:"handleRoutedPaste",value:function(e){this.refs.input&&(this.refs.input.focus(!0),this.refs.input.onPaste(e))}},{key:"clearLinkPreview",value:function(){this.preview=null,this.omitLinkPreview()}},{key:"cancelPendingLinkPreviews",value:function(){this.pendingLinkPreviewPromises.forEach(function(e){return e.cancel()}),this.pendingLinkPreviewPromises=[]}},{key:"_findFirstWebLink",value:function(){return K["default"].findLinks(this.text,!0)[0]}},{key:"scanForLinks",value:function(){this.scanForLinksTimer.debounce(200)}},{key:"renderSendButton",value:function(){var e=navigator.getUserMedia&&window.AudioContext;if(this.state.hasText||!e)return M["default"].createElement("button",{className:"compose-btn-send",onClick:this.onSendText,disabled:!this.hasText},M["default"].createElement(Ee["default"],{name:"send",className:"icon icon-send"}));var t=this.props.chat;return M["default"].createElement(le["default"],{key:"ptt",chat:t,onRecState:this.onPTTRecState})}},{key:"renderPopupPanel",value:function(){var e=void 0;if(this.state.linkPreview){var t=this.state.linkPreview.data,a=t.title,n=t.canonicalUrl,i=t.description,o=t.matchedText,r=t.thumbnail;e=M["default"].createElement(Se["default"],{displayName:"ComposeBoxLinkPreview",escapable:!0,requestDismiss:this.omitLinkPreview},M["default"].createElement("div",{className:"compose-popup-panel"},M["default"].createElement(X["default"],{onOmit:this.omitLinkPreview,title:a,canonicalUrl:n,description:i,matchedText:o,thumbnail:r})))}var s=this.props.chat.composeQuotedMsg,l=void 0;s&&(l=M["default"].createElement(Se["default"],{displayName:"ComposeBoxQuotedMsg",escapable:!0,requestFocus:this.restoreFocus,requestDismiss:this.omitQuotedPreview},M["default"].createElement("div",{className:"compose-popup-panel"},M["default"].createElement(ce["default"],{msg:s,key:s.id.toString(),onOmit:this.omitQuotedPreview,chat:s.chat}))));var u=null;this.state.emojiExpanded&&(u=M["default"].createElement(Se["default"],{displayName:"ComposeBoxEmojiPanel",escapable:!0,requestDismiss:this.closeEmojiPanel,requestFocus:this._restoreEmojiPanelFocus},M["default"].createElement("div",null,M["default"].createElement(L["default"],{ref:(0,we.GetRef)("emojiPanel",this),key:"compose-emoji-panel",onEmoji:this.handleEmoji,onFocusRelease:this.restoreFocus,onGif:A["default"].SHOW_GIF_SEARCH?this.handleGif:void 0}))));var c=this.props.chat,d=W["default"].supportsFeature(W["default"].F.SPAM),f=null;return!c.isPSA&&c.isVisible&&!c.trusted&&d&&(f=M["default"].createElement(ve["default"],{chat:this.props.chat})),M["default"].createElement("div",{className:"compose-box-items-positioning-container"},M["default"].createElement("div",{className:"compose-box-items-overlay-container"},M["default"].createElement(C["default"],{onHeightChange:this.onHeightChange},f,u,l,e)))}},{key:"hasText",value:function(){return Oe=this.text.trim().length>0}},{key:"render",value:function(){var e=this.state.emojiExpanded?M["default"].createElement("button",{className:"icon icon-hide compose-btn-emoji",onClick:this.closeEmojiPanel}):M["default"].createElement("button",{className:"icon icon-smiley compose-btn-emoji",onClick:this.openEmojiPanel}),t={enter:this.handleEmojiButtonClick},a=(0,R["default"])("input-container",{disabled:this.state.recording}),n={pagedown:this.onPageUpDown,pageup:this.onPageUpDown},i=l10n.t("type_a_message"),o=(0,R["default"])("block-compose",r(this.state.textsize),{"ptt-open":this.state.recording}),s={tab:this.handleTab,"shift+tab":this.handleTab},l=null;return M["default"].createElement(Se["default"],{displayName:"ComposeBox",ref:"container",state:Se["default"].State.PASSIVE,requestFocus:this.restoreFocus},M["default"].createElement(Y["default"],{component:"footer",handlers:n,className:this.props.className,onMouseDown:this.preventBlur,onContextMenu:this.preventBlur},M["default"].createElement("div",{className:o,ref:"composeBlock"},M["default"].createElement(Y["default"],{ref:"emojiButton",className:"emoji-button-container","data-tab":4,handlers:t,onFocus:this.onEmojiButtonFocus},e),M["default"].createElement(Y["default"],{ref:"input_hotkey",className:a,handlers:s,onFocus:this.indicateFocus},M["default"].createElement(ie["default"],{placeholder:i,readOnly:this.state.recording,ref:"input",initialValue:this.text,initialSelection:this.selection,spellCheck:!0,multiline:!0,maxLength:A["default"].MAX_TXT_MSG_SIZE,onMaxPasteExceeded:this.onMaxPasteExceeded,onEnter:this.onEnter,onFiles:this.onFiles,onTextPaste:this.onTextPaste,onChange:this.onChange,onSelect:this.onSelectionChange,className:"input"})),this.renderSendButton()),this.renderPopupPanel(),l,M["default"].createElement(De,{key:this.props.chat.id,parent:this,chatId:this.props.chat.id}),M["default"].createElement(ie["default"].Suggestions,{chat:(0,ge.unproxy)(this.props.chat)})))}}]),t}(M["default"].Component);Re.CONCERNS={chat:["id","trusted","composeContents","composeQuotedMsg","isPSA","isVisible","presence"]},t["default"]=(0,_e["default"])(Re);var De=(0,ae["default"])(function(e){function t(){var e,a,n,i;(0,p["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,g["default"])(this,(e=t.__proto__||(0,d["default"])(t)).call.apply(e,[this].concat(r))),n.restoreFocus=function(){n.props.parent.restoreFocus()},n.pasteEmojiInput=function(e){n.props.parent.pasteEmojiInput(e)},n.handleRoutedPaste=function(e){n.props.parent.handleRoutedPaste(e)},n.onSendText=function(){n.props.parent.onSendText()},n.onTextSizeChange=function(e){n.props.parent.onTextSizeChange(e)},i=a,(0,g["default"])(n,i)}return(0,y["default"])(t,e),(0,m["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.chatId,a=e.listeners;a.add(T["default"],"focus_chat_text_input_"+t,this.restoreFocus),a.add(T["default"],"paste_chat_text_input_"+t,this.pasteEmojiInput),a.add(T["default"],"send_paste_to_compose_"+t,this.handleRoutedPaste),a.add(T["default"],"enter_chat_text_input_"+t,this.onSendText),a.add(T["default"],"focus_chat_text_input",this.restoreFocus),a.add(T["default"],"textsize_change",this.onTextSizeChange)}},{key:"render",value:function(){return null}}]),t}(M["default"].PureComponent))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=e.title,a=e.description,n=e.canonicalUrl,i=e.thumbnail,o=e.onOmit,s=i?r["default"].createElement("img",{className:"link-preview-media",src:"data:image/jpeg;base64,"+i}):null,l=o?r["default"].createElement("div",{className:"btn-background"},r["default"].createElement("button",{className:"icon icon-x",onClick:o})):null;return r["default"].createElement("div",{className:"message-in link-preview-compose"},r["default"].createElement("div",{className:"link-preview-container"},s,r["default"].createElement("div",{className:"link-preview-body"},r["default"].createElement("div",{className:"link-preview-title",title:t},t),r["default"].createElement("div",{className:"link-preview-description",title:a},a),r["default"].createElement("div",{className:"link-preview-source ellipsify"},n))),l)}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i;var o=a(5),r=n(o)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var a=[];return a.push(p.createElement(l["default"],{key:"info",a8n:"mi-group-info",action:function(){return h.chatInfoDrawer(e)},shortcut:"i"},l10n.t("web_group_info"))),a.push(p.createElement(l["default"],{a8n:"mi-select-messages",key:"select",action:t,shortcut:"e"},l10n.t("web_select_messages"))),e.mute.canMute()&&a.push(p.createElement(c["default"],{key:"mute",onMute:function(t){return h.muteChat(e,t)},mute:e.mute})),e.canClear()&&a.push(p.createElement(l["default"],{key:"clear",a8n:"mi-clear",shortcut:"e",action:function(){return h.clearChatMsgs(e)}},l10n.t("clear_chat"))),e.canDelete()&&a.push(p.createElement(f["default"],{key:"delete",onDeleteOrExit:function(){return h.deleteOrExitChat(e)},chat:e})),a}function o(e,t){var a=[];return a.push(p.createElement(l["default"],{key:"info",a8n:"mi-broadcast-info",action:function(){return h.chatInfoDrawer(e)},shortcut:"i"},l10n.t("web_list_info"))),a.push(p.createElement(l["default"],{a8n:"mi-select-messages",key:"select",action:t,shortcut:"e"},l10n.t("web_select_messages"))),e.canClear()&&a.push(p.createElement(l["default"],{key:"clear",a8n:"mi-clear",shortcut:"e",action:function(){return h.clearChatMsgs(e)}},l10n.t("clear_chat"))),e.canDelete()&&a.push(p.createElement(f["default"],{key:"delete",onDeleteOrExit:function(){return h.deleteOrExitChat(e)},chat:e})),a}function r(e,t){var a=[];return e.isPSA||a.push(p.createElement(l["default"],{key:"info",a8n:"mi-contact",action:function(){return h.chatInfoDrawer(e)},shortcut:"i"},l10n.t("web_contact_info"))),a.push(p.createElement(l["default"],{a8n:"mi-select-messages",key:"select",action:t,shortcut:"e"},l10n.t("web_select_messages"))),e.mute.canMute()&&a.push(p.createElement(c["default"],{key:"mute",onMute:function(t){return h.muteChat(e,t)},mute:e.mute})),e.canClear()&&a.push(p.createElement(l["default"],{key:"clear",a8n:"mi-clear",shortcut:"e",action:function(){return h.clearChatMsgs(e)}},l10n.t("clear_chat"))),e.canDelete()&&a.push(p.createElement(f["default"],{key:"delete",onDeleteOrExit:function(){return h.deleteOrExitChat(e)},chat:e})),a}var s=a(1415),l=n(s),u=a(1495),c=n(u),d=a(1491),f=n(d),p=a(5),h=a(12);e.exports={group:i,contact:r,broadcast:o}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(5),o=n(i),r=a(79),s=n(r);t["default"]=function(e){var t=e.name,a=e.t;return o["default"].createElement("span",{className:"message-pre-text"},"â â [",s["default"].timeStr(a),"]Â ",t,":Â â â â ")}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.PREVIEW_HEIGHT=void 0;var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(21),g=n(v),_=a(13),y=n(_),E=a(1419),M=n(E),S=a(462),C=(n(S),a(1414)),b=n(C),k=a(1413),T=n(k),w=a(48),N=n(w),P=a(1423),A=n(P),O=a(482),R=n(O),D=a(244),x=n(D),I=a(78),L=n(I),F=50,U=["foursquare.com","facebook.com","maps.google.com"],j=t.PREVIEW_HEIGHT=150,G=270;t["default"]=(0,L["default"])(function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));a.getClientThumb=function(){return"data:image/jpeg;base64,"+a.props.msg.body},a.getStaticMapUrl=function(){var e=a.props.msg,t=j+F,n=R["default"].currentRes===R["default"].RES.HIGH?2:1,i=N["default"].build("https://maps.googleapis.com/maps/api/staticmap",{markers:"color:red|"+e.lat+", "+e.lng,zoom:14,size:G+"x"+t,scale:n,language:l10n.getLocale(),client:N["default"].GSM_NAME});return N["default"].gsmURL(i,N["default"].GSM_NUMS)},a.getMapUrl=function(){var e=a.props.msg,t=a.loc();return t&&t.name?["https://maps.google.com/maps/search",encodeURIComponent(t.name),"@"+e.lat+","+e.lng+",17z"].join("/")+"?hl="+l10n.getLocale():N["default"].build("https://maps.google.com/maps",{q:e.lat+","+e.lng,z:17,hl:l10n.getLocale()})},a.loc=function(){var e=a.props.msg.get("loc");return e?(e=e.split("\n"),2===e.length?{name:e[0],addr:e[1]}:{name:e}):void 0},a.getLocationDetails=function(){var e=a.props.msg,t=a.loc(),n=a.props.msg.clientUrl||a.getMapUrl(),i=void 0,o=void 0,r=void 0,s=N["default"].hostname(n),l=y["default"].isEmpty(U.filter(function(e){return s.indexOf(e)>-1}));if(r=l?m["default"].createElement("div",{className:"location-page-host location-caption"},m["default"].createElement(M["default"],null,s)):null,t){i=t.name?m["default"].createElement("a",{href:n,title:t.name,target:"_blank",className:"text-title"},m["default"].createElement(M["default"],null,t.name)):null;var u=(0,g["default"])("text-contents",{"location-caption":!r});o=t.addr?m["default"].createElement("div",{title:t.addr,className:u},m["default"].createElement(M["default"],null,t.addr)):null}var c=i&&o?m["default"].createElement("div",{className:"image-caption message-text","data-id":e.id},i,o,r):null;return c},a.updateResolution=function(){a.setState({src:a.getStaticMapUrl()})},a.onImgLoaded=function(){a.state.hiResAvail||a.setState({hiResAvail:!0})},a.onClick=function(e){e.stopPropagation()};var n="",i=!1,r=a.getStaticMapUrl();return x["default"].isCached(r)&&(n=r,i=!0),a.state={src:n,hiResAvail:i},a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){this.updateResolution(),this.props.listeners.add(window,"dpichange",this.updateResolution),this.props.listeners.add(this.props.msg,"change:body")}},{key:"render",value:function(){var e=this.props.msg,t=this.getLocationDetails(),a=t?null:m["default"].createElement("div",{className:"shade"}),n=this.props.displayAuthor&&!e.isSentByMe&&e.isGroupMsg?m["default"].createElement(T["default"],{msg:e,className:"bubble-location-author",contact:e.senderObj}):null,i=(0,g["default"])("bubble-location",{"bubble-location-caption":t,"bubble-broadcast":t&&e.broadcast,"bubble-star":t&&e.star}),o={background:"url("+this.getClientThumb()+")",backgroundSize:"cover",width:G,height:this.state.hiResAvail?void 0:j},r={height:j},s=(0,g["default"])("image-thumb-body",{"image-thumb-location-lores":!this.state.hiResAvail});return m["default"].createElement("div",{className:i},n,this.props.quotedMsg,m["default"].createElement("div",{className:"image-thumb",onClick:this.onClick,style:r},m["default"].createElement("a",{href:this.getMapUrl(),target:"_blank"},m["default"].createElement(A["default"],{src:this.state.src,className:s,style:o,hasPrivacyChecks:!1,onLoaded:this.onImgLoaded,noXHR:!0})),a),t,m["default"].createElement(b["default"],{msg:e}))}}]),t}(m["default"].Component))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MsgComponent=void 0;var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1596),g=n(v),_=a(1597),y=n(_),E=a(1599),M=n(E),S=a(1601),C=n(S),b=a(1604),k=n(b),T=a(1503),w=n(T),N=a(1),P=n(N),A=a(462),O=n(A),R=a(1610),D=n(R),x=a(1611),I=n(x),L=a(1612),F=n(L),U=a(1613),j=n(U),G=a(1402),B=n(G),V=a(1616),H=n(V),W=a(1618),z=n(W),Y=a(1619),q=n(Y),K=a(1609),Q=n(K),X=a(1620),Z=n(X),J=a(239),$=t.MsgComponent=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.msg,a=e.quotedMsg,n=e.displayAuthor,i=e.isMsgVisible;switch(t.type){case O["default"].TYPE.CHAT:return m["default"].createElement(H["default"],{msg:(0,G.unproxy)(t),contact:t.senderObj,ref:(0,J.GetRef)("ref",this),quotedMsg:a,trusted:t.isTrusted(),displayAuthor:n});case O["default"].TYPE.IMAGE:return m["default"].createElement(I["default"],{msg:t,mediaData:t.mediaData,ref:(0,J.GetRef)("ref",this),quotedMsg:a,isMsgVisible:i,displayAuthor:n});case O["default"].TYPE.GROUP_NOTIFICATION:case O["default"].TYPE.GP2:case O["default"].TYPE.BROADCAST_NOTIFICATION:case O["default"].TYPE.NOTIFICATION:case O["default"].TYPE.E2E_NOTIFICATION:case O["default"].TYPE.CALL_LOG:return m["default"].createElement(D["default"],{msg:t,ref:(0,J.GetRef)("ref",this)});case O["default"].TYPE.AUDIO:return m["default"].createElement(g["default"],{msg:t,mediaData:t.mediaData,quotedMsg:a,isMsgVisible:i,displayAuthor:n,ref:(0,J.GetRef)("ref",this)});case O["default"].TYPE.VIDEO:return t.isGif?m["default"].createElement(C["default"],{msg:t,mediaData:t.mediaData,ref:(0,J.GetRef)("ref",this),quotedMsg:a,isMsgVisible:i,displayAuthor:n}):m["default"].createElement(Z["default"],{msg:t,mediaData:t.mediaData,ref:(0,J.GetRef)("ref",this),quotedMsg:a,isMsgVisible:i,displayAuthor:n});case O["default"].TYPE.VCARD:return m["default"].createElement(q["default"],{msg:t,ref:(0,J.GetRef)("ref",this),quotedMsg:a,displayAuthor:n});case O["default"].TYPE.MULTI_VCARD:return m["default"].createElement(Q["default"],{msg:t,ref:(0,J.GetRef)("ref",this),quotedMsg:a,displayAuthor:n});case O["default"].TYPE.LOCATION:return t.isLive?m["default"].createElement(k["default"],{msg:(0,G.unproxy)(t),ref:(0,J.GetRef)("ref",this),displayAuthor:n}):m["default"].createElement(w["default"],{msg:(0,G.unproxy)(t),ref:(0,J.GetRef)("ref",this),quotedMsg:a,displayAuthor:n});case O["default"].TYPE.PTT:return m["default"].createElement(F["default"],{msg:t,mediaData:t.mediaData,profilePicThumb:t.senderObj.profilePicThumb,quotedMsg:a,displayAuthor:n,ref:(0,J.GetRef)("ref",this)});case O["default"].TYPE.DOCUMENT:return m["default"].createElement(M["default"],{msg:t,mediaData:t.mediaData,ref:(0,J.GetRef)("ref",this),quotedMsg:a,trusted:t.isTrusted(),displayAuthor:n});case O["default"].TYPE.UNKNOWN:return m["default"].createElement(z["default"],{msg:(0,G.unproxy)(t),displayAuthor:n});case O["default"].TYPE.CIPHERTEXT:return m["default"].createElement(y["default"],{msg:t,ref:(0,J.GetRef)("ref",this),displayAuthor:n});case O["default"].TYPE.REVOKED:return m["default"].createElement(j["default"],{msg:(0,G.unproxy)(t),ref:(0,J.GetRef)("ref",this),displayAuthor:n});default:return P["default"].log("messageList:render Unknown message type: "+t.type)(),m["default"].createElement(z["default"],{msg:(0,G.unproxy)(t),ref:(0,J.GetRef)("ref",this),displayAuthor:n})}}}]),t}(m["default"].PureComponent);$.CONCERNS={msg:["isGif","isLive","mediaData","senderObj","type"]},t["default"]=(0,B["default"])($)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(13),g=n(v),_=a(1490),y=n(_),E=a(21),M=n(E),S=a(78),C=n(S),b=a(46),k=n(b),T=a(239),w=function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));return a.onPlayClick=function(){var e=a._audioNode();a.props.playing?e.pause():e.play()},a.onPlaying=function(){a.props.onPlayingUpdate(!0)},a.onPause=function(){a.props.onPlayingUpdate(!1)},a.onEnded=function(){var e=a._audioNode();e.currentTime=0,e.load()},a.onTimeUpdate=function(){var e=a._audioNode(),t=0;g["default"].isFinite(e.duration)&&(t=Math.round(100*Math.min(1,e.currentTime/e.duration)),a.props.onTimeUpdate(e.currentTime)),a.setState({progress:t})},a.onDrag=function(e){var t=a._audioNode(),n=e.target.value;a.setState({progress:n}),t.duration&&(t.currentTime=t.duration/100*n)},a.onPlayerError=function(e){},a.state={progress:0},a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){var e=this._audioNode();this.props.listeners.add(e,"playing",this.onPlaying),this.props.listeners.add(e,"pause",this.onPause),this.props.listeners.add(e,"ended",this.onEnded),this.props.listeners.add(e,"timeupdate",this.onTimeUpdate),this.props.listeners.add(e,"durationchange",this.onTimeUpdate),this.props.listeners.add(e,"progress",this.onTimeUpdate)}},{key:"_audioNode",value:function(){return k["default"].findDOMNode(this.audioRef)}},{key:"render",value:function(){var e=(0,M["default"])("icon btn-audio",{"icon-audio-pause":this.props.playing,"icon-audio-play":!this.props.playing}),t={width:this.state.progress-this.state.progress/100*3+"%"};return m["default"].createElement("div",{className:"audio"},m["default"].createElement("div",{className:"audio-controls"},m["default"].createElement("button",{ref:"play_pause",className:e,onClick:this.onPlayClick})),m["default"].createElement("div",{className:"audio-body"},m["default"].createElement("div",{className:"audio-track-container"},m["default"].createElement("span",{className:"audio-progress",style:t}),m["default"].createElement("input",{type:"range",className:"audio-track",value:this.state.progress,onChange:this.onDrag,min:"0",max:"100"}))),m["default"].createElement(y["default"],{ref:(0,T.GetRef)("audioRef",this),url:this.props.url,preload:"auto",onError:this.onPlayerError,autoPlay:this.props.autoPlay}))}}]),t}(m["default"].PureComponent);t["default"]=(0,C["default"])(w)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(13),m=n(h),v=a(1447),g=n(v),_=a(118),y=n(_),E=a(95),M=n(E),S=a(78),C=n(S),b=a(5),k=n(b),T=a(1449),w=n(T),N=a(117),P=n(N),A=a(37),O=n(A),R=a(478),D=n(R),x=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.value=n.props.value||"",n.selection=n.props.selection,n.__isMounted=!1,n.setInput=function(e){n.input=e},n.restoreFocus=function(e){if(n.props.editable){var t=n.input;document.activeElement!==t&&(M["default"].focus(t),n.selection&&!e?n.restoreSelection(n.selection):n._moveCursorToEnd(t),n._saveSelection())}},n.onMouseDown=function(e){e.stopPropagation(),n.props.listeners.add(window,"mouseup",n.onWindowMouseUp),n.props.onMouseDown&&n.props.onMouseDown(e)},n.onWindowMouseUp=function(){n.props.listeners.remove(window,"mouseup",n.onWindowMouseUp),n._saveSelection()},n.onContextMenu=function(e){e.stopPropagation()},n.onKeyUp=function(e){if(O["default"].isTrident&&n.onInput(e),"Backspace"===e.key||"Delete"===e.key){var t=n.input;switch(t.innerHTML){case"\n":case"\r\n":case"<br>":t.innerHTML="",n.setNewValue("",!0,!0)}}n._saveSelection()},n.onKeyPress=function(e){if(O["default"].isTrident&&n.onInput(e),!n.props.onKeyPress||(n.props.onKeyPress(e),!e.defaultPrevented)){var t=e.ctrlKey||e.shiftKey||e.altKey;if(!n.props.multiline&&"Enter"===e.key||n.props.multiline&&"Enter"===e.key&&!t)return e.preventDefault(),void(n.props.onEnter&&n.props.onEnter(e));var a=n.limitLength(D["default"].ucs2.encode([e.charCode]));n.props.multiline&&"Enter"===e.key&&t&&(n.replaceSelection("\n",!0),e.preventDefault()),a.length||e.preventDefault()}},n.onInput=function(e){var t=n.input,a="boolean"==typeof e?e:void 0;n.setNewValue(y["default"].NodeToEmoji(t),!0,a)},n._saveSelection=n.props.debounce(function(){var e=n.getSelection();m["default"].isEqual(e,n.prevSelection)||(n.props.onSelectionChange&&n.props.onSelectionChange(e),n.prevSelection=n.selection,n.selection=e)},0),n.onCut=function(e){O["default"].isTrident&&n.onInput(e)},n.onPaste=function(e){if(!e.defaultPrevented){e.preventDefault();var t=new g["default"](e.clipboardData);if(t.hasFiles())return e.stopPropagation(),n.props.onFiles&&n.props.onFiles(t);var a=O["default"].isTrident?"text":"text/plain",i=e.clipboardData.getData(a);n.pasteText(i)}},n.pasteText=function(e){e&&(n.props.maxPaste&&n.props.onMaxPasteExceeded&&e.length>n.props.maxPaste?n.props.onMaxPasteExceeded():n.replaceSelection(e))},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;e.value!==this.value&&(this.setNewValue(e.value||"",!1),this.updateDOM(),this.props.focusOnChange&&this.props.setTimeout(function(){return t.restoreFocus(!0)},0)),this.props.editable!==e.editable&&(this.input.contentEditable=String(e.editable),e.editable&&this._disableObjectResize())}},{key:"componentDidMount",value:function(){this.props.focusOnMount&&this.props.setTimeout(this.restoreFocus,0),this.props.editable&&this._disableObjectResize(),this.input.restoreFocus=this.restoreFocus,this.input.pasteText=this.pasteText,this.__isMounted=!0}},{key:"componentWillUnmount",value:function(){this.input.restoreFocus=null,this.__isMounted=!1}},{key:"_moveCursorToEnd",value:function(e){if(e){var t=window.getSelection();t&&(t.selectAllChildren(e),t=window.getSelection(),t&&t.rangeCount&&t.collapseToEnd())}}},{key:"_disableObjectResize",value:function(){O["default"].isGecko&&document.execCommand("enableObjectResizing",!1,!1)}},{key:"limitLength",value:function(e){var t=this.props.maxLength;if(!t)return e;e=e||"";var a=this.selectionLength(),n=a+t-w["default"].multibyteLength(this.value);return n>0?w["default"].multibyteSubstr(e,0,n):""}},{key:"setNewValue",value:function(e,t,a){if(e!==this.value||a){if(e&&!this.value){var n=this.refs.placeholder;n&&(n.style.display="none")}else if(this.value&&!e){var i=this.refs.placeholder;i&&(i.style.display="")}this.value=e,t&&this.props.onChange&&this.props.onChange(e),this._saveSelection()}}},{key:"updateDOM",value:function(){var e=y["default"].emojiToHTML(m["default"].escape(this.value)),t=this.input;t.innerHTML!==e&&(t.innerHTML=e)}},{key:"selectionLength",value:function(){if(!this.props.editable)return 0;var e=this.input;M["default"].focus(e);var t=window.getSelection();if(t.rangeCount){var a=t.getRangeAt(0);return w["default"].multibyteLength(y["default"].NodeToEmoji(a.cloneContents()))}return 0}},{key:"isCollapsed",value:function(){if(this.__isMounted){var e=this.input;if(document.activeElement===e){var t=window.getSelection();return t.isCollapsed}}}},{key:"getCursor",value:function(){if(!this.__isMounted)return-1;var e=this.input;if(document.activeElement!==e)return null;var t=window.getSelection(),a=t.anchorNode,n=t.anchorOffset,i=e.childNodes,o=0;e===a&&(a=i[n]);for(var r=0;r<i.length;r++){var s=i[r];if(s===a)return o+n;s.nodeType===window.Node.ELEMENT_NODE&&s.alt?o+=s.alt.length:s.nodeType===window.Node.TEXT_NODE&&(o+=s.length)}return o}},{key:"isAtBeginning",value:function(){return!!this.isCollapsed()&&0===this.getCursor()}},{key:"isAtEnd",value:function(){return!!this.isCollapsed()&&this.getCursor()===this.value.length}},{key:"getSelection",value:function(){if(!this.__isMounted)return null;var e=this.input;if(document.activeElement!==e)return null;for(var t=window.getSelection(),a=t.anchorNode,n=t.anchorOffset,i=t.focusNode,o=t.focusOffset,r=e.childNodes,s=-1,l=-1,u=!1,c=!1,d=0;d<r.length;d++){var f=r[d];if(f===a&&(s=d,u=!0),f===i&&(l=d,c=!0),u&&c)break}return{anchor:{index:s,offset:n},focus:{index:l,offset:o}}}},{key:"restoreSelection",value:function(e){var t=this.input,a=void 0,n=void 0,i=t.childNodes,o=void 0,r=void 0,s=void 0,l=void 0;-1===e.anchor.index?(a=t,o=e.anchor.offset,s=0):(a=i[e.anchor.index],o=e.anchor.index,
s=e.anchor.offset),-1===e.focus.index?(n=t,r=e.focus.offset,l=0):(n=i[e.focus.index],r=e.focus.index,l=e.focus.offset);var u=void 0;u=o===r?l>=s?"forward":"reverse":o>r?"reverse":"forward";var c=window.getSelection();if(a&&n)try{var d=document.createRange();return void(O["default"].isTrident?("forward"===u?(d.setStart(a,e.anchor.offset),d.setEnd(n,e.focus.offset)):(d.setStart(n,e.focus.offset),d.setEnd(a,e.anchor.offset)),c.removeAllRanges(),c.addRange(d)):(d.setStart(a,e.anchor.offset),c.removeAllRanges(),c.addRange(d),c.extend(n,e.focus.offset)))}catch(f){this._moveCursorToEnd(t)}else this._moveCursorToEnd(t)}},{key:"replaceSelection",value:function(e,t){if(this.props.editable&&(M["default"].focus(this.input),e=this.limitLength(e),0!==e.length)){this.props.multiline||(e=e.replace(/\n+/g," ").replace(/(\r\n)+/g," "));var a=window.getSelection(),n=null;a.getRangeAt&&a.rangeCount&&(n=a.getRangeAt(0),n.deleteContents());var i=this.input,o=i.scrollTop,r=i.scrollHeight,s=y["default"].emojiToHTML(m["default"].escape(e));O["default"].isTrident?n&&this.replaceSelectionTrident(s,a,n):t?document.execCommand("insertText",!1,s):document.execCommand("insertHTML",!1,s),this.onInput(!0),this._saveSelection(),this.scrollToCursor(o,r)}}},{key:"scrollToCursor",value:function(e,t){var a=this.input,n=a.scrollHeight,i=a.clientHeight;if(!(i>=n)){var o=n-t;this.input.scrollTop=(e||0)+o}}},{key:"replaceSelectionTrident",value:function(e,t,a){var n=document.createElement("div");n.innerHTML=e;for(var i=document.createDocumentFragment(),o=void 0,r=void 0;o=n.firstChild;)r=i.appendChild(o);a.insertNode(i),r&&(a=a.cloneRange(),a.setStartAfter(r),a.collapse(!0),t.removeAllRanges(),t.addRange(a))}},{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){var e=y["default"].emojiToHTML(m["default"].escape(this.value)),t=this.props.className?"input "+this.props.className:"input",a="input-emoji",n=this.props.placeholder&&!this.props.value?k["default"].createElement("div",{className:"input-placeholder",ref:"placeholder"},this.props.placeholder):null;return k["default"].createElement("div",{className:a},n,k["default"].createElement("div",{dangerouslySetInnerHTML:{__html:e},dir:"auto",ref:this.setInput,spellCheck:this.props.spellCheck,"data-tab":this.props.editable?1:null,contentEditable:this.props.editable,className:t,onInput:this.onInput,onPaste:this.onPaste,onCut:this.onCut,onKeyUp:this.onKeyUp,onKeyPress:this.onKeyPress,onMouseDown:this.onMouseDown,onContextMenu:this.onContextMenu,onFocus:this.props.onFocus,onBlur:this.props.onBlur}))}}]),t}(k["default"].Component);x.defaultProps={editable:!0,format:!1,value:"",focusOnChange:!0};t.Component=x;t["default"]=(0,P["default"])((0,C["default"])(x))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=(a(1442),a(5)),m=a(37),v=function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));return a.setVideoRef=function(e){a._videoRef=e,a.synchronizeVideo()},a.synchronizeVideo=function(){var e=a._videoRef;e&&(a.state.animate?e.paused&&e.play():e.paused||(e.pause(),e.currentTime=0))},a.setShouldAnimate=function(e){a.state.animate===e&&a.state.show||a.setState({animate:e,show:!0},a.synchronizeVideo)},a.handleClick=function(){a.props.onSend(a.props.gif)},a._videoRef=null,a.state={animate:!1,show:!1},a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props.gif,t=null;this.state.show&&(t=m.troublesWithLotsOfVideos&&e.nonVideoUrl?h.createElement("img",{className:"gif-search-gif",onClick:this.handleClick,src:e.nonVideoUrl}):h.createElement("video",{className:"gif-search-gif",onClick:this.handleClick,controls:!1,autoPlay:this.state.animate,loop:!0,muted:!0,ref:this.setVideoRef,src:e.previewUrl}));var a=void 0;return this.props.isStarred&&this.props.onUnstarMsg&&(a=h.createElement("span",{className:"icon-s icon-star-light",onClick:this.props.onUnstarMsg})),h.createElement("div",{className:"gif-search-gif-wrapper",style:{flexBasis:e.widthStr}},h.createElement("div",{style:{width:e.widthStr}},h.createElement("div",{style:{paddingBottom:e.ratioStr}},t)),a)}}]),t}(h.Component);t["default"]=v},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,a){this.key=e,this.css=t,this.title=a,this.className="emoji-"+e}Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedTabs=t.TabsOrdered=t.Tab=t.SKIN_TONE_VARIATIONS=t.EMOJI_HEIGHT=t.EMOJI_WIDTH=void 0;var o,r=a(162),s=n(r);t.TabInfo=i;var l=a(118),u=n(l),c=a(164),d=c.EMOJI.CATEGORIES,f=(t.EMOJI_WIDTH=44,t.EMOJI_HEIGHT=44,t.SKIN_TONE_VARIATIONS=[""].concat(u["default"].skinToneVariations),t.Tab=(o={},(0,s["default"])(o,d.RECENT,new i(d.RECENT,"icon-emoji-recent",function(){return l10n.t("emoji_tab_recent")})),(0,s["default"])(o,d.SMILEYS_PEOPLE,new i(d.SMILEYS_PEOPLE,"icon-emoji-people",function(){return l10n.t("emoji_tab_smileys_people")})),(0,s["default"])(o,d.ANIMALS_NATURE,new i(d.ANIMALS_NATURE,"icon-emoji-nature",function(){return l10n.t("emoji_tab_animals_nature")})),(0,s["default"])(o,d.FOOD_DRINK,new i(d.FOOD_DRINK,"icon-emoji-food",function(){return l10n.t("emoji_tab_food_drink")})),(0,s["default"])(o,d.ACTIVITY,new i(d.ACTIVITY,"icon-emoji-activity",function(){return l10n.t("emoji_tab_activity")})),(0,s["default"])(o,d.TRAVEL_PLACES,new i(d.TRAVEL_PLACES,"icon-emoji-travel",function(){return l10n.t("emoji_tab_travel_places")})),(0,s["default"])(o,d.OBJECTS,new i(d.OBJECTS,"icon-emoji-objects",function(){return l10n.t("emoji_tab_objects")})),(0,s["default"])(o,d.SYMBOLS,new i(d.SYMBOLS,"icon-emoji-symbols",function(){return l10n.t("emoji_tab_symbols")})),(0,s["default"])(o,d.FLAGS,new i(d.FLAGS,"icon-emoji-flags",function(){return l10n.t("emoji_tab_flags")})),(0,s["default"])(o,d.GIFS,new i(d.GIFS,"icon-emoji-gifs",function(){return l10n.t("emoji_tab_gifs")})),(0,s["default"])(o,d.SEARCH_RESULT,new i(d.SEARCH_RESULT,null,null)),o)),p=t.TabsOrdered=[f.RECENT,f.SMILEYS_PEOPLE,f.ANIMALS_NATURE,f.FOOD_DRINK,f.ACTIVITY,f.TRAVEL_PLACES,f.OBJECTS,f.SYMBOLS,f.FLAGS];t.ExtendedTabs=p.concat([f.GIFS])},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1650),g=n(v),_=a(1653),y=n(_),E=a(1410),M=n(E),S=a(61),C=n(S),b=a(1661),k=n(b),T=a(1514),w=n(T),N=a(1668),P=n(N),A=a(1518),O=n(A),R=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onStarred=function(){var e=m["default"].createElement(O["default"],{chat:n.props.chat,starredMsgs:n.props.chat.getStarredMsgs(),onClose:n._pop});n.push(e)},n.onMediaGallery=function(){var e=m["default"].createElement(P["default"],{chat:n.props.chat,onBack:n._pop});n.push(e)},n.onGroupInviteLink=function(){var e=m["default"].createElement(w["default"],{chat:n.props.chat,groupMetadata:n.props.chat.groupMetadata,onBack:n._pop});n.push(e)},n._pop=function(){n.pop()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){var e=C["default"].supportsFeature(C["default"].F.STARRED)&&C["default"].supportsFeature(C["default"].F.FULL_TEXT_SEARCH)&&C["default"].supportsFeature(C["default"].F.STARRED_PAGINATION),t=e?this.onStarred:null,a=C["default"].supportsFeature(C["default"].F.MEDIA_GALLERY)?this.onMediaGallery:null,n=this.props.chat;this.props.chat.isGroup?this.push(m["default"].createElement(k["default"],{chat:n,contact:n.contact,profilePicThumb:n.contact.profilePicThumb,onVerification:this.onVerification,onStarred:t,onMediaGallery:a,onGroupInviteLink:this.onGroupInviteLink,onClose:this._pop})):n.isBroadcast?this.push(m["default"].createElement(g["default"],{chat:n,contact:n.contact,onStarred:t,onMediaGallery:a,onClose:this._pop})):n.isUser&&this.push(m["default"].createElement(y["default"],{contact:n.contact,status:Store.Status.get(n.contact.id),onVerification:this.onVerification,onStarred:t,onMediaGallery:a,onClose:this._pop}))}}]),t}(M["default"]);t["default"]=R},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(14),g=n(v),_=a(21),y=n(_),E=a(1405),M=n(E),S=a(1406),C=n(S),b=a(1407),k=n(b),T=a(467),w=n(T),N=a(244),P=n(N),A=a(1),O=n(A),R=a(1418),D=n(R),x=a(64),I=n(x),L=a(115),F=n(L),U=a(55),j=n(U),G=a(1435),B=n(G),V=a(48),H=n(V),W=a(1455),z=n(W),Y=a(239),q={ANIMATING:"ANIMATING",LOADING:"LOADING",RECORDING:"RECORDING",SENDING:"SENDING"},K=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={state:q.ANIMATING,img:void 0,url:void 0,caption:void 0,videoSize:void 0},n.videoRef=null,n.startTimer=new j["default"](function(){n.setState({state:q.LOADING,url:window.URL.createObjectURL(n.props.stream)})}),n.onCapture=function(){if(n.videoRef){var e=n.videoRef.underlyingVideo();if(e){var t=document.createElement("canvas");t.height=e.videoHeight,t.width=e.videoWidth;var a=t.getContext("2d");if(!a)return void O["default"].warn("CaptureDrawer:onCapture can not get 2d context")();a.translate(t.width,0),a.scale(-1,1),a.drawImage(e,0,0,e.videoWidth,e.videoHeight);var i=n.props.onCaptured;i?P["default"].canvasToBlob(t).then(function(e){i(e)}):n.setState({state:q.SENDING,img:t.toDataURL("image/jpeg")})}}},n.onVideoLoaded=function(e){n.setState({state:q.RECORDING,videoSize:{width:e.videoWidth,height:e.videoHeight}})},n.onRetake=function(){n.setState({state:q.RECORDING,caption:void 0})},n.onSend=function(){var e=n.state,t=e.img,a=e.caption,i=n.props.onSend;i?t?i({getImg:I["default"].createFromBase64Jpeg(H["default"].parseDataURL(t).data),caption:a?w["default"].emojify(a.trim()):void 0}):O["default"].assert(t,"capture-drawer-no-img")():O["default"].assert(i,"capture-drawer-no-onSend")()},n.onCaptionChange=function(e){n.setState({caption:e})},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){this.startTimer.onOrBefore(300)}},{key:"componentWillUnmount",value:function(){this.startTimer.cancel();var e=this.state.url;e&&window.URL.revokeObjectURL(e)}},{key:"render",value:function(){var e=void 0,t=void 0,a=void 0,n=void 0;switch(this.state.state){case q.ANIMATING:break;case q.LOADING:case q.RECORDING:var i=(0,y["default"])("capture-video media-viewer-img webcam",{"capture-video-inactive":this.state.state===q.LOADING});a=m["default"].createElement("div",{key:"webcam"},m["default"].createElement(D["default"],{type:this.props.layoutType,size:this.state.videoSize},m["default"].createElement(z["default"],{className:i,autoPlay:!0,ref:(0,Y.GetRef)("videoRef",this),onPlay:this.onVideoLoaded,src:this.state.url}))),e=m["default"].createElement("div",{className:"drawer-controls fade",key:"btn-capture"},m["default"].createElement("button",{className:"btn btn-round btn-l",onClick:this.onCapture},m["default"].createElement("span",{className:"icon icon-camera-light"})));break;case q.SENDING:a=m["default"].createElement(D["default"],{type:this.props.layoutType,size:this.state.videoSize},m["default"].createElement("img",{className:"capture-image snapshot",src:this.state.img})),e=m["default"].createElement("div",{className:"drawer-controls btn-send",key:"btn-send"},m["default"].createElement("button",{className:"btn btn-round btn-l",onClick:this.onSend},m["default"].createElement("span",{className:"icon icon-send-light"}))),t=m["default"].createElement("div",{className:"drawer-header-action",onClick:this.onRetake},m["default"].createElement("span",{className:"icon icon-refresh-light"}),l10n.t("retake")),n=m["default"].createElement(B["default"],{ref:"emojiInput",editable:!0,value:this.state.caption,maxLength:g["default"].MAX_CAPTION_LENGTH,showRemaining:!0,placeholder:l10n.t("add_a_caption"),onEnter:this.onSend,onChange:this.onCaptionChange,supportsEmoji:!0,focusOnMount:!0});break;default:O["default"].log("captureDrawer:render Unhandled video capture state "+this.state.state)()}var o=void 0;return o=this.props.caption?m["default"].createElement("div",{className:"capture-footer"},m["default"].createElement(F["default"],{transitionName:"media-caption",className:"media-caption"},n),m["default"].createElement(F["default"],{transitionName:"pop_delay"},e)):m["default"].createElement("div",{className:"capture-footer"},m["default"].createElement(F["default"],{transitionName:"pop_delay"},e)),m["default"].createElement(M["default"],{key:"attach-capture-modal",className:"drawer-capture",variant:"noheader"},m["default"].createElement(k["default"],{title:l10n.t("take_photo"),type:b.DRAWER_HEADER_TYPE.OFFSET,onCancel:this.props.onBack},t),m["default"].createElement(C["default"],null,m["default"].createElement("div",{className:"media-body"},m["default"].createElement("div",{className:"media-body-container"},m["default"].createElement(F["default"],{transitionName:"capture"},a))),o))}}]),t}(h.PureComponent);K.defaultProps={caption:!1},t["default"]=K},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r,s,l,u,c,d=a(6),f=n(d),p=a(3),h=n(p),m=a(4),v=n(m),g=a(8),_=n(g),y=a(7),E=n(y),M=a(5),S=n(M),C=a(46),b=n(C),k=a(13),T=n(k),w=a(1427),N=n(w),P=a(1404),A=(n(P),a(12)),O=n(A),R=a(1529),D=n(R),x=a(14),I=n(x),L=a(241),F=(n(L),a(21)),U=n(F),j=a(1426),G=n(j),B=a(1405),V=n(B),H=a(1406),W=n(H),z=a(15),Y=n(z),q=a(1403),K=n(q),Q=a(1412),X=n(Q),Z=a(95),J=n(Z),$=a(467),ee=n($),te=a(1525),ae=n(te),ne=a(61),ie=n(ne),oe=a(116),re=n(oe),se=a(1417),le=n(se),ue=a(78),ce=n(ue),de=a(1434),fe=n(de),pe=a(1464),he=n(pe),me=a(462),ve=(n(me),a(1450)),ge=n(ve),_e=a(1408),ye=n(_e),Ee=a(55),Me=n(Ee),Se=a(1411),Ce=n(Se),be=a(161),ke=n(be),Te=a(1402),we=n(Te),Ne=a(1449),Pe=n(Ne),Ae=a(1465),Oe=n(Ae),Re=a(37),De=n(Re),xe=a(96),Ie=n(xe),Le=a(463),Fe=n(Le),Ue=a(466),je=2;t["default"]=(0,ce["default"])((0,ye["default"])((o=i=function(e){function t(){var e,a,n,i;(0,h["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,_["default"])(this,(e=t.__proto__||(0,f["default"])(t)).call.apply(e,[this].concat(r))),n.state={searchText:"",searching:!1},n.setSearch=function(e){return n.search=e},n.ftsMsgs=new ae["default"],n.selection=new Ce["default"]([],function(e){return e.id.toString()}),n.pending=!1,n._batchRenderState={},n._handleScroll=function(e){n.shouldFTSSearch(e)&&(n.fts(),n.pending=!0)},n.handleScroll=T["default"].throttle(n._handleScroll,100),n._debounceSetState=new Me["default"](function(){n.setState(n._batchRenderState),n._batchRenderState={}}),n.batchSetState=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:75;T["default"].assign(n._batchRenderState,e),n._debounceSetState.debounce(t)},n.fts=T["default"].debounce(function(){n.pending=!1;var e=T["default"].trim(n.state.searchText||"");Pe["default"].multibyteLength(e)<je||(n._ftsPromise&&n._ftsPromise.cancel(),n._ftsPromise=n.ftsMsgs.search(e,n.props.chat).checkpoint(n.props.rejectOnUnmount()).then(function(t){e===T["default"].trim(n.state.searchText)&&n.batchSetState({searching:!1})})["catch"](Y["default"].Unmount,T["default"].noop)["catch"](function(){n.pending||n.batchSetState({searching:!1})}))},750),n.fullTextSearch=function(e){var t=T["default"].trim(e);Pe["default"].multibyteLength(t)>=je&&ie["default"].supportsFeature(ie["default"].F.FULL_TEXT_SEARCH)?(n.fts(),n.pending=!0,n.state.searching||n.batchSetState({searching:!0})):(n.fts.cancel(),n.ftsMsgs.resetSearch(),n.ftsMsgs["delete"](),n._ftsPromise&&n._ftsPromise.cancel(),n.pending=!1,n.state.searching&&n.batchSetState({searching:!1}))},n.shouldFTSSearch=function(e){return!n.ftsMsgs.hasMoreMsgs||n.pending||n.state.searching||n.ftsMsgs.searchPromise||Pe["default"].multibyteLength(n.state.searchText||"")<je?!1:e.scrollTop+I["default"].SCROLL_FUDGE>e.scrollHeight-e.clientHeight},n.onSearch=function(e){if(!e)return void n.onStopSearch();var t=n.state.searchText;if(e!==t){var a={searchText:e};n.fullTextSearch(e),n.setState({searchText:e}),n.batchSetState(a)}},n.onStopSearch=function(){n.fts.cancel(),n.ftsMsgs.resetSearch(),n.ftsMsgs["delete"](),n._ftsPromise&&n._ftsPromise.cancel(),n.pending=!1,n.setState({searchText:"",searching:!1})},n.onFocusList=function(e){e.repeat||n.refs.msglist&&n.search.isAtEnd()&&(e.preventDefault(),e.stopPropagation(),re["default"].flashFocus=Date.now(),n.refs.msglist.focusFirst())},n.onOpenFirst=function(e){e.preventDefault();var t=n.ftsMsgs.head();if(t){var a=t.chat,i=a.getSearchContext(t);O["default"].focusChatTextInput(a),O["default"].openChatAt(a,i)}},n.onFocusSearch=function(){re["default"].flashFocus=Date.now(),J["default"].focus(n.search)},n.onClose=function(){n.context.uim.uie.requestDismiss()},n.indicateFocus=function(e){if(!(Date.now()-(re["default"].flashFocus||0)>200)){var t=b["default"].findDOMNode(n.refs.input_hotkey);(0,Fe["default"])(t,"stop"),(0,Fe["default"])(t,{backgroundColor:["#fbfbfb","#D9F3FF"]},{duration:1600,easing:[.19,.69,.01,.99]})}},n.onScroll=function(e){n.handleScroll(e.target)},n.getEmptyChatlistState=function(e){if(e.length)return null;var t=T["default"].trim(n.state.searchText||"");return Pe["default"].multibyteLength(t)>=je?n.state.searching?S["default"].createElement(X["default"].SearchingMessages,null):S["default"].createElement(X["default"].SearchMessages,null):X["default"].BeforeSearchMessages(n.props.chat.title())},i=a,(0,_["default"])(n,i)}return(0,E["default"])(t,e),(0,v["default"])(t,[{key:"componentDidMount",value:function(){this.onFocusSearch(),this.props.listeners.add(this.ftsMsgs,"bulk_remove")}},{key:"componentWillUnmount",value:function(){this.handleScroll.cancel(),this.fts.cancel(),this.ftsMsgs["delete"](!0),this._ftsPromise&&this._ftsPromise.cancel(),this._debounceSetState.cancel()}},{key:"render",value:function(){var e=this.ftsMsgs.models,t=this.getEmptyChatlistState(e);if(!t){var a=this.state.searchText?T["default"].trim(this.state.searchText):null;t=S["default"].createElement(Ge,{ref:"msglist",isSearching:!!this.state.searchText,searchText:a,ftsResult:e,selection:this.selection,onFocusSearch:this.onFocusSearch})}var n={down:this.onFocusList,enter:this.onOpenFirst},i=(this.state.searching||this.ftsMsgs.hasMoreMsgs)&&e.length?S["default"].createElement("div",{className:"more",style:{alignSelf:"center"}},S["default"].createElement(ke["default"],{stroke:6,size:24})):null;return S["default"].createElement(V["default"],{key:"search-modal",className:"drawer-search",variant:"panel",onCancel:this.onClose},S["default"].createElement("header",{className:"pane-header"},S["default"].createElement("div",{className:"header-close"},S["default"].createElement("button",{onClick:this.onClose},S["default"].createElement("span",{className:"icon icon-x"}))),S["default"].createElement("div",{className:"header-body"},S["default"].createElement("div",{className:"header-main"},S["default"].createElement("div",{className:"header-title"},l10n.t("search_msgs"))))),S["default"].createElement(re["default"],{handlers:n,onFocus:this.indicateFocus,ref:"input_hotkey",className:"chatlist-panel-search"},S["default"].createElement(fe["default"],{ref:this.setSearch,onSearch:this.onSearch,placeholder:l10n.t("search"),loading:this.state.searching})),S["default"].createElement(W["default"],null,S["default"].createElement("div",{ref:"panel",className:"chatlist-panel-body pane-list-body",onScroll:this.onScroll,id:"pane-side","data-list-scroll-container":!0},t,i)))}}]),t}(S["default"].Component),i.contextTypes={uim:S["default"].PropTypes.instanceOf(Ie["default"])},o)));var Ge=function(e){function t(){var e,a,n,i;(0,h["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,_["default"])(this,(e=t.__proto__||(0,f["default"])(t)).call.apply(e,[this].concat(r))),n._listPointerEvents=!0,n.onListPointerEventsOff=function(){n._listPointerEvents=!1},n.onListPointerEventsOn=function(){n._listPointerEvents=!0},n.onClick=function(e,t,a){e.preventDefault(),e.stopPropagation(),Store.Chat.find(t.id).then(function(e){2===D["default"].column&&n.context.uim.uie.requestDismiss(),O["default"].focusChatTextInput(e),O["default"].openChatAt(e,a)})},n.getSelection=function(){return n.props.ftsResult||[]},n.getList=function(){return n.props.ftsResult.map(function(e){return e.sender&&e.isGroupMsg&&!e.isNotification&&!e.isSentByMe?S["default"].createElement(Be,{contact:e.senderObj,msg:e,chat:e.chat,searchText:n.props.searchText,onClick:n.onClick,active:n.props.selection,key:e.id.toString()}):S["default"].createElement(Ve,{msg:e,chat:e.chat,searchText:n.props.searchText,onClick:n.onClick,active:n.props.selection,key:e.id.toString()})})},n.restoreFocus=function(){n.props.selection.reset()},n.onFocusGain=function(e){e.target===b["default"].findDOMNode(n)&&n._listPointerEvents&&(n.props.selection.index<0?n.focusFirst():n.props.selection.reset())},n.focusFirst=function(){n.props.selection.setFirst()},n.onNextChat=function(e){e&&(e.preventDefault(),e.stopPropagation());var t=n.props.selection.next();n.props.selection.index!==t&&n.props.selection.setNext()},n.onPrevChat=function(e){e&&(e.stopPropagation(),e.preventDefault());var t=n.props.selection.prev();t>-1?n.props.selection.setPrev():n.props.onFocusSearch()},i=a,(0,_["default"])(n,i)}return(0,E["default"])(t,e),(0,v["default"])(t,[{key:"componentWillMount",value:function(){this.props.selection.init(this.getSelection())}},{key:"render",value:function(){var e=this,t={down:function(t){return e.onNextChat(t)},up:function(t){return e.onPrevChat(t)}};return S["default"].createElement(re["default"],{handlers:t,onFocus:this.onFocusGain,"data-tab":3},S["default"].createElement(le["default"],{className:"chatlist",data:this.getList(),height:72,animate:!0,extraItems:4,onPointerEventsOff:this.onListPointerEventsOff,onPointerEventsOn:this.onListPointerEventsOn}))}}]),t}(S["default"].Component);Ge.contextTypes={uim:S["default"].PropTypes.instanceOf(Ie["default"])};var Be=(0,we["default"])((s=r=function(e){function t(){return(0,h["default"])(this,t),(0,_["default"])(this,(t.__proto__||(0,f["default"])(t)).apply(this,arguments))}return(0,E["default"])(t,e),(0,v["default"])(t,[{key:"render",value:function(){var e=this.props.msg;return S["default"].createElement(Ve,{msg:e,chat:e.chat,author:this.props.contact.formattedShortName,searchText:this.props.searchText,onClick:this.props.onClick,active:this.props.active,key:e.id.toString()})}}]),t}(S["default"].Component),r.CONCERNS={msg:["id","chat"],contact:["formattedShortName"]},s)),Ve=(0,ce["default"])((0,we["default"])((u=l=function(e){function t(e){(0,h["default"])(this,t);var a=(0,_["default"])(this,(t.__proto__||(0,f["default"])(t)).call(this,e));c.call(a);var n=e.msg,i=e.author,o=e.active;return a.state={active:o?o.value===n:!1,author:i?i:null},a}return(0,E["default"])(t,e),(0,v["default"])(t,[{key:"componentWillMount",value:function(){this.props.active&&this.props.listeners.add(this.props.active,this.props.msg.id.toString(),this.onActiveChange)}},{key:"componentWillReceiveProps",value:function(e){e.author!==this.props.author&&this.setState({author:e.author})}},{key:"render",value:function(){var e=this.props.msg,t=S["default"].createElement(Oe["default"],{msg:e}),a=[];e.isSentByMe&&a.push(S["default"].createElement(he["default"],{msg:e,key:"symbol"})),this.state.author&&(a.push(S["default"].createElement(K["default"],{text:this.state.author,direction:"auto",className:{number:!e.senderObj.name,"chat-status-name":!0},key:"author"})),a.push(S["default"].createElement("span",{className:"chat-status-divider",key:"divider"},":"))),e.hasSymbol()&&a.push(S["default"].createElement(ge["default"],{msg:e,key:"msg-symbol"})),a.push(S["default"].createElement(K["default"],{direction:e.dir,ellipsify:!0,formatters:Ue.Configuration.Highlight(this.props.searchText?[this.props.searchText]:[]),text:ee["default"].msgText((0,Te.unproxy)(e)),key:"status"}));var n="chat-status";De["default"].isGecko&&(n+=" ellipsify");var i=l10n.embedDir(ee["default"].msgText((0,Te.unproxy)(e)),e.rtl),o=S["default"].createElement("div",{className:n,title:i},a),r={enter:this.onEnter},s=(0,U["default"])("cell-message","cell-message-simplified",{active:!!this.state.active});return S["default"].createElement(re["default"],{handlers:r,onFocus:this.indicateFocus,onBlur:this.onBlur,className:"chat-drag-cover"},S["default"].createElement(N["default"],{id:e.id+"",ref:"cell",contextEnabled:this.contextEnabled,className:s,primaryDetail:t,secondary:o,onClick:this.onClick}))}}]),t}(S["default"].Component),l.CONCERNS={msg:["id","chat","isSentByMe","senderObj","rtl","dir","type"]},c=function(){var e=this;this.onActiveChange=function(t,a){if("focus"===t){var n=b["default"].findDOMNode(e);J["default"].focus(n),a&&G["default"].scrollIntoViewIfNeeded(n)}e.setState({active:!!t})},this.onClick=function(t){if(T["default"].isFunction(e.props.onClick)){var a=(0,Te.unproxy)(e.props.msg),n=a.chat,i=n.getSearchContext(a);i.msg=a,e.props.onClick(t,n,i)}},this.onEnter=function(t){t.preventDefault(),t.stopPropagation(),re["default"].flashFocus=Date.now(),e.onClick(t)},this.indicateFocus=function(t){if(!(Date.now()-(re["default"].flashFocus||0)>200)){var a=b["default"].findDOMNode(e.refs.cell);(0,Fe["default"])(a,"stop"),(0,Fe["default"])(a,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:e.onBlur})}},this.onBlur=function(t){var a=b["default"].findDOMNode(e.refs.cell);a&&((0,Fe["default"])(a,"stop"),a.style.backgroundColor="")},this.contextEnabled=function(){return!1}},u)))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(13),y=n(_),E=a(1422),M=n(E),S=a(241),C=(n(S),a(21)),b=n(C),k=a(1412),T=n(k),w=a(78),N=n(w),P=a(1515),A=n(P),O=a(1454),R=n(O),D=a(1411),x=n(D);t["default"]=(0,N["default"])((o=i=function(e){function t(e){(0,u["default"])(this,t);var a=(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this,e));return a.onSelect=function(e,t){if(t instanceof E.Component){var n=t.props.contact;a.props.filter(n)===!0&&a.props.onSelect(n)}},a.onSearch=function(e){a.setState({searchFilter:e})},a.selection=new x["default"]([],function(e){return e.id}),a.state={searchFilter:void 0},a}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){this.props.contacts||this.props.listeners.add(Store.Contact,"add remove change:name")}},{key:"render",value:function(){var e=this.props,t=e.title,a=e.onCancel,n=e.filter,i=e.onSelect,o=l10n.accentFold(this.state.searchFilter),r=this.props.contacts||Store.Contact,s=r.filter(function(e){return n(e)&&(!o||o&&e.searchMatch(o))}),l=[];if(s.length){this.selection.init(s.filter(function(e){return n(e)===!0}));for(var u=void 0,c=void 0,d=s.length>10,f=0;f<s.length;f++){u=s[f],d&&u.header!==c&&l.push(g["default"].createElement(R["default"],{key:u.header,header:u.header}));var p=y["default"].isString(n(u)),h=void 0;f<s.length-1&&s[f+1].header!==u.header&&(h="last");var m=void 0;p&&(m=g["default"].createElement("div",{className:"chat-status ellipsify",title:n(u)},n(u)),h=(0,b["default"])(h,"member")),l.push(g["default"].createElement(M["default"],{contact:u,active:this.selection,className:h,secondary:m,onClick:p?void 0:y["default"].once(i.bind(null,u)),key:u.id})),c=u.header}}else l=g["default"].createElement(T["default"].SearchContacts,null);return g["default"].createElement(A["default"],{title:t,selection:this.selection,onSearch:this.onSearch,searchPlaceholder:l10n.t("search_contacts"),onSelect:this.onSelect,onCancel:a},l)}}]),t}(g["default"].Component),i.defaultProps={filter:function(e){return Store.Contact.isFilteredContact(e)}},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(5),o=n(i),r=a(21),s=n(r),l=function(e){var t=e.title,a=e.icon,n=e.classes,i=e.onClick,r=e.children,l=(0,s["default"])("drawer-item",n,{clickable:i}),u=(0,s["default"])("drawer-item-body",{"drawer-item-body-row":a}),c=(0,s["default"])({"drawer-item-main":a}),d=(0,s["default"])({"drawer-item-side":a});return o["default"].createElement("div",{className:l,onClick:i},o["default"].createElement("div",{className:u},o["default"].createElement("div",{className:c},o["default"].createElement("div",{className:"drawer-item-primary"},t),o["default"].createElement("div",{className:"drawer-item-secondary"},r)),o["default"].createElement("div",{className:d},a)))};t["default"]=l},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(13),y=n(_),E=a(1404),M=(n(E),a(1443)),S=(n(M),a(1405)),C=n(S),b=a(1407),k=n(b),T=a(1406),w=n(T),N=a(1459),P=n(N),A=a(15),O=n(A),R=a(1409),D=n(R),x=a(1412),I=n(x),L=a(1403),F=n(L),U=a(1430),j=n(U),G=a(1637),B=n(G),V=a(1642),H=n(V),W=a(12),z=n(W),Y=a(465),q=n(Y),K=a(160),Q=n(K),X=a(1402),Z=n(X),J=a(1408),$=n(J),ee={LOADING:0,REVOKING:1,SUCCESS:2},te=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),n.state={state:ee.LOADING},n.getErrorMessageFromStatusCode=function(e){switch(e){case 401:return Q["default"].t("group_invite_query_401");case 403:return Q["default"].t("group_invite_query_403");case 404:return Q["default"].t("group_invite_query_404");default:return Q["default"].t("group_invite_query_406")}},n.handleLoadingStatusCode=function(e){if(200===e)n.setState({state:ee.SUCCESS});else{var t=n.getErrorMessageFromStatusCode(e);n.props.onBack(),z["default"].openToast(g["default"].createElement(q["default"],{msg:t,id:q["default"].genId()}))}},n.handleRevokeGroupInvite=function(){z["default"].openModal(g["default"].createElement(B["default"],{pushTransition:"none",popTransition:"none",chat:n.props.chat,onConfirm:n.handleConfirmRevokeGroupInvite}),"modal-flow")},n.handleRevokingStatusCode=function(e){if(200===e)z["default"].openToast(g["default"].createElement(q["default"],{msg:Q["default"].t("group_invite_revoke_success"),id:q["default"].genId()})),n.setState({state:ee.SUCCESS});else{var t=n.getErrorMessageFromStatusCode(e);n.props.onBack(),z["default"].openToast(g["default"].createElement(q["default"],{msg:t,id:q["default"].genId()}))}},n.handleConfirmRevokeGroupInvite=function(){n.setState({state:ee.REVOKING});var e=n.props.groupMetadata.revokeGroupInvite();o["default"].delay(500)["return"](e).checkpoint(n.props.rejectOnUnmount()).then(function(e){n.handleRevokingStatusCode(e)})["catch"](O["default"].Unmount,y["default"].noop)},n.handleSendGroupInviteLink=function(){z["default"].openModal(g["default"].createElement(H["default"],{chat:n.props.chat,pushTransition:"none",popTransition:"none"}),"modal-flow")},n.handleClickGroupInviteLink=function(e){e.preventDefault(),n.handleSendGroupInviteLink()},n.handleCopyLink=function(){window.getSelection().removeAllRanges();var e=document.querySelector("#group-invite-link-anchor"),t=document.createRange();t.selectNode(e),window.getSelection().addRange(t);var a=void 0;try{a=document.execCommand("copy"),
window.getSelection().removeAllRanges()}catch(n){a=!1}a?z["default"].openToast(g["default"].createElement(q["default"],{msg:Q["default"].t("group_invite_link_copy_success"),id:q["default"].genId()})):z["default"].openToast(g["default"].createElement(q["default"],{msg:Q["default"].t("group_invite_link_copy_failed"),id:q["default"].genId()}))},n.renderDrawerBody=function(){var e=n.props.groupMetadata,t=void 0;if(n.state.state===ee.LOADING)t=g["default"].createElement(I["default"].LoadingWithText,{text:Q["default"].t("group_invite_check_link")});else if(n.state.state===ee.REVOKING)t=g["default"].createElement(I["default"].LoadingWithText,{text:Q["default"].t("group_invite_revoke_in_progress",{groupName:n.props.chat.contact.name})});else{var a=e.groupInviteLink,i=null;document.queryCommandSupported("copy")&&(i=g["default"].createElement(j["default"],{iconClass:"icon-copy",a8n:"li-copy-link",onClick:n.handleCopyLink},Q["default"].t("group_invite_drawer_copy_link"))),t=g["default"].createElement(w["default"],{wide:!0},g["default"].createElement("div",{className:"chatlist list-identity list-invite"},g["default"].createElement("div",{className:"chat chat-idle","data-ignore-capture":"any"},g["default"].createElement("div",{className:"chat-avatar"},g["default"].createElement(D["default"],{id:n.props.chat.id,size:82,quality:D["default"].Quality.HIGH})),g["default"].createElement("div",{className:"chat-body"},g["default"].createElement("div",{className:"chat-main"},g["default"].createElement("div",{className:"chat-title"},g["default"].createElement("span",{className:"emojitext ellipsify",dir:"auto"},g["default"].createElement(F["default"],{text:n.props.chat.contact.name,direction:"auto"})))),g["default"].createElement("div",{className:"chat-status"},g["default"].createElement("a",{id:"group-invite-link-anchor",href:a,onClick:n.handleClickGroupInviteLink},a))))),g["default"].createElement("div",{className:"controls-container drawer-section"},g["default"].createElement("div",{className:"controls-section"},Q["default"].t("group_invite_link_description"))),g["default"].createElement(P["default"],null,g["default"].createElement(j["default"],{iconClass:"icon-share",a8n:"li-share-link",onClick:n.handleSendGroupInviteLink},Q["default"].t("group_invite_drawer_send_link")),i,g["default"].createElement(j["default"],{iconClass:"icon-revoke",a8n:"li-revoke-link",onClick:n.handleRevokeGroupInvite},Q["default"].t("group_invite_drawer_revoke_link"))))}return t},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){this.props.groupMetadata.groupInviteCode().checkpoint(this.props.rejectOnUnmount()).then(this.handleLoadingStatusCode)["catch"](O["default"].Unmount,y["default"].noop)}},{key:"render",value:function(){return g["default"].createElement(C["default"],{onCancel:this.props.onBack},g["default"].createElement(k["default"],{title:Q["default"].t("group_invite_link"),onBack:this.props.onBack,type:b.DRAWER_HEADER_TYPE.SMALL}),this.renderDrawerBody())}}]),t}(g["default"].Component);te.CONCERNS={groupMetadata:["inviteCode","groupInviteLink"]},t["default"]=(0,$["default"])((0,Z["default"])(te))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1405),g=n(v),_=a(1406),y=n(_),E=a(1407),M=n(E),S=a(95),C=n(S),b=a(116),k=n(b),T=a(1417),w=n(T),N=a(1434),P=n(N),A=a(1421),O=n(A),R=a(1411),D=(n(R),a(239)),x=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.setSearch=function(e){return n.search=e},n.onNext=function(e){e.preventDefault(),e.stopPropagation();var t=n.props.selection;t&&t.setNext()},n.onPrev=function(e){var t=n.props.selection;if(t){e.preventDefault(),e.stopPropagation();var a=t.prev();a>-1?t.setPrev():(t.unset(),k["default"].flashFocus=Date.now(),C["default"].focus(n.search))}},n.onFocusList=function(e){n.list&&(e.preventDefault(),e.stopPropagation(),k["default"].flashFocus=Date.now(),n.props.selection.setFirst())},n.onSelectFirst=function(e){e.preventDefault(),e.stopPropagation();var t=n.props.children,a=Array.isArray(t)?t[0]:t;a&&n.props.onSelect(e,a)},n.onSearch=function(e){n.props.onSearch(e)},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.title,a=e.onCancel,n=e.onSearch,i=e.searchPlaceholder,o=e.children,r={down:this.onFocusList,enter:this.onSelectFirst},s={down:this.onNext,up:this.onPrev},l=void 0;n&&(l=m["default"].createElement(k["default"],{handlers:r},m["default"].createElement(P["default"],{ref:this.setSearch,onSearch:this.onSearch,placeholder:i||l10n.t("search")})));var u=void 0;if(o){var c=Array.isArray(o)?o:[o];u=c.length?m["default"].createElement(k["default"],{handlers:s},m["default"].createElement(w["default"],{className:"chatlist",ref:(0,D.GetRef)("list",this),data:c,height:72,extraItems:4})):o}else u=o;return m["default"].createElement(O["default"],{type:A.TowerModalType},m["default"].createElement(g["default"],{key:"contact-modal",onCancel:a},m["default"].createElement(M["default"],{title:t,type:E.DRAWER_HEADER_TYPE.POPUP,onCancel:a}),l,m["default"].createElement(y["default"],{"data-list-scroll-container":!0},u)))}}]),t}(m["default"].Component);t["default"]=x},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(13),g=n(v),_=a(1405),y=n(_),E=a(1407),M=n(E),S=a(1431),C=n(S),b=a(1406),k=n(b),T=a(1466),w=n(T),N=a(238),P=n(N),A=a(12),O=n(A),R=a(1435),D=n(R),x=a(14),I=n(x),L=a(467),F=n(L),U=a(96),j=n(U),G=a(15),B=n(G),V=a(1446),H=(n(V),a(1433)),W=(n(H),a(475)),z=(n(W),a(1402)),Y=n(z),q=a(1408),K=n(q),Q=function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));return a.onBack=function(){a.props.onClose?a.props.onClose():a.context.uim.uie.requestDismiss()},a.validateStatus=function(e){return!!(e||"").trim()},a.onStatusBegin=function(){a.isEditingStatus=!0},a.onSetStatusError=function(){O["default"].openModal(m["default"].createElement(P["default"],{onOK:O["default"].closeModal.bind(O["default"]),okText:l10n.t("web_ok")},l10n.t("action_status_empty")))},a.onSetStatus=function(e){if(a.isEditingStatus=!1,Store.Status.canSetMyStatus()){var t=a.props.status.status,n=F["default"].emojify(a.state.status);if(n===t)return a.setState({status:n});a.setState({pendingStatus:!0}),Store.Status.setMyStatus(F["default"].emojify(a.state.status)).checkpoint(a.props.rejectOnUnmount()).then(function(){a.setState({pendingStatus:!1})})["catch"](B["default"].Unmount,g["default"].noop)}},a.onStatusChange=function(e){a.setState({status:e})},a.onCancelStatus=function(){a.isEditingStatus=!1,a.setState({status:a.props.status.status})},a.onPushnameBegin=function(){a.isEditingPushname=!0},a.validatePushname=function(e){return!!(e||"").trim()},a.onSetPushname=function(e){if(a.isEditingPushname=!1,Store.Conn.canSetMyPushname()){var t=a.props.conn.pushname,n=F["default"].emojify(a.state.pushname);if(n===t)return a.setState({pushname:n});a.setState({pendingPushname:!0}),Store.Conn.updatePushname(F["default"].emojify(a.state.pushname)).checkpoint(a.props.rejectOnUnmount()).then(function(){a.setState({pendingPushname:!1})})["catch"](B["default"].Unmount,g["default"].noop)}},a.onSetPushnameError=function(){O["default"].openModal(m["default"].createElement(P["default"],{onOK:O["default"].closeModal.bind(O["default"]),okText:l10n.t("web_ok")},l10n.t("action_pushname_empty")))},a.onPushnameChange=function(e){a.setState({pushname:e})},a.onCancelPushname=function(){a.isEditingPushname=!1,a.setState({pushname:a.props.pushname})},a.onImageSet=function(e,t){var n=a.props.profilePicThumb;a.setState({pendingPhoto:!0});var i;i=e&&t?n.setPicture(e,t):n.deletePicture(),i.checkpoint(a.props.rejectOnUnmount()).then(function(){a.setState({pendingPhoto:!1})})["catch"](B["default"].Unmount,g["default"].noop)},a.state={pushname:e.conn.pushname,status:e.status.status,pendingPushname:!1,pendingStatus:!1,pendingPhoto:!1},a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.conn,a=e.status,n=e.profilePicThumb,i=void 0;if(I["default"].STATUS_V2){var o=this.isEditingStatus||this.state.pendingStatus?this.state.status:a.status;i=m["default"].createElement(C["default"],{a8n:"col-main-profile",title:l10n.t("web_status"),classes:"animate-enter1 well-input"},m["default"].createElement(D["default"],{value:o,editable:Store.Status.canSetMyStatus(),pending:this.state.pendingStatus,showRemaining:!0,validate:this.validateStatus,maxLength:I["default"].MAX_STATUS_LENGTH,onBeginEdit:this.onStatusBegin,onChange:this.onStatusChange,onSave:this.onSetStatus,onError:this.onSetStatusError,onCancel:this.onCancelStatus,supportsEmoji:!0,lockable:!0,lowProfile:!0}))}var r=I["default"].STATUS_V2?l10n.t("menuitem_profile_status"):l10n.t("menuitem_profile"),s=!n.canSet()&&!n.canDelete(),l=this.isEditingPushname||this.state.pendingPushname?this.state.pushname:t.pushname;return m["default"].createElement(y["default"],{onCancel:this.onBack,className:"drawer-profile"},m["default"].createElement(M["default"],{a8n:"drawer-title-profile",title:r,onBack:this.onBack,type:E.DRAWER_HEADER_TYPE.LARGE}),m["default"].createElement(k["default"],null,m["default"].createElement("div",{className:"drawer-section drawer-scale drawer-section-photo"},m["default"].createElement(w["default"],{type:T.Type.PROFILE,id:n.id,pending:this.state.pendingPhoto,startImage:n.imgFull,readOnly:s,onImageSet:this.onImageSet})),m["default"].createElement(C["default"],{a8n:"col-main-profile",title:l10n.t("pushname"),classes:"animate-enter1 well-input"},m["default"].createElement(D["default"],{value:l,editable:Store.Conn.canSetMyPushname(),pending:this.state.pendingPushname,showRemaining:!0,validate:this.validatePushname,maxLength:I["default"].MAX_PUSHNAME_LENGTH,onBeginEdit:this.onPushnameBegin,onChange:this.onPushnameChange,onSave:this.onSetPushname,onError:this.onSetPushnameError,onCancel:this.onCancelPushname,supportsEmoji:!0,lockable:!0,lowProfile:!0})),m["default"].createElement("div",{className:"hint animate-enter1 well-transparent"},l10n.t("pushname_description")),i))}}]),t}(m["default"].Component);Q.contextTypes={uim:m["default"].PropTypes.instanceOf(j["default"])},Q.CONCERNS={profilePicThumb:["imgFull","id"],status:["status"],conn:["pushname"]},t["default"]=(0,K["default"])((0,Y["default"])(Q))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(13),g=n(v),_=a(468),y=n(_),E=a(238),M=n(E),S=a(1404),C=(n(S),a(462)),b=(n(C),a(1428)),k=n(b),T=a(12),w=n(T),N=a(1403),P=n(N),A=a(160),O=n(A),R=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={clearMedia:!0},n.onCancel=function(){w["default"].closeModal()},n.onRevoke=function(){var e=n.props,t=e.chat,a=e.msgList,i=e.toastPosition,o=e.onCancel;w["default"].sendRevokeMsgs(t,a,n.state.clearMedia,null,i),w["default"].closeModal(),o&&o()},n.onToggleClearMedia=function(){n.setState({clearMedia:!n.state.clearMedia})},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=void 0,t=this.props.msgList,a=t.length;return g["default"].some(t,function(e){return e.isMMS})&&(e=m["default"].createElement("div",{className:"controls-section controls-section-popup",onClick:this.onToggleClearMedia},m["default"].createElement("div",{"data-a8n":y["default"].key("menu-icon-revoke-message"),className:"control"},m["default"].createElement(k["default"],{onChange:this.onToggleClearMedia,checked:this.state.clearMedia})),m["default"].createElement("div",{className:"label"},O["default"].t("clear_media")))),m["default"].createElement(M["default"],{onOK:this.onRevoke,okText:O["default"].t("revoke_menu"),onCancel:this.onCancel},m["default"].createElement("div",null,m["default"].createElement(P["default"],{text:O["default"].t("revoke_message_confirmation",{count:a,_plural:a})}),e))}}]),t}(m["default"].Component);t["default"]=R},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return e.scrollTop+S["default"].SCROLL_FUDGE>e.scrollHeight-e.clientHeight}Object.defineProperty(t,"__esModule",{value:!0});var o=a(6),r=n(o),s=a(3),l=n(s),u=a(4),c=n(u),d=a(8),f=n(d),p=a(7),h=n(p),m=a(5),v=n(m),g=a(46),_=n(g),y=a(13),E=n(y),M=a(14),S=n(M),C=a(12),b=n(C),k=a(1405),T=n(k),w=a(1412),N=n(w),P=a(1407),A=n(P),O=a(1406),R=n(O),D=a(115),x=n(D),I=a(1474),L=n(I),F=a(1411),U=n(F),j=a(1532),G=n(j),B=a(161),V=n(B),H=a(15),W=n(H),z=a(61),Y=n(z),q=a(1),K=n(q),Q=a(462),X=n(Q),Z=a(95),J=n(Z),$=a(1404),ee=(n($),a(1483)),te=(n(ee),a(1440)),ae=a(1415),ne=n(ae),ie=a(472),oe=n(ie),re=a(1686),se=n(re),le=a(96),ue=n(le),ce=a(116),de=n(ce),fe=a(160),pe=n(fe),he=a(239),me=a(1408),ve=n(me),ge=a(78),_e=n(ge),ye=function(e){function t(e){(0,l["default"])(this,t);var a=(0,f["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this,e));return a.msgRefs={},a.getInitialState=function(){return{cursor:new G["default"](a.props.starredMsgs,void 0,S["default"].RENDOR_CURSOR.STARRED_DRAWER).loadAfter(S["default"].MSG_PRELOAD_THRESHOLD)}},a.handleStarChange=function(e){a.initSelectionObjects(),a.setState({})},a.initSelectionObjects=function(){var e=a.props.starredMsgs.models;a.currSelection.init(e,!0),a.activeSelection.init(e)},a.setMsgComponentRef=function(e,t){t?a.msgRefs[e.id]=t:delete a.msgRefs[e.id]},a.loadEarlierMsgs=function(){var e=a.state.cursor,t=a.props.chat&&a.props.chat.id,n=a.props.starredMsgs.models;if(e.end<n.length)a.setState({cursor:e.loadAfter()});else{if(a.props.starredMsgs.isSynced)return;a.props.starredMsgs.sync(t).checkpoint(a.props.rejectOnUnmount()).then(function(){e.hasAfter()&&a.setState({cursor:e.loadAfter()})})["catch"](W["default"].Unmount,E["default"].noop)["catch"](function(e){K["default"].log("StarredDrawer:loadEarlierMsgs failed")(),K["default"].log(e)()})}},a.onClose=function(){a.props.onClose?a.props.onClose():a.context.uim.uie.requestDismiss()},a.focus=function(){a.body&&J["default"].focus(_["default"].findDOMNode(a.body))},a.onFocusGain=function(e){if(a.body){var t=e?e.target:document.activeElement;t===_["default"].findDOMNode(a.body)&&(a.currSelection.index<0?a.currSelection.setFirst():a.currSelection.reset(!1))}},a.onNextMsg=function(e){e&&(e.preventDefault(),e.stopPropagation());var t=a.currSelection.next();a.currSelection.index!==t&&a.currSelection.setNext()},a.onPrevMsg=function(e){e&&(e.stopPropagation(),e.preventDefault());var t=a.currSelection.prev();t>-1&&a.currSelection.setPrev()},a.onScroll=function(e){a.handleScroll(e.target)},a._handleScroll=function(e){a.updateMsgListInfo(),i(e)&&a.loadEarlierMsgs()},a.selectMsg=function(e){a.currSelection.setVal(e),a.activeSelection.setVal(e),b["default"].openChatAt(e.chat,e.chat.getSearchContext(e)),b["default"].focusShowMsg(e.id)},a.getMsgList=function(){var e=a.state.cursor,t=a.props.starredMsgs.models,n=a.props.starredMsgs.isSynced?e.end:Math.min(e.end,t.length);return t=t.slice(e.start,n),a.length=t.length,t},a.getMsgVisibility=function(e){if(!e)return S["default"].VISIBILITY.BELOW;if(a.scrollContainer){var t=_["default"].findDOMNode(a.scrollContainer),n=t.previousSibling.clientHeight,i=t.scrollTop+n,o=i+t.clientHeight,r=_["default"].findDOMNode(e);return r?r.offsetTop+r.clientHeight<=i?S["default"].VISIBILITY.ABOVE:r.offsetTop>=o?S["default"].VISIBILITY.BELOW:S["default"].VISIBILITY.VISIBLE:S["default"].VISIBILITY.BELOW}},a.isMsgVisible=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1;return!!a.msgListInfo.visibleMsgs[e.toString()]&&(t?!0:a.getMsgComponent(e))},a.getMsgComponent=function(e){var t=a.msgRefs[e.toString()];if(t){var n=t.wrapper;if(n)return n.refs.component&&n.refs.component.refs.msg}},a._updateMsgListInfo=function(){for(var e=a.getMsgList(),t={},n=0,i=a.length-1;i>n;){var o=Math.floor((n+i)/2),r=a.msgRefs[e[o].id.toString()];a.getMsgVisibility(r)===S["default"].VISIBILITY.ABOVE?n=o+1:i=o}for(var s=n;s<e.length;s++){var l=a.msgRefs[e[s].id.toString()];if(a.getMsgVisibility(l)!==S["default"].VISIBILITY.VISIBLE)break;t[e[s].id.toString()]=!0}a.pauseHiddenGifs(a.msgListInfo.visibleMsgs,t),a.msgListInfo.visibleMsgs=t},a.pauseHiddenGifs=function(e,t){for(var n in e)if(!t[n]){var i=a.props.starredMsgs.get(n);if(i&&i.isGif){var o=a.getMsgComponent(n);o&&o.playCount&&o.pause()}}},a.handleScroll=E["default"].throttle(a._handleScroll,100),a.updateMsgListInfo=E["default"].throttle(a._updateMsgListInfo,100),a.msgListInfo={visibleMsgs:{}},a.state=a.getInitialState(),a}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.currSelection=new U["default"]([],function(e){return e.id.toString()}),this.activeSelection=new U["default"]([],function(e){return e.id.toString()})}},{key:"componentDidMount",value:function(){var e=this;this.focus(),this.props.listeners.add(window,"resize",this.updateMsgListInfo),!this.props.starredMsgs.isSynced&&this.props.starredMsgs.length<S["default"].PAGE_SIZE&&this.props.listeners.uiIdle(this.loadEarlierMsgs),this.props.listeners.addAndRun(this.props.starredMsgs,"reset sync",function(){e.initSelectionObjects(),e.setState({})}),this.props.listeners.add(this.props.starredMsgs,"add remove",this.handleStarChange),this.onFocusGain(),this.props.listeners.add(this.props.starredMsgs,"reset",function(){e.msgListInfo={visibleMsgs:{}},e.setState(e.getInitialState()),e.loadEarlierMsgs()})}},{key:"componentWillUnmount",value:function(){this.handleScroll.cancel(),this.updateMsgListInfo.cancel()}},{key:"componentDidUpdate",value:function(){this.updateMsgListInfo()}},{key:"render",value:function(){var e=this,t=this.getMsgList(),a=this.state.cursor,n=this.props.chat||null,i=void 0,o=void 0;if(o=this.props.starredMsgs.isSynced&&a.end>=t.length?null:this.props.starredMsgs.syncPromise?v["default"].createElement("div",{className:"more"},v["default"].createElement("div",{className:"btn-more",title:pe["default"].t("loading_messages")},v["default"].createElement(V["default"],{stroke:6,size:24}))):v["default"].createElement("div",{className:"more"},v["default"].createElement("div",{className:"btn-more",title:pe["default"].t("load_earlier_messages"),onClick:this.loadEarlierMsgs},v["default"].createElement("span",{className:"icon icon-refresh"}))),t.length>0){var r=t.map(function(t){var a=t.type===X["default"].TYPE.IMAGE||t.type===X["default"].TYPE.VIDEO||t.type===X["default"].TYPE.AUDIO;return v["default"].createElement(L["default"],{key:t.id,ref:(0,he.refWrapper)(function(a){return e.setMsgComponentRef(t,a)}),msg:t,isMsgVisible:a?e.isMsgVisible:E["default"].noop,currSelection:e.currSelection,activeSelection:e.activeSelection,onClickMsg:e.selectMsg})});i=v["default"].createElement(x["default"],{transitionName:"slide"},r)}else this.props.starredMsgs.isSynced?i=v["default"].createElement(N["default"].StarredMsgs,null):(i=v["default"].createElement(N["default"].Loading,null),o=null);var s={down:this.onNextMsg,up:this.onPrevMsg},l=t.length||this.props.starredMsgs.isSynced,u=Y["default"].supportsFeature(Y["default"].F.UNSTAR_ALL)?v["default"].createElement(te.MenuBarItem,{a8n:"starred-menu",icon:"icon-menu-white",title:pe["default"].t("menutitle_menu"),disabled:!l},v["default"].createElement(Ee,{chat:n,msgs:t})):null;return v["default"].createElement(T["default"],{className:"drawer-starred",onCancel:this.onClose},v["default"].createElement(de["default"],{className:"drawer",handlers:s,onFocus:this.onFocusGain,"data-tab":2,ref:(0,he.GetRef)("body",this)},v["default"].createElement(A["default"],{title:pe["default"].t("starred_flow_title"),onBack:this.onClose,type:P.DRAWER_HEADER_TYPE.LARGE,menu:u}),v["default"].createElement(R["default"],{onScroll:this.onScroll,ref:(0,he.GetRef)("scrollContainer",this)},i,o)))}}]),t}(v["default"].Component);ye.contextTypes={uim:v["default"].PropTypes.instanceOf(ue["default"])};var Ee=function(e){function t(){var e,a,n,i;(0,l["default"])(this,t);for(var o=arguments.length,s=Array(o),u=0;o>u;u++)s[u]=arguments[u];return a=n=(0,f["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(s))),n.sendUnstarAll=function(){b["default"].openModal(v["default"].createElement(se["default"],{msgs:n.props.msgs,chat:n.props.chat}))},i=a,(0,f["default"])(n,i)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){return v["default"].createElement(oe["default"],{type:"dropdown_menu",flipOnRTL:!0,key:"StarredDrawerHeader",dirX:"left"},v["default"].createElement(ne["default"],{a8n:"mi-unstar-all menu-item",action:this.sendUnstarAll},pe["default"].t("unstar_all")))}}]),t}(v["default"].Component);t["default"]=(0,ve["default"])((0,_e["default"])(ye))},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BlocklistProxy=t["default"]=void 0;var n=a(80),i=(0,n.defineState)("Blocklist",{Collection:"Blocklist",session:{contact:"object"},props:{id:"string"},initialize:function(){this.addChild("contact",Store.Contact.gadd(this.id))}}),o=i.Blocklist,r=i.BlocklistProxy;t["default"]=o,t.BlocklistProxy=r},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.CallProxy=t["default"]=void 0;var i=a(80),o=n(i),r=a(1),s=a(12),l=(0,i.defineState)("Call",{Collection:"Call",props:{id:"string",type:"string",from:"string"},initialize:function(){o["default"].prototype.initialize.call(this),this.listenToAndRun(this,"change:type",this.updateNotification)},updateNotification:function(){r.log("call:"+this.type+" id:"+this.id+" from:"+this.from)(),"offer"===this.type||"offer_video"===this.type?s.alertCall(this.id,this.from,"offer_video"===this.type):s.cancelCall(this.id)}}),u=l.state,c=l.proxy;t["default"]=u,t.CallProxy=c},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(462),s=n(r),l=a(464),u=a(14),c=a(15),d=l.extend({model:s["default"],initialize:function(){l.prototype.initialize.call(this),this.hasDocBefore=!0},"delete":function(){l.prototype["delete"].call(this),this.stopListening(),this.reset()},queryDocs:function(e,t){var a=this;if(t)return this.queryDocBefore?this.queryDocBefore:(this.queryDocBefore=Store.Msg.queryMedia(t.id.remote,u.MEDIA_QUERY_LIMIT,"before",t.id,"document").then(function(e){return(!e||e.length<u.MEDIA_QUERY_LIMIT)&&(a.hasDocBefore=!1),a.add(e.filter(function(e){return e.isDoc}),{at:0}),{length:e.length}})["catch"](c.WapDrop,404,_.noop)["finally"](function(){a.queryDocBefore=null,a.trigger("query_doc_before")}),this.trigger("query_doc_before"),this.queryDocBefore);var n=e.msgs.models;if(0===this.length){if(!n||0===n.length)return this.hasDocBefore=!1,new o["default"](function(e){e({eof:!0})});this.add(n.filter(function(e){return e.isDoc}),{at:0})}if(this.length<=2*u.MEDIA_QUERY_LIMIT){var i=0===this.length?_.head(n):this.head();return this.queryDocs(e,i)}return new o["default"](function(e){e({eof:!1})})}});e.exports=d},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(462),s=n(r),l=a(464),u=a(14),c=a(15),d=l.extend({model:s["default"],initialize:function(){l.prototype.initialize.call(this),this.hasLinkBefore=!0},comparator:function(e,t){return e.t-t.t},"delete":function(){l.prototype["delete"].call(this),this.stopListening(),this.reset()},queryLinks:function(e,t){var a=this;if(t)return this.queryLinkBefore?this.queryLinkBefore:(this.queryLinkBefore=Store.Msg.queryMedia(t.id.remote,u.MEDIA_QUERY_LIMIT,"before",t.id,"url").then(function(e){return(!e||e.length<u.MEDIA_QUERY_LIMIT)&&(a.hasLinkBefore=!1),a.add(e,{at:0}),a.createLinksAndAddMsgs(e),{length:e.length}})["catch"](c.WapDrop,404,_.noop)["finally"](function(){a.queryLinkBefore=null,a.trigger("query_link_before")}),this.trigger("query_link_before"),this.queryLinkBefore);var n=e.msgs.models;if(0===this.length){if(!n||0===n.length)return this.hasLinkBefore=!1,new o["default"](function(e){e({eof:!0})});this.add(n.filter(function(e){return e.hasLink}),{at:0}),this.createLinksAndAddMsgs(n)}if(this.length<=2*u.MEDIA_QUERY_LIMIT){var i=0===this.length?_.head(n):this.head();return this.queryLinks(e,i)}return new o["default"](function(e){e({eof:!1})})},createLinksAndAddMsgs:function(e){var t=this,a=[];o["default"].loop(function(t,n,i){e.length===i&&t();var o=e[i];o.createLinks(),o.links.length&&a.push(o)}).then(function(){t.add(a),t.trigger("query_link_before")})}});e.exports=d},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(80),o=n(i),r=a(1425),s=a(1),l=(0,i.defineState)("ChatMsgs",{props:{pendingMsgs:"boolean"},session:{msgChunks:{type:"array","default":function(){return[]}},lastReceivedKey:"object",unreadMsgAnchor:"object",disableUnreadAnchor:"boolean",msgsLength:"number",msgsChanged:{type:"number","default":0}},collections:{msgs:r},initialize:function(){var e=this;o["default"].prototype.initialize.call(this),_.isFunction(this.onEmptyMRM)||s.error("states that extend ChatMsgs need to define onEmptyMRM()")(),this.listenTo(this.msgs,"change:last",function(){e.msgsChanged++}),this.listenTo(this.msgs,"add remove bulk_add",function(){e.msgsChanged++,e.msgsLength=e.msgs.length})},"delete":function(e){o["default"].prototype["delete"].call(this),this.getAllCMCs().forEach(function(e){e["delete"]()})},removeMsg:function(e){var t=e.msgChunk;if(t){var a=t.indexOf(e);0>a||(s.log("models:Chat:removeMsg "+e.get("id"))(),t.remove(e),0===t.length&&(t===this.msgs?this.onEmptyMRM():this.removeMsgsCollection(t)))}},getAllCMCs:function(){return this.msgChunks.concat([this.msgs])},getAllMsgs:function(){return _.flatten(this.getAllCMCs().map(function(e){return e.models}))},replaceMsgsCollection:function(e){s.info("model:Chat:replaceMsgsCollection:"+this.id)(),this.msgs.replace(e),this.notifyMsgCollectionMerge(e,this.msgs,this.msgs),this.msgChunks=_.without(this.msgChunks,e),e["delete"]()},removeMsgsCollection:function(e){this.msgChunks=_.without(this.msgChunks,e),e["delete"]()},notifyMsgCollectionMerge:function(e,t,a){this.trigger("change:cmc:merge",e,t,a)}}),u=l.ChatMsgs;e.exports=u},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmojiVariantProxy=t["default"]=void 0;var n=a(80),i=(0,n.defineState)("EmojiVariant",{props:{id:"string","char":"string",variant:"string"},initialize:function(e){this.id=e.id||e["char"]}}),o=i.EmojiVariant,r=i.EmojiVariantProxy;t["default"]=o,t.EmojiVariantProxy=r},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(462),s=n(r),l=a(464),u=a(15),c=a(61),d=100,f=l.extend({model:s["default"],initialize:function(){var e=this;l.prototype.initialize.call(this),this.hasMoreMsgs=!0,this.resultPage=0,this.listenTo(Store.Msg,"remove_msgs",function(t){var a=e.remove(t,{silent:!0});a&&e.trigger("bulk_remove")}),this.listenTo(Store.Chat,"remove",function(t){var a=[];e.forEach(function(e){e.chat===t&&a.push(e)});var n=e.remove(a,{silent:!0});n&&e.trigger("bulk_remove")})},"delete":function(e){e&&this.stopListening(),l.prototype["delete"].call(this)},resetSearch:function(e){this.hasMoreMsgs=!0,this.resultPage=0,this.searchTerm=e,this.searchPromise&&this.searchPromise.cancel()},search:function(e,t){var a=this;if(this.searchTerm!==e&&(this.searchTerm&&0===e.indexOf(this.searchTerm)||(this.searchTerm=e,this["delete"]()),this.resultPage=0,this.hasMoreMsgs=!0),this.searchPromise){if(this.searchTerm===e)return this.searchPromise;this.searchPromise.cancel()}var n=void 0;return n=t?t.fts(e,++this.resultPage,d):Store.Msg.search(e,++this.resultPage,d),this.searchPromise=n.cancellable().then(function(t){c.supportsFeature(c.F.FTS_PAGINATION)&&!t.eof||(a.hasMoreMsgs=!1),a.searchTerm!==e&&a["delete"](),a.searchTerm=e,a.add(t.messages)})["catch"](u.WapDrop,o["default"].CancellationError,_.noop)["finally"](function(){a.searchPromise=null})}});e.exports=f},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecentEmojiProxy=t["default"]=void 0;var n=a(80),i=(0,n.defineState)("RecentEmoji",{props:{id:"string","char":"string",weight:"number"},initialize:function(e){this.id=e.id||e["char"]}}),o=i.RecentEmoji,r=i.RecentEmojiProxy;t["default"]=o,t.RecentEmojiProxy=r},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(13),y=n(_),E=a(12),M=n(E),S=a(238),C=n(S),b=a(21),k=n(b),T=a(471),w=n(T),N=a(1403),P=n(N),A=a(1476),O=n(A),R=a(61),D=n(R),x=a(78),I=n(x),L=a(462),F=n(L),U=a(1416),j=(n(U),a(1517)),G=n(j),B=a(470),V=n(B);t["default"]=(0,I["default"])((o=i=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(r))),n.onStarChanged=function(e){n.props.selectedMessages.isSelected(e)&&n.setState({})},n.onStarSelected=function(){var e=n.props,t=e.chat,a=e.selectedMessages,i=e.toastPosition,o=a.getSelected();M["default"].sendStarMsgs(t,o,null,i),n.props.onCancel()},n.onUnstarSelected=function(){var e=n.props,t=e.chat,a=e.selectedMessages,i=e.toastPosition,o=a.getSelected();M["default"].sendUnstarMsgs(t,o,null,i),n.props.onCancel()},n.onDownloadSelected=function(){var e=y["default"].filter(n.props.selectedMessages.getSelected(),function(e){return e.mediaData&&e.mediaData.renderableUrl});e.length&&(w["default"].initDownload(e),n.props.onCancel())},n.onDeleteSelected=function(){var e=n.props,t=e.chat,a=e.selectedMessages,i=e.toastPosition,o=a.getSelected(),r=function(){M["default"].closeModal(),M["default"].sendDeleteMsgs(t,o,null,i),n.props.onCancel()},s=y["default"].size(o),l=l10n.t("delete_message_confirmation",{count:s,_plural:s});M["default"].openModal(g["default"].createElement(C["default"],{onOK:r,okText:l10n.t("web_delete"),onCancel:M["default"].closeModal.bind(M["default"]),cancelText:l10n.t("web_cancel")},g["default"].createElement(P["default"],{text:l})))},n.onRevokeSelected=function(){var e=n.props,t=e.chat,a=e.selectedMessages,i=e.toastPosition,o=a.getSelected();M["default"].openModal(g["default"].createElement(G["default"],{chat:t,msgList:o,toastPosition:i,onCancel:n.props.onCancel}))},n.onForwardSelected=function(){var e=n.props.selectedMessages.getSelected();n.props.noSortOnForward||(e=n.props.chat.sortMsgs(e));var t=y["default"].size(e),a=function(){n.props.onCancel()},i=y["default"].filter(e,function(e){return e.canForward()});if(y["default"].size(i))if(t!==y["default"].size(i)){var o=function(){M["default"].openModal(g["default"].createElement(O["default"],{msgs:i,pushTransition:"none",popTransition:"none",onForward:a}),"modal-flow")};M["default"].openModal(g["default"].createElement(C["default"],{title:l10n.t("confirm_forward_partial_messages_title"),onOK:o,okText:l10n.t("forward"),onCancel:M["default"].closeModal.bind(M["default"]),cancelText:l10n.t("web_cancel")},l10n.t("confirm_forward_partial_messages_text")))}else M["default"].openModal(g["default"].createElement(O["default"],{msgs:e,pushTransition:"none",popTransition:"none",onForward:a}),"modal-flow");else M["default"].openModal(g["default"].createElement(C["default"],{
title:l10n.t("err_unsent_forward_title"),onOK:M["default"].closeModal.bind(M["default"]),okText:l10n.t("web_ok")},l10n.t("err_unsent_forward_text",{count:t,_plural:t})))},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){var e=this;y["default"].forEach(this.props.selectedMessages.getSelected(),function(t){e.props.listeners.add(t,"change:star")}),this.props.listeners.add(this.props.selectedMessages,"all"),this.props.listeners.add(Store.Msg,"change:star",this.onStarChanged)}},{key:"render",value:function(){var e=this.props.selectedMessages.getSelected(),t=y["default"].size(e),a=D["default"].supportsFeature(D["default"].F.ENC_DOC)||y["default"].every(e,function(e){return e.type!==F["default"].TYPE.DOCUMENT}),n=y["default"].some(e,function(e){return e.canForward()}),i=y["default"].some(e,function(e){return e.mediaData&&e.mediaData.renderableUrl}),o=g["default"].createElement("button",{className:"btn-icon btn-forward",disabled:t&&a&&n?null:"disabled",title:l10n.t("forward_message",{count:t,_plural:t}),onClick:this.onForwardSelected},g["default"].createElement(V["default"],{name:"forward",className:"icon icon-forward"})),r=void 0;D["default"].supportsFeature(D["default"].F.MESSAGE_DELETE)&&(r=g["default"].createElement("button",{className:"btn-icon btn-delete",disabled:t?null:"disabled",title:l10n.t("delete_message",{count:t,_plural:t}),onClick:this.onDeleteSelected},g["default"].createElement(V["default"],{name:"delete",className:"icon icon-delete"})));var s=void 0;if(D["default"].supportsFeature(D["default"].F.STARRED)){var l=void 0,u=void 0,c=void 0;t&&y["default"].every(e,"star")?(l=this.onUnstarSelected,u=g["default"].createElement(V["default"],{name:"unstar-btn",className:"icon icon-unstar-btn"}),c=l10n.t("unstar_message",{count:t,_plural:t})):(l=this.onStarSelected,u=g["default"].createElement(V["default"],{name:"star-btn",className:"icon icon-star-btn"}),c=l10n.t("star_message",{count:t,_plural:t})),s=g["default"].createElement("button",{className:"btn-icon btn-star",disabled:t?null:"disabled",title:c,onClick:l},u)}var d=void 0;if(!this.props.disableRevoke&&D["default"].supportsFeature(D["default"].F.REVOKE)){var f=l10n.t("revoke_message",{count:t,_plural:t});d=t?y["default"].every(e,function(e){return e.canRevoke()})?g["default"].createElement("button",{className:"btn-icon",title:f,onClick:this.onRevokeSelected},g["default"].createElement("span",{className:"icon icon-recall"})):null:g["default"].createElement("button",{className:"btn-icon",disabled:"disabled",title:f},g["default"].createElement("span",{className:"icon icon-recall"}))}var p=Modernizr.adownload&&this.props.downloadButton?g["default"].createElement("button",{className:"btn-icon",disabled:t&&i?null:"disabled",title:l10n.t("web_button_download"),onClick:this.onDownloadSelected},g["default"].createElement(V["default"],{name:"download",className:"icon icon-download"})):null;return g["default"].createElement("div",{className:(0,k["default"])("multi-controls",this.props.className)},g["default"].createElement("button",{className:"btn-icon btn-cancel",onClick:this.props.onCancel},g["default"].createElement(V["default"],{name:"x"})),g["default"].createElement("span",{className:"multi-count"},l10n.t("selected_count",{count:t,_plural:t})),s,r,d,o,p)}}]),t}(g["default"].Component),i.defaultProps={downloadButton:!0},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1402),g=n(v),_=a(1420),y=(n(_),a(1714)),E=n(y),M=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props.statusV3;return m["default"].createElement("div",{className:"status-image-container",onClick:this.props.onClick},m["default"].createElement(E["default"],{statusV3:e}),m["default"].createElement(S,{renderedThumbnail:e.renderedThumbnail}))}}]),t}(h.PureComponent);M.CONCERNS={statusV3:["renderedThumbnail"]};var S=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props.renderedThumbnail;e&&e.retain()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.renderedThumbnail,a=e.renderedThumbnail;t!==a&&(t&&t.autorelease(),a&&a.retain())}},{key:"componentWillUnmount",value:function(){var e=this.props.renderedThumbnail;e&&e.autorelease()}},{key:"render",value:function(){var e=this.props.renderedThumbnail,t={backgroundImage:e&&"url("+e.url()+")"};return m["default"].createElement("div",{className:"status-image",style:t})}}]),t}(h.PureComponent);t["default"]=(0,g["default"])(M)},function(e,t){"use strict";var a=window.matchMedia("\nonly screen and (max-width: 1024px)\n"),n={column:a.matches?2:3},i=function(e){var t=e.matches?2:3;if(n.column!==t){n.column=t;var a=document.createEvent("Event");a.initEvent("columnChange",!0,!0),window.dispatchEvent(a)}};a.addListener(i),e.exports=n},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(244),s=a(15),l={getFiles:function(e,t){var a=e.target.files||e.dataTransfer.files;if(a=_.map(a,function(e,t){return e}),a.length)return o["default"].resolve(a);if(e.dataTransfer.getData("text/uri-list"))return r.urlToFile(e.dataTransfer.getData("text/uri-list")).then(function(e){return[e]});if(e.dataTransfer.getData("text/html")){var n=new DOMParser,i=n.parseFromString(e.dataTransfer.getData("text/html"),"text/html");if(i.createNodeIterator(i.childNodes[0],NodeFilter.SHOW_TEXT).nextNode()){if(e.dataTransfer.getData("text/plain")&&!t)return o["default"].reject(new s.MediaDragDropError("dropped html has text nodes",e.dataTransfer.getData("text/plain")))}else{var l=i.getElementsByTagName("img");if(l.length)return r.urlToFile(l[0].src).then(function(e){return[e]})}}return o["default"].resolve(a)}};e.exports=l},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return s.hasOwnProperty(e)?s[e]:s[e]=r["default"].queryLinkPreview(e).then(function(t){var a=t.title,n=t.description,i=t.canonicalUrl,o=t.matchedText,r=t.thumbnail;return o&&(a||n)?{url:e,data:{title:a||void 0,description:n||void 0,canonicalUrl:i||void 0,matchedText:o,thumbnail:r||void 0}}:null})}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i;var o=a(47),r=n(o),s={}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,a){var n=e.models;if(a===M.BEFORE){var i=function(){var e=0;return{v:{hasNext:function(){return t>=e},next:function(){return n[t--]}}}}();if("object"==typeof i)return i.v}else{if(a!==M.AFTER)throw new Error("RendorCursor:invalid direction");var o=function(){var e=n.length-1;return{v:{hasNext:function(){return e>=t},next:function(){return n[t++]}}}}();if("object"==typeof o)return o.v}}function o(e,t,a){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=T*n,r=i(e,t,a),s=0,u=0,c=void 0;r.hasNext();){var d=r.next(),f=l(d),p=2*d.isNotification+d.isSentByMe,h=p&&p===c?S:C;if(s+=f+h,u++,s>o)break;c=p}return u}function r(e,t,a){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=T*n,r=i(e,t,a),s=0,u=0,c=void 0;r.hasNext();){var d=r.next(),f=l(d),p=d.author||(d.isSentByMe?Store.Conn.me:void 0),h=p&&!d.isSentByMe&&p!==c?b:0,m=p&&p===c?S:C;if(s+=f+h+m,u++,s>o)break;c=p}return u}function s(e,t,a){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=T*n,r=i(e,t,a),s=0,u=0;r.hasNext();){var c=r.next(),d=l(c);if(s+=d+k,u++,s>o)break}return u}function l(e){var t=0;switch(e.quotedMsg&&(t+=54),e.caption&&(t+=31),e.type){case v["default"].TYPE.NOTIFICATION:case v["default"].TYPE.GROUP_NOTIFICATION:case v["default"].TYPE.GP2:case v["default"].TYPE.BROADCAST_NOTIFICATION:case v["default"].TYPE.E2E_NOTIFICATION:case v["default"].TYPE.CALL_LOG:case v["default"].TYPE.CIPHERTEXT:case v["default"].TYPE.REVOKED:case v["default"].TYPE.CHAT:e.linkPreview&&(t+=53);var a=E(e.body).length;return t+19*_.ceil(a/100)+13;case v["default"].TYPE.IMAGE:return t+e.fullWidth&&e.fullHeight?Math.floor(Math.min(330/e.fullWidth*e.fullHeight,330)):330;case v["default"].TYPE.VIDEO:case v["default"].TYPE.AUDIO:return e.isGif?t+137:t+166;case v["default"].TYPE.LOCATION:return t+g.PREVIEW_HEIGHT;case v["default"].TYPE.PTT:return t+67;case v["default"].TYPE.VCARD:return t+74;case v["default"].TYPE.DOCUMENT:return t+188;case v["default"].TYPE.UNKNOWN:default:return t}}function u(e){switch(e){case y.RENDOR_CURSOR.CONVERSATION:case y.RENDOR_CURSOR.GROUP_CONVERSATION:return y.RENDOR_CURSOR.RECENT_AT_BOTTOM;case y.RENDOR_CURSOR.STARRED_DRAWER:return y.RENDOR_CURSOR.RECENT_AT_TOP;default:return y.RENDOR_CURSOR.RECENT_AT_BOTTOM}}function c(e){switch(e){case y.RENDOR_CURSOR.CONVERSATION:return o;case y.RENDOR_CURSOR.GROUP_CONVERSATION:return r;case y.RENDOR_CURSOR.STARRED_DRAWER:return s;default:return o}}var d=a(3),f=n(d),p=a(4),h=n(p),m=a(462),v=n(m),g=a(1503),y=a(14),E=a(479),M={BEFORE:"before",AFTER:"after"},S=2,C=12,b=19,k=65,T=window.innerHeight,w=_.debounce(function(e){T=window.innerHeight},500);window.addEventListener("resize",w);var N=function(){function e(t,a,n){var i=this;(0,f["default"])(this,e);var o=c(n);this.msgCollection=t,this.type=n,this.dir=u(n),this.cursorSize=function(e,t){if(e===M.BEFORE)return o(i.msgCollection,i.start-1,e,t);if(e===M.AFTER)return o(i.msgCollection,i.end,e,t);throw new Error("RendorCursor:invalid direction")},this.init(a)}return(0,h["default"])(e,[{key:"init",value:function(e){return this.before=0,this.after=0,this.prevKey=void 0,this.msgKey=e,this.loadBefore(void 0,1),this.loadAfter(void 0,1),this}},{key:"setKey",value:function(e){var t=this.index;this.msgKey=e;var a=this.index;return e?(this.after=this.after-(a-t),this.before=this.before+(a-t)):(this.before+=this.after,this.after=0),this.updatePrev(),this}},{key:"onRemove",value:function(e){e.id===this.prevKey?this.updatePrev():e.id===this.msgKey&&this.focusBefore()}},{key:"updatePrev",value:function(){this.prevKey=this.index>0?this.msgCollection.models[this.index-1].id:void 0}},{key:"focusBefore",value:function(){this.msgKey=this.prevKey,this.updatePrev()}},{key:"hasBefore",value:function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.index-this.before>0}},{key:"loadBefore",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=e||this.cursorSize(M.BEFORE,t);return this.before+=a,this}},{key:"hasAfter",value:function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.index+this.after<this.msgCollection.length-1}},{key:"loadAfter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=e||this.cursorSize(M.AFTER,t);return this.after+=a,this}},{key:"index",get:function(){if(this.msgKey){var e=this.msgCollection.get(this.msgKey),t=this.msgCollection.indexOf(e);if(-1!==t)return t}return this.dir===y.RENDOR_CURSOR.RECENT_AT_TOP?0:this.msgCollection.length-1}},{key:"start",get:function(){return Math.max(this.index-this.before,0)}},{key:"end",get:function(){return Math.min(this.index+this.after+1,this.msgCollection.length)}}]),e}();e.exports=N},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=!1;try{var n={get passive(){a=!0}};window.addEventListener("test",null,n)}catch(i){}t["default"]=a},function(e,t,a){function n(e){return a(i(e))}function i(e){var t=o[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var o={"./de/translation.json":1742,"./en/translation.json":1743,"./es/translation.json":1744,"./it/translation.json":1745,"./pt/translation.json":1746,"./ru/translation.json":1747};n.keys=function(){return Object.keys(o)},n.resolve=i,e.exports=n,n.id=1534},,function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(13),y=n(_),E=a(1651),M=n(E),S=a(12),C=n(S),b=a(1657),k=n(b),T=a(1672),w=n(T),N=a(96),P=n(N),A=a(78),O=n(A);t["default"]=(0,O["default"])((o=i=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(r))),n.onMute=function(e,t){if(t){var a=function(t){e.pendingAction++,e.mute.mute(t,!0)["finally"](function(){e.pendingAction--})};C["default"].openModal(g["default"].createElement(w["default"],{chat:e,onMute:a}),"modal",n.context.uim)}else e.pendingAction++,e.mute.unmute(!0)["finally"](function(){e.pendingAction--})},n.onDeleteOrExit=function(e){var t=function(t){e.pendingAction++,t["finally"](function(){e.pendingAction--})};C["default"].openModal(g["default"].createElement(k["default"],{chat:e,onDeleteOrExit:t}),"modal",n.context.uim)},n.onPin=function(e,t){e.pendingAction++,e.setPin(t)["catch"](y["default"].noop)["finally"](function(){e.pendingAction--})},n.onClear=function(e){C["default"].openModal(g["default"].createElement(M["default"],{chat:e}),"modal",n.context.uim)},n.onArchive=function(e,t){e.pendingAction++,e.setArchive(t)["catch"](y["default"].noop)["finally"](function(){e.pendingAction--})},n.onMarkUnread=function(e,t){e.pendingAction++,e.markUnread(t)["finally"](function(){e.pendingAction--})},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentDidMount",value:function(){this.props.listeners.add(C["default"],"mute_chat",this.onMute),this.props.listeners.add(C["default"],"delete_or_exit_chat",this.onDeleteOrExit),this.props.listeners.add(C["default"],"archive_chat",this.onArchive),this.props.listeners.add(C["default"],"clear_chat_msgs",this.onClear),this.props.listeners.add(C["default"],"mark_chat_unread",this.onMarkUnread),this.props.listeners.add(C["default"],"pin_chat",this.onPin)}},{key:"render",value:function(){return null}}]),t}(v.PureComponent),i.contextTypes={uim:g["default"].PropTypes.instanceOf(P["default"])},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=e.mimeType,a=e.url;return r["default"].createElement("div",{className:"attach-audio media-element-container"},r["default"].createElement("div",{className:"media-element"},r["default"].createElement("audio",{controls:!0,type:t,src:a})))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i;var o=a(5),r=n(o)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=e.preview,a=e.mimeType,n=e.filename;return t?r["default"].createElement("div",{className:"attach-doc media-element-pdf-container"},r["default"].createElement("div",{className:"media-element-pdf-preview"},r["default"].createElement(l["default"],{type:s.FIT_TYPE.SCALE_DOWN,size:{width:t.width,height:t.height}},r["default"].createElement("img",{src:t.url,className:"media-viewer-img"})))):r["default"].createElement(c["default"],{mimeType:a,filename:n})}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i;var o=a(5),r=n(o),s=a(1418),l=n(s),u=a(1463),c=n(u)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=e.mimeType,a=e.url,n=e.isGif,i=e.size,o=void 0;switch(h[t].msgType){case"image":o=l["default"].createElement("img",{src:a,className:"media-viewer-img"});break;case"video":var s=n?{loop:!0,autoPlay:!0,muted:!1,controls:!1}:{};o=l["default"].createElement("video",(0,r["default"])({controls:!0,className:"media-viewer-img",type:t},s,{src:a}));break;case"audio":o=l["default"].createElement("audio",{controls:!0,className:"media-viewer-audio",type:t,src:a})}return l["default"].createElement("div",{className:"attach-media media-element-container"},l["default"].createElement("div",{className:"media-element"},l["default"].createElement(c["default"],{type:u.FIT_TYPE.SCALE_DOWN,size:i},o)))}Object.defineProperty(t,"__esModule",{value:!0});var o=a(62),r=n(o);t["default"]=i;var s=a(5),l=n(s),u=a(1418),c=n(u),d=a(13),f=n(d),p=a(119),h=f["default"].pickBy(p.MIMETYPES,function(e){return"image"===e.msgType||"video"===e.msgType})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=e.preview,a=e.mimeType,n=e.filename;if(t){var i=l10n.t("attach_document_pdf_total_pages",{count:t.pdfPages,_plural:t.pdfPages});return r["default"].createElement("div",{className:"attach-pdf media-element-pdf-container"},r["default"].createElement("div",{className:"media-element-pdf-preview"},r["default"].createElement(l["default"],{type:s.FIT_TYPE.SCALE_DOWN,size:{width:t.width,height:t.height}},r["default"].createElement("img",{src:t.url,className:"media-viewer-img"}))),r["default"].createElement("div",{className:"media-element-pdf-caption"},i))}return r["default"].createElement(c["default"],{mimeType:a,filename:n})}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i;var o=a(5),r=n(o),s=a(1418),l=n(s),u=a(1463),c=n(u)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=e.action||null,a=(0,C["default"])("butterbar",{action:t,"butterbar-computer":"computer"===e.type,"butterbar-phone":"phone"===e.type,"butterbar-notification":"notification"===e.type,"butterbar-battery":"battery"===e.type,"butterbar-update":"update"===e.type}),n=(0,C["default"])("icon","icon-alert",{"icon-alert-computer":"computer"===e.type,"icon-alert-phone":"phone"===e.type,"icon-alert-notification":"notification"===e.type,"icon-alert-battery":"battery"===e.type,"icon-alert-update":"update"===e.type}),i=e.onDismiss?M["default"].createElement("div",{className:"butterbar-controls"},M["default"].createElement("button",{className:"icon icon-x-light",onClick:e.onDismiss})):null,o=e.text?M["default"].createElement("div",{className:"butterbar-text"},e.text):null;return M["default"].createElement("div",{className:"butterbar-wrapper"},M["default"].createElement("div",{className:a,onClick:t},M["default"].createElement("div",{className:"butterbar-icon"},M["default"].createElement("span",{className:n})),M["default"].createElement("div",{className:"butterbar-body"},M["default"].createElement("div",{className:"butterbar-title"},e.title),o),i))}function o(){k["default"].closeModal()}function r(){switch(Z["default"].browser){case P["default"].BROWSER_TYPE.CHROME:return window.open("https://www.whatsapp.com/faq/web/28080004","_blank");case P["default"].BROWSER_TYPE.FIREFOX:return window.open("https://www.whatsapp.com/faq/web/28080006","_blank");case P["default"].BROWSER_TYPE.SAFARI:return window.open("https://www.whatsapp.com/faq/web/28080008","_blank");case P["default"].BROWSER_TYPE.OPERA:return window.open("https://www.whatsapp.com/faq/web/28080007","_blank");default:return window.open("https://www.whatsapp.com/faq/web/28080004","_blank")}}function s(){window.open("http://www.whatsapp.com/faq/web/28080002")}Object.defineProperty(t,"__esModule",{value:!0});var l,u,c=a(6),d=n(c),f=a(3),p=n(f),h=a(4),m=n(h),v=a(8),g=n(v),_=a(7),y=n(_),E=a(5),M=n(E),S=a(21),C=n(S),b=a(12),k=n(b),T=a(475),w=n(T),N=a(14),P=n(N),A=a(1436),O=n(A),R=a(78),D=n(R),x=a(43),I=n(x),L=a(0),F=n(L),U=a(42),j=n(U),G=a(115),B=n(G),V=a(55),H=n(V),W=a(23),z=n(W),Y=a(1402),q=n(Y),K=a(97),Q=n(K),X=a(37),Z=n(X),J=a(251),$=n(J),ee=a(165),te=n(ee),ae=3e3,ne=function(e){function t(){var e,a,n,i;(0,p["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,g["default"])(this,(e=t.__proto__||(0,d["default"])(t)).call.apply(e,[this].concat(r))),n.state={allowReconnect:!0},n.reconnect=function(){var e=te["default"].numSocketsAttempted+1;z["default"].poke(),j["default"].waitForBBEvent(Q["default"],"change:displayInfo",function(){return Q["default"].displayInfo===Q["default"].INFO.NORMAL}).then(function(){new I["default"].WebcManualWebsocketAttempt({webcManualWebsocketAttemptSuccessful:te["default"].numSocketsAttempted===e}).commit()}),n.setState({allowReconnect:!1}),n._reconnectTimeoutTimer.onOrAfter(ae)},n._reconnectTimeoutTimer=new H["default"](function(){n.setState({allowReconnect:!0})}),i=a,(0,g["default"])(n,i)}return(0,y["default"])(t,e),(0,m["default"])(t,[{key:"componentWillUnmount",value:function(){this._reconnectTimeoutTimer.cancel()}},{key:"render",value:function(){var e=void 0,t=void 0;return this.state.allowReconnect?(e=M["default"].createElement("span",null,l10n.t("make_sure_computer_active_internet_connection")+" ",M["default"].createElement("span",{className:"action",onClick:this.reconnect},l10n.t("reconnect"))),t=l10n.t("computer_not_connected")):(e=null,t=l10n.t("connecting_to_whatsapp_or_phone")),M["default"].createElement(i,{type:"computer",title:t,text:e})}}]),t}(E.PureComponent),ie=(0,D["default"])(function(e){function t(){var e,a,n,i;(0,p["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,g["default"])(this,(e=t.__proto__||(0,d["default"])(t)).call.apply(e,[this].concat(r))),n.state={takingTooLong:!1,didShowSubtitle:!1},n._timeoutTimer=new H["default"](function(){n.setState({takingTooLong:!0,didShowSubtitle:!0})}),n.onProgress=function(){n._rerenderTimer.cancel(),n._timeoutTimer.onOrBefore(3e3),n.setState({takingTooLong:!1})},n._rerenderTimer=new H["default"](function(){n.forceUpdate()}),n.retry=function(){z["default"].poke(),n.onProgress()},i=a,(0,g["default"])(n,i)}return(0,y["default"])(t,e),(0,m["default"])(t,[{key:"componentWillMount",value:function(){this.props.listeners.add(z["default"],"change:state",this.onProgress),this.props.listeners.add(z["default"],"change:retryTimestamp",this.onProgress)}},{key:"componentDidMount",value:function(){this._timeoutTimer.onOrBefore(3e3)}},{key:"componentWillUnmount",value:function(){this._timeoutTimer.cancel(),this._rerenderTimer.cancel()}},{key:"render",value:function(){var e,t;if(Q["default"].displayInfo===Q["default"].INFO.OPENING)e=l10n.t("connecting_to_whatsapp");else{if(Q["default"].displayInfo!==Q["default"].INFO.CONNECTING)return null;e=l10n.t("connecting_to_whatsapp_or_phone")}if(this.state.takingTooLong){this._rerenderTimer.onOrAfter(1e3);var a=z["default"].retryTimestamp-Date.now();if(1>a)a=l10n.t("retrying"),setTimeout(function(){z["default"].poke()},0);else if(6e4>a){var n=Math.ceil(a/1e3);a=l10n.t("retrying_in_some_seconds",{number:n,_plural:n})}else a=l10n.t("retrying_in",{duration:F["default"].duration(a).humanize()});t=M["default"].createElement("span",null,a," ",M["default"].createElement("span",{className:"action",onClick:this.retry},l10n.t("retry_now")))}else t=this.state.didShowSubtitle?M["default"].createElement("span",null,l10n.t("retrying")):null;return M["default"].createElement(i,{type:"computer",title:e,text:t})}}]),t}(E.Component)),oe=(0,D["default"])((0,q["default"])((u=l=function(e){function t(e){(0,p["default"])(this,t);var a=(0,g["default"])(this,(t.__proto__||(0,d["default"])(t)).call(this,e));a.onReload=function(){$["default"].restart()},a.onClickManualDownload=function(){},a._showBatteryTimer=new H["default"](function(){return a.batteryUpdate(!1)}),a.dismissLowBatteryWarning=function(){var e=a.state.lowBatteryWarning;e>0&&a.setState({lowBatteryWarning:-e})},a._showNotifyTimer=new H["default"](function(e){a.setState({showNotify:e})}),a.requestPermissions=function(){k["default"].openModal(M["default"].createElement(O["default"],{title:"guide_desktop_notifications_title",desc:"guide_desktop_notifications_description",onConfirm:o,onCancel:r,type:O["default"].TYPE.GUIDE_ALLOW})),window.Notification.requestPermission(function(e){k["default"].closeModal(),a.setState({notifyPermission:e})})};var n=w["default"].battery<P["default"].BATTERY_LOW_THRESHOLD_1?w["default"].battery<P["default"].BATTERY_LOW_THRESHOLD_2?2:1:0;a.state={lowBatteryWarning:w["default"].plugged?0:n,notifyPermission:window.Notification&&window.Notification.permission,showNotify:!1};var i=function(){a.batteryUpdate(!0)};return e.listeners.add(w["default"],"change:plugged",i),e.listeners.add(w["default"],"change:battery",i),a}return(0,y["default"])(t,e),(0,m["default"])(t,[{key:"componentWillUnmount",value:function(){this._showNotifyTimer.cancel(),this._showBatteryTimer.cancel()}},{key:"batteryUpdate",value:function(e){var t=this.state.lowBatteryWarning;w["default"].plugged||w["default"].battery>P["default"].BATTERY_LOW_THRESHOLD_1?0!==t&&this.setState({lowBatteryWarning:0}):w["default"].battery<=P["default"].BATTERY_LOW_THRESHOLD_2?-2!==t&&(e?this._showBatteryTimer.onOrBefore(P["default"].BATTERY_DELAY):2!==t&&this.setState({lowBatteryWarning:2})):t>-1&&w["default"].battery<=P["default"].BATTERY_LOW_THRESHOLD_1&&(e?this._showBatteryTimer.onOrBefore(P["default"].BATTERY_DELAY):1!==t&&this.setState({lowBatteryWarning:1}))}},{key:"render",value:function(){var e=null;switch(Q["default"].displayInfo){case Q["default"].INFO.OFFLINE:e=M["default"].createElement(ne,{key:"bbar"});break;case Q["default"].INFO.OPENING:case Q["default"].INFO.CONNECTING:e=M["default"].createElement(ie,{key:"bbar"});break;case Q["default"].INFO.NORMAL:break;case Q["default"].INFO.RESUMING:case Q["default"].INFO.TIMEOUT:var t=M["default"].createElement("span",null,l10n.t("make_sure_phone_active_internet_connection"),"Â ",M["default"].createElement("span",{className:"action",onClick:s},l10n.t("learn_more")));e=M["default"].createElement(i,{type:"phone",key:"bbar",title:l10n.t("phone_not_connected"),text:t})}if(!e&&this.state.lowBatteryWarning>0&&(e=M["default"].createElement(i,{type:"battery",key:"bbar",title:l10n.t("phone_battery_low"),text:l10n.t("charge_phone_description"),dismissable:!0,onDismiss:this.dismissLowBatteryWarning})),!e&&Q["default"].needsUpdate&&(e=M["default"].createElement(i,{type:"update",key:"bbar",title:l10n.t("update_available"),text:l10n.t("click_to_update_whatsapp_web"),action:this.onReload})),Q["default"].needsManualDownload&&(e=M["default"].createElement(i,{type:"update",key:"bbar",title:l10n.t("desktop_client_update_available"),text:l10n.t("click_to_download_desktop_client"),action:this.onClickManualDownload})),e)this.state.showNotify&&this._showNotifyTimer.onOrBefore(0,!1);else if(this.state.showNotify){if(window.Notification&&this.state.notifyPermission===P["default"].PERMISSION_DEFAULT){var a=M["default"].createElement("span",{className:"action",onClick:this.requestPermissions},l10n.t("enable_desktop_notifications"));e=M["default"].createElement(i,{type:"notification",key:"bbar",title:l10n.t("get_notified_of_new_messages"),text:a})}}else this._showNotifyTimer.onOrBefore(P["default"].NOTIFICATION_PROMPT_DELAY,!0);return M["default"].createElement("div",{className:"butterbar-container"},M["default"].createElement(B["default"],{transitionName:"butterbar"},e))}}]),t}(E.PureComponent),l.CONCERNS={stream:["displayInfo","needsUpdate","needsManualDownload"]},u)));t["default"]=function(){return M["default"].createElement(oe,{conn:w["default"],stream:Q["default"]})}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1404),g=(n(v),a(1461)),_=(n(g),a(1402)),y=n(_),E=a(1546),M=n(E),S=a(1403),C=n(S),b=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.chat,a=e.presence;if(a.isActive()){var n=a.getFormattedString();if(n)return m["default"].createElement("div",{className:"chat-status typing ellipsify",dir:"auto"},m["default"].createElement(C["default"],{ellipsify:!0,titlify:!0,text:n}))}var i=t.previewMessage;return i?m["default"].createElement(M["default"],{msg:i}):m["default"].createElement("div",{className:"chat-status"})}}]),t}(m["default"].PureComponent);b.displayName="ChatStateInfo",b.CONCERNS={chat:["previewMessage"],chatstate:["id","type"]},b.WEAK_CONCERNS={presence:["hasData","withholdDisplay"]};var k=(0,y["default"])(b);t["default"]=function(e){var t=e.chat;return m["default"].createElement(k,{chat:t,presence:t.presence,chatstate:t.presence.chatstate})}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(5),o=n(i),r=a(79),s=n(r);t["default"]=function(e){var t=e.title,a=e.icon,n=e.t,i=n?s["default"].relativeDateAndTimeStr(n):"-",r={cursor:"auto"};return o["default"].createElement("div",{className:"contact chat contact-msg-info-cell",style:r},o["default"].createElement("div",{className:"chat-body"},o["default"].createElement("div",{className:"chat-main"},o["default"].createElement("div",{className:"chat-title"},o["default"].createElement("span",{className:"ellipsify",dir:"auto"},a,t))),o["default"].createElement("div",{className:"chat-secondary"},o["default"].createElement("div",{className:"chat-status ellipsify"},o["default"].createElement("span",{className:"ellipsify",dir:"auto"},i)))))}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(1427),y=n(_),E=a(1409),M=n(E),S=a(79),C=n(S),b=a(1402),k=n(b),T=a(241),w=(n(T),a(1444),a(1403)),N=n(w);t["default"]=(0,k["default"])((o=i=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.contact,a=e.msgInfoParticipant,n={cursor:"auto"},i=g["default"].createElement(M["default"],{id:t.id,profileClick:!0}),o=g["default"].createElement("div",{style:{flex:1}},C["default"].relativeDateAndTimeStr(a.t)),r=void 0;return!t.name&&t.notifyName&&(r=g["default"].createElement("span",{className:"ellipsify screen-name"},g["default"].createElement(N["default"],{className:"screen-name-text",direction:"auto",text:t.notifyName}))),g["default"].createElement(y["default"],{id:t.id,contextEnabled:function(){return!1},image:i,primary:t.formattedName,secondary:o,secondaryDetail:r,style:n})}}]),t}(g["default"].PureComponent),i.CONCERNS={msgInfoParticipant:["t"],contact:["id","name","formattedName","notifyName"]},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1404),g=(n(v),a(1445)),_=(n(g),a(1402)),y=n(_),E=a(160),M=n(E),S=a(1488),C=n(S),b=a(115),k=n(b),T=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.shouldAnimate=!1,i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillUpdate",value:function(e){this.shouldAnimate=this.props.chat.id===e.chat.id}},{key:"render",value:function(){var e=this.props,t=e.chat,a=e.mute,n=a.isMuted?m["default"].createElement("span",{className:"icon icon-meta icon-muted",key:"icon-muted"}):null,i=t.pin?m["default"].createElement("span",{className:"icon icon-meta icon-pinned",key:"icon-pinned"}):null,o=0!==t.unreadCount?m["default"].createElement(C["default"],{count:t.unreadCount,className:"icon-meta",key:"icon-unread"}):null,r=t.archive?m["default"].createElement("span",{className:"icon-meta chat-marker chat-marker-archived",key:"icon-archived"},M["default"].t("chat_archived")):null;
return m["default"].createElement(k["default"],{transitionName:"pop",transitionEnter:this.shouldAnimate,transitionLeave:this.shouldAnimate},n,r,i,o)}}]),t}(m["default"].PureComponent);T.CONCERNS={chat:["id","unreadCount","archive","pin"],mute:["isMuted"]},t["default"]=(0,y["default"])(T)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(462),y=(n(_),a(1487)),E=n(y),M=a(37),S=n(M),C=a(160),b=n(C),k=a(1464),T=n(k),w=a(1450),N=n(w),P=a(1403),A=n(P),O=a(466),R=a(1402),D=n(R);t["default"]=(0,D["default"])((o=i=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props.msg,t=[];e.isSentByMe&&t.push(g["default"].createElement(T["default"],{msg:e,key:"symbol"})),e.isSentByMe||!e.isGroupMsg||e.isNotification||t.push(g["default"].createElement(E["default"],{contact:e.senderObj,key:"author"})),e.hasSymbol()&&t.push(g["default"].createElement(N["default"],{msg:e,key:"msg-symbol"})),t.push(g["default"].createElement(A["default"],{direction:e.dir,ellipsify:!0,text:e.msgText(!1),dirMismatch:e.dir&&e.rtl!==b["default"].isRTL(),formatters:O.Configuration.LastMessage(e.mentionMap()),key:"status"}));var a="chat-status";S["default"].isGecko&&(a+=" ellipsify");var n=b["default"].embedDir(e.msgText(),e.rtl);return g["default"].createElement("div",{className:a,title:n},t)}}]),t}(g["default"].PureComponent),i.CONCERNS={msg:["isSentByMe","isGroupMsg","isNotification","senderObj","dir","rtl","type"]},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(62),o=n(i),r=a(98),s=n(r),l=a(6),u=n(l),c=a(3),d=n(c),f=a(4),p=n(f),h=a(8),m=n(h),v=a(7),g=n(v),_=a(1438),y=(n(_),a(463)),E=n(y),M=a(5),S=n(M),C=a(46),b=n(C),k=a(1427),T=n(k),w=a(1403),N=n(w),P=a(21),A=n(P),O=a(1426),R=n(O),D=a(37),x=n(D),I=a(95),L=n(I),F=a(1465),U=n(F),j=a(1450),G=n(j),B=a(462),V=n(B),H=a(1464),W=n(H),z=a(1487),Y=n(z),q=a(116),K=n(q),Q=a(160),X=n(Q),Z=a(1402),J=n(Z),$=a(78),ee=n($),te=a(1411),ae=(n(te),a(239)),ne=a(466),ie=a(13),oe=n(ie),re=function(e){function t(){var e,a,n,i;(0,d["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,m["default"])(this,(e=t.__proto__||(0,u["default"])(t)).call.apply(e,[this].concat(r))),n.onSearch=function(){n.setState({searchText:n.props.searchQuery.trimmed})},n.onActiveChange=function(e){if("focus"===e){var t=b["default"].findDOMNode(n);L["default"].focus(t),R["default"].scrollIntoViewIfNeeded(t)}n.setState({active:!!e})},n.onClick=function(e){if(oe["default"].isFunction(n.props.onClick)){var t=n.props,a=t.msg,i=t.chat,o=Store.Msg.get(a.id),r=i.getSearchContext(o);r.msg=o,n.props.onClick(e,Store.Chat.get(i.id),r)}},n.onMouseDown=function(e){0===e.button&&n.onClick(e)},n.onEnter=function(e){e.preventDefault(),e.stopPropagation(),K["default"].flashFocus=Date.now(),n.onClick(e)},n.indicateFocus=function(e){if(!(Date.now()-(K["default"].flashFocus||0)>200)){var t=b["default"].findDOMNode(n.cell);(0,E["default"])(t,"stop"),(0,E["default"])(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:n.onBlur})}},n.onBlur=function(e){var t=b["default"].findDOMNode(n.cell);t&&((0,E["default"])(t,"stop"),t.style.backgroundColor="")},i=a,(0,m["default"])(n,i)}return(0,g["default"])(t,e),(0,p["default"])(t,[{key:"componentWillMount",value:function(){this.initListeners(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.initListeners(e,this.props)}},{key:"initListeners",value:function(e,t){var a=e.listeners,n=e.active,i=e.msg,o=e.searchQuery;t&&t.searchQuery&&t.searchQuery!==o&&a.remove(o,_.SEARCH_EVENT,this.onSearch),!o||t&&o===t.searchQuery||a.add(o,_.SEARCH_EVENT,this.onSearch);var r=t&&t.msg.id;i.id.equals(r)||(t&&t.active&&a.remove(t.active,t.msg.id.toString(),this.onActiveChange),n&&a.add(n,i.id.toString(),this.onActiveChange));var s=n&&n.value instanceof V["default"]&&n.value.id.equals(i.id);this.setState({searchText:o.trimmed,active:s})}},{key:"render",value:function(){var e=this.props,t=e.msg,a=e.chat,n=e.searchQuery,i=[];t.isSentByMe&&i.push(S["default"].createElement(W["default"],{msg:t,key:"symbol"})),t.isSentByMe||!t.isGroupMsg||t.isNotification||i.push(S["default"].createElement(Y["default"],{contact:t.senderObj,key:"author"})),t.hasSymbol()&&i.push(S["default"].createElement(G["default"],{msg:t,key:"msg-symbol"}));var o=n.highlighted;i.push(S["default"].createElement(N["default"],{direction:t.dir,ellipsify:!0,text:t.msgText(!1),dirMismatch:t.dir&&t.rtl!==X["default"].isRTL(),formatters:ne.Configuration.FTSMessage(t.mentionMap(),o),key:"status"}));var r=(0,A["default"])("chat-status",{ellipsify:x["default"].isGecko}),s=S["default"].createElement(U["default"],{msg:t}),l=X["default"].embedDir(t.msgText(t.rtl)),u=S["default"].createElement("div",{className:r,title:l},i),c={enter:this.onEnter},d=(0,A["default"])("cell-message",{active:!!this.state.active}),f=this.props.mouseDownAsClick;return S["default"].createElement(K["default"],{handlers:c,onFocus:this.indicateFocus,onBlur:this.onBlur,className:"chat-drag-cover"},S["default"].createElement(T["default"],{id:t.id.toString(),ref:(0,ae.GetRef)("cell",this),contextEnabled:function(){return!1},className:d,primary:a.title(),primaryDetail:s,secondary:u,onClick:f?null:this.onClick,onMouseDown:f?this.onMouseDown:null}))}}]),t}(S["default"].PureComponent);re.CONCERNS={msg:["id","isSentByMe","isGroupMsg","isNotification","senderObj","dir","rtl","type"],chat:["id","formattedTitle"]},re.defaultProps={mouseDownAsClick:!1};var se=(0,ee["default"])((0,J["default"])(re));t["default"]=function(e){var t=e.msg,a=(0,s["default"])(e,["msg"]);return S["default"].createElement(se,(0,o["default"])({msg:t,chat:t.chat},a))}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(1446),y=(n(_),a(1403)),E=n(y),M=a(1402),S=n(M);t["default"]=(0,S["default"])((o=i=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props.status,t=void 0,a=void 0;return"undefined"!=typeof e.status?(a=e.status,t=g["default"].createElement(E["default"],{direction:"auto",ellipsify:!0,text:e.status})):(a=l10n.t("contact_status_loading"),t=g["default"].createElement("span",{className:"muted"},a)),g["default"].createElement("div",{className:"chat-status",title:a},t)}}]),t}(g["default"].PureComponent),i.CONCERNS={status:["status"]},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(2),s=n(r),l=a(6),u=n(l),c=a(3),d=n(c),f=a(4),p=n(f),h=a(8),m=n(h),v=a(7),g=n(v),_=a(5),y=n(_),E=a(13),M=n(E),S=a(1481),C=n(S),b=a(1632),k=n(b),T=a(1404),w=n(T),N=a(1511),P=n(N),A=a(12),O=n(A),R=a(1654),D=n(R),x=a(15),I=n(x),L=a(1664),F=n(L),U=a(1509),j=n(U),G=a(160),B=n(G),V=a(78),H=n(V),W=a(1),z=n(W),Y=a(1424),q=n(Y),K=a(1639),Q=n(K),X=a(462),Z=(n(X),a(96)),J=n(Z),$=a(1689),ee=n($),te=a(243);t["default"]=(0,H["default"])((o=i=function(e){function t(){var e,a,n,i;(0,d["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,m["default"])(this,(e=t.__proto__||(0,u["default"])(t)).call.apply(e,[this].concat(r))),n.onChatInfoDrawer=function(e){O["default"].openDrawerRight(y["default"].createElement(j["default"],{chat:e,key:"info-"+e.id}),"slide-left",n.context.uim)},n.onVerificationDrawer=function(e){O["default"].openDrawerRight(y["default"].createElement(ee["default"],{contact:Store.Contact.get(e),isFirstLevel:!0}),"slide-left",n.context.uim)},n.onMsgInfoDrawer=function(e){e.chat.kind===w["default"].KIND.CHAT?O["default"].openDrawerRight(y["default"].createElement(D["default"],{msg:e}),"slide-left",n.context.uim):O["default"].openDrawerRight(y["default"].createElement(F["default"],{msg:e}),"slide-left",n.context.uim)},n.onAttachMediaDrawer=function(e,t,a){O["default"].existsDrawerMid(function(i){if(!i){var o=new C["default"],r={noFocus:!0,onEnterAnimationComplete:function(){t&&o.processFiles(t,e)}};O["default"].openDrawerMid(y["default"].createElement(k["default"],{chat:e,files:t,onComplete:a,mediaCollection:o}),"slide-up",n.context.uim,r)}})},n.onChatSearch=function(e){O["default"].openDrawerRight(y["default"].createElement(P["default"],{chat:e}),"slide-left",n.context.uim)},n.onMediaViewer=function(e,t,a){Store.Msg.get(e.id)?O["default"].openModalMedia(y["default"].createElement(Q["default"],{msg:e,startTime:a,getZoomNode:t}),"media-viewer",n.context.uim):O["default"].openModal(y["default"].createElement(q["default"],{msg:e}))},n.onSendStarMsgs=function(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"LEFT";if(!t)return s["default"].reject(new I["default"].ActionError);if(M["default"].some(t,function(e){return!e.id}))return s["default"].reject(new I["default"].ActionError);a=a||(0,te.genId)();var o=M["default"].size(t),r={count:o,_plural:o},l=new te.ActionType(B["default"].t("action_message_starring",r)),u=e.sendStarMsgs(t,!0).then(function(o){return 200===o.status?new te.ActionType(B["default"].t("action_message_starred",r),B["default"].t("action_undo"),n.onSendUnstarMsgs.bind(n,e,t,a,i)):o.status>=400?new te.ActionType(B["default"].t("action_message_star_failed",r)):void 0})["catch"](function(o){return z["default"].error("chatAction:sendStarMsgs dropped")(o),new te.ActionType(B["default"].t("action_message_star_failed",r),B["default"].t("action_try_again"),n.onSendStarMsgs.bind(n,e,t,a,i))});return O["default"].openToast(y["default"].createElement(te.ActionToast,{id:a,toastPosition:i,initialAction:l,pendingAction:u})),u},n.onSendUnstarMsgs=function(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"LEFT";if(!t)return s["default"].reject(new I["default"].ActionError);if(M["default"].some(t,function(e){return!e.id}))return s["default"].reject(new I["default"].ActionError);a=a||(0,te.genId)();var o=M["default"].size(t),r={count:o,_plural:o},l=new te.ActionType(B["default"].t("action_message_unstarring",r)),u=e.sendStarMsgs(t,!1).then(function(o){return 200===o.status?new te.ActionType(B["default"].t("action_message_unstarred",r),B["default"].t("action_undo"),n.onSendStarMsgs.bind(n,e,t,a,i)):o.status>=400?new te.ActionType(B["default"].t("action_message_unstar_failed",r)):void 0})["catch"](function(o){return z["default"].error("chatAction:sendUnstarMsgs dropped")(o),new te.ActionType(B["default"].t("action_message_unstar_failed",r),B["default"].t("action_try_again"),n.onSendUnstarMsgs.bind(n,e,t,a,i))});return O["default"].openToast(y["default"].createElement(te.ActionToast,{id:a,toastPosition:i,initialAction:l,pendingAction:u})),u},n.onSendDeleteMsgs=function(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"LEFT";if(!t)return s["default"].reject(new I["default"].ActionError);if(M["default"].some(t,function(e){return!e.id}))return s["default"].reject(new I["default"].ActionError);var o=M["default"].size(t);a=a||(0,te.genId)();var r={count:o,_plural:o},l=new te.ActionType(B["default"].t("action_message_deleting",r)),u=e.sendDeleteMsgs(t).then(function(e){return 200===e.status?new te.ActionType(B["default"].t("action_message_deleted",r)):e.status>=400?new te.ActionType(B["default"].t("action_message_delete_failed",r)):void 0})["catch"](function(o){return z["default"].error("chatAction:sendDeleteMsgs dropped")(o),new te.ActionType(B["default"].t("action_message_delete_failed",r),B["default"].t("action_try_again"),n.onSendDeleteMsgs.bind(n,e,t,a,i))});return O["default"].openToast(y["default"].createElement(te.ActionToast,{id:a,toastPosition:i,initialAction:l,pendingAction:u})),u},n.onSendRevokeMsgs=function(e,t,a,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"LEFT";if(!t)return s["default"].reject(new I["default"].ActionError);if(M["default"].some(t,function(e){return!e.canRevoke()}))return s["default"].reject(new I["default"].ActionError);var o=M["default"].size(t);n=n||(0,te.genId)();var r={count:o,_plural:o},l=new te.ActionType(B["default"].t("action_message_revoking",r)),u=e.sendRevokeMsgs(t,a).then(function(e){return new te.ActionType(B["default"].t("action_message_revoked",r))})["catch"](function(e){return z["default"].error("chatAction:sendRevokeMsgs fail")(e),new te.ActionType(B["default"].t("action_message_revoke_failed",r))});return O["default"].openToast(y["default"].createElement(te.ActionToast,{id:n,toastPosition:i,initialAction:l,pendingAction:u})),u},i=a,(0,m["default"])(n,i)}return(0,g["default"])(t,e),(0,p["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props.listeners;e.add(O["default"],"chat_info_drawer",this.onChatInfoDrawer),e.add(O["default"],"msg_info_drawer",this.onMsgInfoDrawer),e.add(O["default"],"chat_search",this.onChatSearch),e.add(O["default"],"attach_media_drawer",this.onAttachMediaDrawer),e.add(O["default"],"verification_drawer",this.onVerificationDrawer),e.add(O["default"],"media_viewer_modal",this.onMediaViewer),e.add(O["default"],"send_star_msgs",this.onSendStarMsgs),e.add(O["default"],"send_unstar_msgs",this.onSendUnstarMsgs),e.add(O["default"],"send_delete_msgs",this.onSendDeleteMsgs),e.add(O["default"],"send_revoke_msgs",this.onSendRevokeMsgs)}},{key:"render",value:function(){return null}}]),t}(y["default"].Component),i.contextTypes={uim:y["default"].PropTypes.instanceOf(J["default"])},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(13),g=n(v),_=a(1403),y=n(_),E=a(160),M=n(E),S=a(78),C=n(S),b=a(1416),k=(n(b),a(115)),T=n(k);t["default"]=(0,C["default"])(function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.props.listeners.add(this.props.selections,"all"),this.firstRenderActive=this.props.startActive}},{key:"render",value:function(){var e=void 0,t=this.firstRenderActive?"btn btn-round btn-l btn-active":"btn btn-round btn-l btn-action";return g["default"].size(this.props.selections.getSelected())>0?e=m["default"].createElement("div",{className:"drawer-controls-summary"},m["default"].createElement(w,{chats:this.props.selections.getSelected()}),m["default"].createElement("button",{className:t,onClick:this.props.onForward},m["default"].createElement("span",{className:"icon icon-send-light"}))):this.firstRenderActive=!1,m["default"].createElement(T["default"],{transitionName:"slide-up-down-footer",className:"drawer-controls-container"},e)}}]),t}(m["default"].Component));var w=function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));return a.state={chats:a.props.chats},a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.state.chats,a=e.chats;t=g["default"].size(a)>g["default"].size(t)?t.concat(g["default"].difference(a,t)):g["default"].intersection(t,a),this.setState({chats:t})}},{key:"render",value:function(){var e=g["default"].map(this.state.chats,function(e){var t=e.isGroup?e.formattedTitle:e.formattedShortNameWithNonBreakingSpaces;return m["default"].createElement(y["default"],{text:t,className:"list-comma-item",key:e.id})});return M["default"].isRTL()||e.reverse(),m["default"].createElement(T["default"],{transitionName:"pop",className:"drawer-controls-summary-text"},e)}}]),t}(m["default"].Component)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var i=a(81),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(13),g=n(v),_=a(14),y=n(_),E=a(1437),M=n(E),S=a(1404),C=n(S),b=a(241),k=(n(b),a(12)),T=n(k),w=a(1422),N=n(w),P=a(61),A=n(P),O=a(116),R=n(O),D=a(1438),x=(n(D),a(1493)),I=n(x),L=a(78),F=n(L),U=a(1547),j=n(U),G=a(5),B=n(G),V=a(46),H=n(V),W=a(1454),z=n(W),Y=a(1411),q=(n(Y),a(117)),K=n(q),Q=a(240),X=n(Q),Z=0,J=1,$=2,ee=3,te=function(e){function t(e){(0,u["default"])(this,t);var a=(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this,e));ae.call(a),a._listPointerEvents=!0,a.ftsStarred=a.getFTSStarred(e),a.ftsMessages=a.getFTSMessages(e),a.debouncedOpenSelected=a.props.debounce(function(){a.openSelected(a.focusComposer),a.focusComposer=!1},200);var n=void 0;return n=0,a.state={textsize:n},a}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){this.props.selection.init(this.getSelection())}},{key:"componentWillReceiveProps",value:function(e){this.ftsStarred=this.getFTSStarred(e),this.ftsMessages=this.getFTSMessages(e)}},{key:"componentWillUnmount",value:function(){var e=this.getSelection(),t=this.props.selection.getVal();t&&t.isState&&!this.props.isSearching&&!e.length&&T["default"].clearChat(t)}},{key:"componentDidMount",value:function(){var e=this;this.props.listeners.add(T["default"],"focus_chat_list",this.restoreFocus),this.props.listeners.add(T["default"],"focus_next_chat",function(t){e.onNextChat(null,!0,t)}),this.props.listeners.add(T["default"],"focus_prev_chat",function(t){e.onPrevChat(null,!0,t)}),this.props.listeners.add(T["default"],"update_chatlist_selection",this.updateSelected),this.props.listeners.add(T["default"],"textsize_change",function(t){e.setState({textsize:t})})}},{key:"componentDidUpdate",value:function(e,t){var a=this.props.selection.getVal();this.props.selection.init(this.getSelection(),!e.isSearching&&!this.props.isSearching),a!==this.props.selection.getVal()&&(this.focusComposer=!0,this.debouncedOpenSelected())}},{key:"openSelected",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!1,t=this.props.selection.getVal();t&&(t instanceof C["default"]&&t!==this.getActiveChat()?T["default"].openChatFromUnread(t).then(function(a){a&&e&&T["default"].focusChatTextInput(t)}):e&&T["default"].focusChatTextInput(t))}},{key:"getSelection",value:function(){return[].concat((0,o["default"])(this.props.chats),(0,o["default"])(this.props.contacts),(0,o["default"])(this.ftsStarred),(0,o["default"])(this.ftsMessages))}},{key:"getSection",value:function(e){var t=this.props,a=t.chats,n=t.contacts,i=t.isSearching,o=[];return a.length>0&&o.push(Z),i&&n.length>0&&o.push(J),this.ftsStarred.length>0&&o.push($),this.ftsMessages.length>0&&o.push(ee),o[e]}},{key:"focusFirst",value:function(){this.props.selection.setFirst(),this.debouncedOpenSelected()}},{key:"onNextChat",value:function(e,t,a){e&&(e.preventDefault(),e.stopPropagation());var n=this.props.selection.next();this.props.selection.index!==n&&(this.props.selection.setNext(),this.focusComposer=a,this.debouncedOpenSelected())}},{key:"onPrevChat",value:function(e,t,a){e&&(e.stopPropagation(),e.preventDefault());var n=this.props.selection.prev();n>-1?(this.props.selection.setPrev(),this.focusComposer=a,this.debouncedOpenSelected()):t||(this.debouncedOpenSelected.cancel(),this.openSelected(),this.props.onFocusSearch())}},{key:"render",value:function(){var e=this,t={down:function(t){return e.onNextChat(t)},j:function(t){return e.onNextChat(t)},up:function(t){return e.onPrevChat(t)},k:function(t){return e.onPrevChat(t)}},a=72,n=g["default"].find(y["default"].LIST_HEIGHT_TEXTSIZE_MAP,function(t){return t.scale===e.state.textsize});return n&&(a=n.height),B["default"].createElement(X["default"],{displayName:"Chatlist",ref:"uie",state:X["default"].State.PASSIVE,requestFocus:function(){return e.props.selection.reset(!1)}},B["default"].createElement(R["default"],{handlers:t,onFocus:this.onFocusGain,"data-tab":3},B["default"].createElement(I["default"],{className:"chatlist",itemForRowAtIndexPath:this.itemForRowAtIndexPath,keyForRowAtIndexPath:this.keyForRowAtIndexPath,sectionForSection:this.sectionForSection,numberOfRowsInSection:this.numberOfRowsInSection,numberOfSections:this.numberOfSections,heightForItem:a,extraItems:10,onPointerEventsOff:this.onListPointerEventsOff,onPointerEventsOn:this.onListPointerEventsOn})))}},{key:"getActiveChat",value:function(){return g["default"].find(Store.Chat.toArray(),{active:!0})}}]),t}(B["default"].Component);te.defaultProps={chats:[]};var ae=function(){var e=this;this.onListPointerEventsOff=function(){e._listPointerEvents=!1},this.onListPointerEventsOn=function(){e._listPointerEvents=!0},this.updateSelected=function(t){e.debouncedOpenSelected.cancel(),e.props.selection.setVal(t,!1)},this.onClick=function(t,a,n){t.preventDefault(),t.stopPropagation(),Store.Chat.find(a.id).then(function(t){e.props.isSearching&&e.props.onClick&&e.props.onClick(),n?T["default"].openChatAt(t,n).then(function(e){e&&T["default"].focusChatTextInput(t)}):t!==e.getActiveChat()?T["default"].openChatFromUnread(t).then(function(e){e&&T["default"].focusChatTextInput(t)}):T["default"].focusChatTextInput(t)})},this.getFTSStarred=function(e){return g["default"].filter(e.ftsResult,{star:!0})},this.getFTSMessages=function(e){return g["default"].filter(e.ftsResult,{star:!1})},this.numberOfSections=function(){var t=e.props,a=t.contacts,n=t.chats,i=t.isSearching,o=n.length>0?1:0;return i?(a.length>0&&o++,A["default"].supportsFeature(A["default"].F.FULL_TEXT_SEARCH)?(e.ftsStarred.length>0&&o++,e.ftsMessages.length>0&&o++,o):o):o},this.numberOfRowsInSection=function(t){var a=e.props,n=a.contacts,i=a.chats;switch(e.getSection(t)){case Z:return i.length;case J:return n.length;case $:return e.ftsStarred.length;case ee:return e.ftsMessages.length;default:return 0}},this.sectionForSection=function(t){var a=e.props.isSearching;if(a)switch(e.getSection(t)){case Z:return B["default"].createElement(z["default"],{key:"chat-header",header:l10n.t("web_chats")});case J:return B["default"].createElement(z["default"],{key:"contact-header",header:l10n.t("web_contacts")});case $:return B["default"].createElement(z["default"],{key:"fts-header-starred",header:l10n.t("web_starred_messages")});case ee:return B["default"].createElement(z["default"],{key:"fts-header-messages",header:l10n.t("web_messages")})}},this.keyForRowAtIndexPath=function(t){var a=e.props,n=a.chats,i=a.contacts,o=t.row,r=t.section;switch(e.getSection(r)){case Z:return n[o].id;case J:return i[o].id;case $:return e.ftsStarred[o].id.toString();case ee:return e.ftsMessages[o].id.toString()}},this.itemForRowAtIndexPath=function(t){var a=e.props,n=a.chats,i=a.contacts,o=a.searchQuery,r=t.row,s=t.section;switch(e.getSection(s)){case Z:var l=n[r];return B["default"].createElement(M["default"],{chat:l,contact:l.contact,mode:E.Mode.LAST,searchQuery:o,onClick:e.onClick,mouseDownAsClick:!0,profileClick:!0,active:e.props.selection});case J:var u=i[r];return B["default"].createElement(N["default"],{contact:u,active:e.props.selection,searchQuery:o,onClick:e.onClick,profileClick:!0,mouseDownAsClick:!0});case $:var c=e.ftsStarred[r];return B["default"].createElement(j["default"],{msg:c,searchQuery:o,onClick:e.onClick,active:e.props.selection});case ee:var d=e.ftsMessages[r];return B["default"].createElement(j["default"],{msg:d,searchQuery:o,onClick:e.onClick,active:e.props.selection})}},this.restoreFocus=function(){e.props.selection.reset()},this.onFocusGain=function(t){var a=e.refs.uie;a&&a.activate(),t.target===H["default"].findDOMNode(e)&&e._listPointerEvents&&(e.props.selection.index<0?e.focusFirst():e.props.selection.reset())}};t.Component=te;t["default"]=(0,F["default"])((0,K["default"])(te))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(23),g=n(v),_=a(1516),y=n(_),E=a(238),M=n(E),S=a(1640),C=n(S),b=a(1641),k=n(b),T=a(1644),w=n(T),N=a(1647),P=n(N),A=a(1518),O=n(A),R=a(1445),D=(n(R),a(31)),x=n(D),I=a(472),L=n(I),F=a(1415),U=n(F),j=a(1409),G=n(j),B=a(12),V=n(B),H=a(14),W=n(H),z=a(1715),Y=n(z),q=a(1440),K=a(61),Q=n(K),X=a(465),Z=n(X),J=a(21),$=n(J),ee=a(1402),te=n(ee),ae=a(117),ne=n(ae),ie=a(78),oe=n(ie),re=a(115),se=n(re),le=function(e){function t(){(0,s["default"])(this,t);var e=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments));return e.onWindowFocus=function(){e.setState({newlyFocused:!0}),e.props.setTimeout(function(){return e.setState({newlyFocused:!1})},100)},e.onMouseDown=function(){},e.onDrag=function(t){e.didDrag=!0},e.onClickCapture=function(e){},e.onNewChat=function(e){e.preventDefault(),V["default"].openDrawerLeft(m["default"].createElement(C["default"],null))},e.onProfile=function(){var e=Store.Status.get(Store.Conn.me),t=Store.ProfilePicThumb.get(Store.Conn.me);V["default"].openDrawerLeft(m["default"].createElement(y["default"],{status:e,profilePicThumb:t,conn:Store.Conn}))},e.onUnmute=function(){Store.Mute.globalMute().unmute(),V["default"].openToast(m["default"].createElement(Z["default"],{msg:l10n.t("global_unmuted"),id:Z["default"].genId()}))},e.state={},e}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){}},{key:"render",value:function(){var e=null;this.props.mute.isMuted&&(e=m["default"].createElement(q.MenuBarItem,{a8n:"menu-bar-unmute",icon:"icon-dnd",title:l10n.t("global_unmute"),onClick:this.onUnmute,key:"btn-dnd"}));var t=null;Q["default"].supportsFeature(Q["default"].F.STATUS_V3_UI)&&(t=m["default"].createElement(Y["default"],null));var a=(0,$["default"])("pane-list-user",{});return m["default"].createElement("header",{className:"pane-header pane-list-header",onMouseDown:this.onMouseDown,onClickCapture:this.onClickCapture},m["default"].createElement("div",{className:a},m["default"].createElement(G["default"],{id:Store.Conn.me,size:40,onClick:this.onProfile})),m["default"].createElement("div",{className:"pane-list-controls"},m["default"].createElement(q.MenuBar,{key:"chatlist-header"},m["default"].createElement(se["default"],{transitionName:"btn"},e,t,m["default"].createElement(q.MenuBarItem,{a8n:"menu-bar-chat",icon:"icon-chat",title:l10n.t("web_menuitem_new"),onClick:this.onNewChat}),m["default"].createElement(q.MenuBarItem,{a8n:"menu-bar-menu",icon:"icon-menu",title:l10n.t("menutitle_menu")},m["default"].createElement(ue,null))))))}}]),t}(m["default"].Component);le.CONCERNS={mute:["isMuted"]},e.exports=(0,ne["default"])((0,oe["default"])((0,te["default"])(le)));var ue=function(e){function t(){(0,s["default"])(this,t);var e=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments));return e.onCreateGroup=function(){V["default"].openDrawerLeft(m["default"].createElement(k["default"],null))},e.onProfile=function(){var e=Store.Status.get(Store.Conn.me),t=Store.ProfilePicThumb.get(Store.Conn.me);V["default"].openDrawerLeft(m["default"].createElement(y["default"],{status:e,profilePicThumb:t,conn:Store.Conn}))},e.onDisconnect=function(){var e=Store.Msg.some(function(e){return 0===e.ack&&e.local&&e.isSentByMe});return e?void V["default"].openModal(m["default"].createElement(M["default"],{title:l10n.t("confirm_logout"),onOK:function(){return g["default"].logout()},okText:l10n.t("menuitem_logout"),onCancel:function(){return V["default"].closeModal()},cancelText:l10n.t("web_cancel")},l10n.t("some_of_your_messages_are_still_sending"))):g["default"].logout()},e.onArchived=function(){V["default"].openDrawerLeft(m["default"].createElement(P["default"],null))},e.onSettings=function(){V["default"].openDrawerLeft(m["default"].createElement(w["default"],null))},e.onStarred=function(){V["default"].openDrawerLeft(m["default"].createElement(O["default"],{starredMsgs:Store.AllStarredMsgs}))},e.state={rememberMe:x["default"].getRememberMe()},e}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=Q["default"].supportsFeature(Q["default"].F.GROUP_CREATE)?m["default"].createElement(U["default"],{a8n:"mi-new-group menu-item",action:this.onCreateGroup,shortcut:"g"},l10n.t("web_menuitem_groupchat")):null,t=Q["default"].supportsFeature(Q["default"].F.STARRED)&&Q["default"].supportsFeature(Q["default"].F.FULL_TEXT_SEARCH)?m["default"].createElement(U["default"],{a8n:"mi-starred menu-item",action:this.onStarred},l10n.t("menuitem_starred")):null,a=l10n.t("menuitem_profile_status"),n=l10n.t("menuitem_profile");return m["default"].createElement(L["default"],{type:"dropdown_menu",flipOnRTL:!0,key:"ChatlistHeader",dirX:"left"},e,m["default"].createElement(U["default"],{a8n:"mi-profile-status menu-item",action:this.onProfile},W["default"].STATUS_V2?a:n),m["default"].createElement(U["default"],{a8n:"mi-archived menu-item",action:this.onArchived},l10n.t("menuitem_archived")),t,m["default"].createElement(U["default"],{a8n:"mi-setting menu-item",action:this.onSettings},l10n.t("menuitem_settings")),m["default"].createElement(U["default"],{a8n:"mi-logout menu-item",action:this.onDisconnect,shortcut:"q"},l10n.t("menuitem_logout")))}}]),t}(m["default"].Component)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(13),g=n(v),_=a(1422),y=n(_),E=a(116),M=n(E),S=a(1411),C=n(S),b=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.focusLast=function(){g["default"].size(n.props.contacts)&&n.selection.setLast()},n.focusPrev=function(e){e.preventDefault(),e.stopPropagation();var t=n.selection.prev();t>-1&&n.selection.setPrev()},n.focusNext=function(e){e.preventDefault(),e.stopPropagation();var t=n.selection.next();n.selection.index===t?(n.selection.unset(),n.props.onFocusSearch(e)):n.selection.setNext()},n.deleteContact=function(e){e.preventDefault(),e.stopPropagation();var t=g["default"].find(n.props.contacts,n.selection.getVal());n.props.onDelete(e,t)},n.onParticipantClick=function(e,t){n.selection.setVal(t)},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.selection=new C["default"](this.props.contacts,function(e){return e.id})}},{key:"componentWillReceiveProps",value:function(e){this.selection.init(e.contacts,!0)}},{key:"render",value:function(){var e=this,t=this.props.contacts;if(!t)return null;var a=g["default"].size(t)?g["default"].map(t,function(t){return m["default"].createElement(y["default"],{contact:t,active:e.selection,onDelete:e.props.onDelete,onClick:e.onParticipantClick,type:_.Type.SMALL,key:t.id})}):null,n={up:this.focusPrev,down:this.focusNext,backspace:this.deleteContact};n[l10n.LR("left","right")]=this.focusPrev,n[l10n.LR("right","left")]=this.focusNext;var i=m["default"].createElement("ul",{ref:"list"},a);return m["default"].createElement(M["default"],{handlers:n},i)}}]),t}(m["default"].PureComponent);t["default"]=b},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(46),y=n(_),E=a(21),M=n(E),S=a(13),C=n(S),b=a(160),k=n(b),T=a(1552),w=n(T),N=a(1434),P=n(N),A=a(463),O=n(A),R=a(1551),D=n(R),x=a(1412),I=n(x),L=a(161),F=n(L),U=a(1541),j=n(U),G=a(12),B=n(G),V=a(61),H=n(V),W=a(1449),z=n(W),Y=a(15),q=n(Y),K=a(1411),Q=n(K),X=a(14),Z=n(X),J=a(95),$=n(J),ee=a(1525),te=n(ee),ae=a(116),ne=n(ae),ie=a(55),oe=n(ie),re=a(1404),se=(n(re),
a(241)),le=(n(se),a(1438)),ue=n(le),ce=a(239),de=a(78),fe=n(de),pe=a(1408),he=n(pe),me=a(117),ve=n(me),ge=Z["default"].MIN_CHARS_FOR_FTS,_e={THROTTLE:450},ye=50,Ee=75,Me=function(e){function t(e){(0,u["default"])(this,t);var a=(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this,e));a._batchState={},a.setSearch=function(e){return a.search=e},a.debounceSetState=function(e,t,n){C["default"].assign(a._batchState,e),C["default"].isUndefined(t)&&C["default"].isUndefined(n)?a._debounceSetState.forceRunNow():C["default"].isUndefined(n)?a._debounceSetState.debounce(t):a._debounceSetState.debounceAndCap(t,n)},a.getFilteredContacts=function(e,t){if(!e)return[];e=k["default"].accentFold(C["default"].trim(e));var a=Store.Contact.getFilteredContacts();return a.filter(function(a){var n=a.searchMatch(e);if(!n)return!1;var i=Store.Chat.get(a.id);return t||!i||!i.isVisible})},a.getFilteredChats=function(e){return e=C["default"].trim(e),e?(e=k["default"].accentFold(e),Store.Chat.filter(function(t){return t.contact.searchMatch(e)&&t.isVisible})):Store.Chat.filter(function(e){return!e.archive&&e.isVisible})},a.fullTextSearch=function(e){if(H["default"].supportsFeature(H["default"].F.FULL_TEXT_SEARCH)){var t=C["default"].trim(e||a.searchQuery.query);z["default"].multibyteLength(t)>=ge?a._fts():a.isFTSSearching()&&a.cancelSearch()}},a.shouldFTSSearch=function(e){return!a.ftsMsgs.hasMoreMsgs||a.isFTSSearching()||!H["default"].supportsFeature(H["default"].F.FULL_TEXT_SEARCH)||z["default"].multibyteLength(a.searchQuery.query||"")<ge?!1:e.scrollTop+Z["default"].SCROLL_FUDGE>e.scrollHeight-e.clientHeight},a.onSearch=function(e){if(!e)return void a.onStopSearch();var t=a.searchQuery.query;e!==t&&(a.fullTextSearch(e),a.throttledFilteredChats(e),a.throttledFilteredContacts(e),a.searchQuery.updateQuery(e))},a.hasSearchText=function(){return!!a.searchQuery.query},a.isFTSSearching=function(){var e=a._batchState;return"searching"in e?e.searching:a.state.searching},a.cancelSearch=function(){a._fts.cancel(),a.ftsMsgs.resetSearch(),a.ftsMsgs.reset(),a._ftsPromise&&a._ftsPromise.cancel(),a.isFTSSearching()&&a.debounceSetState({searching:!1},Ee)},a.cancelThrottled=function(){a.throttledFilteredChats.cancel(),a.throttledFilteredContacts.cancel(),a.throttledOnScroll.cancel()},a.onStopSearch=function(){a.cancelSearch(),a.searchQuery.clear(),a.cancelThrottled(),a.search&&a.search.setState({searchText:a.searchQuery.query}),a.debounceSetState({chats:a.getFilteredChats(),contacts:a.getFilteredContacts(),searching:!1})},a.onFocusList=function(e){e.repeat||a.chatlist&&a.search.isAtEnd()&&(e.preventDefault(),e.stopPropagation(),ne["default"].flashFocus=Date.now(),a.chatlist.focusFirst())},a.onOpenFirst=function(e){e.preventDefault();var t=a.searchQuery.query,n=C["default"].head(a.getFilteredChats(t))||C["default"].head(a.getFilteredContacts(t));n&&Store.Chat.find(n.id).then(function(e){a.onStopSearch(),ne["default"].flashFocus=Date.now(),B["default"].openChatFromUnread(e).then(function(t){t&&B["default"].focusChatTextInput(e)})})},a.onFocusSearch=function(e){B["default"].existsDrawerLeft(function(e){e||(ne["default"].flashFocus=Date.now(),$["default"].focus(a.search))})},a.indicateFocus=function(e){if(!(Date.now()-(ne["default"].flashFocus||0)>200)){var t=y["default"].findDOMNode(a.refs.input_hotkey);(0,O["default"])(t,"stop"),(0,O["default"])(t,{backgroundColor:["#fbfbfb","#D9F3FF"]},{duration:1600,easing:[.19,.69,.01,.99]})}},a.onScroll=function(e){a.throttledOnScroll(e.target)},a.getEmptyChatlistState=function(e,t,n){return e&&e.length||t&&t.length||n&&n.length?null:a.searchQuery.query?a.state.searching?g["default"].createElement(I["default"].Searching,null):g["default"].createElement(I["default"].Search,null):Store.Chat.some(function(e){return e.isVisible})?g["default"].createElement(I["default"].AllArchived,null):g["default"].createElement(I["default"].ListChats,null)},a._debounceSetState=new oe["default"](function(){a.setState(a._batchState),a._batchState={}}),a.ftsMsgs=new te["default"],a.selection=new Q["default"]([],function(e){return e.id.toString()}),a.searchQuery=new ue["default"],a._fts=a.props.debounce(function(){var e=a.searchQuery.trimmed;a._ftsPromise&&a._ftsPromise.cancel(),a._ftsPromise=o["default"].resolve().then(function(){a.isFTSSearching()||a.debounceSetState({searching:!0},Ee)}).then(function(){return a.ftsMsgs.search(e)}).checkpoint(a.props.rejectOnUnmount()).then(function(e){a.debounceSetState({searching:!1},Ee)})["catch"](q["default"].Unmount,C["default"].noop)["catch"](o["default"].CancellationError,C["default"].noop)["finally"](function(){a._ftsPromise=void 0})["catch"](function(){a.isFTSSearching()&&a.debounceSetState({searching:!1},Ee)})},750),a.throttledFilteredChats=a.props.throttle(function(e){var t=a.getFilteredChats(e);a.debounceSetState({chats:t},Ee,ye)},_e.THROTTLE,{leading:!1,trailing:!0}),a.throttledFilteredContacts=a.props.throttle(function(e){var t=a.getFilteredContacts(e);a.debounceSetState({contacts:t},Ee,ye)},_e.THROTTLE,{leading:!1,trailing:!0}),a.throttledOnScroll=a.props.throttle(function(e){a.shouldFTSSearch(e)&&a.fullTextSearch()},100);var n;return n=0,a.state={searching:!1,chats:a.getFilteredChats(),contacts:a.getFilteredContacts(),textsize:n},a}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){var e=this;this.props.listeners.add(Store.Chat,"remove",function(t){if(e.searchQuery.query){var a=C["default"].without(e.state.chats,t);e.state.chats&&a.length!==e.state.chats.length&&e.debounceSetState({chats:a})}else e.throttledFilteredChats.cancel(),e.debounceSetState({chats:e.getFilteredChats()})}),this.props.listeners.add(Store.Contact,"remove",function(t){if(e.searchQuery.query){var a=C["default"].without(e.state.contacts,t);e.state.contacts&&a.length!==e.state.contacts.length&&e.debounceSetState({contacts:a})}else e.throttledFilteredContacts.cancel(),e.debounceSetState({contacts:e.getFilteredContacts()})}),this.props.listeners.add(Store.Chat,"sort change:archive",function(){e.searchQuery.query||(e.throttledFilteredChats.cancel(),e.debounceSetState({chats:e.getFilteredChats()}))}),this.props.listeners.add(Store.Contact,"sort",function(){e.searchQuery.query||(e.throttledFilteredContacts.cancel(),e.debounceSetState({contacts:e.getFilteredContacts()}))}),this.props.listeners.add(this.ftsMsgs,"bulk_remove",function(){e.forceUpdate()}),this.props.listeners.add(B["default"],"focus_chat_search",this.onFocusSearch),this.props.listeners.add(B["default"],"textsize_change",function(t){e.debounceSetState({textsize:t})})}},{key:"componentWillUnmount",value:function(){this.cancelSearch(),this.cancelThrottled(),this._debounceSetState.cancel()}},{key:"render",value:function(){var e=this,t=this.state,a=t.chats,n=t.contacts,i=this.ftsMsgs.models,o=this.getEmptyChatlistState(a,n,i);o||(o=g["default"].createElement(D["default"],{ref:(0,ce.GetRef)("chatlist",this),chats:a,contacts:n,isSearching:!!this.hasSearchText(),searchQuery:this.searchQuery,ftsResult:i,selection:this.selection,onFocusSearch:this.onFocusSearch,onClick:this.onStopSearch}));var r,s={down:this.onFocusList,enter:this.onOpenFirst},l=(this.state.searching||this.ftsMsgs.hasMoreMsgs)&&this.ftsMsgs.length?g["default"].createElement("div",{key:"spinner",className:"more",style:{alignSelf:"center"}},g["default"].createElement(F["default"],{stroke:6,size:24})):null,u=C["default"].find(Z["default"].TEXTSIZE_CLASS_MAP,function(t){return t.scale===e.state.textsize});u&&(r=u.classname);var c=(0,M["default"])("chatlist-panel",r,this.props.className),d=this.ftsMsgs.hasMoreMsgs&&i.length?this.onScroll:void 0;return g["default"].createElement("div",{id:"side",className:c},g["default"].createElement(w["default"],{key:"ChatHeader",mute:Store.Mute.globalMute()}),g["default"].createElement(j["default"],{key:"ButterBar"}),g["default"].createElement(ne["default"],{handlers:s,onFocus:this.indicateFocus,ref:"input_hotkey",className:"chatlist-panel-search"},g["default"].createElement(P["default"],{ref:this.setSearch,onSearch:this.onSearch,loading:this.state.searching})),g["default"].createElement("div",{ref:"panel",className:"chatlist-panel-body",onScroll:d,id:"pane-side","data-list-scroll-container":!0},o,l))}}]),t}(g["default"].Component);t["default"]=(0,he["default"])((0,ve["default"])((0,fe["default"])(Me)))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,a){for(var n=[],i=0,o=0;i<e.length||o<t.length;)a(e[i],t[o])?n.push(e[i++]):n.push(t[o++]);return i<e.length?n.concat(e.slice(i)):o<t.length?n.concat(t.slice(o)):n}var o=a(81),r=n(o),s=a(2),l=n(s),u=a(6),c=n(u),d=a(3),f=n(d),p=a(4),h=n(p),m=a(8),v=n(m),g=a(7),_=n(g),y=a(16),E=n(y),M=a(12),S=n(M),C=a(5),b=n(C),k=a(46),T=n(k),w=a(463),N=n(w),P=a(477),A=n(P),O={duration:300,easing:[.1,.82,.25,1]},R=function(e,t){return e.map(function(e,a){return[t[a]===e,a]}).filter(function(e){var t=(0,E["default"])(e,1),a=t[0];return!a}).map(function(e){var t=(0,E["default"])(e,2),a=t[1];return a})},D=function(e,t){return R(e,t).filter(function(a){return e[a]&&!t[a]})},x=function(e,t,a){var n=R(e,t).filter(function(a){return!e[a]&&t[a]}),o=a.filter(function(e){return!!t[e]});return o.length?i(n,o,function(e,t){return t>e}):n},I=function(e){function t(){var e,a,n,i;(0,f["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,v["default"])(this,(e=t.__proto__||(0,c["default"])(t)).call.apply(e,[this].concat(r))),n.containerHeight=0,n.childAnimations=[],n.didCancel=!1,n.state={children:n.props.children||[]},n.pendingRemoval=[],i=a,(0,v["default"])(n,i)}return(0,_["default"])(t,e),(0,h["default"])(t,[{key:"getHeightChange",value:function(e,t){var a=this;return e.reduce(function(e,n){if(t>n)return e;var i=a.refs["animation-child-"+n];if(!i)return e;var o=T["default"].findDOMNode(i);return o?e+o.clientHeight:e},0)}},{key:"animateElement",value:function(e,t,a,n){var i=this;this.childAnimations[e]||(this.childAnimations[e]=l["default"].resolve()),this.childAnimations[e]&&(this.didCancel=!0,this.childAnimations[e].cancel());var o=a>0?[0,a]:[-a,0];return this.childAnimations[e]=(this.childAnimations[e]||l["default"].resolve()).then(function(){return(0,N["default"])(t,{translateY:o},O)}).cancellable().then(function(){return 0>a&&(-1===n.indexOf(e)?t.style.transform="":t.style.opacity="0"),e})["catch"](l["default"].CancellationError,function(){return(0,N["default"])(t,"stop",!0),t.style.transform="",!1})["finally"](function(){i.didCancel?i.didCancel=!1:(delete i.childAnimations[e],S["default"].setUiBusy(!1,"animation_group"))}),this.childAnimations[e]}},{key:"transitionAffected",value:function(e,t){if(!e)return l["default"].resolve();for(var a=[],n=e.slice(-1),i=(0,E["default"])(n,1),o=i[0],r=0;o>=r;++r){var s=this.refs["animation-child-"+r];s&&a.push(this.animateElement(r,T["default"].findDOMNode(s),(t?1:-1)*this.getHeightChange(e,r),e))}return l["default"].all(a).then(function(e){return e.filter(function(e){return e!==!1})})}},{key:"notifyHeightChange",value:function(e,t){e.length&&this.props.onHeightChange&&this.props.onHeightChange((t?1:-1)*this.getHeightChange(e,0))}},{key:"componentWillReceiveProps",value:function(e){var t,a=this,n=e.children,i=void 0===n?[]:n,o=D(this.state.children,i);this.added=x(this.state.children,i,this.pendingRemoval);for(var s=0;s<this.added.length;++s)this.busyId=A["default"].setBusy(this.busyId),S["default"].setUiBusy(!0,"animation_group");if(!o.length)return this.setState({children:i});var l=o.filter(function(e){return-1===a.pendingRemoval.indexOf(e)});if(l.length){for(var u=0;u<l.length;++u)this.busyId=A["default"].setBusy(this.busyId),S["default"].setUiBusy(!0,"animation_group");(t=this.pendingRemoval).push.apply(t,(0,r["default"])(l)),this.notifyHeightChange(o,!1),this.transitionAffected(o,!1).then(function(e){a.pendingRemoval=a.pendingRemoval.filter(function(t){return-1===e.indexOf(t)}),e.length>0&&a.setState({children:i},function(){A["default"].decBusy(a.busyId)})})}}},{key:"componentDidUpdate",value:function(e,t){var a=this;t.children;this.added.length&&(this.notifyHeightChange(this.added,!0),this.transitionAffected(this.added,!0).then(function(){A["default"].decBusy(a.busyId)}))}},{key:"componentDidMount",value:function(){var e=this,t=this.state.children.reduce(function(t,a,n){var i=e.refs["animation-child-"+n];if(!i)return t;var o=T["default"].findDOMNode(i);return o?(o.style.transform="translateY(0)",t+o.clientHeight):t},0);this.props.onHeightChange(t,!0)}},{key:"render",value:function(){var e=this.state.children,t=b["default"].Children.map(e,function(e,t){return e?b["default"].cloneElement(e,{ref:"animation-child-"+t}):e});return b["default"].createElement("div",null,t)}}]),t}(b["default"].Component);e.exports=I},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(1404),y=(n(_),a(1415)),E=n(y),M=a(1402),S=n(M);t["default"]=(0,S["default"])((o=i=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props.chat,t=this.props.onArchive.bind(null,!e.archive);return g["default"].createElement(E["default"],{a8n:"mi-archive",action:t,shortcut:"a",key:"ArchiveMenuItem"},e.archive?l10n.t("unarchive_chat"):l10n.t("archive_chat"))}}]),t}(g["default"].PureComponent),i.CONCERNS={chat:["archive"]},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(21),g=n(v),_=a(470),y=n(_),E=a(115),M=n(E),S=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onToggle=function(e){e&&e.stopPropagation(),n.props.onChange()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=(0,g["default"])("checkbox-container","checkbox-round",this.props.className),t=void 0;return t=this.props.checked?m["default"].createElement(y["default"],{name:"checkbox-round-checked",key:"checked"}):this.props.hover?m["default"].createElement(y["default"],{name:"checkbox-round-unchecked",key:"unchecked",className:"checkbox-round-unchecked"}):m["default"].createElement(y["default"],{name:"checkbox-round-passive",key:"unchecked",className:"checkbox-round-passive"}),m["default"].createElement(M["default"],{className:e,onClick:this.onToggle,transitionName:"pop"},t)}}]),t}(m["default"].Component);t["default"]=S},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(78),m=n(h),v=a(1404),g=(n(v),a(462)),_=(n(g),a(1521)),y=(n(_),a(1474)),E=n(y),M=a(161),S=n(M),C=a(5),b=a(14),k=a(13),T=a(12),w=a(1412),N=(a(1416),function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onScroll=function(e){n.handleScroll(e.target)},n.handleScroll=k.throttle(function(e){var t=n.props.docMsgs;t.hasDocBefore&&e.scrollTop+b.SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&n.queryDocs(t.head())},100),n.onClickMsg=function(e,t){n.props.selectable&&void 0!==t?n.props.onMessageSelect(e,t):T.openChatAt(e.chat,e.chat.getSearchContext(e))},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.props.docMsgs.hasDocBefore&&this.queryDocs()}},{key:"componentDidMount",value:function(){this.props.listeners.add(this.props.docMsgs,"add remove reset"),this.props.listeners.add(this.props.docMsgs,"query_doc_before")}},{key:"componentWillUnmount",value:function(){this.handleScroll.cancel()}},{key:"queryDocs",value:function(e){var t=this,a=this.props.docMsgs;a.hasDocBefore&&this.props.listeners.uiIdle(function(){a.queryDocs(t.props.chat,e)})}},{key:"render",value:function(){var e=this,t=this.props.docMsgs,a=this.props.selectedMessages,n=t.map(function(t){return C.createElement(E["default"],{key:t.id,ref:t.id.toString(),msg:t,multiMedia:!0,selectable:e.props.selectable,selectedMessages:a,onMessageSelect:e.props.onMessageSelect,onClickMsg:e.onClickMsg})});if(n.reverse(),t.queryDocBefore){if(0===n.length)return C.createElement(w.Loading,null);n.push(C.createElement("div",{className:"more",key:"spinner"},C.createElement(S["default"],{stroke:6,size:24})))}return 0!==t.length||t.queryDocBefore||t.hasDocBefore?C.createElement("div",{onScroll:this.onScroll,className:"doc-gallery"},n):C.createElement(w.DocMsgs,null)}}]),t}(C.Component));e.exports=(0,m["default"])(N)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(62),o=n(i),r=a(98),s=n(r),l=a(161),u=n(l),c=a(5),d=a(21),f=function(e){var t=e.className,a=e.children,n=(0,s["default"])(e,["className","children"]),i=d("doc-state",t);return c.createElement("div",(0,o["default"])({className:i},n),a)},p=function(e){var t=e.onClick;return c.createElement(f,{onClick:t||_.noop},c.createElement("span",{className:"icon doc-state-icon icon-audio-download"}))},h=function(){return c.createElement(f,null,c.createElement(u["default"],{stroke:3,size:32}))},m=function(){return c.createElement(f,null,c.createElement("span",{className:"icon doc-state-icon icon-audio-cancel-noborder"},c.createElement(u["default"],{stroke:3,size:32})))},v=function(){return c.createElement(f,null,c.createElement("span",{className:"icon doc-state-icon icon-audio-upload"}))};e.exports={Download:p,Pending:h,PendingCancel:m,Upload:v}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r,s=a(162),l=n(s),u=a(6),c=n(u),d=a(3),f=n(d),p=a(4),h=n(p),m=a(8),v=n(m),g=a(7),_=n(g),y=a(5),E=n(y),M=a(46),S=n(M),C=a(246),b=n(C),k=a(21),T=n(k),w=a(78),N=n(w);t["default"]=(0,N["default"])((o=i=function(e){function t(e){(0,f["default"])(this,t);var a=(0,v["default"])(this,(t.__proto__||(0,c["default"])(t)).call(this,e));r.call(a);var n=a.props.start?a.props.start.x:0,i=a.props.start?a.props.start.y:0;return a.state={height:0,width:0,dragging:!1,x:n,y:i,scaledPadding:a.props.scale*a.props.padding,offsetX:0,offsetY:0,center:void 0},a}return(0,_["default"])(t,e),(0,h["default"])(t,[{key:"componentDidMount",value:function(){this.updateContainer()}},{key:"componentWillReceiveProps",value:function(e){e.scale!==this.props.scale||e.container.width!==this.props.container.width||e.container.height!==this.props.container.height?this.updateContainer(e,!0):this.updateContainer(e)}},{key:"render",value:function(){var e,t=this.props.scale?" scale("+this.props.scale+")":"",a=(e={},(0,l["default"])(e,b["default"].prefix("transform"),"translate("+this.state.x+"px, "+this.state.y+"px)"+t),(0,l["default"])(e,"padding",this.props.padding+"px"),e);this.state.dragging||(a[b["default"].prefix("transition")]="transform 200ms");var n=(0,T["default"])("draggable",{dragging:this.state.dragging});return E["default"].cloneElement(E["default"].Children.only(this.props.children),{style:a,draggable:!0,ref:"draggable",className:n,onMouseDown:this.handleMouseDown})}}]),t}(E["default"].Component),r=function(){var e=this;this.updateContainer=function(t,a){t=t||e.props;var n=t.container;if(n&&e.refs.draggable){var i=S["default"].findDOMNode(e.refs.draggable),o=i&&0===i.width&&t.childSize?t.childSize.width:i.width,r=i&&0===i.height&&t.childSize?t.childSize.height:i.height,s=n.x?n.x:0,l=n.y?n.y:0,u=e.state.x,c=e.state.y,d=o*t.scale,f=r*t.scale,p=t.padding*t.scale,h=void 0;e.props.scale!==t.scale&&e.state.center?(h=e.state.center,u=n.width/2+s-h.x*d,c=n.height/2+l-h.y*f):h={x:(n.width/2+s-u)/d,y:(n.height/2+l-c)/f},u+p>s?u=s-p:u+d+p<s+n.width&&(u=s+n.width-d-p),c+p>l?c=l-p:c+f+p<l+n.height&&(c=l+n.height-f-p),e.setState({width:d,height:f,x:u,y:c,scaledPadding:p,center:h}),e.props.onStop&&a&&t.onStop(u,c)}},this.handleMouseDown=function(t){t.preventDefault(),e.setState({dragging:!0,offsetX:t.clientX-e.state.x,offsetY:t.clientY-e.state.y}),e.props.listeners.add(window,"mousemove",e.handleMouseMove),e.props.listeners.add(window,"mouseup",e.handleMouseUp),e.props.onStart&&e.props.onStart()},this.handleMouseUp=function(t){e.props.listeners.remove(window,"mousemove",e.handleMouseMove),e.props.listeners.remove(window,"mouseup",e.handleMouseUp),e.setState({dragging:!1}),e.props.onStop&&e.props.onStop(e.state.x,e.state.y)},this.handleMouseMove=function(t){if(e.state.dragging){var a=t.clientX-e.state.offsetX,n=t.clientY-e.state.offsetY,i=e.props.container,o=i.x?i.x:0,r=i.y?i.y:0,s=e.state.scaledPadding;i&&((a+s>o||a+e.state.width+s<o+i.width)&&(a=e.state.x),(n+s>r||n+e.state.height+s<r+i.height)&&(n=e.state.y)),e.setState({x:a,y:n}),e.props.onDrag&&e.props.onDrag(a,n)}}},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(477),g=n(v),_=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={isBusy:g["default"].isBusy()},n.onIdle=function(){n.setState({isBusy:!1})},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.idleTaskId=g["default"].enqueue(this.onIdle)}},{key:"componentWillReceiveProps",value:function(e){if(this.props.id!==e.id){this.state.isBusy&&g["default"].dequeue(this.idleTaskId);var t=g["default"].isBusy();t&&(this.idleTaskId=g["default"].enqueue(this.onIdle)),this.setState({isBusy:t})}}},{key:"componentWillUnmount",value:function(){g["default"].dequeue(this.idleTaskId)}},{key:"render",value:function(){var e=this.props,t=e.children,a=e.onComplex,n=this.state.isBusy;return n?t:a()}}]),t}(m["default"].Component);t["default"]=_},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(13),m=n(h),v=a(14),g=n(v),_=a(1426),y=n(_),E=a(95),M=n(E),S=a(116),C=n(S),b=a(1),k=n(b),T=a(5),w=n(T),N=a(1411),P=n(N),A=a(161),O=n(A),R=a(117),D=n(R),x=a(463),I=n(x),L=a(21),F=n(L),U=3,j=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.selection=new P["default"](n.props.thumbnails,function(e){return e.id}),n.handleMouseDown=function(e){e.preventDefault(),e.stopPropagation()},n.handleClick=function(e){var t=e.target;n.props.onImageClick&&1===t.nodeType&&"IMG"===t.tagName&&n.props.onImageClick(t.src)},n.handleEnter=function(e){var t=n.selection.getVal();k["default"].assert(t,"No value selected, but enter clicked")(),n.props.onImageClick&&n.props.onImageClick(t.thumbUrl)},n._requestMoreImagesIfNeeded=function(){var e=n.refs.body;n.props.isLoadingMore||n.props.canLoadMore&&n.props.onRequestMoreImages&&e.scrollTop+g["default"].SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&n.props.onRequestMoreImages()},n.handleScroll=n.props.throttle(n._requestMoreImagesIfNeeded,100),n.selectPrev=function(e){e.preventDefault(),e.stopPropagation(),n.selection.setPrev(!1),n._updateSelected(!0)},n.selectNext=function(e){e.preventDefault(),e.stopPropagation(),n.selection.setNext(!1),n._updateSelected(!0)},n.selectPrevRow=function(e){if(e.preventDefault(),e.stopPropagation(),0===n.selection.index&&n.props.onFocusPrev)n.props.onFocusPrev();else{var t=Math.max(n.selection.index-U,0);n.selection.set(t,!1,!1),n._updateSelected(!0)}},n.selectNextRow=function(e){e.preventDefault(),e.stopPropagation(),n.selection.set(n.selection.index+U,!1,!1),n._updateSelected(!0)},n.handleFocus=function(e){e.stopPropagation(),e.preventDefault(),(m["default"].isNil(n.selection.index)||n.selection.index<0)&&n.selection.setFirst(!1),n._updateSelected(),n._indicateFocus()},n.handleRequestDismiss=function(){n.selection.unset(),n.setState({selectedImage:void 0})},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this._updateSelected()}},{key:"componentDidUpdate",value:function(){this._requestMoreImagesIfNeeded(),this.selection.init(this.props.thumbnails,!1,!1),this._updateSelected()}},{key:"_updateSelected",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!1;if(this.setState({selectedImage:this.selection.getVal()}),this.selection.index>-1){var t=this.refs[""+this.selection.index];M["default"].focus(t),e&&y["default"].scrollIntoViewIfNeeded(t,!1)}}},{key:"_indicateFocus",value:function(){if(!(Date.now()-(C["default"].flashFocus||0)>200)){var e=m["default"].head(this.refs[""+this.selection.index].getElementsByClassName("image-gallery-item-overlay"));(0,I["default"])(e,"stop"),(0,I["default"])(e,{backgroundColorAlpha:[0,.5]},{duration:1300,easing:[.19,.69,.01,.99]})}}},{key:"render",value:function(){var e=this,t={down:this.selectNextRow,enter:this.handleEnter,left:this.selectPrev,right:this.selectNext,up:this.selectPrevRow},a=m["default"].map(this.props.thumbnails,function(t,a){var n=t.id,i=t.thumbUrl,o=e.state.selectedImage?e.state.selectedImage.id===n:!1,r=(0,F["default"])("image-gallery-item",{selected:o}),s=w["default"].createElement("div",{className:"image-gallery-item-overlay"});return w["default"].createElement("div",{key:n,ref:a,className:r,tabIndex:-1},s,w["default"].createElement("img",{onClick:e.handleClick,className:"image-gallery-item-image",src:i}))}),n=this.props.isLoadingMore?w["default"].createElement("div",{tabIndex:-1,className:"image-gallery-footer"},w["default"].createElement(O["default"],{stroke:6,size:24})):null;return w["default"].createElement(C["default"],{className:(0,F["default"])("image-gallery",this.props.classes),"data-tab":3,handlers:t,onFocus:this.handleFocus,onMouseDown:this.handleMouseDown},w["default"].createElement("div",{ref:"body",className:"image-gallery-list",onScroll:this.handleScroll},a,w["default"].createElement("div",{tabIndex:-1,className:"image-gallery-item-spacer"}),w["default"].createElement("div",{tabIndex:-1,className:"image-gallery-item-spacer"}),w["default"].createElement("div",{tabIndex:-1,className:"image-gallery-item-spacer"}),n))}}]),t}(w["default"].PureComponent);j.defaultProps={thumbnails:[]};t.Component=j;t["default"]=(0,D["default"])(j)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(98),o=n(i),r=a(5),s=n(r);t["default"]=function(e){var t=e.Component,a=e.children,n=(0,o["default"])(e,["Component","children"]),i=t||"span";return s["default"].createElement(i,n,"â€‹â â€‹",a,"â€‹â â€‹")}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(13),m=n(h),v=a(1404),g=(n(v),a(1522)),_=(n(g),a(12)),y=n(_),E=a(14),M=n(E),S=a(1412),C=n(S),b=a(1565),k=n(b),T=a(78),w=n(T),N=a(462),P=(n(N),a(1416)),A=(n(P),a(161)),O=n(A),R=a(1474),D=n(R),x=a(5),I=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onScroll=function(e){n.handleScroll(e.target)},n.handleScroll=m["default"].throttle(function(e){var t=n.props.linkMsgs;t.hasLinkBefore&&e.scrollTop+M["default"].SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&n.queryLinks(t.head())},100),n.onClickMsg=function(e,t){n.props.selectable&&void 0!==t?n.props.onMessageSelect(e,t):y["default"].openChatAt(e.chat,e.chat.getSearchContext(e))},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.props.linkMsgs.hasLinkBefore&&this.queryLinks()}},{key:"componentDidMount",value:function(){this.props.listeners.add(this.props.linkMsgs,"add remove reset"),this.props.listeners.add(this.props.linkMsgs,"query_link_before")}},{key:"componentWillUnmount",value:function(){this.handleScroll.cancel()}},{key:"queryLinks",value:function(e){var t=this,a=this.props.linkMsgs;a.hasLinkBefore&&this.props.listeners.uiIdle(function(){a.queryLinks(t.props.chat,e)})}},{key:"render",value:function(){var e=this,t=this.props.linkMsgs,a=this.props.selectedMessages,n=[];if(t.forEach(function(t){t.links.forEach(function(i,o){n.push(x.createElement(k["default"],{key:t.id+"-"+o,msg:t,link:i,selectable:e.props.selectable,selectedMessages:a,onMessageSelect:e.props.onMessageSelect,onClickMsg:e.onClickMsg}))}),t.isLink&&n.push(x.createElement(D["default"],{key:t.id,ref:t.id.toString(),msg:t,multiMedia:!0,selectable:e.props.selectable,selectedMessages:a,onMessageSelect:e.props.onMessageSelect,onClickMsg:e.onClickMsg}))}),n.reverse(),t.queryLinkBefore){if(0===n.length)return x.createElement(C["default"].Loading,null);n.push(x.createElement("div",{className:"more",key:"spinner"},x.createElement(O["default"],{stroke:6,size:24})))}return 0!==t.length||t.queryLinkBefore||t.hasLinkBefore?x.createElement("div",{onScroll:this.onScroll,className:"link-gallery"},n):x.createElement(C["default"].LinkMsgs,null)}}]),t}(x.Component);e.exports=(0,w["default"])(I)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(78),g=n(v),_=a(1500),y=n(_),E=a(1428),M=n(E),S=a(1403),C=n(S),b=a(21),k=n(b),T=a(1416),w=(n(T),a(115)),N=n(w),P=a(160),A=n(P),O=a(466);t["default"]=(0,g["default"])(function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));a.mouseOver=function(){a.state.hover||a.setState({hover:!0})},a.mouseEnter=function(){a.state.hover||a.setState({hover:!0})},a.mouseLeave=function(){a.state.hover&&a.setState({hover:!1})},a.onSelectChange=function(e){a.state.selected!==e&&a.setState({selected:e})},a.onSelectClick=function(e){e&&e.stopPropagation(),a.props.onMessageSelect(a.props.msg,!a.state.selected)},a.onClick=function(){a.props.onClickMsg(a.props.msg,!a.state.selected)};var n=e.msg,i=e.selectedMessages;return a.state={hover:!1,selected:i?i.isSelected(n):!1},a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){this.props.selectedMessages&&this.props.listeners.add(this.props.selectedMessages,this.props.msg.id.toString(),this.onSelectChange)}},{key:"render",value:function(){var e=this.props,t=e.msg,a=e.link,n=this.props.selectable||this.state.hover?m["default"].createElement("div",{className:"msg-select",onClick:this.onSelectClick},m["default"].createElement(M["default"],{onChange:this.onSelectClick,checked:this.state.selected})):null,i={wrapper:(0,k["default"])("starred-msg-wrapper",{hover:this.state.hover}),linkContainer:(0,k["default"])("message tail-override-left",{"message-out":t.isSentByMe,"message-in":!t.isSentByMe})},o=t.isTrusted?O.Configuration.TrustedConversation:O.Configuration.UntrustedConversation;return m["default"].createElement("div",{className:i.wrapper,onClick:this.onClick,onMouseEnter:this.state.hover?null:this.mouseEnter,onMouseOver:this.state.hover?null:this.mouseOver,
onMouseLeave:this.state.hover?this.mouseLeave:null},m["default"].createElement("div",{className:"msg"},m["default"].createElement(N["default"],{transitionName:"delay-leave"},n),m["default"].createElement("div",{className:i.linkContainer},m["default"].createElement("span",{className:"tail-container"}),m["default"].createElement("div",{className:"bubble message-text"},m["default"].createElement(y["default"],{title:a.url,canonicalUrl:a.domain}),m["default"].createElement(C["default"],{text:t.body,selectable:!0,dirMismatch:t.rtl!==A["default"].isRTL(),direction:t.dir,formatters:o(t.mentionMap())})))))}}]),t}(m["default"].Component))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(3),o=n(i),r=a(4),s=n(r),l=function(){function e(t,a){(0,o["default"])(this,e),this.row=t,this.section=a}return(0,s["default"])(e,null,[{key:"indexPathIterator",value:function(t,a,n){function i(){if(h){var t=h;return h=void 0,t}var a=r(f)-1;return a>p&&f<d.section||p<d.row&&f===d.section?new e(++p,f):f<d.section?(p=0,new e(p,++f)):void 0}function o(){if(h){var t=h;return h=void 0,t}return p>0&&f>c.section||p>0&&f===c.section?new e(--p,f):f>c.section?(p=r(--f)-1,new e(p,f)):void 0}var r=t.numberOfRowsInSection,s=t.numberOfSections,l=s()-1,u=r(l)-1,c=a?a:new e(0,0),d=n?n:new e(u,l);if(c.row<0||c.section<0)throw new Error("Invalid iterator range.");if(d.section>l||d.row>r(d.section))throw new Error("Invalid iterator range.");if(c.gt(d))throw new Error("Invalid iterator range.");var f=c.section,p=c.row,h=c;return{next:i,prev:o}}}]),(0,s["default"])(e,[{key:"lt",value:function(e){return this.section<e.section||this.section===e.section&&this.row<e.row}},{key:"gt",value:function(e){return this.section>e.section||this.section===e.section&&this.row>e.row}},{key:"equals",value:function(e){return this.row===e.row&&this.section===e.section}}]),e}();t["default"]=l},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(162),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(46),y=n(_),E=a(246),M=n(E),S=a(21),C=n(S),b=a(463),k=n(b),T=200,w=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(r))),n.dirtiedShadowDOM=!1,n.isAnimating=!1,i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props.dataKey!==e.dataKey||this.props.rowHeight!==e.rowHeight;return t||this.props.rowOffset===e.rowOffset?t&&this.isAnimating&&(0,k["default"])(y["default"].findDOMNode(this),"stop"):this.animate(e),t}},{key:"componentDidUpdate",value:function(e){this.animate(this.props),this.dirtiedShadowDOM=!1}},{key:"animate",value:function(e){var t=this,a=e.rowOffset,n=e.prevRowOffset,i=e.zIndex;return"number"!=typeof n?!1:(this.dirtiedShadowDOM=!0,this.isAnimating=!0,(0,k["default"])(y["default"].findDOMNode(this),{translateY:[a,n],zIndex:[i,i]},{easing:"easeInOut",duration:T}).then(function(){t.isAnimating=!1}),!0)}},{key:"render",value:function(){var e=this.props,t=e.children,a=e.rowHeight,n=e.rowOffset,i=e.zIndex,r=e.className,s=this.dirtiedShadowDOM?"translateY("+n+"px)":"translate3d(0, "+n+"px, 0)",l=(0,o["default"])({zIndex:i,height:a},M["default"].prefix("transform"),s),u=(0,C["default"])(r,"infinite-list-item","infinite-list-item-transition");return g["default"].createElement("div",{className:u,style:l},t)}}]),t}(g["default"].Component);t["default"]=w},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(162),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=a(246),_=a(21),y=function(e){function t(e){(0,u["default"])(this,t);var a=(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this,e));return a.state={rendered:!1},a}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentDidMount",value:function(){this.setState({rendered:!0})}},{key:"render",value:function(){var e=this.props,t=e.children,a=e.rowNumber,n=e.rowHeight,i=e.zIndex,r=e.className,s=(0,o["default"])({zIndex:i,height:n},g.prefix("transform"),"translate3d(0, "+n*a+"px, 0)");return r=_(r,{"infinite-list-item":!0,"infinite-list-item-keyframe":!this.state.rendered,"infinite-list-item-transition":!0}),v.createElement("div",{className:r,style:s},t)}}]),t}(v.Component);e.exports=y},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(1404),y=(n(_),a(1415)),E=n(y),M=a(1402),S=n(M);t["default"]=(0,S["default"])((o=i=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props.chat,t=this.props.onMarkUnread.bind(null,!e.unreadCount);return g["default"].createElement(E["default"],{a8n:"mi-mark-as",action:t,shortcut:"r",key:"MarkUnreadMenuItem"},e.unreadCount?l10n.t("mark_read_chat"):l10n.t("mark_unread_chat"))}}]),t}(g["default"].PureComponent),i.CONCERNS={chat:["unreadCount"]},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(14),g=n(v),_=a(1560),y=n(_),E=a(244),M=n(E),S=a(250),C=n(S),b=a(1),k=n(b),T=a(5),w=n(T),N=a(115),P=n(N),A=a(21),O=n(A),R=336,D=1.1,x=2,I=82,L=12.5,F=350,U=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(r))),n.state={img:n.props.img,left:I,minScale:1,scale:1,top:L},n.handleZoomIn=function(){var e=n.state.scale*D;e>=x||n.setState({scale:e})},n.handleZoomOut=function(){var e=n.state.scale/D;n.state.minScale>=e&&(e=n.state.minScale),n.setState({scale:e})},n.handleMouseWheel=function(e){e.deltaY<-4?n.handleZoomOut():e.deltaY>4&&n.handleZoomIn()},n.handleStop=function(e,t){e+=n.state.scale*F,t+=n.state.scale*F,n.setState({left:e,top:t})},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){this.setImage(this.props.img)}},{key:"componentWillReceiveProps",value:function(e){return!this.props.doneEditing&&e.doneEditing?void this.onCrop():void(this.props.img!==e.img&&this.setImage(e.img))}},{key:"setImage",value:function(e){var t=this;M["default"].rotateAndResize(e,3*g["default"].IMG_MAX_EDGE,M["default"].DATA_URL|M["default"].CANVAS).then(function(e){var a=e.width,n=e.height,i=e.images;C["default"].loadImage(i.dataUrl).then(function(e){var i=R/Math.min(a,n),o=t.getInitialPadding(i,a,n),r=0>x-(i+o)?x:i+o,s=t.getStart(r,e.width,e.height),l=s.x+r*F,u=s.y+r*F;t.setState({scale:r,minScale:i,start:s,left:l,top:u,img:e.src,imageSize:{width:e.width,height:e.height}})})["catch"](function(e){k["default"].error("PhotoEditor:loadImage failed to load image: "+e)()})})["catch"](function(e){k["default"].error("PhotoEditor:setImage failed to load image: "+e)()})}},{key:"getInitialPadding",value:function(e,t,a){var n=(R+2*I)/t,i=(R+2*L)/a;return Math.max(n,i)-e}},{key:"cropImage",value:function(){var e=this;if(!this.state.img)return o["default"].reject("Image missing from state");var t=this.state.img,a=this.getOffset(),n=this.state.scale,i=Math.abs((this.state.left-a.x)/n),r=Math.abs((this.state.top-a.y)/n),s=R/n,l=s;s>g["default"].MAX_PIC_SIDE?l=g["default"].MAX_PIC_SIDE:s<g["default"].MIN_PIC_SIDE&&(l=g["default"].MIN_PIC_SIDE);var u=void 0;return this.promise=new o["default"](function(a,n){M["default"].crop(t,i,r,s,s,l,l,M["default"].DATA_URL|M["default"].CANVAS).then(function(e){var t=e.images;return u=t.dataUrl,M["default"].crop(t.canvas,0,0,g["default"].PROF_PIC_THUMB_SIDE,g["default"].PROF_PIC_THUMB_SIDE,M["default"].DATA_URL)}).then(function(e){var t=e.images;a({thumb:t.dataUrl,full:u})})["catch"](n)["finally"](function(){e.promise=null})}),this.promise}},{key:"onCrop",value:function(){var e=this;this.promise||this.cropImage().then(function(t){e.props.onImageSet(t.thumb,t.full)})["catch"](function(){e.setState({img:e.props.img})})}},{key:"getStart",value:function(e,t,a){var n=this.getOffset(),i=(t*e-R)/2,o=(a*e-R)/2,r=n.x-F*e-i,s=n.y-F*e-o;return{x:r,y:s}}},{key:"getOffset",value:function(){var e=I,t=L;return this.props.size&&(e=this.props.size.width/2-R/2,t=this.props.size.height/2-R/2),{x:e,y:t}}},{key:"render",value:function(){var e=this.getOffset(),t={width:R,height:R,x:e.x,y:e.y},a=void 0;this.state.img&&this.state.imageSize&&this.state.start&&(a=w["default"].createElement(y["default"],{container:t,onStop:this.handleStop,start:this.state.start,scale:this.state.scale,padding:F,childSize:this.state.imageSize},w["default"].createElement("img",{className:"avatar-original",src:this.state.img})));var n=w["default"].createElement("div",{className:"avatar-picker-controls",key:"zoom-controls"},w["default"].createElement("button",{className:"icon icon-plus",onClick:this.handleZoomIn}),w["default"].createElement("button",{className:"icon icon-minus",onClick:this.handleZoomOut})),i=(0,O["default"])("avatar-picker-editor",this.props.className);return w["default"].createElement("div",{className:i,onWheel:this.handleMouseWheel},w["default"].createElement("div",{className:"avatar-editor",dir:"ltr"},w["default"].createElement("div",{className:"avatar-editor-body"},a)),w["default"].createElement("svg",{className:"svg-overlay",style:{position:"absolute"}},w["default"].createElement("defs",null,w["default"].createElement("mask",{id:"mask",x:0,y:0,width:this.props.size.width,height:this.props.size.height,style:{position:"absolute"}},w["default"].createElement("rect",{x:0,y:0,width:this.props.size.width,height:this.props.size.height,fill:"rgba(255, 255, 255, 0.7)"}),w["default"].createElement("circle",{cx:this.props.size.width/2,cy:this.props.size.height/2,r:R/2,style:{position:"absolute"}}))),w["default"].createElement("rect",{x:0,y:0,width:this.props.size.width,height:this.props.size.height,mask:"url(#mask)",fillOpacity:.7,style:{position:"absolute"}})),w["default"].createElement(P["default"],{transitionName:"fade",style:{left:this.state.left,top:this.state.top}},n))}}]),t}(w["default"].Component);t["default"]=U},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1404),g=(n(v),a(1402)),_=n(g),y=a(1415),E=n(y),M=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.pin=function(){var e=n.props,t=e.chat,a=e.onPinOrUnpin;a(!t.pin)},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props.chat;return m["default"].createElement(E["default"],{a8n:"mi-pin",action:this.pin,shortcut:"p",key:"PinChat"},e.pin?l10n.t("unpin_chat"):l10n.t("pin_chat"))}}]),t}(m["default"].PureComponent);M.CONCERNS={chat:["pin"]},t["default"]=(0,_["default"])(M)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return function(a){e.some(function(e){var n=(0,r["default"])(e,2),i=n[0],o=n[1],s=o.call(i,a,t);return a.defaultPrevented?!0:s===!0?(a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),!0):!1})}}var o=a(16),r=n(o),s=a(24),l=n(s);e.exports=function(e,t){var a=e.reduce(function(e,t){var a=t.handlers;return a?((0,l["default"])(a).forEach(function(n){e[n]||(e[n]=[]),e[n].push([t,a[n]])}),e):e},{});return(0,l["default"])(a).reduce(function(e,n){return e[n]=i(a[n],t),e},{})}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return function(){for(var a=arguments.length,n=Array(a),i=0;a>i;i++)n[i]=arguments[i];e.forEach(function(e){var a=(0,r["default"])(e,2),i=a[0],o=a[1];return o.call.apply(o,[i].concat(n,[t]))})}}var o=a(16),r=n(o),s=a(24),l=n(s);e.exports=function(e,t){var a=e.reduce(function(e,t){var a=t.hooks;return a?((0,l["default"])(a).forEach(function(n){e[n]||(e[n]=[]),e[n].push([t,a[n]])}),e):e},{});return(0,l["default"])(a).reduce(function(e,n){return e[n]=i(a[n],t),e},{})}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return function(a){e.some(function(e){var n=(0,r["default"])(e,2),i=n[0],o=n[1],s=o.call(i,a,t);return a.defaultPrevented?!0:s===!0?(a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),!0):!1})}}var o=a(16),r=n(o),s=a(24),l=n(s);e.exports=function(e,t){var a=e.reduce(function(e,t){var a=t.hotkeys;return a?((0,l["default"])(a).forEach(function(n){e[n]||(e[n]=[]),e[n].push([t,a[n]])}),e):e},{});return(0,l["default"])(a).reduce(function(e,n){return e[n]=i(a[n],t),e},{})}},function(e,t){"use strict";function a(e){return e.metaKey||e.shiftKey||e.altKey||e.ctrlKey}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return e.msMatchesSelector?e.msMatchesSelector(t):e.webkitMatchesSelector?e.webkitMatchesSelector(t):e.matches(t)}function o(e,t){for(var a=0;a<t.length;++a){var n=t[a].serializers;if(n)for(var o=0;o<n.length;++o){var r=(0,l["default"])(n[o],2),s=r[0],u=r[1];if(i(e,s))return u}}return null}function r(e,t){for(var a=[],n=e.cloneNode(!0),i=n.firstChild;i;){switch(i.nodeType){case 1:var r=o(i,t);if(r){a.push(r(i));break}switch(i.tagName){case"P":case"BR":case"PRE":case"DIV":a.push("\n")}case 3:a.push(i.nodeValue)}if(i.hasChildNodes())i=i.firstChild;else{for(;i&&!i.nextSibling;)if(i=i.parentNode,i===e){i=null;break}i&&(i=i.nextSibling)}}return a.join("")}var s=a(16),l=n(s);e.exports=r},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return t.reduce(function(e,t){var a=t.parsers;return a?a.reduce(function(e,t){return t(e)},e):e},r["default"].escape(e))}var o=a(13),r=n(o);e.exports=i},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(62),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=function(e,t){var a,n;return n=a=function(a){function n(){return(0,u["default"])(this,n),(0,p["default"])(this,(n.__proto__||(0,s["default"])(n)).apply(this,arguments))}return(0,m["default"])(n,a),(0,d["default"])(n,[{key:"render",value:function(){return v.createElement(e,(0,o["default"])({},this.props,t))}}]),n}(v.Component),a.displayName="Wrapper("+(e.displayName||e.name)+")",n};e.exports=g},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(6),o=n(i),r=a(3),s=n(r),l=a(8),u=n(l),c=a(7),d=n(c),f=a(1581),p=n(f),h=a(1586),m=n(h),v=a(1580),g=n(v),_=a(1589),y=n(_),E=a(1588),M=n(E),S=a(1578),C=n(S),b=function(e){function t(){return(0,s["default"])(this,t),(0,u["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,d["default"])(t,e),t}((0,g["default"])([p["default"],m["default"],y["default"]]));b.Suggestions=(0,C["default"])(M["default"],{plugin:m["default"]}),e.exports=b},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return{handlers:o(e,B)}}function o(e,t){return t.reduce(function(t,a){return Array.isArray(a)?t[a[0]]=e[a[1]]:t[a]=e[a],t},{})}function r(e){return e.which===U&&(e.getModifierState("Shift")||e.getModifierState("Alt")||e.getModifierState("Control"))}function s(e,t,a){var n={};return a.forEach(function(a){return n[a]=e[a]!==t[a]}),n}var l=a(81),u=n(l),c=a(62),d=n(c),f=a(16),p=n(f),h=a(6),m=n(h),v=a(3),g=n(v),_=a(4),y=n(_),E=a(8),M=n(E),S=a(7),C=n(S),b=a(116),k=n(b),T=a(1467),w=a(1447),N=a(95),P=a(1468),A=a(5),O=a(1572),R=a(1573),D=a(1574),x=a(21),I=a(1576),L=a(479),F=a(1577),U=13,j=function(e){function t(){var e,a,n,i;(0,g["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,M["default"])(this,(e=t.__proto__||(0,m["default"])(t)).call.apply(e,[this].concat(r))),G.call(n),i=a,(0,M["default"])(n,i)}return(0,C["default"])(t,e),(0,y["default"])(t,[{key:"serialize",value:function(){return this.plugins.reduce(function(e,t){var a=(0,p["default"])(e,2),n=a[0],i=a[1];return t.serialize?t.serialize(n,i):[n,i]},[this.state.value,{}])}},{key:"replaceSelection",value:function(e){if(!this.props.readOnly){var t=this.refs.input;this._hasFocus(t)||(N.focus(t),this.selection&&this.restoreSelection(this.selection));var a=this.trimToFit(e);if(a.length){this.props.multiline||(a=a.replace(/\r?\n/g,"")),window.getSelection().getRangeAt(0).deleteContents();var n=t.scrollTop,i=t.scrollHeight;document.execCommand("insertHTML",!1,F(a,this.plugins)),this.onSelect();var o=t.scrollHeight,r=t.clientHeight;r>=o||(t.scrollTop=(n||0)+(o-i))}}}},{key:"restoreSelection",value:function(e){var t=this.refs.input;if(t){var a=e.anchorIndex,n=e.focusIndex,i=e.anchorOffset,o=e.focusOffset,r=t.childNodes,s=-1===a?t:r[a],l=-1===n?t:r[n];if(s&&l)try{if(s===l&&i>o){var u=[o,i];i=u[0],o=u[1]}var c=document.createRange();c.setStart(s,i),c.setEnd(l,o);var d=window.getSelection();d.removeAllRanges(),d.addRange(c);try{var f=document.createRange();f.setStart(l,o),f.setEnd(l,o);var p=f.getBoundingClientRect(),h=p.bottom,m=p.top,v=this.refs.input.getBoundingClientRect(),g=v.bottom,_=v.top;if(m>=_&&g>=h)return;this.refs.input.scrollTop+=_>h?m-_:h-g}catch(y){}}catch(y){this.focus(!0)}}}},{key:"getSelection",value:function(){var e=this.refs.input;if(!e||document.activeElement!==e)return null;for(var t=window.getSelection(),a=t.anchorNode,n=t.anchorOffset,i=t.focusNode,o=t.focusOffset,r=e.childNodes,s=-1,l=-1,u=0,c=void 0;(0>s||0>l)&&(c=r[u++]);)a===c&&(s=u-1),i===c&&(l=u-1);return{anchorIndex:s,anchorOffset:n,focusIndex:l,focusOffset:o}}},{key:"trimToFit",value:function(e){var t=this.props.maxLength;if(!t)return e;var a=this.selectionLength,n=this.length,i=t+a-n;if(0>=i)return"";var o=L(String(e));return o.slice(0,i).join("")}},{key:"render",value:function(){var e=this.props.placeholder,t=this.state.value,a=t.length?"hidden":"visible",n=F(t,this.plugins);return A.createElement(k["default"],{className:"input-emoji",handlers:this.hotKeyMap},A.createElement("div",{className:"input-placeholder",ref:"placeholder",style:{visibility:a}},e),A.createElement("div",(0,d["default"])({},this.handlerMap,{className:x(this.props.className),contentEditable:!this.props.readOnly,dangerouslySetInnerHTML:{__html:n},"data-tab":this.props.readOnly?null:1,dir:"auto",ref:"input",spellCheck:this.props.spellCheck})))}},{key:"value",get:function(){return this.state.value}},{key:"selectionLength",get:function(){if(this.props.readOnly)return 0;var e=this.refs.input;this._hasFocus(e)||N.focus(e);var t=window.getSelection();return t.rangeCount?L(I(t.getRangeAt(0).cloneContents(),this.plugins)).length:0}},{key:"length",get:function(){return L(this.state.value).length}},{key:"isComposing",get:function(){return this.__isComposing}}]),t}(A.Component),G=function(){var e=this;this.__changeDueToReset=!1,this.__isMounted=!0,this.__isComposing=!1,this.selection=this.props.initialSelection,this.state={value:this.props.initialValue||""},this.trigger=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e.hookMap[t];n&&n.apply(void 0,(0,u["default"])(a))},this.serializeNode=function(t){return I(t,e.plugins)},this._hasFocus=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.refs.input;if(!t)return!1;var a=document,n=a.activeElement;return n?n===t||t.contains(n):!1},this.forceFocus=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!1;if(!e.props.readOnly&&e.__isMounted){var a=e.refs.input;if(a){var n=e._hasFocus(a);if(!n||t)if(n||N.focus(a),!t&&e.selection)e.restoreSelection(e.selection);else{var i=window.getSelection();i&&i.rangeCount&&(i.selectAllChildren(a),i.collapseToEnd())}}}},this.focus=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!1;return setTimeout(function(){e.forceFocus(t)},0)},this.reset=function(){e.__changeDueToReset=!0,e.selection=null,e.setState({value:""})},this.onSelect=function(){e.selection=e.getSelection(),e.props.onSelect&&e.props.onSelect(e.selection)},this.shouldComponentUpdate=function(t,a){var n=a.value,i=!n.length&&!!e.state.value.length,o=!!n.length&&!e.state.value.length;if(!o&&!i)return!1;var r=o?"hidden":"visible";return e.refs.placeholder&&e.refs.placeholder.setAttribute("style","visibility: "+r),i&&(e.refs.input.innerHTML=""),e.__changeDueToReset&&(e.__changeDueToReset=!1,e.refs.input&&(e.refs.input.innerHTML=F(n,e.plugins))),!1},this.componentWillReceiveProps=function(t){var a=s(e.props,t,["readOnly"]);a.readOnly&&e.refs.input.setAttribute("contentEditable",String(!t.readOnly))},this.componentWillUnmount=function(){e.__isMounted=!1,e.refs.input.restoreFocus=null},this.onInput=function(t){var a=I(e.refs.input,e.plugins),n="\n"===a?"":a,i=e.props.maxLength;if(i>0&&L(n).length>i){var o=e.selection;return e.refs.input.innerHTML=F(e.state.value,e.plugins),void(o&&e.restoreSelection(o))}e.setState({value:n},function(){e.trigger(P.CHANGE,[n]),e.props.onChange&&e.props.onChange(n)})},this.onPaste=function(t){t.preventDefault();var a=new w(t.clipboardData),n=e.props,i=n.onFiles,o=n.onTextPaste;a.hasFiles()&&i&&i(a)||a.hasText()&&a.getText().then(function(t){if(t&&(!o||!o(t))){if(L(t).length>e.props.maxLength){var a=e.props.onMaxPasteExceeded;return a&&a()}e.replaceSelection(t)}})},this.onBeforeInput=function(t){if(e.props.readOnly)return!0;var a=e.props.maxLength;if(!a)return!1;var n=t.data.charCodeAt(0);if(8===n||127===n)return!1;var i=e.selectionLength,o=e.length,r=a+i-o;return L(t.data).length>r},this.onKeyDown=function(t){return e.props.onKeyDown&&e.props.onKeyDown(t)?!0:t.which!==U?!1:e.props.multiline&&r(t)?!1:(e.props.onEnter&&e.props.onEnter(t),!0)},this.componentDidMount=function(){e.refs.input.restoreFocus=e.focus,e.trigger(P.MOUNT)},this.onBlur=function(t){return e.props.onBlur&&e.props.onBlur(t)},this.onFocus=function(t){e.props.onFocus&&e.props.onFocus(t)},this.onCompositionStart=function(t){return!(e.__isComposing=!0)},this.onCompositionEnd=function(){return e.__isComposing=!1}};e.exports=function(e){var t=function(t){function a(){var t,n,o,r;(0,g["default"])(this,a);for(var s=arguments.length,l=Array(s),c=0;s>c;c++)l[c]=arguments[c];return n=o=(0,M["default"])(this,(t=a.__proto__||(0,m["default"])(a)).call.apply(t,[this].concat(l))),o.plugins=[].concat((0,u["default"])(e.map(function(e){return e instanceof T&&e.initialize(o),e})),[i(o)]),o.handlerMap=O(o.plugins,o),o.hookMap=R(o.plugins,o),o.hotKeyMap=D(o.plugins,o),r=n,(0,M["default"])(o,r)}return(0,C["default"])(a,t),a}(j);return t};var B=["onBeforeInput","onBlur","onCompositionEnd","onCompositionStart","onFocus","onInput","onKeyDown","onPaste","onSelect"]},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(162),o=n(i),r=a(118),s=r.emojiRegex,l=r.emojiMap,u=a(14),c=u.ONE_BY_ONE_TRANS_GIF,d=a(1468),f=s(),p={serializers:[["img.emoji",function(e){return e.getAttribute("alt")||""}]],parsers:[function(e){return e.replace("ï¸","")},function(e){return e.replace(f,function(e,t){var a=l[t];if(!a)return"";var n=document.createElement("img");return n.setAttribute("alt",t),n.setAttribute("draggable","false"),n.setAttribute("class",r.getClasses(a)),n.setAttribute("src",c),n.outerHTML})}],hooks:(0,o["default"])({},d.MOUNT,function(){document.execCommand("enableObjectResizing",!1,!1)}),handlers:{onBeforeInput:function(e,t){var a=e.data,n=f.exec(a);return n?(t.replaceSelection(n[0]),!0):!1}}};e.exports=p},function(e,t,a){"use strict";var n=a(1452),i=a(1453),o=a(1441),r=i.Direction;e.exports=function(e,t){if(!o(e))return!1;var a=i(t,r.BACKWARD);if(!a||!a.getAttribute("data-mention-jid"))return!1;var s=n(t,a),l=window.getSelection();l.removeAllRanges();var u=document.createRange();return u.setStart(t,s),u.setEnd(t,s),l.addRange(u),!0}},function(e,t,a){"use strict";var n=a(1452),i=a(1453),o=a(1441),r=i.Direction;e.exports=function(e,t){if(!o(e))return!1;var a=i(t,r.FORWARD);if(!a||!a.getAttribute("data-mention-jid"))return!1;var s=n(t,a),l=window.getSelection();l.removeAllRanges();var u=document.createRange();return u.setStart(t,s+1),u.setEnd(t,s+1),l.addRange(u),!0}},function(e,t,a){"use strict";var n=a(1452),i=a(1453),o=a(1441),r=i.Direction,s=a(37),l=s.isGecko;e.exports=function(e,t){if(!l||!o(e))return!1;var a=i(t,r.BACKWARD);if(!a||!a.getAttribute("data-mention-jid"))return!1;var s=n(t,a),u=window.getSelection();u.removeAllRanges();var c=document.createRange();return c.setStart(t,s),c.setEnd(t,s+1),u.addRange(c),!0}},function(e,t,a){"use strict";var n=a(1452),i=a(1453),o=a(1441),r=i.Direction;e.exports=function(e,t){if(!o(e))return!1;var a=i(t,r.FORWARD);if(!a||!a.getAttribute("data-mention-jid"))return!1;var s=n(t,a),l=window.getSelection();l.removeAllRanges();var u=document.createRange();return u.setStart(t,s),u.setEnd(t,s+1),l.addRange(u),!0}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(e.hasChildNodes())for(;e.childNodes.length;)e.removeChild(e.childNodes[0])}function o(e,t){if(!e.rangeCount)return null;var a=e.getRangeAt(0);if(!a.collapsed)return null;for(var n=0;5>n;++n)e.modify("extend","backward","word");var i=e.getRangeAt(0).cloneContents(),o=t.serializeNode(i),l=O(F,o).pop();if(!l)return r(e,a);r(e,a);for(var u=l[0].length;u--;)e.modify("extend","backward","character");var c=b.findDOMNode(t.refs.input),d=c.querySelectorAll("span[data-mention-jid]");return s(e,d)?r(e,a):{original:a,range:e.getRangeAt(0),match:l}}function r(e,t){e.removeAllRanges(),e.addRange(t)}function s(e,t){var a=t.length;if(!a)return 0;for(var n=0,i=0;a>i;++i)e.containsNode(t[i],!0)&&++n;return n}var l=a(162),u=n(l),c=a(6),d=n(c),f=a(3),p=n(f),h=a(4),m=n(h),v=a(8),g=n(v),_=a(7),y=n(_),E=a(1467),M=a(1497),S=a(61),C=a(1468),b=a(46),k=a(122),T=k.dir,w=a(37),N=w.isGecko,P=w.isTrident,A=a(1727),O=A.matchAll,R=a(1584),D=a(1585),x=a(1583),I=a(1582),L=/\u200B((\d+)@c\.us)\u200B/g,F=/(?:\B|^)@((?:[^\s@]+ ?){1,3}(?:[^\s@]+)?)?$/g,U={Enter:M.ENTER,Tab:M.TAB,ArrowUp:M.UP,ArrowDown:M.DOWN},j=function(e){function t(){var e,a,n,s,l;(0,p["default"])(this,t);for(var c=arguments.length,f=Array(c),h=0;c>h;h++)f[h]=arguments[h];return n=s=(0,g["default"])(this,(e=t.__proto__||(0,d["default"])(t)).call.apply(e,[this].concat(f))),s.serializers=[["span[data-mention-jid]",function(e){return i(e),"â€‹"+(e.getAttribute("data-mention-jid")||"")+"â€‹"}]],s.parsers=[function(e){return e.replace(L,function(e,t,a){var n=window.Store.Contact.get(t);if(!n)return t;var i=!n.isMyContact&&n.notifyName?n.notifyName:n.formattedName,o=document.createElement("span");o.setAttribute("data-mention-jid",n.id);var r=document.createElement("span");r.setAttribute("class","at-symbol"),r.appendChild(document.createTextNode("@"));var s=document.createElement("span");return s.setAttribute("dir",T(i)||"auto"),s.appendChild(document.createTextNode(i)),o.appendChild(r),o.appendChild(s),o.outerHTML})}],s.serialize=function(e,t){t.mentionedJidList=[];var a=e.replace(L,function(e,a,n){return t.mentionedJidList.push(a),"@"+n});return[a,t]},s.hooks=(a={},(0,u["default"])(a,C.CHANGE,function(e,t){var a=t.refs.input;if(N)for(var n=a.querySelectorAll("[data-mention-jid]"),i=0;i<n.length;++i){var o=n[i].nextSibling;o&&o instanceof Element&&"BR"===o.tagName&&"_moz"===o.getAttribute("type")&&o.remove()}}),(0,u["default"])(a,C.MOUNT,function(e){for(var t=e.refs.input,a=t.querySelectorAll("[data-mention-jid]"),n=0;n<a.length;++n)a[n].setAttribute("contenteditable","false")}),a),s.handlers={onKeyDown:function(e,t){if(!this.ctx.isComposing){var a=t.refs.input,n=e.key;if("Backspace"===n&&R(e,a)||"Delete"===n&&D(e,a))return!1;if("ArrowRight"===n&&x(e,a)||"ArrowLeft"===n&&I(e,a))return!0}var i=U[e.key];return i?this.handle(i,[e,t]):!1},onBlur:function(){return this.handle(M.INACTIVE),!1},onSelect:function(e,t){var a=S.supportsFeature(S.F.MENTIONS_OUT);if(P||this.ctx.isComposing||!a)return!1;if(t.value.indexOf("@")<0)return this.handle(M.INACTIVE);var n=window.getSelection(),i=o(n,t);if(!i)return this.handle(M.INACTIVE);var s=i.original,l=i.match;return this.handle(M.SEARCH,[l[1]||""]),r(n,s),!1}},l=n,(0,g["default"])(s,l)}return(0,y["default"])(t,e),(0,m["default"])(t,[{key:"handleSelect",value:function(e,t){if(o(window.getSelection(),this.ctx)){this.ctx.replaceSelection("â€‹"+e.id+"â€‹ "),this.handle(M.INACTIVE);for(var a=this.ctx.refs.input,n=a.querySelectorAll("[data-mention-jid]"),i=0;i<n.length;++i)n[i].setAttribute("contenteditable","false")}}}]),t}(E);e.exports=new j},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(1409),m=n(h),v=a(1403),g=n(v),_=a(5),y=n(_),E=a(466),M=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.className!==e.className||this.props.contact!==e.contact||this.props.term!==e.term}},{key:"render",value:function(){var e=this.props,t=e.className,a=e.contact,n=a.id,i=a.formattedName,o=a.isMyContact,r=a.notifyName,s=e.onMouseDown,l=e.onMouseOver,u=e.onMouseUp,c=e.term,d=E.Configuration.Highlight(c?[c]:[],!0);return y["default"].createElement("div",{className:t,onMouseDown:s,onMouseUp:u,onMouseOver:l},y["default"].createElement(m["default"],{id:n,size:32,className:"mentions-result-image"}),y["default"].createElement("div",{className:"mentions-result-text-contact",dir:"auto"},y["default"].createElement(g["default"],{text:i,formatters:d})),y["default"].createElement("div",{className:"mentions-result-text-pushname",dir:"auto"},!o&&r?y["default"].createElement(g["default"],{text:r,formatters:d,className:"emoji-text"}):null))}}]),t}(y["default"].Component);e.exports=M},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return function(a,n){return t.state.active&&t.state.results.length?a&&(0,E["default"])(a)?!1:(e.call(t,a,n),!0):!1}}function o(e,t){if(t.isMe)return!1;var a=[t.searchName||t.formattedName];return!t.isMyContact&&t.notifyName&&a.push(t.notifyName.toLowerCase()),a.some(function(t){return r(e,t)})}function r(e,t){var a=-1;do if(t.indexOf(e,a+1)===a+1)return!0;while(-1!==(a=t.indexOf(" ",a+1)));return!1}var s=a(6),l=n(s),u=a(3),c=n(u),d=a(4),f=n(d),p=a(8),h=n(p),m=a(7),v=n(m),g=a(13),_=n(g),y=a(1575),E=n(y),M=a(1417),S=n(M),C=a(115),b=n(C),k=a(21),T=a(1497),w=a(5),N=a(46),P=a(1587),A=a(240),O={active:!1,offset:0,omitted:"",query:"",results:[],scrollTop:0},R=52,D=function(e){function t(){var e,a,n,o;(0,c["default"])(this,t);for(var r=arguments.length,s=Array(r),u=0;r>u;u++)s[u]=arguments[u];return a=n=(0,h["default"])(this,(e=t.__proto__||(0,l["default"])(t)).call.apply(e,[this].concat(s))),n.state=O,n.onEnter=i(function(){return n.handleSelect(n.state.offset)},n),n.onInactive=i(function(){return n.setState(O)},n),n.onSearch=function(e){var t=n,a=t.state.omitted;a&&_["default"].startsWith(e,a)||n.props.chat&&n.props.chat.isGroup&&n.setState({active:!0,offset:0,omitted:null,query:e,results:n.getResults(e)})},n.onEscape=function(){n.setState({active:!1,offset:0,omitted:n.state.query,
query:"",results:[]})},n.onUp=i(function(){var e=Math.max(n.state.offset-1,0);n.setOffset(e)},n),n.onDown=i(function(){var e=n.state.results.length-1,t=Math.min(n.state.offset+1,e);n.setOffset(t)},n),o=a,(0,h["default"])(n,o)}return(0,v["default"])(t,e),(0,f["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props.plugin;e.registerHandler(T.ENTER,this.onEnter),e.registerHandler(T.TAB,this.onEnter),e.registerHandler(T.SEARCH,this.onSearch),e.registerHandler(T.INACTIVE,this.onInactive),e.registerHandler(T.UP,this.onUp),e.registerHandler(T.DOWN,this.onDown)}},{key:"componentWillUnmount",value:function(){var e=this.props.plugin;e.unregisterHandler(T.ENTER),e.unregisterHandler(T.TAB),e.unregisterHandler(T.SEARCH),e.unregisterHandler(T.INACTIVE),e.unregisterHandler(T.UP),e.unregisterHandler(T.DOWN)}},{key:"handleSelect",value:function(e){var t=this.state.results[e];if(t&&t.id){var a=this.props.chat.assignedColor(t.id);this.props.plugin.handleSelect(t,a)}}},{key:"getResults",value:function(e){var t=this.props.chat.groupMetadata.participants,a=t.models.map(function(e){var t=e.contact;return t}),n=(e||"").toLowerCase(),i=a.filter(function(e){return o(n,e)});return i}},{key:"setOffset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1,a=e*R,n=a+R,i=N.findDOMNode(this.refs.overflow),o=i.scrollTop,r=o+i.clientHeight,s={offset:e,scrollTop:o};t||(o>a?s.scrollTop=a:n>r&&(s.scrollTop+=n-r)),this.setState(s)}},{key:"renderList",value:function(e,t,a){var n=this;if(!e||!t.length)return null;var i=t.map(function(e,t){return w.createElement(P,{key:e.id,contact:e,term:a,ref:"mention-result-"+t,className:k("mentions-result",{selected:t===n.state.offset}),onMouseDown:function(e){return e.preventDefault()},onMouseUp:function(){return n.handleSelect(t)},onMouseOver:function(){return n.setOffset(t,!0)}})});return w.createElement(A,{displayName:"MentionSuggestions",escapable:!0,requestDismiss:this.onEscape},w.createElement("div",{className:"mentions-overlay-container"},w.createElement("div",{className:"mentions-results-container","data-list-scroll-container":"true",ref:"overflow"},w.createElement(S["default"],{data:i,height:R,scrollTop:this.state.scrollTop,animate:!1}))))}},{key:"render",value:function(){var e=this.state,t=e.query,a=e.results,n=e.active;return w.createElement(b["default"],{component:"div",className:"mentions-positioning-container",transitionName:"slide-up"},this.renderList(n,a,t))}}]),t}(w.Component);e.exports=D},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(8),u=n(l),c=a(7),d=n(c),f=a(1467),p=n(f),h=a(12),m=n(h),v=a(1441),g=n(v),_=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return a=n=(0,u["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.handlers={onKeyDown:function(e){return this.ctx.isComposing?!1:" "===e.key&&(0,g["default"])(e)?this.ctx.value.length?!1:(m["default"].scrollMessages(),!0):!1}},i=a,(0,u["default"])(n,i)}return(0,d["default"])(t,e),t}(p["default"]);t["default"]=new _},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(13),y=n(_),E=a(12),M=n(E),S=a(15),C=n(S),b=a(1635),k=n(b),T=a(1436),w=n(T),N=a(1415),P=n(N),A=a(1421),O=n(A),R=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),n.onCapture=function(){var e=n,t=new o["default"](function(a,n){navigator.getUserMedia({video:!0},function(n){M["default"].closeModal(),a(n),t.isPending()||M["default"].openModal(g["default"].createElement(O["default"],{type:A.BoxModalType},g["default"].createElement(k["default"],{stream:n,onFinished:e.props.onImageTake,handleStreamClose:!1})))},function(e){var a=y["default"].isString(e)?e:e.name,i=C["default"].GUM[a]||C["default"].GUM.GUMError;n(new i),t&&!t.isPending()&&M["default"].closeModal()})}).timeout(1500,"waitForGUMTakePhotoTimeout").then(function(t){M["default"].openModal(g["default"].createElement(O["default"],{type:A.BoxModalType},g["default"].createElement(k["default"],{stream:t,onFinished:e.props.onImageTake,handleStreamClose:!1})))})["catch"](o["default"].TimeoutError,function(e){M["default"].openModal(g["default"].createElement(w["default"],{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_description",type:w["default"].TYPE.GUIDE_ALLOW}))})["catch"](C["default"].GUM.PermissionDeniedError,function(){M["default"].openModal(g["default"].createElement(w["default"],{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:w["default"].TYPE.GUIDE_UNBLOCK}))})["catch"](C["default"].GUM.GUMError,function(){M["default"].openModal(g["default"].createElement(w["default"],{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:w["default"].TYPE.GUIDE_NONE}))})},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){return g["default"].createElement(P["default"],{action:this.onCapture,a8n:"mi-take-photo"},l10n.t("take_photo"))}}]),t}(g["default"].Component);t["default"]=R},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(62),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(12),y=n(_),E=a(96),M=n(E),S=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentDidMount",value:function(){var e=this,t=(0,o["default"])({},this.props.tooltip,{uim:this.context.uim});y["default"].openTooltip(t,function(t){return e.element=t})}},{key:"componentWillUnmount",value:function(){y["default"].closeTooltip(this.context.uim)}},{key:"getElement",value:function(){return this.element}},{key:"render",value:function(){return null}}]),t}(v.Component);S.contextTypes={uim:g["default"].PropTypes.instanceOf(M["default"])},t["default"]=S},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(46),g=n(v),_=a(13),y=n(_),E=a(1624),M=n(E),S=a(1646),C=n(S),b=a(15),k=n(b),T=a(14),w=n(T),N=a(97),P=n(N),A=a(12),O=n(A),R=a(1404),D=(n(R),a(1425)),x=(n(D),a(78)),I=n(x),L=a(117),F=n(L),U=void 0,j=function(e){function t(){(0,s["default"])(this,t);var e=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments));return e.windowResized=function(){U=g["default"].findDOMNode(e).clientHeight},e.msgCollectionChanged=function(t,a,n){var i=e.state.msgCollection;i!==t&&i!==a||e.setState({msgCollection:n})},e.windowGainedFocus=function(){P["default"].markAvailable();var t=e.state.chat;t&&t.isUser&&t.presence.subscribe()["catch"](k["default"].WapDrop,y["default"].noop)},e.windowLostFocus=function(){P["default"].markUnavailable(w["default"].SEND_UNAVAILABLE_WAIT)},e.handleClearChat=function(t){e.state.chat===t&&e.setState({chat:void 0,msgCollection:void 0,focusCtx:void 0})},e.handleOpenChat=function(t,a,n){O["default"].updateChatlistSelection(t);var i=e.openedChatInfo,o={},r=function(e){y["default"].assign(o,e)};e.state.chat!==t?e.setState({chat:t,msgCollection:a?a.collection:t.msgs,focusCtx:a,notifyChatRendered:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return n(e.newChatScrollInfo(i,a))}),updateOpenedChatInfo:r}):e.setState({msgCollection:a?a.collection:t.msgs,focusCtx:a,notifyChatRendered:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return n(e.newChatScrollInfo(i,a))}),updateOpenedChatInfo:r}),e.openedChatInfo=o},e.newChatScrollInfo=function(e,t){var a=t?t.msg||Store.Msg.get(t.key):void 0;if(t&&a&&e&&e.chat&&e.renderedMsgsInfo&&e.visibleMsgOrder&&!y["default"].isEmpty(e.renderedMsgsInfo)&&!y["default"].isEmpty(e.visibleMsgOrder)){var n=e.renderedMsgsInfo[y["default"].head(e.visibleMsgOrder)],i=y["default"].find(e.renderedMsgsInfo,function(e,t){return t===a.id.toString()});return i?{wasVisible:!0,offset:i.offset}:e.chat===a.chat?a.t<n.t?{wasVisible:!1,alignAt:"top"}:{wasVisible:!1,alignAt:"bottom"}:{wasVisible:!1,alignAt:"center"}}return{wasVisible:!1,alignAt:"center"}},e.state={chat:void 0,msgCollection:void 0,focusCtx:void 0},e}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.props.listeners.add(O["default"],"open_chat",this.handleOpenChat),this.props.listeners.add(O["default"],"clear_chat",this.handleClearChat),this.props.listeners.add(window,"focus",this.windowGainedFocus),this.props.listeners.add(window,"blur",this.windowLostFocus)}},{key:"componentDidMount",value:function(){var e=this.props.debounce(this.windowResized,100);this.props.listeners.add(window,"resize",e),e()}},{key:"shouldComponentUpdate",value:function(e,t){return t!==this.state||e.animate!==this.props.animate}},{key:"componentDidUpdate",value:function(e,t){var a=this.state.chat,n=t.chat;a&&n!==a&&(this.props.listeners.add(a,"change:cmc:merge",this.msgCollectionChanged),n&&this.props.listeners.remove(n,"change:cmc:merge"))}},{key:"render",value:function(){var e=this.state,t=e.chat,a=e.msgCollection,n=e.focusCtx;return t?m["default"].createElement(M["default"],{key:t.id,chat:t,msgCollection:a,height:U,focusCtx:n,notifyChatRendered:this.state.notifyChatRendered,updateOpenedChatInfo:this.state.updateOpenedChatInfo,chatPreference:Store.ChatPreference.get("defaultPreference")}):m["default"].createElement("div",{className:"pane pane-two"},m["default"].createElement(C["default"],{animate:this.props.animate,className:"pane-body"}))}}]),t}(m["default"].Component);e.exports=(0,I["default"])((0,F["default"])(j))},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(2),r=i(o),s=a(6),l=i(s),u=a(3),c=i(u),d=a(4),f=i(d),p=a(8),h=i(p),m=a(7),v=i(m),g=a(5),_=i(g),y=a(14),E=i(y),M=a(119),S=i(M),C=a(1501),b=i(C),k=a(13),T=i(k),w=a(1404),N=(i(w),a(1492)),P=i(N),A=a(1470),O=i(A),R=a(1409),D=i(R),x=a(1403),I=i(x),L=a(1634),F=i(L),U=a(1509),j=i(U),G=a(1633),B=i(G),V=a(1511),H=i(V),W=a(12),z=i(W),Y=a(1436),q=i(Y),K=a(238),Q=i(K),X=a(15),Z=i(X),J=a(61),$=i(J),ee=a(1440),te=a(472),ae=i(te),ne=a(1415),ie=i(ne),oe=a(1498),re=i(oe),se=a(1448),le=n(se),ue=a(96),ce=i(ue),de=a(117),fe=i(de),pe=a(78),he=i(pe),me=a(1408),ve=i(me),ge=a(1402),_e=i(ge),ye=function(e){function t(){(0,c["default"])(this,t);var e=(0,h["default"])(this,(t.__proto__||(0,l["default"])(t)).apply(this,arguments));return e.isListeningForMove=!1,e.didDrag=!1,e.onWindowFocus=function(){e.setState({newlyFocused:!0}),e.props.setTimeout(function(){return e.setState({newlyFocused:!1})},100)},e.onMouseDown=function(e){},e.onDrag=function(t){e.didDrag=!0},e.onClickCapture=function(e){},e.onInfoPanel=function(){var t=e.props.chat;!t.isPSA&&(t.isUser||t.isBroadcast||t.isGroup)&&z["default"].openDrawerRight(_["default"].createElement(j["default"],{chat:(0,ge.unproxy)(t),key:"info-"+t.id}),"slide-left",e.context.uim)},e.checkForDrawerMid=function(e){z["default"].existsDrawerMid(function(t){t&&e.preventDefault()})},e.onChatSearch=function(t){t.preventDefault();var a=e.props.chat;z["default"].openDrawerRight(_["default"].createElement(H["default"],{chat:(0,ge.unproxy)(a),key:"chat-search-"+a.id}),"slide-left",e.context.uim)},e.onCaptureClick=function(){var t=e.props.chat,a=le.start("camera");r["default"].race([a,e.props.rejectOnUnmount()]).checkpoint(e.props.rejectOnUnmount()).then(function(a){z["default"].openDrawerMid(_["default"].createElement(F["default"],{chat:(0,ge.unproxy)(t),stream:a}),"slide-up",e.context.uim,{noFocus:!0})})["catch"](Z["default"].Unmount,function(){a.then(function(e){return le.stop(e)})["catch"](T["default"].noop)})["catch"](Z["default"].GUM.PermissionDeniedError,function(){z["default"].openModal(_["default"].createElement(q["default"],{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:q["default"].TYPE.GUIDE_UNBLOCK}))})["catch"](Z["default"].GUM.GUMError,function(){z["default"].openModal(_["default"].createElement(q["default"],{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:q["default"].TYPE.GUIDE_NONE}))})},e.state={},e}return(0,v["default"])(t,e),(0,f["default"])(t,[{key:"componentWillMount",value:function(){}},{key:"render",value:function(){var e,t,n=this.props.chat;n.isUser?(e=_["default"].createElement(Ce,{chat:(0,ge.unproxy)(n),onSelectMessages:this.props.onSelectMessages}),t=_["default"].createElement(O["default"],{presence:n.presence,chatstate:n.presence.chatstate,placeholder:l10n.t("click_here_for_user_info"),location:"title",className:"chat-secondary pane-chat-header-subtitle"})):n.isBroadcast?(e=_["default"].createElement(Se,{chat:(0,ge.unproxy)(n),onSelectMessages:this.props.onSelectMessages}),t=null):n.isGroup&&(e=_["default"].createElement(Me,{chat:(0,ge.unproxy)(n),onSelectMessages:this.props.onSelectMessages}),t=_["default"].createElement(P["default"],{chatstate:n.presence.chatstate,groupMetadata:n.groupMetadata,presence:n.presence,placeholder:l10n.t("click_here_for_group_info"),className:"chat-secondary pane-chat-header-subtitle"}));var i=a(61),o=i.supportsFeature(i.F.FTS_IN_CONV)?_["default"].createElement(ee.MenuBarItem,{a8n:"search-button",icon:"icon-search-alt",title:l10n.t("search"),onClick:this.onChatSearch}):null,r=this.props.canAttach?_["default"].createElement(ee.MenuBarItem,{a8n:"conversation-clip",icon:"icon-clip",title:l10n.t("menutitle_attach"),transitionName:"menu",onClick:this.checkForDrawerMid},_["default"].createElement(Ee,{chat:(0,ge.unproxy)(n),onCaptureClick:this.onCaptureClick})):null,s="chat-avatar",l="chat-body",u="chat-title",c=null,d=n.contact&&n.contact.isVerified;return(n.isPSA||d)&&(n.isPSA&&(s+=" chat-psa",l+=" chat-psa",t=null),u+=" chat-title-verified",c=_["default"].createElement("span",{className:"icon-psa-verified"})),_["default"].createElement("header",{className:"pane-header pane-chat-header",onClickCapture:this.onClickCapture,onMouseDown:this.onMouseDown},_["default"].createElement("div",{className:s,onClick:this.onInfoPanel},_["default"].createElement(D["default"],{id:n.id,size:40})),_["default"].createElement("div",{className:l,onClick:this.onInfoPanel},_["default"].createElement("div",{className:"chat-main"},_["default"].createElement("h2",{className:u,dir:"auto"},_["default"].createElement(I["default"],{text:n.title(),titlify:!0,ellipsify:!0}),c)),t),_["default"].createElement("div",{className:"pane-chat-controls"},_["default"].createElement(ee.MenuBar,{key:"conversation-header"},o,r,_["default"].createElement(ee.MenuBarItem,{a8n:"conversation-menu",icon:"icon-menu",title:l10n.t("menutitle_menu"),onClick:this.checkForDrawerMid},e))))}}]),t}(_["default"].Component);ye.contextTypes={uim:_["default"].PropTypes.instanceOf(ce["default"])},ye.CONCERNS={chat:["id","formattedTitle","presence","isUser","isGroup","isBroadcast","groupMetadata","isPSA","contact"]};var Ee=function(e){function t(){var e,a,n,i;(0,c["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,h["default"])(this,(e=t.__proto__||(0,l["default"])(t)).call.apply(e,[this].concat(r))),n.setDocPicker=function(e){return n.docPicker=e},n.setMediaPicker=function(e){return n.mediaPicker=e},n.onDocumentPick=function(e){if(e){e.stopPropagation();var t=T["default"].toArray(e.target.files);t.length&&(e.target.value="",n.canSendDocument()?z["default"].attachMediaDrawer(n.props.chat,t):n.showCantSendDocument())}},n.onMediaPick=function(e){if(e){e.stopPropagation();var t=T["default"].toArray(e.target.files);t.length&&(e.target.value="",z["default"].attachMediaDrawer(n.props.chat,t))}},n.onMediaClick=function(e){e.preventDefault(),n.mediaPicker.triggerInput()},n.onDocumentClick=function(e){e.preventDefault(),n.canSendDocument()?n.docPicker.triggerInput():n.showCantSendDocument()},n.onContactClick=function(e){e.preventDefault(),z["default"].openModal(_["default"].createElement(B["default"],{chat:n.props.chat}))},n.showCantSendDocument=function(e){var t=void 0;if(e instanceof Z["default"].InvalidMediaFileType)t=l10n.t("cannot_send_document_type_unsupported");else if(e instanceof Z["default"].MediaFileTooLarge)t=l10n.t("document_too_big",{maxSize:E["default"].MAX_MEDIA_UPLOAD_SIZE/1024/1024+"MB"});else{var a=n.props.chat;t=a.isUser?l10n.t("cannot_send_document_to_contact_unsupported",{contact:a.title()}):l10n.t("cannot_send_document_to_group_unsupported",{group:a.title()})}z["default"].openModal(_["default"].createElement(Q["default"],{key:"doc_cant_send",onOK:z["default"].closeModal.bind(z["default"])},_["default"].createElement(I["default"],{text:t})))},n.onCaptureClick=function(){n.props.onCaptureClick()},i=a,(0,h["default"])(n,i)}return(0,v["default"])(t,e),(0,f["default"])(t,[{key:"canSendDocument",value:function(){return $["default"].supportsFeature($["default"].F.ENC_DOC)}},{key:"render",value:function(){var e=_["default"].createElement(re["default"],{direction:"left",className:"tooltip-menu"},l10n.t("attach_capture")),t=navigator.getUserMedia?_["default"].createElement(ie["default"],{tooltip:e,a8n:"mi-attach-camera",action:this.onCaptureClick},_["default"].createElement("button",{className:"menu-icons-item"},_["default"].createElement("div",{className:"icon-xl icon-camera"}))):null,a=void 0;if($["default"].supportsFeature($["default"].F.ENC_DOC)){var n=_["default"].createElement(re["default"],{direction:"left",className:"tooltip-menu"},l10n.t("attach_document"));a=_["default"].createElement(ie["default"],{tooltip:n,ref:this.setDocPicker,a8n:"mi-attach-document",action:this.onDocumentClick,mimes:S["default"].DOC_MIMES,onFilePick:this.onDocumentPick},_["default"].createElement("button",{className:"menu-icons-item"},_["default"].createElement("div",{className:"icon-xl icon-document"})))}var i=_["default"].createElement(re["default"],{direction:"left",className:"tooltip-menu"},l10n.t("attach_media")),o=_["default"].createElement(re["default"],{direction:"left",className:"tooltip-menu"},l10n.t("attach_vcard"));return _["default"].createElement("div",{className:"attach-menu-container"},_["default"].createElement(ae["default"],{type:"menu",key:"AttachMenuDropdown"},_["default"].createElement(ie["default"],{tooltip:i,ref:this.setMediaPicker,a8n:"mi-attach-media",action:this.onMediaClick,mimes:[E["default"].IMAGE_MIMES,E["default"].VIDEO_MIMES].join(","),onFilePick:this.onMediaPick},_["default"].createElement("button",{className:"menu-icons-item"},_["default"].createElement("div",{className:"icon-xl icon-image"}))),t,a,_["default"].createElement(ie["default"],{tooltip:o,a8n:"mi-attach-contact",action:this.onContactClick},_["default"].createElement("button",{className:"menu-icons-item"},_["default"].createElement("div",{className:"icon-xl icon-contact"})))))}}]),t}(_["default"].Component),Me=function(e){var t=e.chat,a=e.onSelectMessages;return _["default"].createElement(ae["default"],{type:"dropdown_menu",key:"GroupMenuDropdown",flipOnRTL:!0,dirX:"left"},b["default"].group(t,a))},Se=function(e){var t=e.chat,a=e.onSelectMessages;return _["default"].createElement(ae["default"],{type:"dropdown_menu",key:"BroadcastMenuDropdown",flipOnRTL:!0,dirX:"left"},b["default"].broadcast(t,a))},Ce=function(e){var t=e.chat,a=e.onSelectMessages;return _["default"].createElement(ae["default"],{type:"dropdown_menu",key:"ContactMenuDropdown",flipOnRTL:!0,dirX:"left"},b["default"].contact(t,a))};t["default"]=(0,fe["default"])((0,he["default"])((0,ve["default"])((0,_e["default"])(ye))))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(24),o=n(i),r=a(120),s=n(r),l=a(6),u=n(l),c=a(3),d=n(c),f=a(4),p=n(f),h=a(8),m=n(h),v=a(7),g=n(v),_=a(5),y=n(_),E=a(46),M=n(E),S=a(1447),C=n(S),b=a(14),k=n(b),T=a(1621),w=n(T),N=a(1595),P=n(N),A=a(12),O=n(A),R=a(463),D=n(R),x=a(1404),I=(n(x),a(63)),L=n(I),F=a(21),U=n(F),j=a(1501),G=n(j),B=a(55),V=n(B),H=a(1532),W=n(H),z=a(1615),Y=n(z),q=a(115),K=n(q),Q=a(1),X=n(Q),Z=a(79),J=n(Z),$=a(1429),ee=n($),te=a(240),ae=n(te),ne=a(160),ie=n(ne),oe=a(95),re=n(oe),se=a(465),le=n(se),ue=a(1488),ce=n(ue),de=a(245),fe=(n(de),a(1425)),pe=(n(fe),a(1416)),he=(n(pe),a(462)),me=(n(he),a(15)),ve=n(me),ge=a(13),_e=n(ge),ye=a(78),Ee=n(ye),Me=a(1408),Se=n(Me),Ce=a(239),be=3e3,ke=8.5,Te=300,we=function(e){function t(){var e,a,n,i;(0,d["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,m["default"])(this,(e=t.__proto__||(0,u["default"])(t)).call.apply(e,[this].concat(r))),n.state=n.initialState(n.props),n.hideStickyDateMarkerTimer=new V["default"](function(){n.stickyDateMarker.hideStickyDateMarker(!0)}),n.renderedMsgCache=new s["default"],n.setScrollContainer=function(e){return n.scrollContainer=e},n.onPanesWillChange=function(e){var t=_e["default"].last(n.visibleMsgOrder);if(t){var a=t.toString(),i=n.messageList;if(a&&i){var o=i.getMsgWrapperRef(a);if(o){var r=n.scrollContainer,s=M["default"].findDOMNode(o),l=n.getMsgBottom(r,s);n.panesChanging={msg:s,container:r,msgBottom:l}}}}},n.onPanesDidChange=function(e){if(n.panesChanging){var t=n.panesChanging,a=t.msg,i=t.container,o=t.msgBottom;n.setMsgBottom(i,a,o),n.panesChanging=void 0}},n.onRerender=(0,ge.debounce)(function(){n._onRerender()},100),n._onRerender=function(){var e=n.scrollContainer,t=e.scrollTop;n.setState({msgListKey:n.state.msgListKey+1},function(){n.setScrollTop(e,t)})},n.handleScroll=(0,ge.throttle)(function(e,t,a){n.updateRenderedMsgCache(),e.scrollTop<Te&&Date.now()-(n.chatOpenScrollTimestamp||0)>k["default"].MSG_FOCUS_SCROLL_ANIMATION_DURATION+50&&n.loadEarlierMsgs();var i=n.state,o=i.isNearBottom,r=i.cursor,s=a(e);s?(n.maybeSendSeen(!0),n.isMostRecentCMC()&&o!==s&&(n.setUpdateType(T.UpdateTypes.NONE),n.setState({isNearBottom:s,newUnread:0})),(r.end<n.props.msgCollection.length||!n.isMostRecentCMC())&&n.loadRecentMsgs()):o!==s&&(n.setUpdateType(T.UpdateTypes.NONE),n.setState({isNearBottom:s}))},100),n.onResizeThrottle=(0,ge.throttle)(function(){n.updateRenderedMsgCache()},100),n.onMsgKeyChange=function(e){var t=e.newKey,a=e.oldKey;console.log("old key: ",a," -> ","new key: ",t);var i=a.toString(),o=t.toString(),r=n.renderedMsgCache.get(i);r&&(n.renderedMsgCache.set(o,r),n.renderedMsgCache["delete"](i));for(var s=0;s<n.visibleMsgOrder.length;++s)if(n.visibleMsgOrder[s]===a){n.visibleMsgOrder[s]=t;break}},n.onResizeDebounce=(0,ge.debounce)(function(){var e=n.nearBottom();n.nearBottom!==e&&(n.setUpdateType(T.UpdateTypes.NONE),n.setState({isNearBottom:e}))},100),n.loadEarlierMsgs=function(){var e=n.props,t=e.chat,a=e.msgCollection,i=n.state.cursor;if(i.start>0)i.hasBefore()&&(n.setUpdateType(T.UpdateTypes.KEEP_SCROLL_BOTTOM),n.setState({cursor:i.loadBefore()}));else{if(a.msgLoadState.noEarlierMsgs||a.msgLoadState.isLoadingEarlierMsgs||a.msgLoadState.isLoadingAroundMsgs)return;t.loadEarlierMsgs(a).checkpoint(n.props.rejectOnUnmount()).then(function(){var e={};n.state.focusCtx||(e.focusCtx=n.getUnreadFocusCtx(n.props)),i.hasBefore()?(n.setUpdateType(T.UpdateTypes.KEEP_SCROLL_BOTTOM),e.cursor=i.loadBefore(),n.setState(e)):n.setState(e)})["catch"](ve["default"].Unmount,_e["default"].noop)["catch"](function(e){X["default"].log("ConversationMsgs:loadEarlierMsgs failed")(),X["default"].log(e)()})}},n.loadRecentMsgs=function(){var e=n.props,t=e.chat,a=e.msgCollection,i=n.state.cursor;if(i.end<a.length)n.setUpdateType(T.UpdateTypes.KEEP_SCROLL_TOP),n.setState({cursor:i.loadAfter()});else{if(a.msgLoadState.isLoadingRecentMsgs||a.msgLoadState.isLoadingAroundMsgs)return;t.loadRecentMsgs(a).checkpoint(n.props.rejectOnUnmount()).then(function(){i.hasAfter()?(n.setUpdateType(T.UpdateTypes.KEEP_SCROLL_TOP),n.setState({cursor:i.loadAfter()})):n.state.cursor.end>=a.length&&n.isMostRecentCMC()&&n.setState({})})["catch"](ve["default"].Unmount,_e["default"].noop)["catch"](function(e){X["default"].log("ConversationMsgs:loadRecentMsgs failed")(),X["default"].log(e)()})}},n.onComposeHeightChange=function(e){var t=n.scrollContainer;if(e){if(0>e&&t.scrollTop===t.scrollHeight-t.clientHeight)return;n.setScrollTop(t,t.scrollTop+e)}else!function(){var e=t.scrollHeight-(t.scrollTop+t.clientHeight);(0,D["default"])(t,{tween:18},{progress:function(){n.setScrollTop(t,t.scrollHeight-e-t.clientHeight)},duration:300},[.1,.82,.25,1])}()},n.getScrollBottom=function(){var e=n.scrollContainer;return e?e.scrollHeight-(e.scrollTop+e.clientHeight):0},n.isMsgVisible=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1,a=e.toString();return n.renderedMsgCache.has(a)&&(t?!0:n.getMsgComponent(a))},n.onScroll=function(e){n.handleScroll(e.target,n.props.chat,n.nearBottom,n)},n.onWindowGainedFocus=function(){var e=n.props.chat;!n.clearUnreadTimer&&e.isDirty()&&(n.clearUnreadTimer=setTimeout(function(){delete n.clearUnreadTimer,n.maybeSendSeen()},k["default"].CLEAR_CHAT_DIRTY_WAIT))},n.onWindowLostFocus=function(){if(n.state.unreadCount&&n.isMostRecentCMC()){var e=n.props.chat;0===e.unreadCount&&(n.setUpdateType(T.UpdateTypes.KEEP_SCROLL_BOTTOM),n.setState({unreadCount:0})),e.markedUnread=!1}},n.jumpToBottom=function(){n.isMostRecentCMC()&&n.state.cursor.end>=n.props.msgCollection.length?n.scrollToBottom():O["default"].openChatBottom(n.props.chat).then(function(e){e&&O["default"].focusChatTextInput(n.props.chat)})},n.scrollToBottom=function(e){var t=n.scrollContainer;n.setScrollTop(t,t.scrollHeight),e&&e()},n.onLastMsgChanged=function(){var e=n.props.msgCollection,t=n.state,a=t.cursor,i=t.focusCtx,o=e.last();if(!n.isMostRecentCMC())return void(o&&o.isSentByMe&&n.jumpToBottom());var r={},s=document.hasFocus(),l=n.nearBottom();n.setUpdateType(l?T.UpdateTypes.SCROLL_BOTTOM:T.UpdateTypes.KEEP_SCROLL_TOP),s&&l?(n.setUpdateType(T.UpdateTypes.SCROLL_BOTTOM),r.unreadCount=0,r.focusCtx=void 0,r.cursor=a.setKey()):o&&o.isSentByMe&&(n.setUpdateType(T.UpdateTypes.SCROLL_BOTTOM),n.state.unreadCount&&(r.unreadCount=0,r.focusCtx=void 0,r.cursor=a.setKey()),n.jumpToBottom()),n.isMostRecentCMC()&&(i&&!r.hasOwnProperty("focusCtx")?r.cursor=a.loadAfter(1):r.cursor=a.loadBefore(1)),_e["default"].isEmpty(r)||n.setState(r)},n.onUnreadCount=function(){var e=n.props.chat,t=n.nearBottom(),a=document.hasFocus();n.maybeSendSeen(t,a);var i={};if(e.unreadCount&&!e.pendingSeenCount){i.unreadCount=e.unreadCount;var o=n.getUnreadFocusCtx();o&&(i.focusCtx=o,i.cursor=n.state.cursor.setKey(o.msg.key))}t&&i.unreadCount-n.state.unreadCount===1&&n.setUpdateType(T.UpdateTypes.SCROLL_BOTTOM),(!t&&n.isMostRecentCMC()||!e.pendingSeenCount&&n.state.newUnread!==e.unreadCount)&&(i.newUnread=e.unreadCount),_e["default"].isEmpty(i)||n.setState(i)},n.onMsgsDelete=function(e,t,a){e.forEach(function(e){n.state.cursor.onRemove(e)}),n.setState({})},n.onPageUpDown=function(e){re["default"].focus(n.scrollContainer)},n.onKeyPress=function(e){e.metaKey||e.ctrlKey||(e.preventDefault(),"Enter"!==e.key||e.shiftKey?O["default"].pasteChatTextInput(n.props.chat,String.fromCharCode(e.charCode)):O["default"].enterChatTextInput(n.props.chat))},n.onContextMenu=function(e){var t,a=n.props.chat,i=n.props.onSelectMessages;if(a.isUser)t=G["default"].contact(a,i);else if(a.isGroup)t=G["default"].group(a,i);else{if(!a.isBroadcast)return;t=G["default"].broadcast(a,i)}e.preventDefault(),e.stopPropagation(),e.persist(),n.setState({contextMenu:{menu:t,event:e}})},n.onContextClose=function(){n.setState({contextMenu:null})},n.onPaste=function(e){e.preventDefault();var t=new C["default"](e.clipboardData);if(!t.hasFiles()&&t.hasType("text/plain"))return e.persist(),void O["default"].sendPasteToCompose(n.props.chat,e);var a=_e["default"].filter(t.getFiles(),function(e){var t=L["default"].typeFromMimetype(e.type);return"image"===t||"video"===t});a.length&&O["default"].attachMediaDrawer(n.props.chat,a)},i=a,(0,m["default"])(n,i)}return(0,g["default"])(t,e),(0,p["default"])(t,[{key:"componentWillUnmount",value:function(){this.onRerender.cancel(),this.handleScroll.cancel(),this.onResizeThrottle.cancel(),this.onResizeDebounce.cancel(),this.hideStickyDateMarkerTimer.cancel(),this.clearUnreadTimer&&clearTimeout(this.clearUnreadTimer),this.maybeSendSeen()&&(this.props.chat.markedUnread=!1)}},{key:"componentDidMount",value:function(){var e=this,t=this.props,a=t.chat,n=t.msgCollection,i=t.listeners;if(i.add(O["default"],"scroll_chat_to_bottom",this.scrollToBottom),i.add(O["default"],"textsize_change",function(t){return e.setState({textSize:t})}),i.add(O["default"],"panes_will_change",this.onPanesWillChange),i.add(O["default"],"panes_did_change",this.onPanesDidChange),i.add(O["default"],"scroll_to_focused_msg",function(){e.chatOpenScrollTimestamp=Date.now()}),i.add(window,"focus",this.onWindowGainedFocus),i.add(window,"blur",this.onWindowLostFocus),i.add(window,"resize",this.onResizeThrottle),i.add(window,"resize",this.onResizeDebounce),i.add(a,"change:trusted",this._onRerender),i.add(Store.Msg,"change:msgKey",this.onMsgKeyChange),a.isGroup?i.add(a.groupMetadata.participants,"change:contact.name change:contact.isMyContact change:contact.notifyName",this.onRerender):a.isUser&&i.add(a.contact,"change:isMyContact",this.onRerender),i.add(n,"change:star",this.onRerender),!this.props.focusCtx){var o=this.scrollContainer;if(this.messageList){var r=M["default"].findDOMNode(this.messageList);r.clientHeight<o.clientHeight&&this.loadEarlierMsgs()}}this.attachMsgCollectionObservers(this.props),this.updateRenderedMsgCache(),this.props.updateOpenedChatInfo({chat:a}),a.sendSeen()}},{key:"componentWillReceiveProps",value:function(e){var t=this;this.attachMsgCollectionObservers(e);var a=_e["default"].clone(e);a.selectable=!e.selectable,_e["default"].isEqual(a,this.props)||this.setState(this.initialState(e),function(){t.props.chat.sendSeen()})}},{key:"componentDidUpdate",value:function(e,t){var a=this.props.chat;this.updateType=T.UpdateTypes.DEFAULT,this.updateRenderedMsgCache(e.chat===a),t.msgListKey===this.state.msgListKey&&this.props.updateOpenedChatInfo({chat:a})}},{key:"getMsgBottom",value:function(e,t){var a=e.scrollTop,n=e.scrollHeight,i=e.clientHeight,o=n-(a+i);return n-(t.offsetTop+t.clientHeight+o)}},{key:"setMsgBottom",value:function(e,t,a){var n=t.offsetTop,i=t.clientHeight,o=n+i+a-e.clientHeight;this.setScrollTop(e,o)}},{key:"initialState",value:function(e){var t=e.focusCtx,a=e.chat,n=e.msgCollection;this.updateType=T.UpdateTypes.DEFAULT;var i=t||this.getUnreadFocusCtx(e),o=i&&i.msg,r=o&&o.id,s=void 0;return s=0,{msgListKey:0,cursor:new W["default"](n,r,a.isGroup?k["default"].RENDOR_CURSOR.GROUP_CONVERSATION:k["default"].RENDOR_CURSOR.CONVERSATION),unreadCount:a.pendingSeenCount?0:a.unreadCount,isNearBottom:!0,newUnread:0,focusCtx:i,contextMenu:null,textSize:s}}},{key:"attachMsgCollectionObservers",value:function(e){var t=this,a=this.props,n=a.listeners,i=a.chat,o=a.msgCollection;o&&(i.msgs===o&&n.remove(i,"change:unreadCount",this.onUnreadCount),n.remove(o,"remove_msgs",this.onMsgsDelete),n.remove(i.msgs,"change:last",this.onLastMsgChanged)),e.msgCollection===e.chat.msgs&&n.add(e.chat,"change:unreadCount",this.onUnreadCount),n.add(e.chat.msgs,"change:last",this.onLastMsgChanged),n.add(e.msgCollection,"remove_msgs",this.onMsgsDelete),
this.state.cursor.msgCollection=e.msgCollection;var r=e.focusCtx,s=function(){return r.key&&(r.msg=Store.Msg.get(r.key)),r.msg?(t.setUpdateType(T.UpdateTypes.KEEP_SCROLL_BOTTOM),void t.setState({cursor:t.state.cursor.init(r.msg.id)})):O["default"].openChatBottom(t.props.chat)};r&&e.msgCollection.loadAroundPromise?e.msgCollection.loadAroundPromise.checkpoint(this.props.rejectOnUnmount()).then(s)["catch"](ve["default"].Unmount,_e["default"].noop)["catch"](ve["default"].E404,function(){O["default"].openToast(y["default"].createElement(le["default"],{msg:ie["default"].t("message_query_404"),id:le["default"].genId()})),s()})["catch"](s):r&&s()}},{key:"isMostRecentCMC",value:function(){return this.props.chat.msgs===this.props.msgCollection}},{key:"setScrollBottom",value:function(e){var t=this.scrollContainer;t&&this.setScrollTop(t,t.scrollHeight-e-t.clientHeight)}},{key:"setScrollTop",value:function(e,t){this.programmaticScroll=Date.now(),e.scrollTop=t}},{key:"updateStickyDateMarker",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1,a=this.messageList;if(a&&"number"==typeof e){var n=t||Date.now()-(this.programmaticScroll||0)<200;n||(this.hideStickyDateMarkerTimer.debounce(be),this.stickyDateMarker&&this.stickyDateMarker.hideStickyDateMarker(!1));var i=a.getDateMarkerRef(e);if(-1===e)this.stickyDateMarker.updateDateMarkerText();else if(i){var o=i.getTimestamp(),r=J["default"].relativeDateStr(o).toUpperCase();this.stickyDateMarker.updateDateMarkerText(r)}if(this.dateMarkerIdx!==e){var s=a.getDateMarkerRef(this.dateMarkerIdx);s&&s.hide(!1),i&&i.hide(!0)}}}},{key:"setUpdateType",value:function(e){T.UpdateTypePriority[e]>=T.UpdateTypePriority[this.updateType]&&(this.updateType=e)}},{key:"nearBottom",value:function(e){return e=e||this.scrollContainer,e.scrollTop+k["default"].SCROLL_FUDGE>e.scrollHeight-e.clientHeight}},{key:"getUnreadFocusCtx",value:function(e){var t=e||this.props,a=t.chat,n=t.msgCollection,i=t.focusCtx,o=void 0;if(a.unreadCount?o=a.unreadCount:this.state&&this.state.unreadCount&&(o=this.state.unreadCount),(!i||this.isMostRecentCMC())&&o){var r=(0,_e["default"])(n.toArray()).filter(function(e){return e.isUnreadType}).reverse().take(o).value();if(r.length===o)return r=_e["default"].last(r),{msg:r,isUnreadDivider:!0,highlightMsg:!1}}}},{key:"getMsgs",value:function(){var e=this.props.msgCollection,t=this.state.cursor;return e.toArray().slice(t.start,t.end)}},{key:"updateRenderedMsgCache",value:function(e){var t=this.messageList;if(!t)return this.renderedMsgCache.clear();for(var a=[],n=t.props.msgs,i=new s["default"],r={},l=0,u=n.length-1;u>l;){var c=Math.floor((l+u)/2),d=n[c].id.toString(),f=t.getMsgWrapperRef(d);t.getMsgVisibility(f).visibility===k["default"].VISIBILITY.ABOVE?l=c+1:u=c}for(var p=l;p<n.length;p++){var h=n[p].id.toString(),m=t.getMsgWrapperRef(h);if(!m)throw new Error("msgRef not found!");var v=t.getMsgVisibility(m);if(v.visibility!==k["default"].VISIBILITY.VISIBLE)break;r[h]={offset:v.offset,t:n[p].t},i.set(h,m),a.push(n[p].id)}var g=this.scrollContainer.scrollTop;l=0,u=_e["default"].size(t.renderedDateMarkers)-1;var _=t.getDateMarkerRef(0),y=_&&M["default"].findDOMNode(_);if(y&&y.offsetTop<=g+ke)for(;u>l;){var E=Math.ceil((l+u)/2),S=t.getDateMarkerRef(E);if(!S)throw new Error("DateMarkerRef: "+E+" not found. "+(0,o["default"])(t.renderedDateMarkers).toString()+"}");var C=M["default"].findDOMNode(S);C.offsetTop>g+ke?u=E-1:l=E}else l=-1;this.updateStickyDateMarker(l,e),this.dateMarkerIdx=l,this.pauseHiddenGifs(this.renderedMsgCache,i),this.renderedMsgCache=i,this.visibleMsgOrder=a,this.props.updateOpenedChatInfo({renderedMsgsInfo:r,visibleMsgOrder:a,clientHeight:this.scrollContainer.clientHeight})}},{key:"getMsgComponent",value:function(e){var t=this.messageList;return t?t.getMsgComponentRef(e.toString()):void 0}},{key:"pauseHiddenGifs",value:function(e,t){var a=this;e.forEach(function(e,n){if(!t.has(n)){var i=a.props.msgCollection.get(n);i&&i.isGif&&"function"==typeof e.pause&&e.pause()}})}},{key:"maybeSendSeen",value:function(e,t){var a=this.props,n=a.chat,i=a.msgCollection,o=this.state.cursor;return n.isDirty()&&this.isMostRecentCMC()&&o.end>=i.length&&(_e["default"].isUndefined(t)&&(t=document.hasFocus()),t&&(_e["default"].isUndefined(e)&&(e=this.nearBottom()),e))?(n.sendSeen(),!0):void 0}},{key:"render",value:function(){var e=this,t=this.props,a=t.chat,n=t.msgCollection,i=t.selectable,o=t.onMessageSelect,r=this.state.focusCtx,s=(0,U["default"])("pane-chat-msgs pane-chat-body lastTabIndex",{selectable:i}),l=this.isMostRecentCMC(),u=!!r,c=void 0,d=_e["default"].find(k["default"].TEXTSIZE_CLASS_MAP,function(t){return t.scale===e.state.textSize});d&&(c=d.classname);var f=y["default"].createElement(w["default"],{key:"ml-"+a.id+"-"+this.state.msgListKey,ref:(0,Ce.GetRef)("messageList",this),updateType:this.updateType,unreadCount:this.state.unreadCount,selectable:i,onMessageSelect:o,msgs:this.getMsgs(),focusedMsgCtx:r,selectedMessages:this.props.selectedMessages,isMsgVisible:this.isMsgVisible,notifyChatRendered:this.props.notifyChatRendered}),p=n.msgLoadState,h=y["default"].createElement(P["default"],{direction:"around",isMostRecentCMC:l,loadMoreMsgs:_e["default"].noop,msgLoad:p}),m=void 0;(this.state.cursor.start>0||!p.noEarlierMsgs)&&(m=y["default"].createElement(P["default"],{direction:"earlier",isMostRecentCMC:l,loadMoreMsgs:this.loadEarlierMsgs,msgLoad:p}));var v=void 0;(this.state.cursor.end<n.length||!l)&&(v=y["default"].createElement(P["default"],{direction:"recent",isMostRecentCMC:l,loadMoreMsgs:this.loadRecentMsgs,msgLoad:p})),u&&n.msgLoadState.isLoadingAroundMsgs?(v=void 0,m=void 0,f=void 0):h=void 0;var g=void 0,_=void 0,E=this.state,M=E.isNearBottom,S=E.newUnread;M&&(n.msgLoadState.isLoadingAroundMsgs||l)||(S&&a.unreadCount&&(_=y["default"].createElement(ce["default"],{count:this.state.newUnread,className:"badge-unread",key:"icon-unread"})),g=y["default"].createElement("div",{className:"incoming-msgs",onClick:this.jumpToBottom},y["default"].createElement(K["default"],{transitionName:"pop"},_),y["default"].createElement("span",{className:"icon icon-down"})));var C=void 0;return this.state.contextMenu&&(C=y["default"].createElement(ae["default"],{displayName:"ConversationContextMenu",escapable:!0,popable:!0,requestDismiss:this.onContextClose},y["default"].createElement(ee["default"],{contextMenu:this.state.contextMenu}))),y["default"].createElement("div",{className:c},y["default"].createElement(Y["default"],{ref:(0,Ce.GetRef)("stickyDateMarker",this)}),y["default"].createElement(K["default"],{transitionName:"pop"},g),y["default"].createElement("div",{className:s,ref:this.setScrollContainer,onScroll:this.onScroll,onKeyPress:this.onKeyPress,onContextMenu:i?null:this.onContextMenu,onPaste:this.onPaste,tabIndex:"0"},y["default"].createElement("div",{className:"pane-chat-empty"}),h,m,f,v),C)}}]),t}(_.Component);t["default"]=(0,Se["default"])((0,Ee["default"])(we))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(161),g=n(v),_=(a(1425),a(1402)),y=n(_),E=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props.direction,t=this.props.msgLoad;if("earlier"===e&&t.isLoadingEarlierMsgs||"recent"===e&&t.isLoadingRecentMsgs||"around"===e&&t.isLoadingAroundMsgs)return m["default"].createElement("div",{className:"more"},m["default"].createElement("div",{className:"btn-more",title:l10n.t("loading_messages")},m["default"].createElement(g["default"],{stroke:6,size:24})));var a=void 0;switch(e){case"earlier":a=l10n.t("load_earlier_messages");break;case"recent":a=l10n.t("load_recent_messages");break;default:a=l10n.t("loading_messages")}return m["default"].createElement("div",{className:"more"},m["default"].createElement("div",{className:"btn-more",title:a,onClick:this.props.loadMoreMsgs},m["default"].createElement("span",{className:"icon icon-refresh"})))}}]),t}(m["default"].PureComponent);E.CONCERNS={msgLoad:["isLoadingEarlierMsgs","isLoadingRecentMsgs","isLoadingAroundMsgs"]},t["default"]=(0,y["default"])(E)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(14),g=n(v),_=a(1402),y=n(_),E=a(21),M=n(E),S=a(79),C=n(S),b=a(1414),k=n(b),T=a(1413),w=n(T),N=a(1505),P=n(N),A=a(1419),O=n(A),R=a(12),D=n(R),x=a(1424),I=n(x),L=a(1432),F=n(L),U=a(61),j=n(U),G=a(471),B=n(G),V=a(238),H=n(V),W=a(161),z=n(W),Y=a(462),q=(n(Y),a(242)),K=n(q),Q=function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));return a.showMediaMissing=function(){D["default"].openModal(m["default"].createElement(I["default"],{msg:a.props.msg}))},a.downloadMedia=function(){a.props.msg.forceDownloadMedia()},a.cancelDownload=function(){a.props.msg.cancelDownload()},a.cancelUpload=function(){a.props.msg.cancelUpload()},a.resumeUpload=function(){a.props.msg.resumeUpload()},a.resumeRemoteUpload=function(){j["default"].supportsFeature(j["default"].F.MEDIA_RETRY)?a.props.msg.resumeRemoteUpload():D["default"].openModal(m["default"].createElement(F["default"],{msg:a.props.msg}))},a.initDownload=function(){D["default"].closeModal(),B["default"].initDownload((0,_.unproxy)(a.props.msg))},a.downloadUnsupportedToDesktop=function(e){e&&e.stopPropagation(),D["default"].openModal(m["default"].createElement(H["default"],{onCancel:D["default"].closeModal.bind(D["default"]),onOK:a.initDownload,okText:l10n.t("web_button_download"),cancelText:l10n.t("web_cancel"),title:l10n.t("download_unsupported_media_title")},l10n.t("download_unsupported_media_prompt")))},a.handleTimeUpdate=function(e){a.setState({currentTime:e})},a.handlePlayingUpdate=function(e){a.setState({autoPlay:!1,playing:e})},a.state={currentTime:0,playing:!1,autoPlay:!1},a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){this.props.msg.downloadMedia()}},{key:"loader",value:function(e,t,a){return a=a?m["default"].createElement(z["default"],{stroke:3,size:38}):null,m["default"].createElement("div",{className:"audio"},m["default"].createElement("div",{className:"audio-controls"},m["default"].createElement("button",{className:"btn-audio "+(t?"icon "+t:""),onClick:e},a)),m["default"].createElement("div",{className:"audio-body"},m["default"].createElement("input",{type:"range",className:"audio-track",min:0,max:100,value:0,disabled:"disabled"})))}},{key:"render",value:function(){var e=this.props.msg,t=this.props.mediaData,a=(0,M["default"])("bubble bubble-attach bubble-audio audio-state-default",{"audio-state-played":e.ack===g["default"].ACK_PLAYED}),n=this.state.playing?this.state.currentTime:t.duration,i=(0,M["default"])("preview preview-audio no-image",{"quoted-msg-bubble-ptt":!!this.props.quotedMsg}),o=m["default"].createElement("div",{className:i},m["default"].createElement("div",{className:"icon icon-audio-file"}),m["default"].createElement("span",{className:"meta meta-audio"},m["default"].createElement(O["default"],null,C["default"].durationStr(n)))),r=e.isSentByMe?o:null,s=e.isSentByMe?null:o,l=e.isSentByMe?"text no-author":"text",u=void 0;switch(t.mediaStage){case K["default"].STAGE.RESOLVED:u=m["default"].createElement(P["default"],{url:t.renderableUrl,playing:this.state.playing,autoPlay:!1,onPlayingUpdate:this.handlePlayingUpdate,onTimeUpdate:this.handleTimeUpdate});break;case K["default"].STAGE.NEED_POKE:u=this.loader(this.downloadMedia,"icon-audio-download");break;case K["default"].STAGE.NEED_UPLOAD:u=this.loader(this.resumeUpload,"icon-audio-upload");break;case K["default"].STAGE.REMOTE_NEED_UPLOAD:u=this.loader(this.resumeRemoteUpload,"icon-audio-upload");break;case K["default"].STAGE.ERROR_MISSING:u=this.loader(this.showMediaMissing,"icon-audio-play");break;default:u=this.loader(null,null,!0)}var c=this.props.displayAuthor&&!e.isSentByMe&&e.isGroupMsg?m["default"].createElement(w["default"],{msg:e,contact:e.senderObj,className:"bubble-audio-author"}):null;return m["default"].createElement("div",{className:a},this.props.quotedMsg?c:null,this.props.quotedMsg,m["default"].createElement("div",{className:"wrapper"},r,m["default"].createElement("div",{className:"contents"},this.props.quotedMsg?null:c,m["default"].createElement("div",{className:l},u)),s,m["default"].createElement(k["default"],{msg:e})))}}]),t}(m["default"].PureComponent);Q.CONCERNS={msg:["ack","isSentByMe","isGroupMsg","senderObj"],mediaData:["duration","type","mediaStage","renderableUrl"]},t["default"]=(0,y["default"])(Q)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){var e=k["default"].build("https://www.whatsapp.com/faq/general/26000015/",{lg:l10n.getLocale()});window.open(e,"_blank")}Object.defineProperty(t,"__esModule",{value:!0});var o,r,s=a(6),l=n(s),u=a(3),c=n(u),d=a(4),f=n(d),p=a(8),h=n(p),m=a(7),v=n(m),g=a(5),_=n(g),y=a(462),E=(n(y),a(1414)),M=n(E),S=a(1413),C=n(S),b=a(48),k=n(b),T=a(1402),w=n(T),N=a(21),P=n(N);t["default"]=(0,w["default"])((r=o=function(e){function t(){return(0,c["default"])(this,t),(0,h["default"])(this,(t.__proto__||(0,l["default"])(t)).apply(this,arguments))}return(0,v["default"])(t,e),(0,f["default"])(t,[{key:"render",value:function(){var e=this.props.msg,t=this.props.displayAuthor&&!e.isSentByMe&&e.isGroupMsg,a=t?_["default"].createElement(C["default"],{msg:e,className:"bubble-placeholder-author",contact:e.senderObj}):null,n=(0,P["default"])("bubble bubble-placeholder",{"has-author":t}),o="message-text";return _["default"].createElement("div",{className:n},a,_["default"].createElement("div",{className:"icon icon-ciphertext placeholder-icon"}),_["default"].createElement("div",{className:o},_["default"].createElement("span",null,_["default"].createElement("span",{className:"placeholder-msg"},l10n.t("placeholder_msg")),_["default"].createElement("span",{className:"placeholder-msg-action",onClick:i},l10n.t("learn_more")))),_["default"].createElement(M["default"],{msg:e}))}}]),t}(_["default"].PureComponent),o.CONCERNS={msg:["isSentByMe","isGroupMsg","senderObj"]},r))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(473),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(1419),y=n(_),E=a(1403),M=n(E),S=a(21),C=n(S),b=a(79),k=n(b),T=a(0),w=n(T),N=a(12),P=n(N),A=a(78),O=n(A),R=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(r))),n.state={hide:!1},n.rerender=function(){n.forceUpdate()},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentDidMount",value:function(){this.maybeRegMidnight()}},{key:"componentDidUpdate",value:function(){this.maybeRegMidnight()}},{key:"getTimestamp",value:function(){return this.props.timestamp}},{key:"hide",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){this.state.hide!==e&&this.setState({hide:e})})},{key:"maybeRegMidnight",value:function(){this.props.listeners.remove(P["default"],"midnight",this.rerender);var e=(0,w["default"])().startOf("day").subtract(7,"day");this.props.timestamp>=e.unix()&&this.props.listeners.add(P["default"],"midnight",this.rerender)}},{key:"render",value:function(){var e=k["default"].relativeDateStr(this.props.timestamp).toUpperCase(),t=(0,C["default"])("message-system-body",{"date-marker-floating":this.state.hide});return g["default"].createElement("div",{className:"msg msg-system"},g["default"].createElement("div",{className:"message message-system"},g["default"].createElement("span",{className:t},g["default"].createElement(y["default"],null,g["default"].createElement(M["default"],{direction:"auto",text:e})))))}}]),t}(g["default"].PureComponent),D=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"getTimestamp",value:function(){return(0,o["default"])(t.prototype.__proto__||(0,s["default"])(t.prototype),"getComponent",this).call(this).getTimestamp()}},{key:"hide",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return(0,o["default"])(t.prototype.__proto__||(0,s["default"])(t.prototype),"getComponent",this).call(this).hide(e)})}]),t}((0,O["default"])(R));t["default"]=D},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){e&&(e.stopPropagation(),e.preventDefault())}Object.defineProperty(t,"__esModule",{value:!0});var o=a(62),r=n(o),s=a(6),l=n(s),u=a(3),c=n(u),d=a(4),f=n(d),p=a(8),h=n(p),m=a(7),v=n(m),g=a(5),_=n(g),y=a(1413),E=n(y),M=a(1402),S=n(M),C=a(1414),b=n(C),k=a(462),T=(n(k),a(242)),w=n(T),N=a(1403),P=n(N),A=a(21),O=n(A),R=a(1424),D=n(R),x=a(1432),I=n(x),L=a(1559),F=n(L),U=a(61),j=n(U),G=a(12),B=n(G),V=a(119),H=a(471),W=n(H),z=a(13),Y=n(z),q=a(238),K=n(q),Q=a(14),X=n(Q),Z=a(465),J=n(Z),$=Y["default"].pickBy(V.MimeTypes,function(e){return"document"===e.msgType}),ee=function(e){function t(){var e,a,n,o;(0,c["default"])(this,t);for(var r=arguments.length,s=Array(r),u=0;r>u;u++)s[u]=arguments[u];return a=n=(0,h["default"])(this,(e=t.__proto__||(0,l["default"])(t)).call.apply(e,[this].concat(s))),n.showMediaMissing=function(e){i(e),B["default"].openModal(_["default"].createElement(D["default"],{msg:n.props.msg}))},n.downloadMedia=function(e){if(i(e),!Modernizr.adownload){var t=l10n.t("whatsapp_safari_limited").replace("__chrome_homepage__",X["default"].BROWSER_LINK.CHROME).replace("__firefox_homepage__",X["default"].BROWSER_LINK.FIREFOX).replace("__opera_homepage__",X["default"].BROWSER_LINK.OPERA);return void B["default"].openModal(_["default"].createElement(K["default"],{onOK:B["default"].closeModal.bind(B["default"]),okText:l10n.t("web_ok")},_["default"].createElement("div",{dangerouslySetInnerHTML:{__html:t}})))}n.props.msg.forceDownloadMedia()["catch"](Y["default"].noop).then(function(){switch(n.props.mediaData.mediaStage){case w["default"].STAGE.RESOLVED:case w["default"].STAGE.ERROR_UNSUPPORTED:n.displayToast(),W["default"].initDownload((0,M.unproxy)(n.props.msg));break;case w["default"].STAGE.ERROR_MISSING:n.showMediaMissing()}})},n.cancelDownload=function(e){i(e),n.props.msg.cancelDownload()},n.cancelUpload=function(e){i(e),n.props.msg.cancelUpload()},n.resumeUpload=function(e){i(e),n.props.msg.resumeUpload()},n.resumeRemoteUpload=function(e){i(e),j["default"].supportsFeature(j["default"].F.MEDIA_RETRY)?n.props.msg.resumeRemoteUpload():B["default"].openModal(_["default"].createElement(I["default"],{msg:n.props.msg}))},o=a,(0,h["default"])(n,o)}return(0,v["default"])(t,e),(0,f["default"])(t,[{key:"displayToast",value:function(){var e=this.props,t=e.msg,a=e.mediaData,n=t.caption||a.filename||l10n.t("untitled_document");B["default"].openToast(_["default"].createElement(J["default"],{msg:l10n.t("document_downloaded",{name:n}),id:J["default"].genId()}))}},{key:"render",value:function(){var e=this.props,t=e.msg,a=e.mediaData,n=e.displayAuthor,i=(0,O["default"])("bubble","bubble-doc",{"bubble-broadcast":t.broadcast,"bubble-star":t.star}),o=n&&!t.isSentByMe&&t.isGroupMsg?_["default"].createElement(E["default"],{msg:t,className:"bubble-doc-author",contact:t.senderObj}):null,s=void 0;a.pageCount>0&&(s=_["default"].createElement("span",{className:"document-meta-value"},l10n.t("web_conversations_most_recent_document",{count:a.pageCount,_plural:a.pageCount})));var l=a.size>0?_["default"].createElement("span",{className:"document-meta-value"},l10n.filesize(a.size)):null,u=void 0,c="icon-doc";Y["default"].has($,a.mimetype)&&(u=_["default"].createElement("span",{className:"document-meta-value"},$[a.mimetype].ext),c=(0,O["default"])(c,$[a.mimetype].icon));var d=a.preview&&this.props.trusted?_["default"].createElement("div",{className:"document-thumb",style:{backgroundImage:'url("'+a.preview.url()+'")'}}):null,f=t.caption||a.filename||l10n.t("untitled_document"),p=null,h={href:"#",onClick:null};switch(a.mediaStage){case w["default"].STAGE.RESOLVED:case w["default"].STAGE.ERROR_UNSUPPORTED:h.onClick=this.downloadMedia,p=_["default"].createElement(F["default"].Download,{onClick:h.onClick});break;case w["default"].STAGE.FETCHING:p=_["default"].createElement(F["default"].PendingCancel,null),h.onClick=this.cancelDownload;break;case w["default"].STAGE.NEED_POKE:case w["default"].STAGE.INIT:h.onClick=this.downloadMedia,p=_["default"].createElement(F["default"].Download,{onClick:h.onClick});break;case w["default"].STAGE.UPLOADING:p=_["default"].createElement(F["default"].PendingCancel,null),h.onClick=this.cancelUpload;break;case w["default"].STAGE.NEED_UPLOAD:p=_["default"].createElement(F["default"].Upload,null),h.onClick=this.resumeUpload;break;case w["default"].STAGE.REMOTE_NEED_UPLOAD:p=_["default"].createElement(F["default"].Upload,null),h.onClick=this.resumeRemoteUpload;break;case w["default"].STAGE.ERROR_MISSING:h.onClick=this.showMediaMissing;break;default:p=_["default"].createElement(F["default"].Pending,null)}return _["default"].createElement("div",{className:i},o,this.props.quotedMsg,_["default"].createElement("a",(0,r["default"])({className:"document-container",title:l10n.t("web_download_document",{name:f})},h),d,_["default"].createElement("div",{className:"document-body"},_["default"].createElement("div",{className:"document-icon"},_["default"].createElement("div",{className:c})),_["default"].createElement("div",{className:"document-text"},_["default"].createElement(P["default"],{text:f,ellipsify:!0,selectable:!1,dirMismatch:t.rtl!==l10n.isRTL(),direction:"auto"})),p)),_["default"].createElement("div",{className:"document-meta"},s,u,l),_["default"].createElement(b["default"],{msg:t}))}}]),t}(_["default"].PureComponent);ee.CONCERNS={msg:["broadcast","star","caption","rtl","ack","isSentByMe","isGroupMsg","senderObj"],mediaData:["mediaStage","filename","pageCount","size","mimetype","preview"]},t["default"]=(0,S["default"])(ee)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1498),g=n(v),_=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={hover:!1},n.onMouseEnter=function(){n.setState({hover:!0})},n.onMouseLeave=function(){n.setState({hover:!1})},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.state.hover?m["default"].createElement(g["default"],{direction:"left",className:"tooltip-error"},this.props.errMsg):null;return m["default"].createElement("div",{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,className:"icon-error-container"},e,m["default"].createElement("button",{className:"error",onClick:this.props.onResend},m["default"].createElement("span",{className:"icon icon-error"})))}}]),t}(m["default"].PureComponent);t["default"]=_},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}function o(e){e.stopPropagation()}Object.defineProperty(t,"__esModule",{value:!0});var r=a(6),s=i(r),l=a(3),u=i(l),c=a(4),d=i(c),f=a(8),p=i(f),h=a(7),m=i(h),v=a(5),g=i(v),_=a(1413),y=i(_),E=a(1472),M=i(E),S=a(21),C=i(S),b=a(12),k=i(b),T=a(14),w=i(T),N=a(61),P=i(N),A=a(242),O=i(A),R=a(1424),D=i(R),x=a(1439),I=n(x),L=a(1414),F=i(L),U=a(462),j=i(U),G=a(1432),B=i(G),V=a(1402),H=i(V),W=a(1455),z=i(W),Y=a(239),q=2.4,K=330,Q=K/q,X=3,Z=6,J=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(r))),n.state={playing:!1},n.playerRef=null,n.playCount=0,n.pause=function(){n.playCount=0,n._pause()},n.play=function(e){if(n.props.mediaData.mediaStage===O["default"].STAGE.RESOLVED&&n.playerRef){e&&e.stopPropagation();var t=n.props.mediaData.duration;if(t){var a=Math.ceil(Z/parseInt(t,10));n.playCount=Math.max(a,X)}else n.playCount=X;n._play()}},n._pause=function(){n.setState({playing:!1}),n.playerRef&&n.playerRef.pauseAndReset()},n._play=function(){if(n.playerRef){if(n.playCount<=0)return void n.pause();n.playCount-=1,n.state.playing||n.setState({playing:!0}),n.playerRef.play()}},n.showMediaMissing=function(){k["default"].openModal(g["default"].createElement(D["default"],{msg:n.props.msg}))},n.getZoomNode=function(e){var t=n.props.isMsgVisible;if(!t)return null;var a=t(e);return a?a.getImgNode&&a.getImgNode():null},n.launchMediaViewer=function(e){e&&e.stopPropagation(),k["default"].mediaViewerModal((0,V.unproxy)(n.props.msg),n.getZoomNode)},n.downloadMedia=function(){n.props.msg.forceDownloadMedia()},n.cancelDownload=function(){n.props.msg.cancelDownload()},n.cancelUpload=function(){n.props.msg.cancelUpload()},n.resumeUpload=function(){n.props.msg.resumeUpload()},n.resumeRemoteUpload=function(){P["default"].supportsFeature(P["default"].F.MEDIA_RETRY)?n.props.msg.resumeRemoteUpload():k["default"].openModal(g["default"].createElement(B["default"],{msg:n.props.msg}))},n.onDragStart=function(e){e.nativeEvent.dataTransfer.setData(w["default"].DRAG_TYPE_LOCAL_IMAGE,!0)},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentDidMount",value:function(){this.props.msg.downloadMedia()}},{key:"getStyle",value:function(){var e=this.props.mediaData,t=e.aspectRatio;if(!t)return{bubbleWidth:K,bubbleHeight:"100%",contentWidth:K,contentHeight:"100%"};var a=void 0,n=void 0;1/q>t?(n=K,a=Q):1>t?(n=K,a=K*t):q>t?(a=K,n=K/t):(a=K,n=Q);var i=e.renderableUrl?e.fullWidth||a:a,o=e.renderableUrl?e.fullHeight||n:n;return i/o>a/n?(i=i*n/o,o=n):(o=o*a/i,i=a),{bubbleWidth:a,bubbleHeight:n,contentWidth:i,contentHeight:o}}},{key:"getImgNode",value:function(){return this.playerRef?this.playerRef.underlyingVideo():void 0}},{key:"render",value:function(){var e=this.props.msg,t=this.props.mediaData,a=e.caption?g["default"].createElement(M["default"],{msg:e,contact:e.senderObj}):null,n=a?null:g["default"].createElement("div",{className:"shade"}),i=t.preview?t.preview.url():void 0,r=null,s=null,l=null,u=this.getStyle(),c=u.bubbleWidth,d=u.bubbleHeight,f=u.contentWidth,p=u.contentHeight,h={width:c,height:d};switch(t.mediaStage){case O["default"].STAGE.RESOLVED:this.state.playing||(r=g["default"].createElement("span",{className:"image-gif-control",onClick:this.play},g["default"].createElement("button",{className:"icon icon-media-gif"}))),l=g["default"].createElement(z["default"],{ref:(0,Y.GetRef)("playerRef",this),src:t.renderableUrl,className:"image-thumb-body",width:f,height:p,onEnded:this._play,muted:!0},l10n.t("video_playback_not_supported")),s=this.launchMediaViewer;break;case O["default"].STAGE.INIT:s=this.launchMediaViewer;break;case O["default"].STAGE.FETCHING:r=g["default"].createElement(I.PendingCancel,null),s=this.cancelDownload;break;case O["default"].STAGE.NEED_POKE:r=g["default"].createElement(I.Download,{filesize:t.size}),s=this.downloadMedia;break;case O["default"].STAGE.UPLOADING:r=g["default"].createElement(I.PendingCancel,null),s=this.cancelUpload;break;case O["default"].STAGE.NEED_UPLOAD:r=g["default"].createElement(I.Upload,{filesize:t.size}),s=this.resumeUpload;break;case O["default"].STAGE.REMOTE_NEED_UPLOAD:r=g["default"].createElement(I.Upload,{filesize:t.size}),s=this.resumeRemoteUpload;break;case O["default"].STAGE.ERROR_MISSING:s=this.showMediaMissing;break;default:r=g["default"].createElement(I.Pending,null)}!l&&i&&(l=g["default"].createElement("div",{className:"image-thumb-body image-thumb-gif",style:{backgroundImage:"url("+i+")"}}));var m=(0,C["default"])("bubble-image",{"bubble-image-caption":e.caption,"bubble-broadcast":e.caption&&e.broadcast,"bubble-star":e.caption&&e.star}),v=this.props.displayAuthor&&!e.isSentByMe&&e.isGroupMsg?g["default"].createElement(y["default"],{msg:e,className:"bubble-image-author",contact:e.senderObj}):null,_=void 0;switch(e.gifAttribution){case j["default"].GIF_ATTRIBUTION.GIPHY:_=g["default"].createElement("span",{className:"icon-gif-vendor icon icon-giphy"});break;case j["default"].GIF_ATTRIBUTION.TENOR:_=g["default"].createElement("span",{className:"icon-gif-vendor icon icon-tenor"});break;default:_=null}return g["default"].createElement("div",{className:m,onClick:o,style:{width:h.width}},v,this.props.quotedMsg,g["default"].createElement("div",{className:"image-thumb",onClick:s,style:h},r,l,n,_),a,g["default"].createElement(F["default"],{msg:this.props.msg}))}}]),t}(g["default"].PureComponent);J.CONCERNS={msg:["id","ack","caption","broadcast","star","isSentByMe","isGroupMsg","gifAttribution","senderObj"],mediaData:["aspectRatio","preview","duration","type","mediaStage","renderableUrl","fullWidth","fullHeight","size"]},t["default"]=(0,H["default"])(J)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.EMOJI_SIZE=void 0;var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(21),y=n(_),E=a(1423),M=n(E),S=a(482),C=n(S),b=a(1462),k=n(b),T=a(118),w=a(14),N=a(78),P=n(N),A=t.EMOJI_SIZE={LARGE:"large",XLARGE:"xlarge"};t["default"]=(0,P["default"])((o=i=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(r))),n.state={assetLoaded:!1},n.onAssetLoaded=function(){n.setState({assetLoaded:!0})},n.onCopy=function(e){if(e.clipboardData){var t=window.getSelection();e.clipboardData.setData("text/plain",k["default"].asPlainText(t))}e.stopPropagation(),e.preventDefault()},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){var e=this;this.props.listeners.add(window,"dpichange",function(){e.setState({assetLoaded:!1})})}},{key:"render",value:function(){var e=T.emojiMap[this.props.emoji];if(!e)return null;var t=(0,T.getEmojiPath)(e,this.props.emojiSize)[C["default"].currentRes],a=void 0;a=this.state.assetLoaded?(0,y["default"])("large-emoji","selectable-text",{"heart-animation":this.props.animation}):(0,y["default"])((0,T.getClasses)(e),"selectable-text");var n=(0,y["default"])("large-emoji-container",this.props.className);return this.props.animation&&this.state.assetLoaded?g["default"].createElement("div",{className:n,onCopy:this.onCopy},g["default"].createElement("img",{className:"large-emoji selectable-text image",src:w.ONE_BY_ONE_TRANS_GIF,alt:this.props.emoji}),g["default"].createElement(M["default"],{className:"large-emoji heart-animation container",draggable:!1,src:t})):g["default"].createElement("div",{className:n,onCopy:this.onCopy},g["default"].createElement(M["default"],{draggable:!1,onLoad:this.onAssetLoaded,alt:this.props.emoji,src:t,className:a}))}}]),t}(g["default"].Component),i.defaultProps={emojiSize:A.LARGE,animation:!1},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e
}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(462),g=(n(v),a(1402)),_=n(g),y=a(48),E=n(y),M=a(478),S=n(M),C=a(21),b=n(C),k=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onClick=function(e){var t=document.createElement("a");t.href=n.props.msg.matchedText,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t)},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.msg,a=e.invite,n=void 0;t.thumbnail&&(n=m["default"].createElement("img",{className:a?"group-invite-preview":"link-preview-media",src:"data:image/jpeg;base64,"+t.thumbnail}));var i=t.title?m["default"].createElement("div",{className:"link-preview-title",title:t.title},t.title):null,o=t.description?m["default"].createElement("div",{className:"link-preview-description",title:t.description},t.description):null,r=(0,b["default"])("link-preview-body",{nothumb:!n}),s=a?null:m["default"].createElement("div",{className:"link-preview-source ellipsify"},S["default"].toUnicode(E["default"].hostname(t.canonicalUrl||t.matchedText)));return m["default"].createElement("div",{className:"link-preview-container",onClick:this.onClick},n,m["default"].createElement("div",{className:r},i,o,s))}}]),t}(m["default"].PureComponent);k.CONCERNS={msg:["thumbnail","title","description","canonicalUrl","matchedText"]},t["default"]=(0,_["default"])(k)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(21),g=n(v),_=a(1414),y=n(_),E=a(1413),M=n(E),S=a(1607),C=n(S),b=a(462),k=(n(b),a(160)),T=n(k),w=a(1403),N=n(w),P=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props.msg,t=this.props.displayAuthor&&!e.isSentByMe&&e.isGroupMsg?m["default"].createElement(M["default"],{msg:e,className:"bubble-live-author",contact:e.senderObj}):null,a=(0,g["default"])("message-text",{"empty-text":!e.comment});return m["default"].createElement("div",{className:"bubble bubble-placeholder"},t,m["default"].createElement("div",{className:a},m["default"].createElement(C["default"],{msg:e,type:S.TYPE.LIVE_LOCATION}),m["default"].createElement(N["default"],{text:e.comment,selectable:!0,dirMismatch:e.rtl!==T["default"].isRTL(),direction:e.dir})),m["default"].createElement(y["default"],{msg:this.props.msg}))}}]),t}(m["default"].Component);t["default"]=P},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(242),y=(n(_),a(462)),E=n(y),M=a(1402),S=n(M);t["default"]=(0,S["default"])((o=i=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.mediaData,a=e.className,n=t.type===E["default"].TYPE.IMAGE&&t.renderableUrl?t.renderableUrl:t.preview&&t.preview.url();return n?g["default"].createElement("div",{style:{backgroundImage:"url("+n+")"},className:a}):null}}]),t}(g["default"].PureComponent),i.CONCERNS={mediaData:["type","preview","renderableUrl"]},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1402),g=n(v),_=a(462),y=n(_),E=a(21),M=n(E),S={FRONT:"FRONT",MID:"MID",END:"END",SINGLE:"SINGLE"},C=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"click",value:function(){this.refs.context.click()}},{key:"onMouseDown",value:function(e){e.stopPropagation()}},{key:"render",value:function(){var e=this.props,t=e.msg,a=e.position,n=e.onClick,i=t.isSentByMe,o=t.isGroupMsg,r=t.type,s=!!t.quotedMsg,l=i?"context-out":"context-in",u=t.type===y["default"].TYPE.DOCUMENT&&!t.body,c=t.type===y["default"].TYPE.DOCUMENT&&t.body,d=r===y["default"].TYPE.LOCATION,f=t.isMedia&&r!==y["default"].TYPE.AUDIO||c||d||s,p=!1;o&&(p=!i&&(a===S.FRONT||a===S.SINGLE||s),f=f&&!p);var h=r===y["default"].TYPE.CHAT&&t.matchedText&&t.matchedText.length&&t.body.indexOf(t.matchedText)>-1&&!p&&t.isTrusted(),v=(0,M["default"])("js-context-icon",f?"context-icon-media":"context-icon"),g=r===y["default"].TYPE.PTT||r===y["default"].TYPE.AUDIO,_=(0,M["default"])(l,{context:!(f||h),"context-media":f,"context-media-document":c,"context-ptt":g&&!s,"context-ptt-author":g&&p&&!s,"context-special":(h||u)&&!p&&!s,"context-doc":u&&!p&&!s,"context-inverse":r===y["default"].TYPE.CHAT&&!s&&!!t.dir&&t.rtl!==l10n.isRTL()});return m["default"].createElement("div",{className:_},m["default"].createElement("div",{className:v,ref:"context",onMouseDown:this.onMouseDown,onClick:n}))}}]),t}(m["default"].PureComponent);C.CONCERNS={msg:["matchedText","dir","rtl","isMedia","isSentByMe","isGroupMsg","type","quotedMsg","body"]},t["default"]=(0,g["default"])(C)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.TYPE=void 0;var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(462),g=(n(v),a(160)),_=n(g),y=t.TYPE={LIVE_LOCATION:"LIVE_LOCATION"},E=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=void 0,t=void 0;switch(this.props.type){case y.LIVE_LOCATION:e=_["default"].t("check_phone_for_live_location"),t=m["default"].createElement("span",{className:"icon icon-live-location placeholder-icon"});break;default:throw new Error("Unrecognized type")}return m["default"].createElement("div",{className:"msg-desc-container"},t,e)}}]),t}(m["default"].Component);t["default"]=E},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1602),g=n(v),_=a(13),y=n(_),E=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this,t=this.props.emojis,a=y["default"].size(t);if(0===a)return null;var n=void 0,i=void 0;switch(a){default:case 3:n=v.EMOJI_SIZE.LARGE,i="large-emoji-three";break;case 2:n=v.EMOJI_SIZE.LARGE,i="large-emoji-two";break;case 1:n=v.EMOJI_SIZE.XLARGE,i="large-emoji-one"}var o=t.map(function(t,a){return m["default"].createElement(g["default"],{animation:e.props.animation,emoji:t,className:i,key:t+a,emojiSize:n})});return m["default"].createElement("div",{className:"multi-emoji"},o)}}]),t}(m["default"].Component);t["default"]=E},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(13),m=n(h),v=a(1413),g=n(v),_=a(12),y=n(_),E=a(21),M=n(E),S=a(1403),C=n(S),b=a(1414),k=n(b),T=a(462),w=(n(T),a(1671)),N=n(w),P=a(492),A=n(P),O=a(1409),R=n(O),D=a(1456),x=n(D),I=a(5),L=n(I),F=a(1402),U=n(F),j=a(469),G=n(j),B=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n._showContactsModal=function(){y["default"].openModal(L["default"].createElement(N["default"],{msg:n.props.msg}))},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"_renderProfilePics",value:function(){for(var e=(0,m["default"])(this.props.msg.vcardList).map(function(e,t){var a=G["default"].thumbnailWAid(G["default"].vcardWAids(G["default"].parse(e.vcard))),n=G["default"].thumbnail(e.vcard);return a||n?L["default"].createElement(x["default"],{key:t,waid:a,thumb:n,size:R["default"].Size.NONE,className:"preview-vcard-multi preview-vcard"}):void 0}).filter().take(3).value(),t=Math.min(3-e.length,this.props.msg.vcardList.length-e.length),a=0;t>a;a++)e.push(L["default"].createElement(x["default"],{key:"default-"+a,size:R["default"].Size.NONE,className:"preview-vcard-multi preview-vcard"}));return e}},{key:"render",value:function(){var e=this.props,t=e.msg,a=e.quotedMsg,n=(0,M["default"])(["bubble","bubble-vcard"],{"bubble-attach-caption":!!t.caption,"bubble-vcard-quoted":!!a}),i=(0,M["default"])("vcard-avatar",{"quoted-msg-bubble-vcard":!!a}),o=this.props.displayAuthor&&!t.isSentByMe&&t.isGroupMsg?L["default"].createElement(g["default"],{msg:t,className:"bubble-vcard-author",contact:t.senderObj}):null,r=null,s=A["default"].getNameString(t.vcardList),l=a?L["default"].createElement(x["default"],{className:"preview-vcard",size:R["default"].Size.NONE}):this._renderProfilePics();return L["default"].createElement("div",{className:n},o,a,L["default"].createElement("div",{className:"wrapper wrapper-vcard wrapper-vcard-multi",title:s,onClick:this._showContactsModal},L["default"].createElement("div",{className:"vcard"},L["default"].createElement("div",{className:i},l),L["default"].createElement("div",{className:"vcard-body"},L["default"].createElement(C["default"],{text:s,element:"div",className:"vcard-name vcard-name-multi",dirMismatch:t.rtl!==l10n.isRTL(),direction:t.dir,wbr:15}))),L["default"].createElement(k["default"],{msg:t})),r)}}]),t}(L["default"].PureComponent);B.CONCERNS={msg:["caption","rtl","dir","senderObj","vcardList","isSentByMe","isGroupMsg"]},t["default"]=(0,U["default"])(B)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,a){M["default"].openModal(y["default"].createElement(C["default"],{e2eSubtype:e,jid:t,chatId:a}))}function o(e){var t=y["default"].createElement(P["default"],{chat:e,groupMetadata:e?e.groupMetadata:void 0,onBack:function(){return M["default"].closeDrawerRight()}});M["default"].openDrawerRight(t,"slide-left")}Object.defineProperty(t,"__esModule",{value:!0});var r,s,l=a(6),u=n(l),c=a(3),d=n(c),f=a(4),p=n(f),h=a(8),m=n(h),v=a(7),g=n(v),_=a(5),y=n(_),E=a(12),M=n(E),S=a(1660),C=n(S),b=a(1403),k=n(b),T=a(467),w=n(T),N=a(1514),P=n(N),A=a(1419),O=n(A),R=a(462),D=n(R),x=a(1402),I=n(x);t["default"]=(0,I["default"])((s=r=function(e){function t(){return(0,d["default"])(this,t),(0,m["default"])(this,(t.__proto__||(0,u["default"])(t)).apply(this,arguments))}return(0,g["default"])(t,e),(0,p["default"])(t,[{key:"render",value:function(){var e=this.props.msg,t=void 0,a=void 0,n=void 0;!function(){switch(e.type){case D["default"].TYPE.GP2:case D["default"].TYPE.GROUP_NOTIFICATION:a=w["default"].formatGroupNotification((0,x.unproxy)(e)),"revoke_invite"===e.subtype&&!function(){var t=e.chat;n=function(){o(t)}}();break;case D["default"].TYPE.BROADCAST_NOTIFICATION:a=w["default"].formatBroadcastNotification(e.subtype,e.body);break;case D["default"].TYPE.E2E_NOTIFICATION:a=w["default"].formatE2ENotification((0,x.unproxy)(e));var r=e.subtype,s=e.body,l=e.id.remote;n=function(){i(r,s,l)};break;case D["default"].TYPE.CALL_LOG:t="miss_video"===e.subtype?y["default"].createElement("span",{className:"icon icon-miss_video"}):y["default"].createElement("span",{className:"icon icon-miss"}),a=w["default"].formatCallLog((0,x.unproxy)(e),!0)}}();var r=y["default"].createElement(O["default"],null,t,y["default"].createElement(k["default"],{direction:l10n.isRTL()?"rtl":"ltr",text:a}));return n?y["default"].createElement("div",{role:"button",onClick:n},r):y["default"].createElement("span",null,r)}}]),t}(y["default"].PureComponent),r.CONCERNS={msg:["id","body","chat","type","subtype"]},s))},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(!e)return Y;var t=void 0;return t=1>=e?Y:2.4>=e?z/e:z/2.4,Math.round(t)}function r(e,t,a,n){return e&&t&&a&&n?t/e>n/a?{height:"100%"}:{width:"100%"}:{height:"100%",width:"100%"}}function s(e){e.stopPropagation()}Object.defineProperty(t,"__esModule",{value:!0});var l=a(6),u=i(l),c=a(3),d=i(c),f=a(4),p=i(f),h=a(8),m=i(h),v=a(7),g=i(v),_=a(5),y=i(_),E=a(1413),M=i(E),S=a(1402),C=i(S),b=a(1472),k=i(b),T=a(21),w=i(T),N=a(12),P=i(N),A=a(1424),O=i(A),R=a(1432),D=i(R),x=a(242),I=i(x),L=a(1439),F=n(L),U=a(1414),j=i(U),G=a(462),B=(i(G),a(61)),V=i(B),H=a(14),W=i(H),z=330,Y=330,q=function(e){function t(){var e,a,n,i;(0,d["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,m["default"])(this,(e=t.__proto__||(0,u["default"])(t)).call.apply(e,[this].concat(r))),n.showMediaMissing=function(){P["default"].openModal(y["default"].createElement(O["default"],{msg:n.props.msg}))},n.getZoomNode=function(e){var t=n.props.isMsgVisible;if(!t)return null;var a=t(e);return a?a.getImgNode&&a.getImgNode():null},n.launchMediaViewer=function(e){e&&e.stopPropagation(),P["default"].mediaViewerModal((0,S.unproxy)(n.props.msg),n.getZoomNode)},n.downloadMedia=function(){n.props.msg.forceDownloadMedia()},n.cancelDownload=function(){n.props.msg.cancelDownload()},n.cancelUpload=function(){n.props.msg.cancelUpload()},n.resumeUpload=function(){n.props.msg.resumeUpload()},n.resumeRemoteUpload=function(){V["default"].supportsFeature(V["default"].F.MEDIA_RETRY)?n.props.msg.resumeRemoteUpload():P["default"].openModal(y["default"].createElement(D["default"],{msg:n.props.msg}))},i=a,(0,m["default"])(n,i)}return(0,g["default"])(t,e),(0,p["default"])(t,[{key:"componentDidMount",value:function(){this.props.msg.downloadMedia()}},{key:"onDragStart",value:function(e){e.nativeEvent.dataTransfer.setData(W["default"].DRAG_TYPE_LOCAL_IMAGE,!0)}},{key:"getImgNode",value:function(){return this.refs.img}},{key:"render",value:function(){var e=this.props.msg,t=this.props.mediaData,a=e.caption?null:y["default"].createElement("div",{className:"shade"}),n=e.caption?y["default"].createElement(k["default"],{msg:e,contact:e.senderObj}):null,i=t.renderableUrl||t.preview&&t.preview.url(),l=null,u=null;switch(t.mediaStage){case I["default"].STAGE.RESOLVED:u=this.launchMediaViewer;break;case I["default"].STAGE.FETCHING:l=y["default"].createElement(F.PendingCancel,null),u=this.cancelDownload;break;case I["default"].STAGE.NEED_POKE:l=y["default"].createElement(F.Download,{filesize:t.size}),u=this.downloadMedia;break;case I["default"].STAGE.UPLOADING:l=y["default"].createElement(F.PendingCancel,null),u=this.cancelUpload;break;case I["default"].STAGE.NEED_UPLOAD:l=y["default"].createElement(F.Upload,{filesize:t.size}),u=this.resumeUpload;break;case I["default"].STAGE.REMOTE_NEED_UPLOAD:l=y["default"].createElement(F.Upload,{filesize:t.size}),u=this.resumeRemoteUpload;break;case I["default"].STAGE.ERROR_MISSING:u=this.showMediaMissing;break;case I["default"].STAGE.ERROR_UNSUPPORTED:l=y["default"].createElement(F.Download,{filesize:t.size}),u=this.launchMediaViewer;break;default:l=y["default"].createElement(F.Pending,null)}var c=(0,w["default"])("bubble-image",{"bubble-image-caption":e.caption,"bubble-broadcast":e.caption&&e.broadcast,"bubble-star":e.caption&&e.star}),d=(0,w["default"])("image-thumb-body",{"image-thumb-lores":!t.renderableUrl}),f=this.props.displayAuthor&&!e.isSentByMe&&e.isGroupMsg?y["default"].createElement(M["default"],{msg:e,className:"bubble-image-author",contact:e.senderObj}):null,p=z,h=o(t.aspectRatio),m={width:p,height:h},v=t.fullHeight||h,g=t.fullWidth||p,_=r(v,g,h,p);return y["default"].createElement("div",{className:c,onClick:s},f,this.props.quotedMsg,y["default"].createElement("div",{className:"image-thumb",onClick:u,style:m},l,y["default"].createElement("img",{src:i,onDragStart:this.onDragStart,className:d,style:_,ref:"img"}),a),n,y["default"].createElement(j["default"],{msg:e}))}}]),t}(y["default"].PureComponent);q.CONCERNS={msg:["id","ack","caption","broadcast","star","isSentByMe","isGroupMsg","senderObj"],mediaData:["aspectRatio","preview","mediaStage","renderableUrl","fullWidth","fullHeight","size"]},t["default"]=(0,C["default"])(q)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(14),g=n(v),_=a(1402),y=n(_),E=a(21),M=n(E),S=a(79),C=n(S),b=a(1419),k=n(b),T=a(48),w=n(T),N=a(1414),P=n(N),A=a(1413),O=n(A),R=a(1505),D=n(R),x=a(1432),I=n(x),L=a(12),F=n(L),U=a(61),j=n(U),G=a(462),B=(n(G),a(1433)),V=(n(B),a(242)),H=n(V),W=a(1424),z=n(W),Y=a(161),q=n(Y),K=function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));return a.showMediaMissing=function(){F["default"].openModal(m["default"].createElement(z["default"],{msg:a.props.msg}))},a.downloadMedia=function(){a.props.msg.forceDownloadMedia()},a.cancelDownload=function(){a.props.msg.cancelDownload()},a.cancelUpload=function(){a.props.msg.cancelUpload()},a.resumeUpload=function(){a.props.msg.resumeUpload()},a.resumeRemoteUpload=function(){j["default"].supportsFeature(j["default"].F.MEDIA_RETRY)?a.props.msg.resumeRemoteUpload():F["default"].openModal(m["default"].createElement(I["default"],{msg:a.props.msg}))},a.handleTimeUpdate=function(e){a.setState({currentTime:e})},a.handlePlayingUpdate=function(e){e&&a.props.msg.canSendPlayed()&&a.props.msg.sendPlayed(),a.setState({autoPlay:!1,playing:e})},a.state={currentTime:0,playing:!1,autoPlay:!1},a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){this.props.msg.downloadMedia()}},{key:"loader",value:function(e,t,a){return a=a?m["default"].createElement(q["default"],{stroke:3,size:38}):null,m["default"].createElement("div",{className:"audio"},m["default"].createElement("div",{className:"audio-controls"},m["default"].createElement("button",{className:"btn-audio "+(t?"icon "+t:""),onClick:e},a)),m["default"].createElement("div",{className:"audio-body"},m["default"].createElement("input",{type:"range",className:"audio-track",min:0,max:100,value:0,disabled:"disabled"})))}},{key:"render",value:function(){var e=this.props.msg,t=this.props.mediaData,a=(0,M["default"])("bubble bubble-attach bubble-audio audio-state-default",{"audio-state-played":e.ack===g["default"].ACK_PLAYED}),n=(0,M["default"])("audio-status icon",e.ack===g["default"].ACK_PLAYED?e.isSentByMe?"icon-ptt-out-blue":"icon-ptt-in-blue":e.isSentByMe?"icon-ptt-out-gray":"icon-ptt-in-green"),i=m["default"].createElement("span",{className:n,key:"status"}),o=this.state.playing?this.state.currentTime:t.duration,r=!!this.props.quotedMsg,s=this.props.profilePicThumb.img,l=(0,M["default"])("preview","icon-user-default",{"preview-ptt":r,"quoted-msg-bubble-ptt":r,"icon-user-default-square":r,"no-image":!s}),u=m["default"].createElement("div",{className:l,key:"image"},m["default"].createElement("div",{className:"preview-image",style:w["default"].thumbAsBackgroundImage(s)}),m["default"].createElement("span",{className:"meta meta-audio"},m["default"].createElement(k["default"],null,C["default"].durationStr(o)))),c=e.isSentByMe?[u,i]:null,d=e.isSentByMe?null:[u,i],f=e.isSentByMe?"text no-author":"text",p=void 0;switch(t.mediaStage){case H["default"].STAGE.RESOLVED:p=m["default"].createElement(D["default"],{url:t.renderableUrl,playing:this.state.playing,autoPlay:this.state.autoPlay,onPlayingUpdate:this.handlePlayingUpdate,onTimeUpdate:this.handleTimeUpdate});break;case H["default"].STAGE.NEED_POKE:p=this.loader(this.downloadMedia,"icon-audio-download");break;case H["default"].STAGE.NEED_UPLOAD:p=this.loader(this.resumeUpload,"icon-audio-upload");break;case H["default"].STAGE.REMOTE_NEED_UPLOAD:p=this.loader(this.resumeRemoteUpload,"icon-audio-upload");break;case H["default"].STAGE.ERROR_MISSING:p=this.loader(this.showMediaMissing,"icon-audio-play");break;default:p=this.loader(null,null,!0)}var h=this.props.displayAuthor&&!e.isSentByMe&&e.isGroupMsg?m["default"].createElement(O["default"],{msg:e,contact:e.senderObj,className:"bubble-audio-author"}):null;return m["default"].createElement("div",{className:a},r?h:null,this.props.quotedMsg,m["default"].createElement("div",{className:"wrapper"},c,m["default"].createElement("div",{className:"contents"},this.props.quotedMsg?null:h,m["default"].createElement("div",{className:f},p)),d,m["default"].createElement(P["default"],{msg:e})))}}]),t}(m["default"].PureComponent);K.CONCERNS={msg:["ack","isSentByMe","isGroupMsg","senderObj"],mediaData:["duration","type","mediaStage","renderableUrl"],profilePicThumb:["img"]},t["default"]=(0,y["default"])(K)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(462),m=(n(h),a(5)),v=n(m),g=a(1414),_=n(g),y=a(1413),E=n(y),M=a(21),S=n(M),C=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props.msg,t=this.props.displayAuthor&&!e.isSentByMe&&e.isGroupMsg?v["default"].createElement(E["default"],{msg:e,className:"bubble-placeholder-author",contact:e.senderObj}):null,a=(0,S["default"])("bubble bubble-placeholder bubble-revoked",{"has-author":!!t}),n=e.isSentByMe?l10n.t("revoke_outgoing"):l10n.t("revoke_incoming");return v["default"].createElement("div",{className:a},t,v["default"].createElement("div",{className:"message-text"},v["default"].createElement("span",{className:"placeholder-msg"},n)),v["default"].createElement(_["default"],{msg:e}))}}]),t}(v["default"].Component);t["default"]=C},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(462),g=n(v),_=a(1402),y=n(_),E=a(21),M=n(E),S=g["default"].TYPE,C=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props.msg,t=e.ack,a=e.isMedia&&!e.caption&&e.type!==S.AUDIO||e.type===S.LOCATION&&!e.loc&&!e.isLive,n=void 0;return n=1>t?a?"icon-msg-time-light":"icon-msg-time":1===t?a?"icon-msg-check-light":"icon-msg-check":2===t?a?"icon-msg-dblcheck-light":"icon-msg-dblcheck":a?"icon-msg-dblcheck-ack-light":"icon-msg-dblcheck-ack",m["default"].createElement("span",{className:(0,M["default"])("icon",n)})}}]),t}(m["default"].PureComponent);C.CONCERNS={msg:["ack","isMedia","caption","type","loc","isLive"]},t["default"]=(0,y["default"])(C)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1419),g=n(v),_=a(1403),y=n(_),E=a(115),M=n(E),S=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={date:void 0,hide:!1},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"updateDateMarkerText",value:function(e){this.setState({date:e})}},{key:"hideStickyDateMarker",value:function(e){this.setState({hide:e})}},{key:"render",value:function(){var e=void 0;return this.state.date&&!this.state.hide&&(e=m["default"].createElement("div",{className:"msg msg-system sticky-date-marker-floating-container"},m["default"].createElement("div",{className:"sticky-date-marker-floating-wrapper message-system"},m["default"].createElement("span",{className:"message-system-body"},m["default"].createElement(g["default"],null,m["default"].createElement(y["default"],{direction:"auto",text:this.state.date})))))),m["default"].createElement(M["default"],{transitionName:"slide-down-date"},e)}}]),t}(h.PureComponent);t["default"]=S},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(16),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(1413),y=n(_),E=a(1414),M=n(E),S=a(1603),C=n(S),b=a(1502),k=n(b),T=a(160),w=n(T),N=a(462),P=(n(N),a(241)),A=(n(P),a(14)),O=n(A),R=a(1403),D=n(R),x=a(21),I=n(x),L=a(248),F=a(1608),U=n(F),j=a(118),G=n(j),B=a(466),V=function(e){function t(e){(0,u["default"])(this,t);var a=(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this,e));return a.state={folded:a.props.msg.body.length>=O["default"].MSG_TRUNC_LENGTH},a}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.msg,n=t.contact,i=t.displayAuthor,r=t.trusted,s=i&&!a.isSentByMe&&a.isGroupMsg?g["default"].createElement(y["default"],{msg:a,contact:a.senderObj,className:"bubble-text-author"}):null,l=(0,I["default"])("bubble","bubble-text",{"bubble-broadcast":a.broadcast,"bubble-star":a.star,"has-author":!!s}),u=void 0,c=void 0;if(r&&a.linkPreview){var d=(0,L.parseCmd)(a.matchedText),f=(0,o["default"])(d,1),p=f[0];if(p===L.Cmd.GROUP_INVITE){u=g["default"].createElement(C["default"],{msg:a,invite:!0});var h=function(e){var t=document.createElement("a");t.href=a.matchedText,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t)},m=a.isSentByMe?w["default"].t("group_invite_view"):w["default"].t("group_invite_join");c=g["default"].createElement("div",{className:"bubble-actions"},g["default"].createElement("div",{className:"bubble-btn",onClick:h,title:m},m))}else u=g["default"].createElement(C["default"],{msg:a})}var v=void 0,_=void 0,E=G["default"].getMatchedEmojis(a.body);if(E){_="message-text-emoji";var S=1===E.length&&"â¤"===E[0];v=g["default"].createElement(U["default"],{animation:S,emojis:E})}else{var b=a.mentionMap(),T=r?B.Configuration.TrustedConversation:B.Configuration.UntrustedConversation;v=g["default"].createElement(D["default"],{text:a.body,selectable:!0,dirMismatch:a.rtl!==w["default"].isRTL(),direction:a.dir,formatters:T(b),textLimit:this.state.folded?O["default"].MSG_TRUNC_LENGTH:1/0})}var N=this.state.folded?g["default"].createElement("span",{className:(0,I["default"])("read-more"),onClick:function(){e.setState({folded:!1})}}," "+w["default"].t("read_more")):null;return g["default"].createElement("div",{className:l},s,this.props.quotedMsg,g["default"].createElement("div",{className:(0,I["default"])("message-text",_),"data-id":a.id},u,g["default"].createElement(k["default"],{t:a.t,name:n.formattedUser}),v,N),g["default"].createElement(M["default"],{msg:a}),c)}}]),t}(g["default"].PureComponent);t["default"]=V},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(5),o=n(i),r=a(1419),s=n(r),l=a(160),u=n(l);t["default"]=function(e){var t=e.count,a=u["default"].t("unread_message_count",{count:u["default"].n(t),_plural:t});return o["default"].createElement("div",{className:"msg-unread"},o["default"].createElement("span",{className:"msg-unread-body"},o["default"].createElement(s["default"],null,a)))}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(5),o=n(i),r=a(21),s=n(r),l=a(1414),u=n(l),c=a(1413),d=n(c),f=a(467),p=n(f),h=a(251),m=n(h),v=a(462),g=(n(v),a(160)),_=n(g);t["default"]=function(e){var t=e.msg,a=e.displayAuthor,n=a&&!t.isSentByMe&&t.isGroupMsg?o["default"].createElement(d["default"],{msg:t,className:"bubble-placeholder-author",contact:t.senderObj}):null,i=(0,s["default"])("bubble bubble-placeholder",{"has-author":!!n}),r="message-text",l=t.isSentByMe||!t.subtype?o["default"].createElement("a",{className:"text-clickable placeholder-msg-action",onClick:m["default"].restart.bind(m["default"])},_["default"].t("unsupported_msg_web_click_to_update")):null;return o["default"].createElement("div",{className:i},n,o["default"].createElement("div",{className:"icon icon-unknown placeholder-icon"}),o["default"].createElement("div",{className:r},o["default"].createElement("span",null,o["default"].createElement("span",{className:"placeholder-msg"},p["default"].msgText(t)),l)),o["default"].createElement(u["default"],{msg:t}))}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(13),g=n(v),_=a(466),y=a(1630),E=n(y),M=a(1413),S=n(M),C=a(12),b=n(C),k=a(238),T=n(k),w=a(1655),N=n(w),P=a(21),A=n(P),O=a(471),R=n(O),D=a(1403),x=n(D),I=a(1414),L=n(I),F=a(462),U=(n(F),a(1409)),j=n(U),G=a(1456),B=n(G),V=a(5),H=n(V),W=a(1402),z=n(W),Y=a(469),q=n(Y),K=a(1688),Q=n(K);t["default"]=(0,z["default"])((o=i=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(r))),n.onMessageClick=function(){var e=n.props.msg.getWAids();e.length>1?b["default"].openModal(H["default"].createElement(Q["default"],{vCard:n.props.msg.vcard,onCancel:b["default"].closeModal.bind(b["default"]),onSelect:n.openContactChat})):n.openContactChat(g["default"].first(e))},n.onViewContact=function(){n.props.msg.vcard?b["default"].openModal(H["default"].createElement(N["default"],{msg:n.props.msg})):b["default"].openModal(H["default"].createElement(T["default"],{onCancel:b["default"].closeModal.bind(b["default"]),onOK:function(){b["default"].closeModal(),R["default"].initDownload((0,W.unproxy)(n.props.msg))},okText:l10n.t("web_button_download"),cancelText:l10n.t("web_cancel"),title:l10n.t("download_contact_title")},l10n.t("download_contact_prompt")))},n.onAddToGroupClick=function(){var e=n.props.msg.getWAids();e.length>1?b["default"].openModal(H["default"].createElement(Q["default"],{vCard:n.props.msg.vcard,onCancel:b["default"].closeModal.bind(b["default"]),onSelect:n.addContactToGroup,iconClass:"icon icon-add-user"})):n.addContactToGroup(g["default"].first(e))},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"openContactChat",value:function(e){Store.Chat.find(e).then(function(e){b["default"].closeModal(),b["default"].openChatFromUnread(e).then(function(t){t&&b["default"].focusChatTextInput(e)})})}},{key:"addContactToGroup",value:function(e){Store.Contact.find(e).then(function(e){b["default"].openModal(H["default"].createElement(E["default"],{contact:e,pushTransition:"none",popTransition:"none"}),"modal-flow")})}},{key:"render",value:function(){var e=this.props.msg,t=e.getWAids(),a="vcard-avatar vcard-avatar-single",n=(0,A["default"])(["bubble","bubble-vcard"],{"bubble-attach-caption":!!e.caption,"bubble-vcard-quoted":e.isQuoted()}),i=g["default"].truncate(e.subtype||l10n.t("attach_vcard"),{length:120,omission:l10n.t("punctuation_ellipsis")
}),o=void 0;t.length>0&&(o=H["default"].createElement("div",{className:"bubble-actions"},H["default"].createElement("div",{className:"bubble-btn",onClick:this.onMessageClick,title:l10n.t("message_author",{author:i})},l10n.t("message")),H["default"].createElement("div",{className:"bubble-btn",onClick:this.onAddToGroupClick,title:l10n.t("add_contact_to_group")},l10n.t("add_contact_to_group"))));var r=this.props.displayAuthor&&!e.isSentByMe&&e.isGroupMsg?H["default"].createElement(S["default"],{msg:e,className:"bubble-vcard-author",contact:e.senderObj}):null,s=this.props.msg.vcard||this.props.msg.chat.isTrusted(),l=(0,A["default"])({vcard:!0,"vcard-pointer":s}),u=s?this.onViewContact:g["default"].noop;return H["default"].createElement("div",{className:n},r,this.props.quotedMsg,H["default"].createElement("div",{className:"wrapper wrapper-vcard",onClick:u},H["default"].createElement("div",{className:l},H["default"].createElement(B["default"],{className:a,size:j["default"].Size.SMALL,thumb:q["default"].thumbnail(e.body),waid:e.getVCardThumbnailWAid()}),H["default"].createElement("div",{className:"vcard-body"},H["default"].createElement(x["default"],{text:i,element:"div",className:"vcard-name vcard-name-single",selectable:!0,dirMismatch:e.rtl!==l10n.isRTL(),direction:e.dir,formatters:_.Configuration.Compatibility()}))),H["default"].createElement(L["default"],{msg:e})),o)}}]),t}(V.Component),i.CONCERNS={msg:["vcard","caption","isQuoted","body","subtype","rtl","dir","isSentByMe","isGroupMsg","senderObj","chat"]},o))},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}function o(e){e.stopPropagation()}Object.defineProperty(t,"__esModule",{value:!0});var r=a(6),s=i(r),l=a(3),u=i(l),c=a(4),d=i(c),f=a(8),p=i(f),h=a(7),m=i(h),v=a(5),g=i(v),_=a(462),y=(i(_),a(1402)),E=i(y),M=a(242),S=i(M),C=a(1439),b=n(C),k=a(1472),T=i(k),w=a(1414),N=i(w),P=a(1413),A=i(P),O=a(12),R=i(O),D=a(1424),x=i(D),I=a(1432),L=i(I),F=a(61),U=i(F),j=a(79),G=i(j),B=a(471),V=i(B),H=a(238),W=i(H),z=a(1),Y=i(z),q=a(48),K=i(q),Q=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(r))),n.showMediaMissing=function(){R["default"].openModal(g["default"].createElement(x["default"],{msg:n.props.msg}))},n.downloadMedia=function(){n.props.msg.forceDownloadMedia()},n.cancelDownload=function(){n.props.msg.cancelDownload()},n.cancelUpload=function(){n.props.msg.cancelUpload()},n.resumeUpload=function(){n.props.msg.resumeUpload()},n.resumeRemoteUpload=function(){U["default"].supportsFeature(U["default"].F.MEDIA_RETRY)?n.props.msg.resumeRemoteUpload():R["default"].openModal(g["default"].createElement(L["default"],{msg:n.props.msg}))},n.getZoomNode=function(e){var t=n.props.isMsgVisible;if(!t)return null;var a=t(e);return a?a.getImgNode&&a.getImgNode():null},n.downloadUnsupportedToDesktop=function(e){e&&e.stopPropagation(),R["default"].openModal(g["default"].createElement(W["default"],{onCancel:R["default"].closeModal.bind(R["default"]),onOK:function(){R["default"].closeModal(),V["default"].initDownload((0,y.unproxy)(n.props.msg))},okText:l10n.t("web_button_download"),cancelText:l10n.t("web_cancel"),title:l10n.t("download_unsupported_media_title")},l10n.t("download_unsupported_media_prompt")))},n.launchMediaViewer=function(e){e&&e.stopPropagation(),R["default"].mediaViewerModal((0,y.unproxy)(n.props.msg),n.getZoomNode)},n.launchVideoFloater=function(e){e&&e.stopPropagation(),R["default"].videoPlayerFloater((0,y.unproxy)(n.props.msg),n.getZoomNode)},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props.msg,t=this.props.mediaData,a=null,n=null;switch(t.mediaStage){case S["default"].STAGE.RESOLVED:case S["default"].STAGE.INIT:a=g["default"].createElement(b.Play,null),n=this.launchMediaViewer;break;case S["default"].STAGE.NEED_POKE:a=g["default"].createElement(b.Download,{filesize:t.size}),n=this.downloadMedia;break;case S["default"].STAGE.UPLOADING:a=g["default"].createElement(b.PendingCancel,null),n=this.cancelUpload;break;case S["default"].STAGE.NEED_UPLOAD:a=g["default"].createElement(b.Upload,{filesize:t.size}),n=this.resumeUpload;break;case S["default"].STAGE.REMOTE_NEED_UPLOAD:a=g["default"].createElement(b.Upload,{filesize:t.size}),n=this.resumeRemoteUpload;break;case S["default"].STAGE.ERROR_MISSING:n=this.showMediaMissing;break;case S["default"].STAGE.ERROR_UNSUPPORTED:e.isUnsentMedia||(a=g["default"].createElement(b.Download,{filesize:t.size}),n=this.downloadUnsupportedToDesktop);break;default:a=g["default"].createElement(b.Pending,null)}var i=G["default"].durationStr(t.duration),r=i?g["default"].createElement("span",{className:"message-duration"},g["default"].createElement("span",{className:"icon-s icon-msg-video-light"}),i):null,s=t.preview?K["default"].thumbAsBackgroundImage(t.preview.url()):void 0,l=g["default"].createElement("div",{className:"image-thumb-body",style:s});t.preview||void 0===t.preview||Y["default"].assert(!1,"media-preview-invalid","Invalid preview: "+t.preview)();var u=this.props.displayAuthor&&!e.isSentByMe&&e.isGroupMsg?g["default"].createElement(A["default"],{msg:e,className:"bubble-video-author",contact:e.senderObj}):null,c=g["default"].createElement("div",{className:"shade"}),d=e.caption?g["default"].createElement(T["default"],{msg:e,contact:e.senderObj}):null,f=d?"bubble-image bubble-video bubble-image-caption":"bubble-image bubble-video",p=null;return g["default"].createElement("div",{onClick:o},g["default"].createElement("div",{className:f},u,this.props.quotedMsg,p,g["default"].createElement("div",{className:"image-thumb",onClick:n},a,l,c,r),d,g["default"].createElement(N["default"],{msg:this.props.msg})))}}]),t}(g["default"].PureComponent);Q.CONCERNS={msg:["id","ack","caption","broadcast","star","isSentByMe","isGroupMsg","gifAttribution","senderObj","isUnsentMedia"],mediaData:["aspectRatio","preview","duration","type","mediaStage","renderableUrl","fullWidth","fullHeight","size"]},t["default"]=(0,E["default"])(Q)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateTypePriority=t.UpdateTypes=void 0;var i,o=a(6),r=n(o),s=a(3),l=n(s),u=a(4),c=n(u),d=a(8),f=n(d),p=a(7),h=n(p),m=a(162),v=n(m),g=a(5),_=n(g),y=a(13),E=n(y),M=a(79),S=n(M),C=a(14),b=n(C),k=a(1462),T=n(k),w=a(21),N=n(w),P=a(1598),A=n(P),O=a(1),R=n(O),D=a(462),x=n(D),I=a(1416),L=(n(I),a(46)),F=n(L),U=a(1617),j=n(U),G=a(1457),B=n(G),V=a(239),H=a(78),W=n(H),z=t.UpdateTypes={KEEP_SCROLL_BOTTOM:"KEEP_SCROLL_BOTTOM",KEEP_SCROLL_TOP:"KEEP_SCROLL_TOP",SCROLL_BOTTOM:"SCROLL_BOTTOM",NONE:"NONE",DEFAULT:"DEFAULT"},Y=(t.UpdateTypePriority=(i={},(0,v["default"])(i,z.KEEP_SCROLL_BOTTOM,2),(0,v["default"])(i,z.KEEP_SCROLL_TOP,2),(0,v["default"])(i,z.SCROLL_BOTTOM,2),(0,v["default"])(i,z.NONE,1),(0,v["default"])(i,z.DEFAULT,0),i),function(e){function t(){var e,a,n,i;(0,l["default"])(this,t);for(var o=arguments.length,s=Array(o),u=0;o>u;u++)s[u]=arguments[u];return a=n=(0,f["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(s))),n.renderedMsgs={},n.renderedDateMarkers={},n.onMsgKeyChange=function(e){var t=e.newKey,a=e.oldKey;console.log("old key: ",a," -> ","new key: ",t);var i=t.toString(),o=a.toString();if(n.renderedMsgs[o]){var r=n.renderedMsgs[o];n.renderedMsgs[i]=r,delete n.renderedMsgs[o]}},n.onMsgRendered=function(e,t){e?n.renderedMsgs[t]=e:delete n.renderedMsgs[t]},i=a,(0,f["default"])(n,i)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"shouldComponentUpdate",value:function(e){return e.updateType!==z.NONE}},{key:"componentWillUpdate",value:function(e){var t=F["default"].findDOMNode(this).parentNode,a=e.updateType;a===z.KEEP_SCROLL_BOTTOM?this.shouldRestoreScroll=t.scrollHeight-t.scrollTop-t.clientHeight:a===z.KEEP_SCROLL_TOP&&(this.shouldRestoreScroll=t.scrollTop)}},{key:"componentDidMount",value:function(){this.maybeNotifyChatRendered(),this.props.listeners.add(Store.Msg,"change:msgKey",this.onMsgKeyChange)}},{key:"componentDidUpdate",value:function(e){var t=F["default"].findDOMNode(this).parentNode;this.props.updateType===z.SCROLL_BOTTOM?t.scrollTop=t.scrollHeight:void 0!==this.shouldRestoreScroll&&(this.props.updateType===z.KEEP_SCROLL_BOTTOM?t.scrollTop=t.scrollHeight-this.shouldRestoreScroll-t.clientHeight:t.scrollTop=this.shouldRestoreScroll,this.shouldRestoreScroll=void 0),this.maybeNotifyChatRendered()}},{key:"maybeNotifyChatRendered",value:function(){this.props.notifyChatRendered&&(this.props.focusedMsgCtx&&this.props.focusedMsgCtx.msg&&!E["default"].includes(this.props.msgs,this.props.focusedMsgCtx.msg)||this.props.notifyChatRendered())}},{key:"onCopy",value:function(e){var t=window.getSelection();e.clipboardData.setData("text/plain",T["default"].asPlainText(t)),e.stopPropagation(),e.preventDefault()}},{key:"getMsgVisibility",value:function(e){var t=F["default"].findDOMNode(this).parentNode,a=t.scrollTop,n=a+t.clientHeight,i=F["default"].findDOMNode(e);return i?i.offsetTop+i.clientHeight<=a?{visibility:b["default"].VISIBILITY.ABOVE,offset:i.offsetTop-a}:i.offsetTop>=n?{visibility:b["default"].VISIBILITY.BELOW,offset:i.offsetTop-a}:{visibility:b["default"].VISIBILITY.VISIBLE,offset:i.offsetTop-a}:(R["default"].error("getMsgVisibility on invalid ref: "+e)(),{visibility:b["default"].VISIBILITY.VISIBLE,offset:0})}},{key:"getMsgWrapperRef",value:function(e){return this.renderedMsgs[e]}},{key:"getMsgComponentRef",value:function(e){return this.renderedMsgs[e]&&this.renderedMsgs[e].refMsgComponent&&this.renderedMsgs[e].refMsgComponent.ref}},{key:"getDateMarkerRef",value:function(e){return this.renderedDateMarkers[e]}},{key:"onDateMarkerRendered",value:function(e,t){t?this.renderedDateMarkers[e]=t:delete this.renderedDateMarkers[e]}},{key:"render",value:function(){var e,t,a=[],n=this.props.msgs,i=this.props,o=i.focusedMsgCtx,r=i.unreadCount,s=i.selectedMessages,l=!1,u=void 0,c=0;for(t=0;t<n.length;t++)if(e=n[t]){var d=S["default"].dayOfMsg(e);0!==t&&u===d||(a.push(_["default"].createElement(A["default"],{ref:this.onDateMarkerRendered.bind(this,c),key:"msg-"+e.id+"-date",timestamp:e.t})),l=!1,c+=1),u=d,r>0&&o&&o.isUnreadDivider&&o.msg===e&&(a.push(_["default"].createElement(j["default"],{count:r,key:"msg-unread"})),l=!1);var f=E["default"].matches({from:e.from,startOfDay:e.startOfDay}),p=E["default"].matches({author:e.author,startOfDay:e.startOfDay}),h=e.isGroupMsg?p:f,m=G.MsgPosition.SINGLE,v=n[t+1];(v&&r&&o&&o.isUnreadDivider&&o.msg===v||v&&v.isNotification||v&&d!==S["default"].dayOfMsg(v))&&(v=!1),e.isNotification?m=G.MsgPosition.SINGLE:h(v)&&!h(l)?m=G.MsgPosition.FRONT:h(l)&&h(v)?m=G.MsgPosition.MID:h(l)&&!h(v)&&(m=G.MsgPosition.END);var g=o&&o.msg===e,y=e.type===x["default"].TYPE.IMAGE||e.type===x["default"].TYPE.VIDEO||e.type===x["default"].TYPE.AUDIO;a.push(_["default"].createElement(B["default"],{key:"msg-"+e.id,ref:(0,V.refWrapper)(this.onMsgRendered,e.id.toString()),msg:e,displayType:b["default"].DISP_TYPE.CONVERSATION,isMsgVisible:y?this.props.isMsgVisible:E["default"].noop,selectable:this.props.selectable,selectedMessages:s,onMessageSelect:this.props.onMessageSelect,position:m,isFocusedMsg:g})),l=e.isNotification?!1:e}var M=(0,N["default"])("message-list",{selectable:this.props.selectable});return _["default"].createElement("div",{className:M,onCopy:this.onCopy.bind(this)},a)}}]),t}(_["default"].Component));t["default"]=(0,W["default"])(Y)},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(2),r=i(o),s=a(6),l=i(s),u=a(3),c=i(u),d=a(4),f=i(d),p=a(8),h=i(p),m=a(7),v=i(m),g=a(5),_=i(g),y=a(1),E=i(y),M=a(12),S=i(M),C=a(1404),b=(i(C),a(15)),k=i(b),T=a(1436),w=i(T),N=a(1448),P=n(N),A=a(1730),O=i(A),R=a(0),D=i(R),x=a(42),I=i(x),L=a(64),F=i(L),U=a(21),j=i(U),G=a(117),B=i(G),V=a(78),H=i(V),W=a(1408),z=i(W),Y=a(13),q=i(Y),K=a(474),Q=a(240),X=i(Q),Z=a(115),J=i(Z),$=function(e){function t(e){(0,c["default"])(this,t);var a=(0,h["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this,e));return a.cancelRecording=function(){"ready"!==a.state.state&&(a.recorder&&a.recorder.stop(),a.clearInterval(),a.props.chat.markPaused(),a.setState({state:"ready",active:void 0,elapsed:0}),a.props.onRecState(!1))},a._incElapsed=function(){a.setState({elapsed:a.state.elapsed+1})},a.onPTTReady=function(){a.cancelPTTTimer(),"delay"===a.state.state&&a.setState({state:"recording"})},a.onMouseOverSend=function(){a.setState({active:"send"})},a.onMouseOutSend=function(){a.setState({active:void 0})},a.onMouseOverCancel=function(){a.setState({active:"cancel"})},a.onMouseOutCancel=function(){a.setState({active:void 0})},a.onMouseUpCancel=function(){a.state.elapsed<1||(a.cancelPTTTimer(),a.cancelRecording())},a.onMouseUpSend=function(){if(!(a.state.elapsed<1)){if(a.cancelPTTTimer(),"recording"!==a.state.state)return void a.cancelRecording();var e=a.props.chat;a.setState({state:"processing"}),a.props.onRecState(!1);var t=e.regCancellablePromise(I["default"].waitForEvent(a.recorder,"dataAvailable").then(function(e){return F["default"].createFromData(e.detail,e.detail.type)}));(0,K.prepRawMedia)(t,{isPtt:!0,precomputedDuration:~~a.recorder.duration}).sendToChat(e,{quotedMsg:e.composeQuotedMsg||void 0,addEvenWhilePreparing:!0}),e.composeQuotedMsg=null,t["catch"](r["default"].CancellationError,q["default"].noop)["finally"](function(){a.cancelRecording()}),a.recorder.stop()}},a.onMouseDown=function(){if("ready"===a.state.state){var e=P.start("microphone");r["default"].race([e,a.props.rejectOnUnmount()]).checkpoint(a.props.rejectOnUnmount()).then(function(e){a.recorder=new O["default"]({bitRate:16e3,encoderSampleRate:16e3,encoderApplication:2048}),a.recorder.initStream(e),a.recorder.start(),a.props.chat.presence.update()["catch"](k["default"].WapDrop,q["default"].noop),a.props.chat.markRecording(),a.setState({state:"delay"}),a.props.onRecState(!0),a.pttTimer=a.props.setTimeout(a.onPTTReady,1500),a.startInterval()})["catch"](k["default"].Unmount,function(){e.then(function(e){return P.stop(e)})["catch"](q["default"].noop)})["catch"](k["default"].GUM.PermissionDeniedError,function(){S["default"].openModal(_["default"].createElement(w["default"],{title:"guide_desktop_mic_title",desc:"guide_desktop_mic_fail_description",type:w["default"].TYPE.GUIDE_UNBLOCK}))})["catch"](k["default"].GUM.GUMError,function(){S["default"].openModal(_["default"].createElement(w["default"],{title:"guide_desktop_mic_missing_title",desc:"guide_desktop_mic_missing_description",type:w["default"].TYPE.GUIDE_NONE}))})["catch"](function(e){a.recorder&&a.recorder.stop(),E["default"].error("PTT Recording Error")(e)})}},a.state={state:"ready",active:null,elapsed:0},a}return(0,v["default"])(t,e),(0,f["default"])(t,[{key:"componentDidMount",value:function(){this.props.listeners.add(window,"blur",this.cancelRecording)}},{key:"componentWillUnmount",value:function(){}},{key:"startInterval",value:function(){this.clearInterval(),this.elapsedInterval=this.props.setInterval(this._incElapsed,1e3)}},{key:"clearInterval",value:function(){this.elapsedInterval&&(this.props.clearInterval(this.elapsedInterval),this.elapsedInterval=null),this.setState({elapsed:0})}},{key:"cancelPTTTimer",value:function(){this.pttTimer&&(this.props.clearTimeout(this.pttTimer),this.pttTimer=null)}},{key:"render",value:function(){var e=this.state.state,t=(0,j["default"])("btn-close btn-border ptt-close",{"is-hover":"cancel"===this.state.active}),a=(0,j["default"])("btn-border ptt-send",{"is-hover":"send"===this.state.active}),n="delay"===e||"recording"===e?_["default"].createElement(X["default"],{displayName:"PTT",popable:!0,escapable:!0,requestDismiss:this.cancelRecording},_["default"].createElement("div",{className:"ptt-recording",key:"recording"},_["default"].createElement("button",{className:t,onMouseOver:this.onMouseOverCancel,onMouseOut:this.onMouseOutCancel,onMouseUp:this.onMouseUpCancel},_["default"].createElement("span",{className:"icon icon-round-x btn-state-default"}),_["default"].createElement("span",{className:"icon icon-round-x-inv btn-state-hover"})),_["default"].createElement("div",{className:"ptt-counter"},D["default"].unix(this.state.elapsed).format("m:ss")),_["default"].createElement("button",{className:a,onMouseOver:this.onMouseOverSend,onMouseOut:this.onMouseOutSend,onMouseUp:this.onMouseUpSend},_["default"].createElement("span",{className:"icon icon-round-send btn-state-default"}),_["default"].createElement("span",{className:"icon icon-round-send-inv btn-state-hover"})))):null,i="ready"===e||"processing"===e?_["default"].createElement("button",{className:"icon btn-icon icon-ptt",onMouseDown:this.onMouseDown,disabled:"processing"===e,key:"button"}):null,o=(0,j["default"])("ptt-container",{active:!!n});return _["default"].createElement("div",{className:o},_["default"].createElement(J["default"],{transitionName:"ptt"},n||i))}}]),t}(_["default"].PureComponent);t["default"]=(0,z["default"])((0,B["default"])((0,H["default"])($)))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(1404),y=(n(_),a(238)),E=n(y),M=a(12),S=n(M),C=a(78),b=n(C),k=a(1402),T=n(k),w=a(42),N=n(w),P=a(13),A=n(P),O=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),n.confirmReportGroupSpam=function(){S["default"].openModal(g["default"].createElement(E["default"],{onOK:n.reportGroupSpam,okText:l10n.t("report_group_spam"),onCancel:S["default"].closeModal.bind(S["default"]),cancelText:l10n.t("web_cancel")},l10n.t("report_group_spam_ack")))},n.reportGroupSpam=function(){var e=(0,k.unproxy)(n.props.chat),t=e.sendSpamReport(!0);if(!e.isReadOnly){var a=e.sendExit(),i=N["default"].waitForBBEvent(e.msgs,"change:last",function(e){return e.isGroupLeave()});t=o["default"].all([t,a,i])}t.then(function(){return e.sendDelete()})["catch"](A["default"].noop),S["default"].closeModal()},n.confirmReportSpam=function(){S["default"].openModal(g["default"].createElement(E["default"],{onOK:n.reportSpam,okText:l10n.t("report_spam"),onCancel:S["default"].closeModal.bind(S["default"]),cancelText:l10n.t("web_cancel")},l10n.t("report_spam_ack")))},n.reportSpam=function(){var e=(0,k.unproxy)(n.props.chat);e.sendSpamReport().then(function(){return e.contact.setBlock(!0)}).then(function(){return e.sendDelete()})["catch"](A["default"].noop),S["default"].closeModal()},n.notSpam=function(){n.props.chat.sendNotSpam(!0)["catch"](A["default"].noop)},n.confirmBlock=function(){S["default"].openModal(g["default"].createElement(E["default"],{onOK:n.block,okText:l10n.t("block"),onCancel:S["default"].closeModal.bind(S["default"]),cancelText:l10n.t("web_cancel")},l10n.t("block_ack")))},n.block=function(){n.props.chat.contact.setBlock(!0)["catch"](A["default"].noop),S["default"].closeModal()},n.confirmUnblock=function(){S["default"].openModal(g["default"].createElement(E["default"],{okText:l10n.t("unblock_button"),onOK:n.unblock,cancelText:l10n.t("web_cancel"),onCancel:S["default"].closeModal.bind(S["default"])},l10n.t("unblock_confirmation",{contact:n.props.chat.contact.formattedName})))},n.unblock=function(){n.props.chat.contact.setBlock(!1)["catch"](A["default"].noop),S["default"].closeModal()},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){this.props.listeners.add(Store.Blocklist,"add remove reset")}},{key:"render",value:function(){var e=this.props.chat;if(e.isPSA||!e.isVisible||e.trusted)return null;var t=void 0,a=[];if(e.isGroup)t=l10n.t("group_admin_not_a_contact"),a.push(g["default"].createElement("button",{className:"spam-button btn-plain",key:"report_spam",onClick:this.confirmReportGroupSpam},l10n.t("report_spam")));else{t=l10n.t("sender_not_a_contact"),a.push(g["default"].createElement("button",{className:"spam-button btn-plain",key:"report_spam",onClick:this.confirmReportSpam},l10n.t("report_spam")));var n=Store.Blocklist.get(e.id);n?a.push(g["default"].createElement("button",{onClick:this.confirmUnblock,key:"unblock",className:"spam-button btn-plain"},l10n.t("unblock_button"))):a.push(g["default"].createElement("button",{onClick:this.confirmBlock,key:"block",className:"spam-button btn-plain"},l10n.t("block")))}return a.push(g["default"].createElement("button",{onClick:this.notSpam,key:"not_spam",className:"spam-button btn-plain"},l10n.t("not_spam"))),g["default"].createElement("div",{className:"spam"},g["default"].createElement("div",{className:"spam-text"},t),g["default"].createElement("div",{className:"spam-controls"},a))}}]),t}(g["default"].PureComponent);O.CONCERNS={chat:["id","isPSA","isVisible","trusted","isGroup","contact"]},t["default"]=(0,b["default"])((0,T["default"])(O))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(46),y=n(_),E=a(13),M=n(E),S=a(463),C=n(S),b=a(1404),k=(n(b),a(462)),T=(n(k),a(1460)),w=(n(T),a(1425)),N=(n(w),a(1593)),P=n(N),A=a(1594),O=n(A),R=a(1499),D=n(R),x=a(1527),I=n(x),L=a(12),F=n(L),U=a(43),j=n(U),G=a(115),B=n(G),V=a(1416),H=n(V),W=a(14),z=n(W),Y=a(1549),q=n(Y),K=a(239),Q=a(15),X=n(Q),Z=a(1402),J=n(Z),$=a(78),ee=n($),te=a(240),ae=n(te),ne=function(e){function t(){(0,u["default"])(this,t);var e=(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments));e.onComposeState=function(){var t=e.props.chat.canSend;e.state.canCompose!==t&&e.setState({canCompose:t})},e.onComposeHeightChange=function(t,a){var n=t.input,i=t.overlay,r=void 0===i?0:i,s=y["default"].findDOMNode(e.refs.msgPanel);if(s&&e.msgs){var l=e.msgs,u=l.getScrollBottom();if(void 0!==n)return void e.msgs.onComposeHeightChange(n);if(a)return e.fillerHeight=r,void(e.refs.filler&&(e.refs.filler.style.height=e.fillerHeight+"px",e.msgs.setScrollBottom(u)));e.fillerHeight+=r,0>r&&(e.refs.filler&&(e.refs.filler.style.height=e.fillerHeight+"px"),e.msgs&&e.msgs.setScrollBottom(u)),e.msgPanelAnimation&&(e.didCancel=!0,e.msgPanelAnimation.cancel()),e.msgPanelAnimation=(e.msgPanelAnimation||o["default"].resolve()).then(function(){return(0,C["default"])(s,{translateY:r>0?[-r,0]:[0,r]},{duration:300,easing:[.1,.82,.25,1]})}).cancellable()["catch"](X["default"].Unmount,M["default"].noop).then(function(){r>0&&e.refs.filler&&(e.refs.filler.style.height=e.fillerHeight+"px"),s.style.transform="",e.msgs&&r>0&&e.msgs.setScrollBottom(u)})["catch"](o["default"].CancellationError,function(){(0,C["default"])(s,"finish",!0)}).then(function(){e.didCancel?e.didCancel=!1:e.msgPanelAnimation=void 0})}},e.onWallpaperColorPreview=function(t){t?e.state.wallpaperColor!==t&&e.setState({wallpaperColor:t}):e.setState({wallpaperColor:Store.ChatPreference.get("defaultPreference").wallpaperColor})},e.onSelectMessages=function(){e.state.selectable||e.setState({selectable:!0})},e.onCancelSelection=function(){e.state.selectable&&(e.selectedMessages.unsetAll(),e.setState({selectable:!1}))},e.onMessageSelect=function(t,a){e.onSelectMessages(),e.selectedMessages.setVal(t,a)},e.onPageUpDown=function(t){e.msgs.onPageUpDown(t)},e.scrollMessages=function(){var t=e.msgs,a=t&&t.refs.scrollContainer;if(a){var n=M["default"].last(t.visibleMsgOrder);if(n){var i=y["default"].findDOMNode(t.refs.messageList.refs[n.toString()]);if(i){var o=0;1===t.visibleMsgOrder.length&&(o=i.clientHeight),(0,C["default"])(i,"stop"),(0,C["default"])(a,"stop"),(0,C["default"])(i,"scroll",{duration:300,container:a,offset:o})}}}},e.onDragStart=function(t){e.state.canCompose&&(e.blockDrop=!0)},e.onDragEnd=function(t){e.state.canCompose&&(e.blockDrop=!1)},e.onDragEnter=function(t){e.state.canCompose&&!e.blockDrop&&(M["default"].includes(t.dataTransfer.types,"Files")||M["default"].includes(t.dataTransfer.types,"text/uri-list")||M["default"].includes(t.dataTransfer.types,"text/html"))&&(F["default"].attachMediaDrawer(e.props.chat,void 0),t.stopPropagation(),t.preventDefault())},e.getMsgs=(0,K.GetRef)("msgs",e);var a=e.props.chat;return e.fillerHeight=a.fillerHeight||0,e.selectedMessages=new H["default"]([],function(e){return e.id.toString()}),e.state={canCompose:a.canSend,selectable:!1,wallpaperColor:e.props.chatPreference.wallpaperColor},e}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props.chat;e.fillerHeight=null,this.props.listeners.add(e,"change:canSend",this.onComposeState),this.openEvent=new j["default"].WebcChatOpen({webcUnreadCount:e.unreadCount}),this.uiActionEvent=new j["default"].UiAction({uiActionType:j["default"].UI_ACTION_TYPE.CHAT_OPEN,uiActionPreloaded:!0})}},{key:"componentDidMount",value:function(){var e=this.props.chat;e.set({active:!0,viewed:!0});var t=this.openEvent;t&&(t.markWebcChatOpenT(),t.commit(),this.openEvent=void 0);var a=this.uiActionEvent;a&&(a.markUiActionT(),a.commit(),this.uiActionEvent=void 0),this.props.listeners.add(Store.ChatPreference,"wallpaper_color_preview",this.onWallpaperColorPreview),this.props.listeners.add(F["default"],"scroll_messages",this.scrollMessages)}},{key:"componentWillUnmount",value:function(){this.props.chat.set("active",!1)}},{key:"render",value:function(){var e,t,a,n=this.props,i=n.chat,o=n.msgCollection,r=n.focusCtx;if(this.state.selectable)t=g["default"].createElement(ae["default"],{displayName:"MultiSelect",escapable:!0,requestDismiss:this.onCancelSelection},g["default"].createElement(I["default"],{chat:i,className:"multi-controls-conversation",selectedMessages:this.selectedMessages,disableRevoke:!1,noSortOnForward:!1,onCancel:this.onCancelSelection})),e=g["default"].createElement("footer",{className:"pane-footer pane-chat-footer"}),a=g["default"].createElement("div",{ref:"filler",className:"compose-filler"});else if(this.state.canCompose)e=g["default"].createElement(D["default"],{chat:i,className:"pane-footer pane-chat-footer",onComposeHeightChange:this.onComposeHeightChange,onPageUpDown:this.onPageUpDown}),a=g["default"].createElement("div",{ref:"filler",style:{height:this.fillerHeight+"px"},className:"compose-filler"});else{var s;s=i.isGroup?l10n.t("web_cannot_send_not_a_group_participant"):i.isPSA?l10n.t("web_psa_title"):l10n.t("web_cannot_send_to_blocked_contact_1",{contact:i.contact.formattedName}),e=g["default"].createElement("footer",{className:"pane-footer pane-chat-footer"},g["default"].createElement("div",{className:"block-message"},s))}var l={},u={};return this.state.wallpaperColor!==z["default"].DEFAULT_CHAT_WALLPAPER&&(l.background=this.state.wallpaperColor,l.transition="background 0.3s ease",u.display="none"),g["default"].createElement(ae["default"],{displayName:"ConversationPanel",state:ae["default"].State.INACTIVE},g["default"].createElement("div",{id:"main",className:"pane pane-chat pane-two"},g["default"].createElement("div",{className:"pane-chat-tile",style:u}),g["default"].createElement(P["default"],{chat:i,canAttach:this.state.canCompose,onSelectMessages:this.onSelectMessages}),g["default"].createElement("div",{className:"pane-body pane-chat-tile-container",ref:"msgPanel",onDragStart:this.onDragStart,onDragEnd:this.onDragEnd,onDragEnter:this.onDragEnter,style:l},g["default"].createElement(O["default"],{ref:this.getMsgs,chat:i,selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,msgCollection:o,onSelectMessages:this.onSelectMessages,focusCtx:r,selectedMessages:this.selectedMessages,notifyChatRendered:this.props.notifyChatRendered,updateOpenedChatInfo:this.props.updateOpenedChatInfo})),a,e,g["default"].createElement(B["default"],{transitionName:"slide-up"},t),g["default"].createElement(q["default"],null)))}}]),t}(g["default"].Component);ne.CONCERNS={chatPreference:["wallpaperColor"]},e.exports=(0,ee["default"])((0,J["default"])(ne))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Dir=t.Transition=void 0;var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(13),g=n(v),_=a(12),y=n(_),E=a(21),M=n(E),S=a(95),C=n(S),b=a(78),k=n(b),T=a(5),w=n(T),N=a(115),P=n(N),A=a(46),O=n(A),R=a(488),D=n(R),x=a(240),I=n(x),L=a(96),F=n(L),U=t.Transition={LEFT:"drawer-left",MID:"slide-up",NONE:"none",RIGHT:"slide-left"},j=t.Dir={LEFT:"left",MID:"mid",RIGHT:"right"},G=function(e){return U[e.toUpperCase()]};t["default"]=(0,k["default"])((o=i=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(r))),n.state={drawer:void 0,drawerId:null,transition:G(n.props.direction),uim:void 0,option:void 0},n.blockTransition=null,n.openFlow=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:G(n.props.direction),a=arguments[2],i=arguments[3],o=g["default"].uniqueId("DrawerManager"+n.props.direction);if(n.state.drawer){if(e.key&&g["default"].isEqual(n.state.drawer.key,e.key))return;n.blockTransition=U.NONE,n.setState({drawer:e,drawerId:o,transition:t,uim:a,option:i},function(){n.blockTransition=t})}else n.props.onDrawerIn&&n.props.onDrawerIn(),n.setState({drawer:e,drawerId:o,transition:t,uim:a,option:i})},n.existsFlow=function(e){e(!!n.state.drawer)},n.closeFlow=function(e){e&&n.state.drawerId!==e||n.state.drawer&&(n.props.onDrawerOut&&n.props.onDrawerOut(),n.setState({drawer:void 0}))},n.requestFocus=function(){var e=O["default"].findDOMNode(n.refs.UIE);e&&!e.contains(document.activeElement)&&C["default"].focus(e)},n.onAnimationComplete=function(){var e=n.props.onDrawerAnimationComplete;e&&e();var t=n.state,a=t.option,i=t.drawer;a&&(i&&g["default"].isFunction(a.onEnterAnimationComplete)&&a.onEnterAnimationComplete(),!i&&g["default"].isFunction(a.onLeaveAnimationComplete)&&a.onLeaveAnimationComplete())},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"getChildContext",value:function(){var e=this.state.uim||this.context.uim;return{uim:e}}},{key:"componentWillMount",value:function(){this.props.listeners.add(y["default"],"open_drawer_"+this.props.direction,this.openFlow),this.props.listeners.add(y["default"],"exists_drawer_"+this.props.direction,this.existsFlow),this.props.listeners.add(y["default"],"close_drawer_"+this.props.direction,this.closeFlow)}},{key:"componentWillReceiveProps",value:function(e){e.direction!==this.props.direction&&(this.props.listeners.remove(y["default"],"open_drawer_"+this.props.direction,this.openFlow),this.props.listeners.remove(y["default"],"exists_drawer_"+this.props.direction,this.existsFlow),this.props.listeners.remove(y["default"],"close_drawer_"+this.props.direction,this.closeFlow),e.listeners.add(y["default"],"open_drawer_"+e.direction,this.openFlow),e.listeners.add(y["default"],"exists_drawer_"+e.direction,this.existsFlow),e.listeners.add(y["default"],"close_drawer_"+e.direction,this.closeFlow))}},{key:"render",value:function(){var e=this.props.direction,t=this.state,a=t.drawer,n=t.drawerId,i=t.transition,o=t.option,r=this.blockTransition||i,s=o&&o.noFocus?null:this.requestFocus;a&&(a=w["default"].createElement(I["default"],{displayName:"Drawer"+g["default"].upperFirst(e),escapable:!0,key:n,ref:"UIE",requestFocus:s,requestDismiss:this.closeFlow.bind(null,n)
},w["default"].createElement(D["default"],{style:{height:"100%"}},a)));var l=(0,M["default"])("pane",{"pane-one":e===j.LEFT,"pane-two":e===j.MID,"pane-three":e===j.RIGHT});return w["default"].createElement(P["default"],{transitionName:r,className:l,onAnimationComplete:this.onAnimationComplete},a)}}]),t}(T.PureComponent),i.contextTypes={uim:w["default"].PropTypes.instanceOf(F["default"])},i.childContextTypes={uim:w["default"].PropTypes.instanceOf(F["default"])},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.EmojiTabComponent=void 0;var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(46),g=n(v),_=a(13),y=n(_),E=a(118),M=n(E),S=a(1403),C=n(S),b=a(95),k=a(116),T=n(k),w=a(1591),N=n(w),P=a(1415),A=n(P),O=a(472),R=a(12),D=n(R),x=a(239),I=a(466),L=a(96),F=n(L),U=a(240),j=n(U),G=a(1508),B=a(78),V=n(B),H=a(117),W=n(H),z=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={skinTonePicker:null},n.emojiList=null,n.lastFocusedElement=null,n.rowLength=0,n.windowResized=function(){var e=n.getEmojiRowLength();n.rowLength!==e&&(n.rowLength=e,n.forceUpdate())},n.onEmojiClick=function(e){if(n.stopEvent(e),e.target instanceof HTMLElement){var t=e.target.dataset.unicode;if(t)if(M["default"].skinToneEmojis[t]){var a=n.getEmojiVariant(t);n.props.tab===G.Tab.RECENT?n.onEmoji(a||t):a?n.onEmoji(a):n.onContextMenu(e)}else n.onEmoji(t)}},n.onEmojiMouseDown=function(e){if(n.stopEvent(e),e.target instanceof HTMLElement){var t=e.target.dataset.unicode;t&&M["default"].skinToneEmojis[t]&&n.startPickerTimer(e)}},n.onEmoji=function(e){n.props.onEmoji(e),n.releaseFocus()},n.releaseFocus=function(){n.props.onFocusRelease&&n.props.onFocusRelease()},n.getEmojiVariant=function(e){return M["default"].skinToneEmojis[e]?Store.EmojiVariant.getVariant(e):null},n.setEmojiVariant=function(e,t,a){return n.stopEvent(e),n.onEmoji(a),Store.EmojiVariant.setVariant(t,a),!1},n.stopEvent=function(e){e&&(e.preventDefault(),e.stopPropagation())},n.onContextMenu=function(e){if(n.stopEvent(e),e.target instanceof HTMLElement){var t=e.target.dataset.unicode;t&&M["default"].skinToneEmojis[t]&&n._onContextMenu(t,e.target)}},n._onContextMenu=function(e,t,a){a||(n.lastFocusedElement=null),n.clearPickerTimer();var i=M["default"].skinToneEmojis[e],o=G.SKIN_TONE_VARIATIONS.map(function(t){var a=M["default"].variantToUnicode(i,t);return m["default"].createElement(A["default"],{key:a,a8n:"mi-emoji-variant",action:function(t){return n.setEmojiVariant(t,e,a)}},m["default"].createElement("div",{className:"emoji-picker"},m["default"].createElement(C["default"],{text:a,formatters:I.Configuration.LargeEmojiOnly(),tabIndex:"-1"})))});n.setState({skinTonePicker:{menu:o,anchor:t,type:"picker",dirX:O.DirX.RIGHT,dirY:O.DirY.TOP,horizontal:!0,autoFocus:a}})},n.closeSkinTonePicker=function(){n.setState({skinTonePicker:null})},n.clearPickerTimer=function(){n.pickerTimer&&(n.props.clearTimeout(n.pickerTimer),n.pickerTimer=null)},n.startPickerTimer=function(e){n.stopEvent(e),n.clearPickerTimer();var t=e.target;if(t instanceof HTMLElement){var a=t.dataset.unicode;n.pickerTimer=n.props.setTimeout(function(){n.props.listeners.addOnce(D["default"],"window_click",n.stopEvent),n._onContextMenu(a,t)},250),n.props.listeners.addOnce(window,"mouseup",n.clearPickerTimer,!0)}},n.getEmojiRowLength=function(){var e=n.emojiPanel&&n.emojiPanel.offsetWidth;return e?Math.floor(e/G.EMOJI_WIDTH):8},n.focusPrevSection=function(e){n.props.focusPrevSection&&(n.props.focusPrevSection(n.props.tab,e),n.lastFocusedElement=null)},n.focusNextSection=function(e){n.props.focusNextSection&&(n.props.focusNextSection(n.props.tab,e),n.lastFocusedElement=null)},n.onEmojiArrowUp=function(e){n.onEmojiArrow(e,"up")},n.onEmojiArrowDown=function(e){n.onEmojiArrow(e,"down")},n.onEmojiArrowLeft=function(e){n.onEmojiArrow(e,"left")},n.onEmojiArrowRight=function(e){n.onEmojiArrow(e,"right")},n.onEmojiArrow=function(e,t){if(n.stopEvent(e),e.target instanceof HTMLElement){var a=e.target.dataset.emojiIndex;if(a){a=Number(a);var i=n.props.emojiList,o=n.getEmojiRowLength(),r=a;switch(t){case"up":if(n.props.isSuggestion)r=0;else{if(o>a)return void n.focusPrevSection(a%o);r=a-o}break;case"down":if(n.props.isSuggestion)n.props.onArrowDown&&n.props.onArrowDown();else{if(Math.floor(a/o)>=Math.floor((i.length-1)/o))return void n.focusNextSection(a%o);r=Math.min(a+o,i.length-1)}break;case"left":if(!(a>0))return void n.focusPrevSection(o-1);r=a-1;break;case"right":if(a+1>=i.length)return void n.focusNextSection(0);r=a+1}n.focusEmoji(r)}}},n.getEmoji=function(e){if(n.props.isSuggestion){var t=n.getEmojiRowLength();e&&e.length>t&&(e=e.slice(0,t))}var a=y["default"].map(e,function(e,t){var a=M["default"].codeToEmoji[e],i=n.getEmojiVariant(a);return i&&(e=M["default"].emojiMap[i]),m["default"].createElement("span",{key:a,"data-unicode":a,"data-variant":i,tabIndex:"-1","data-emoji-index":t,className:M["default"].getClasses(e,"large")})}),i={up:n.onEmojiArrowUp,down:n.onEmojiArrowDown,left:n.onEmojiArrowLeft,right:n.onEmojiArrowRight,enter:n.onEmojiEnter};return m["default"].createElement(T["default"],{ref:(0,x.GetRef)("emojis",n),onMouseDown:n.onEmojiMouseDown,onClick:n.onEmojiClick,onContextMenu:n.onContextMenu,handlers:i},a)},n.onEmojiEnter=function(e){if(n.stopEvent(e),e.target instanceof HTMLElement){var t=e.target.dataset.emojiIndex;if(t){var a=n.props.emojiList,i=a[t],o=M["default"].codeToEmoji[i];n.keyboardSelectEmoji(e,o)}}},n.keyboardSelectRow=function(e,t){var a=n.getEmojiRowLength(),i=n.props.emojiList,o=i.length,r=0;r=t*a>=o?o-o%a:a*t;var s=i[r];if(s){n.stopEvent(e);var l=M["default"].codeToEmoji[s];n.keyboardSelectEmoji(e,l)}},n.keyboardSelectEmoji=function(e,t){if(M["default"].skinToneEmojis[t]){var a=n.getEmojiVariant(t);if(n.props.tab===G.Tab.RECENT)n.onEmoji(a||t);else if(a)n.onEmoji(a);else{if(n.stopEvent(e),!(e.target instanceof HTMLElement))return;n._onContextMenu(t,e.target,!0)}}else n.onEmoji(t)},n.focusElement=function(e){(0,b.focus)(e),n.lastFocusedElement=e},n.focusEmoji=function(e){if(!(0>e)&&n.emojis){var t=g["default"].findDOMNode(n.emojis).children;if(!(e>=t.length)){var a=t[e];n.focusElement(a),n.props.scrollEmojiIntoViewIfNeeded&&n.props.scrollEmojiIntoViewIfNeeded(a)}}},n.focusRow=function(e){var t=n.getEmojiRowLength();e*t>=n.props.emojiList.length?n.focusLastRow(0):n.focusEmoji(t*e)},n.focusFirstRow=function(e){var t=n.getEmojiRowLength();n.focusEmoji(Math.min(t-1,e))},n.focusLastRow=function(e){var t=n.getEmojiRowLength(),a=n.props.emojiList.length,i=a-a%t+e;i=Math.min(i,a-1),n.focusEmoji(i)},n.restoreFocus=function(){n.lastFocusedElement&&n.focusElement(n.lastFocusedElement)},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.skinTonePicker!==t.skinTonePicker}},{key:"componentWillReceiveProps",value:function(e){this.state.skinTonePicker&&this.closeSkinTonePicker()}},{key:"componentDidMount",value:function(){var e=this;if(this.props.listeners.add(Store.EmojiVariant,"add remove change:variant",function(){return e.forceUpdate()}),this.props.isSuggestion){var t=this.props.debounce(this.windowResized,100);this.props.listeners.add(window,"resize",t),this.windowResized()}}},{key:"render",value:function(){var e=void 0;this.state.skinTonePicker&&(e=m["default"].createElement(j["default"],{displayName:"SkinTonePicker",popable:!0,escapable:!0,requestDismiss:this.closeSkinTonePicker},m["default"].createElement(N["default"],{tooltip:this.state.skinTonePicker})));var t=this.props.emojiList,a=void 0;return a=this.props.tab===G.Tab.RECENT&&!t||this.props.tab===G.Tab.SEARCH_RESULT?null:m["default"].createElement("div",{className:"emoji-panel-title"},this.props.tab.title()),m["default"].createElement("div",{ref:(0,x.GetRef)("emojiPanel",this),className:this.props.tab.className},a,this.getEmoji(t),e)}}]),t}(m["default"].Component);z.contextTypes={uim:m["default"].PropTypes.instanceOf(F["default"])};t.EmojiTabComponent=z;t["default"]=(0,V["default"])((0,W["default"])(z))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){switch((0,Y.gifProvider)()){case"giphy":return o(e);case"tenor":return s(e);default:throw new Error("Unrecognized provider "+(0,Y.gifProvider)())}}function o(e){var t=!e,a=void 0;if(t)a=z["default"].request("https://api.giphy.com/v1/gifs/trending","GET",{api_key:$,limit:100,rating:"pg-13"},"json");else{var n=l10n.getLocale(),i=void 0;J["default"].indexOf(Y.GIPHY_LOCALES,n)>=0&&(i=n),a=z["default"].request("https://api.giphy.com/v1/gifs/search","GET",{q:e,api_key:$,limit:100,rating:"pg-13",lang:i},"json")}return a["catch"](function(){return null}).then(function(e){return e&&e.status<300&&r(e.response,t)})}function r(e,t){if(!e||!J["default"].isArray(e.data))return[];for(var a=e.data,n=[],i=0;i<a.length;i++){var o=a[i];if(o&&o.images){var r=o.images.downsizedSmall,s=o.images.fixed_height,l=o.images.fixed_width,u=void 0,c=void 0;if(l&&l.mp4){var d=parseInt(l.height,10);d===d&&te>d&&(u=l,c=te*Y.TARGET_GIF_HEIGHT/d)}if(s&&s.mp4){var f=parseInt(l.width,10);f===f&&te>f&&(u=s,c=f*Y.TARGET_GIF_HEIGHT/te)}u&&c&&n.push(new Y.GifInfo(n.length,r&&r.url||u.mp4,u.mp4,u.webp||u.gif||void 0,Math.round(c),Y.GIPHY,t))}}return n}function s(e){var t=!e,a=l10n.lng().replace("-","_"),n=void 0;return n=t?z["default"].request("https://api.tenor.co/v1/trending","GET",{key:ee,limit:50,safesearch:"moderate",locale:a},"json"):z["default"].request("https://api.tenor.co/v1/search","GET",{tag:e,key:ee,limit:50,safesearch:"moderate",locale:a},"json"),n["catch"](function(){return null}).then(function(e){return e&&e.status<300&&l(e.response)})}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1;if(!e||!J["default"].isArray(e.results))return[];for(var a=e.results,n=[],i=0;i<a.length;i++){var o=a[i];if(o&&o.media&&o.media[0]){var r=o.media[0],s=r.tinymp4,l=r.previewmp4,u=r.previewgif;if(s){var c=(0,d["default"])(s.dims,2),f=c[0],p=c[1];n.push(new Y.GifInfo(n.length,s.url,l&&l.url||void 0,u&&u.url||void 0,Math.round(f*Y.TARGET_GIF_HEIGHT/p),Y.TENOR,t))}}}return n}function u(e,t){for(var a=[],n=.9*t,i=e,o=null,r=.05;1>r&&i.length;r+=.05){i.sort(function(e,t){var a=e.rank-t.rank;return Math.abs(a)>8?a:t.width-e.width});for(var s=(1+r)*t,l=[],u=[],c=0;c<i.length;c++){for(var d=i[c],f=!1,p=Math.min(s-d.width,n),h=0;!f&&h<l.length;h++)l[h]<p&&(l[h]+=d.width+Y.GAP_SIZE,u[h].push(d),f=!0);f||(l.push(d.width),u.push([d]))}if(1===u.length){i=[];var m=t-l[0]-Y.GAP_SIZE;o={gifs:u[0],blankStr:m>0?m+"px":void 0}}else{i=[];for(var v=0;v<u.length;v++)l[v]>n?a.push(u[v]):i.push.apply(i,u[v])}}a.forEach(function(e){return e.sort(function(e,t){return e.rank-t.rank})}),a.sort(function(e,t){return e[0].rank-t[0].rank});var g=a.map(function(e){return{gifs:e,blankStr:void 0}});return o&&g.push(o),g}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var c=a(16),d=n(c),f=a(2),p=n(f),h=a(6),m=n(h),v=a(3),g=n(v),_=a(4),y=n(_),E=a(8),M=n(E),S=a(7),C=n(S),b=a(5),k=n(b),T=a(46),w=n(T),N=a(15),P=n(N),A=a(43),O=n(A),R=a(462),D=n(R),x=a(82),I=n(x),L=a(55),F=n(L),U=a(42),j=n(U),G=a(1732),B=n(G),V=a(1408),H=n(V),W=a(99),z=n(W),Y=a(1442),q=a(1629),K=n(q),Q=a(1507),X=n(Q),Z=a(13),J=n(Z),$=void 0;$="3o85xmWDYKgihhIKSA";var ee="DLAQBEYLJJIM",te=200,ae={giphy:O["default"].GIF_SEARCH_PROVIDER.GIPHY,tenor:O["default"].GIF_SEARCH_PROVIDER.TENOR},ne={giphy:D["default"].GIF_ATTRIBUTION.GIPHY,tenor:D["default"].GIF_ATTRIBUTION.TENOR},ie=new B["default"](i,{maxCached:6,maxAge:36e4,shouldCache:function(e){return!(!e||!e.length)}}),oe=function(e){function t(e){(0,g["default"])(this,t);var a=(0,M["default"])(this,(t.__proto__||(0,m["default"])(t)).call(this,e));return a._scrollTop=0,a._didSendGif=!1,a._onlineRestarter=null,a._pendingQuery=null,a._gifRefs={},a.onSend=function(e){var t=ae[e.attribution];new O["default"].GifFromProviderSent({gifSearchProvider:t}).commit(),e.trending||new O["default"].GifSearchResultTapped({gifSearchProvider:t,rank:e.rank}).commit(),a._didSendGif=!0,a.props.onGif(e.url,ne[e.attribution])},a.animateGif=function(){var e=a._animatingRow,t=a._scrollTop+Y.GAP_SIZE;a._starredGifsDom&&(t-=a._starredGifsDom.clientHeight);var n=Math.round(t/(Y.TARGET_GIF_HEIGHT+Y.GAP_SIZE)),i=a.state.gifRows[n];if(i&&i.gifs.length&&i!==e){if(a._animatingRow=i,e)for(var o=0;o<e.gifs.length;o++)a.setGifAnimating(e.gifs[o].gifId,!1);for(var r=0;r<i.gifs.length;r++)a.setGifAnimating(i.gifs[r].gifId,!0)}[n+1,n-1].forEach(function(e){if(a.state.gifRows[e])for(var t=a.state.gifRows[e].gifs,n=0;n<t.length;n++)a.setGifAnimating(t[n].gifId,!1)})},a.searchForAndSetGifs=function(){var e=ae[(0,Y.gifProvider)()],t=a.props.searchText,n=ie.getOrRun(t);n=n.then(),a._pendingQuery=n,n.checkpoint(a.props.rejectOnUnmount()).then(function(i){if(i&&0===i.length&&new O["default"].GifSearchNoResults({gifSearchProvider:e}).commit(),n===a._pendingQuery&&(a._pendingQuery=null,i)){t||new O["default"].GifTrendingViewed({gifSearchProvider:e}).commit();var o=a._containerDom.clientWidth;o-=2*Y.GAP_SIZE,a._resetScroll=!0,a._animateTimer.debounce(0),a.setState({gifRows:u(i,o),width:o})}})["catch"](P["default"].Unmount,p["default"].CancellationError,J["default"].noop),t&&setTimeout(function(){a.props.rejectOnUnmount().isPending()&&t===a.props.searchText&&new O["default"].GifSearchPerformed({gifSearchProvider:e}).commit()},500)},a.onStarredGifsMount=function(e){a._starredGifsDom=w["default"].findDOMNode(e)},a.onContainerMount=function(e){a._containerDom=e,null!==e&&a._resetScroll&&(e.scrollTop=0)},a._scrollTop=0,a._animatingRow=null,a._containerDom=null,a._didSendGif=!1,a.state={gifRows:[],width:0},a}return(0,C["default"])(t,e),(0,y["default"])(t,[{key:"componentWillReceiveProps",value:function(e){e.searchText!==this.props.searchText&&this.scheduleQuery()}},{key:"shouldComponentUpdate",value:function(e,t){return e.onGif!==this.props.onGif||t.gifRows!==this.state.gifRows}},{key:"componentWillMount",value:function(){var e=this;this._searchTimer=new F["default"](this.searchForAndSetGifs),this._animateTimer=new F["default"](this.animateGif),this._onlineRestarter=p["default"].loop(function(){return j["default"].waitForBBEvent(I["default"],"change:online",function(){return I["default"].online}).then(function(){return e.scheduleQuery()})}).cancellable(),this._onlineRestarter["catch"](p["default"].CancellationError,J["default"].noop),this.searchForAndSetGifs(),new O["default"].GifSearchSessionStarted({gifSearchProvider:ae[(0,Y.gifProvider)()]}).commit()}},{key:"componentWillUnmount",value:function(){this._animateTimer.cancel(),this._searchTimer.cancel(),this._onlineRestarter&&this._onlineRestarter.cancel(),this._didSendGif||new O["default"].GifSearchCancelled({gifSearchProvider:ae[(0,Y.gifProvider)()]}).commit()}},{key:"scheduleQuery",value:function(){this._searchTimer.debounceAndCap(200,2e3)}},{key:"animateOnScroll",value:function(e){this._scrollTop=e.scrollTop,this._animateTimer.debounce(200)}},{key:"setGifAnimating",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1,a=this._gifRefs[e];a&&a.setShouldAnimate(t)}},{key:"render",value:function(){var e=this,t=this.state.gifRows,a=t.map(function(t,a){var n=t.gifs.map(function(t,a){return k["default"].createElement(X["default"],{key:t.gifId,ref:function(a){return e._gifRefs[t.gifId]=a},gif:t,display:!0,onSend:e.onSend})}),i=null;return t.blankStr&&(i=k["default"].createElement("div",{className:"gif-search-blank",style:{flexBasis:t.blankStr}})),k["default"].createElement("div",{key:a,className:"gif-search-row"},n,i)}),n=void 0;a.length&&!this.props.searchText&&(n=k["default"].createElement("div",{className:"gif-section-title"},l10n.t("gif_trending_title")));var i=void 0;return this.props.searchText||(i=k["default"].createElement(K["default"],{onSend:this.onSend,ref:this.onStarredGifsMount})),k["default"].createElement("div",{className:"gif-search-container",ref:this.onContainerMount},i,k["default"].createElement("div",{className:"gifs-section"},n,a))}}]),t}(k["default"].Component);t.Component=oe;t["default"]=(0,H["default"])(oe)},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(6),r=i(o),s=a(3),l=i(s),u=a(4),c=i(u),d=a(8),f=i(d),p=a(7),h=i(p),m=a(5),v=i(m),g=a(21),_=i(g),y=a(1507),E=i(y),M=a(1442),S=a(462),C=i(S),b=a(242),k=i(b),T=a(1439),w=n(T),N=a(12),P=i(N),A=a(238),O=i(A),R=a(78),D=i(R);t["default"]=(0,D["default"])(function(e){function t(){var e,a,n,i;(0,l["default"])(this,t);for(var o=arguments.length,s=Array(o),u=0;o>u;u++)s[u]=arguments[u];return a=n=(0,f["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(s))),n.setGifRef=function(e){n._gifRef=e},n.getGifProvider=function(){var e=n.props.msg.gifAttribution;switch(e){case C["default"].GIF_ATTRIBUTION.GIPHY:return M.GIPHY;case C["default"].GIF_ATTRIBUTION.TENOR:return M.TENOR;default:return""}},n.handleClick=function(e){e.stopPropagation();var t=n.props.msg.mediaData;switch(t.mediaStage){case k["default"].STAGE.NEED_POKE:n.props.msg.downloadMedia(!0);break;case k["default"].STAGE.FETCHING:n.props.msg.cancelDownload();break;case k["default"].STAGE.UPLOADING:n.props.msg.cancelUpload();break;case k["default"].STAGE.ERROR_MISSING:P["default"].openModal(v["default"].createElement(O["default"],{title:l10n.t("missing_photo_title"),onOK:P["default"].closeModal.bind(P["default"]),okText:l10n.t("web_ok")},l10n.t("missing_photo_text")))}},n.onUnstarMsg=function(){var e=n.props.msg;P["default"].sendUnstarMsgs(e.chat,[e])},i=a,(0,f["default"])(n,i)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"animateGif",value:function(){var e=this;this.props.listeners.uiIdle(function(){e._gifRef&&e._gifRef.setShouldAnimate(!0)})}},{key:"componentDidMount",value:function(){this.animateGif()}},{key:"componentDidUpdate",value:function(){this.animateGif()}},{key:"componentWillMount",value:function(){var e=this,t=this.props.msg;this.props.listeners.add(t,"change:mediaData.mediaStage",function(){e.forceUpdate()}),this.props.listeners.uiIdle(function(){t.downloadMedia()})}},{key:"render",value:function(){var e=this.props.msg,t=e.mediaData,a=new M.GifInfo(void 0,t.renderableUrl,void 0,void 0,Math.round(t.aspectRatio*M.TARGET_GIF_HEIGHT),this.getGifProvider(),!1);if(t.mediaStage===k["default"].STAGE.RESOLVED)return v["default"].createElement(E["default"],{key:e.filehash,ref:this.setGifRef,gif:a,display:!0,onSend:this.props.onSend,isStarred:!0,onUnstarMsg:this.onUnstarMsg});if(t.preview){var n=t.preview.url(),i=void 0;switch(t.mediaStage){case k["default"].STAGE.ERROR_MISSING:break;case k["default"].STAGE.NEED_POKE:i=v["default"].createElement(w.Download,null);break;case k["default"].STAGE.FETCHING:case k["default"].STAGE.UPLOADING:i=v["default"].createElement(w.PendingCancel,null);break;default:i=v["default"].createElement(w.Pending,null)}var o=(0,_["default"])("image-thumb-body","image-thumb-gif",{blur:t.mediaStage===k["default"].STAGE.ERROR_MISSING}),r=v["default"].createElement("div",{className:o,style:{backgroundImage:"url("+n+")",height:M.TARGET_GIF_HEIGHT+"px"}});return v["default"].createElement("div",{className:"gif-search-gif-wrapper",style:{flexBasis:a.widthStr},key:e.filehash},v["default"].createElement("div",{style:{width:a.widthStr},onClick:this.handleClick},v["default"].createElement("div",null,i,r)),v["default"].createElement("span",{className:"icon-s icon-star-light",onClick:this.onUnstarMsg}))}return null}}]),t}(v["default"].Component))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(21),g=n(v),_=a(1628),y=n(_),E=a(1442),M=a(78),S=n(M),C={RIGHT:"RIGHT",LEFT:"LEFT"},b=4;t["default"]=(0,S["default"])(function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={curIndex:0,direction:C.RIGHT},n.onSlideLeft=function(){n.setState({curIndex:n.state.curIndex-1,direction:C.LEFT})},n.onSlideRight=function(){n.setState({curIndex:n.state.curIndex+1,direction:C.RIGHT})},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){var e=this,t=Store.StarredGifMsgs;this.props.listeners.add(t,"add remove reset",function(){e.forceUpdate()}),t.isSynced||t.sync()}},{key:"render",value:function(){var e=this,t=Store.StarredGifMsgs.models;if(0===t.length)return m["default"].createElement("div",null);if(t.length<=b){var a=0,n=t.map(function(t){return a+=Math.round(t.mediaData.aspectRatio*E.TARGET_GIF_HEIGHT),m["default"].createElement(y["default"],{key:t.filehash,msg:t,onSend:e.props.onSend})});return a+=(n.length-1)*E.GAP_SIZE,m["default"].createElement("div",{className:"gifs-section"},m["default"].createElement("div",{className:"gif-section-title"},l10n.t("gif_starred_title")),m["default"].createElement("div",{className:"gif-search-row",style:{maxWidth:a+"px"}},n))}var i=void 0,o=void 0,r=this.state.curIndex>0,s=this.state.curIndex+b<t.length,l=r?this.onSlideLeft:null,u=s?this.onSlideRight:null,c=(0,g["default"])("star-gifs-pager gifs-pager-left",{"gifs-pager-disabled":!r}),d=(0,g["default"])("star-gifs-pager gifs-pager-right",{"gifs-pager-disabled":!s});i=m["default"].createElement("div",{className:c,onClick:l},m["default"].createElement("span",{className:"icon icon-chevron-left-alt"})),o=m["default"].createElement("div",{className:d,onClick:u},m["default"].createElement("span",{className:"icon icon-chevron-right-alt"}));var f=t.slice(this.state.curIndex,this.state.curIndex+b).map(function(t){return m["default"].createElement(y["default"],{key:t.filehash,msg:t,onSend:e.props.onSend})});return m["default"].createElement("div",{className:"gifs-section"},m["default"].createElement("div",{className:"gif-section-title"},l10n.t("gif_starred_title")),m["default"].createElement("div",{className:"gif-search-row"},i,m["default"].createElement("div",{className:"starred-gifs-body"},f),o))}}]),t}(m["default"].Component))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(13),g=n(v),_=a(12),y=n(_),E=a(238),M=n(E),S=a(1403),C=n(S),b=a(1410),k=n(b),T=a(1665),w=n(T),N=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.filter=function(e){var t=e.groupMetadata;return!e.isGroup||e.isGroup&&!t.participants.iAmMember()?!1:t.participants.get(n.props.contact.id)?l10n.t("already_added_to_group"):t.participants.iAmAdmin()?!0:l10n.t("chat_not_an_admin")},n.confirmAddToGroup=function(e){n.push(m["default"].createElement(M["default"],{onOK:n.addToGroup.bind(null,e),okText:l10n.t("add_group_participant"),onCancel:n._pop,cancelText:l10n.t("web_cancel")},m["default"].createElement(C["default"],{text:l10n.t("confirm_add_group_participant",{participant:n.props.contact.formattedName,subject:e.contact.name})})))},n.addToGroup=function(e){e.groupMetadata.participants.addParticipant(n.props.contact).then(function(){y["default"].openChatFromUnread(e).then(function(t){t&&y["default"].focusChatTextInput(e)})})["catch"](g["default"].noop),n.end()},n._pop=function(){n.pop()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.push(m["default"].createElement(w["default"],{chats:Store.Chat.filter(function(e){return e.isGroup}),filter:this.filter,onCancel:this._pop,onGroup:this.confirmAddToGroup}))}}]),t}(k["default"]);t["default"]=N},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(13),g=n(v),_=a(12),y=n(_),E=a(238),M=n(E),S=a(1512),C=n(S),b=a(1403),k=n(b),T=a(1410),w=n(T),N=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.contactFilter=function(e){var t=n.props.chat.groupMetadata;return Store.Contact.isFilteredContact(e)?t.participants.get(e.id)?l10n.t("already_added_to_group"):!0:!1},n.confirmAddParticipant=function(e){var t=n.onAddParticipant.bind(n,e),a=l10n.t("confirm_add_group_participant",{participant:e.formattedName,subject:n.props.chat.contact.name});n.push(m["default"].createElement(M["default"],{onOK:t,okText:l10n.t("add_group_participant"),onCancel:n._pop,cancelText:l10n.t("web_cancel")},m["default"].createElement(k["default"],{text:a})))},n.onAddParticipant=function(e){n.props.chat.groupMetadata.participants.addParticipant(e)["catch"](g["default"].noop),y["default"].closeModal()},n._pop=function(){n.pop()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.push(m["default"].createElement(C["default"],{title:l10n.t("add_group_participant"),filter:this.contactFilter,onCancel:this._pop,onSelect:this.confirmAddParticipant}))}}]),t}(w["default"]);t["default"]=N},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(13),m=n(h),v=a(1480),g=(n(v),a(1481)),_=(n(g),a(1648)),y=n(_),E=a(12),M=n(E),S=a(1410),C=n(S),b=a(78),k=n(b),T=a(5),w=n(T),N=a(37),P=n(N),A=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onCancel=function(){n.props.onComplete&&n.props.onComplete(!1),n.end()},n.sendMedia=function(e){var t=n.props.chat;m["default"].delay(function(){e.forEach(function(e,a){var n={};0===a&&(n.quotedMsg=t.composeQuotedMsg,t.composeQuotedMsg=null),n.caption=e.caption,e.mediaPrep.sendToChat(t,n)})},300),n.props.onComplete&&n.props.onComplete(!0),n.end()},n.setText=function(e){m["default"].delay(function(){M["default"].pasteChatTextInput(n.props.chat,e)},300),n.end()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){M["default"].closeContextMenu(),M["default"].closeTooltip(),this.push(w["default"].createElement(y["default"],{chat:this.props.chat,files:this.props.files,onBack:this.onCancel,onSendMedia:m["default"].once(this.sendMedia),onDropText:m["default"].once(this.setText),mediaCollection:this.props.mediaCollection}))}},{key:"componentWillUnmount",value:function(){var e=this;P["default"].isGecko?m["default"].defer(function(){return M["default"].focusChatTextInput(e.props.chat)}):M["default"].focusChatTextInput(this.props.chat),this.props.mediaCollection["delete"]()}}]),t}(C["default"]);t["default"]=(0,k["default"])(A)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1410),g=n(v),_=a(1656),y=n(_),E=a(1404),M=(n(E),a(241)),S=(n(M),a(1687)),C=n(S),b=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.confirmSendContacts=function(e){n.push(m["default"].createElement(C["default"],{contactList:e,onSend:function(){return n.sendContacts(e)},onBack:n._popNone,chatName:n.props.chat.title()}),"none"),n.contacts=e},n.sendContacts=function(e){1===e.length?n.props.chat.sendContact(e[0]):n.props.chat.sendContactList(e),n.end()},n._getContacts=function(){return n.contacts},n._pop=function(){n.pop()},n._popNone=function(){n.pop("none")},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.contacts=[],this.push(m["default"].createElement(y["default"],{excludeChat:this.props.chat,title:l10n.t("send_contacts"),onCancel:this._pop,onChat:this.confirmSendContacts,getInitialItems:this._getContacts}))}}]),t}(g["default"]);t["default"]=b},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(6),r=i(o),s=a(3),l=i(s),u=a(4),c=i(u),d=a(8),f=i(d),p=a(7),h=i(p),m=a(5),v=i(m),g=a(1448),_=n(g),y=a(1510),E=i(y),M=a(1410),S=i(M),C=a(1418),b=a(474),k=function(e){function t(){var e,a,n,i;(0,l["default"])(this,t);for(var o=arguments.length,s=Array(o),u=0;o>u;u++)s[u]=arguments[u];return a=n=(0,f["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(s))),n.sendMedia=function(e){var t=e.getImg,a=e.caption,i=n.props.chat,o=i.composeQuotedMsg;i.composeQuotedMsg=null,(0,b.prepRawMedia)(t,{}).sendToChat(i,{caption:a||void 0,quotedMsg:o||void 0}),n.end()},i=a,(0,f["default"])(n,i)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){var e=this;this.push(v["default"].createElement(E["default"],{onBack:function(){e.end()},caption:!0,layoutType:C.FIT_TYPE.CONTAIN,onSend:this.sendMedia,stream:this.props.stream}))}},{key:"componentWillUnmount",value:function(){_.stop(this.props.stream)}}]),t}(S["default"]);t["default"]=k},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(6),r=i(o),s=a(3),l=i(s),u=a(4),c=i(u),d=a(8),f=i(d),p=a(7),h=i(p),m=a(5),v=i(m),g=a(1448),_=n(g),y=a(1510),E=i(y),M=a(1477),S=i(M),C=a(1410),b=i(C),k=a(1418),T=function(e){function t(){var e,a,n,i;(0,l["default"])(this,t);for(var o=arguments.length,s=Array(o),u=0;o>u;u++)s[u]=arguments[u];return a=n=(0,f["default"])(this,(e=t.__proto__||(0,r["default"])(t)).call.apply(e,[this].concat(s))),n.pushCaptureDrawer=function(){n.push(v["default"].createElement(E["default"],{onBack:n.cleanUp,onCaptured:n.onCaptured,onSend:null,layoutType:k.FIT_TYPE.COVER,stream:n.props.stream}))},n.closeStream=function(){n.props.stream&&_.stop(n.props.stream)},n.onFinished=function(e,t){n.props.onFinished(e,t),n.cleanUp()},n.cleanUp=function(){n.closeStream(),n.end()},n._pop=function(){n.pop()},n.onCaptured=function(e){n.push(v["default"].createElement(S["default"],{onCancel:n.cleanUp,onRetake:n._pop,retryText:M.RETRY_OPTIONS.RETAKE,onFinished:n.onFinished,img:e}))},i=a,(0,f["default"])(n,i)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.pushCaptureDrawer()}},{key:"componentWillUnmount",value:function(){this.closeStream()}}]),t}(b["default"]);t["default"]=T},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{
value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1477),g=n(v),_=a(1410),y=n(_),E=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onFinished=function(e,t){n.props.onFinished(e,t),n.end()},n._pop=function(){n.pop()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.push(m["default"].createElement(g["default"],{onCancel:this._pop,onFinished:this.onFinished,onRetake:this.props.onRetake,retryText:v.RETRY_OPTIONS.RESTART,img:this.props.img}))}}]),t}(y["default"]);t["default"]=E},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1663),g=n(v),_=a(1410),y=n(_),E=a(1404),M=(n(E),function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.push(m["default"].createElement(g["default"],{chat:this.props.chat,onConfirm:this.props.onConfirm}))}}]),t}(y["default"]));t["default"]=M},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(1477),m=n(h),v=a(1410),g=n(v),_=a(1667),y=n(_),E=a(5),M=n(E),S=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onImageSelected=function(e,t){n.push(M["default"].createElement(m["default"],{attributionUrl:t,onCancel:n._pop,onFinished:n.onFinished,img:e}))},n._pop=function(){n.pop()},n.onFinished=function(e,t){n.props.onFinished(e,t),n.end()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.push(M["default"].createElement(y["default"],{onCancel:this._pop,onImageSelected:this.onImageSelected}))}}]),t}(g["default"]);t["default"]=S},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(13),g=n(v),_=a(1482),y=(n(_),a(12)),E=n(y),M=a(14),S=n(M),C=a(21),b=n(C),k=a(15),T=n(k),w=a(61),N=n(w),P=a(78),A=n(P),O=a(1),R=n(O),D=a(242),x=n(D),I=a(1494),L=n(I),F=a(1670),U=n(F),j=a(43),G=n(j),B=a(462),V=n(B),H=a(1408),W=n(H),z=a(115),Y=n(z),q=a(46),K=n(q),Q=a(161),X=n(Q),Z=a(463),J=n(Z),$=function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));a.onKeyDown=function(e){37===e.keyCode?a.onPrev():39===e.keyCode&&a.onNext()},a.onImageLoad=function(){a.uiActionEvent&&(a.uiActionEvent.markUiActionT(),a.uiActionEvent.commit(),delete a.uiActionEvent)},a.onScroll=function(e){a.handleScroll(e.target)},a._handleScroll=function(e){0!==a.mediaMsgs.length&&(a.mediaMsgs.hasMediaBefore&&e.scrollLeft<e.clientWidth&&!function(){var e=a.mediaMsgs.head();a.props.listeners.uiIdle(function(){a.mediaMsgs.queryMedia(e.chat,e),a.forceUpdate()})}(),a.mediaMsgs.hasMediaAfter&&e.scrollLeft+S["default"].SCROLL_FUDGE>e.scrollWidth-2*e.clientWidth&&!function(){var e=a.mediaMsgs.last();a.props.listeners.uiIdle(function(){a.mediaMsgs.queryMedia(e.chat,e,"after"),a.forceUpdate()})}())},a.onNext=function(e){if(e&&e.stopPropagation(),!a.state.imgZoomed){var t=a.state.activeMsg,n=a.mediaMsgs.getAfter(t);return n?void a.onSelectThumb(n):void(N["default"].supportsFeature(N["default"].F.MEDIA_GALLERY)&&a.mediaMsgs.hasMediaAfter&&(a._queryMediaAfter||(a._queryMediaAfter=a.mediaMsgs.queryMedia(t.chat,t,"after").checkpoint(a.props.rejectOnUnmount()).then(function(e){e.length>0&&a.state.activeMsg===t&&a.onNext()})["catch"](T["default"].Unmount,g["default"].noop)["catch"](function(e){R["default"].error("query media msgs error: ",e)})["finally"](function(){a._queryMediaAfter=null}))))}},a.onPrev=function(e){if(e&&e.stopPropagation(),!a.state.imgZoomed){var t=a.state.activeMsg,n=a.mediaMsgs.getBefore(t);return n?void a.onSelectThumb(n):void(N["default"].supportsFeature(N["default"].F.MEDIA_GALLERY)&&a.mediaMsgs.hasMediaBefore&&(a._queryMediaBefore||(a._queryMediaBefore=a.mediaMsgs.queryMedia(t.chat,t,"before").checkpoint(a.props.rejectOnUnmount()).then(function(e){e.length>0&&a.state.activeMsg===t&&a.onPrev()})["catch"](T["default"].Unmount,g["default"].noop)["catch"](function(e){R["default"].error("query media msgs error: ",e)})["finally"](function(){a._queryMediaBefore=null}))))}},a.onImgZoomIn=function(e){a.setState({imgZoomed:e})},a.endFlow=function(){E["default"].closeModalMedia()},a.willEndFlow=function(){(0,J["default"])(a.refs.thumbsContainer,{opacity:[0,1],translateY:["100%","0%"]},{duration:300,easing:[.1,.82,.25,1]})},a.onSelectThumb=function(e){N["default"].supportsFeature(N["default"].F.MEDIA_GALLERY)&&a.props.listeners.uiIdle(function(){a.mediaMsgs.loadMoreAroundIfNeeded(e)}),a.setState({activeMsg:e})},a.scrollToActive=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!1,t=a.refs.thumbsContainer,n=K["default"].findDOMNode(a.refs.thumbs),i=K["default"].findDOMNode(a.refs.activeThumb);if(t&&n&&i){var o=i.clientWidth/2-t.clientWidth/2;(0,J["default"])(n,"stop");var r=0;e&&(r=300),(0,J["default"])(i,"scroll",{duration:r,container:n,offset:o,axis:"x",easing:[.1,.82,.25,1]})}},a.getThumbs=function(){var e=a.mediaMsgs.map(function(e){var t=(0,b["default"])("media-thumb",{active:e===a.state.activeMsg});return m["default"].createElement(L["default"],{classes:t,msg:e,ref:e===a.state.activeMsg?"activeThumb":null,key:"media-"+e.id.id,onClick:a.onSelectThumb.bind(a,e)})});return e.push(m["default"].createElement("div",{className:"media-thumb-spinner media-thumb",key:"spinner-right"},a.mediaMsgs.queryMediaAfter?m["default"].createElement(X["default"],{stroke:6,size:24}):null)),e.unshift(m["default"].createElement("div",{className:"media-thumb-spinner media-thumb",key:"spinner-left"},a.mediaMsgs.queryMediaBefore?m["default"].createElement(X["default"],{stroke:6,size:24}):null)),e.push(m["default"].createElement("div",{className:"media-thumb-padding",key:"padding-right"})),e.unshift(m["default"].createElement("div",{className:"media-thumb-padding",key:"padding-left"})),e},a.zoomIn=!0,a.prevScrollWidth=null;var n=a.props.msg;return a.mediaMsgs=n.chat.constructMediaMsgs(n),a.handleScroll=g["default"].throttle(a._handleScroll,100),n.type===V["default"].TYPE.IMAGE&&(a.uiActionEvent=new G["default"].UiAction({uiActionType:G["default"].UI_ACTION_TYPE.IMAGE_OPEN,uiActionPreloaded:n.mediaData.mediaStage===x["default"].STAGE.RESOLVED})),a.state={activeMsg:n,imgZoomed:!1},a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.props.listeners.add(window,"keydown",this.onKeyDown)}},{key:"componentDidMount",value:function(){var e=this;this.zoomIn=!1;var t=this.props.listeners;N["default"].supportsFeature(N["default"].F.MEDIA_GALLERY)&&t.uiIdle(function(){e.mediaMsgs.loadMoreAroundIfNeeded(e.state.activeMsg)}),t.add(this.mediaMsgs,"remove reset",function(t,a,n){if(e.mediaMsgs.indexOf(t)>-1||e.state.activeMsg!==t)return void e.forceUpdate();var i=n.index;0===e.mediaMsgs.length?e.endFlow():e.mediaMsgs.length===i?e.onSelectThumb(e.mediaMsgs.at(i-1)):e.onSelectThumb(e.mediaMsgs.at(i))}),t.add(this.mediaMsgs,"query_media_after"),t.add(this.mediaMsgs,"query_media_before",function(){var t=K["default"].findDOMNode(e.refs.thumbs);t&&(e.prevScrollWidth=t.scrollWidth,e.forceUpdate())}),this.scrollToActive(),(0,J["default"])(this.refs.thumbsContainer,{opacity:[1,0],translateY:["0%","100%"]},{duration:300,delay:100,easing:[.1,.82,.25,1]})}},{key:"componentWillUnmount",value:function(){this.handleScroll.cancel()}},{key:"componentDidUpdate",value:function(e,t){if(t.activeMsg!==this.state.activeMsg)this.scrollToActive(!0);else{var a=K["default"].findDOMNode(this.refs.thumbs);if(!a||!this.prevScrollWidth)return;a.scrollLeft+=a.scrollWidth-this.prevScrollWidth,this.prevScrollWidth=null}}},{key:"render",value:function(){var e=this.mediaMsgs.last(),t=this.mediaMsgs.hasMediaAfter||this.state.activeMsg!==e?this.onNext:null,a=this.mediaMsgs.head(),n=this.mediaMsgs.hasMediaBefore||this.state.activeMsg!==a?this.onPrev:null,i=this.getThumbs(),o=N["default"].supportsFeature(N["default"].F.MEDIA_GALLERY)?this.onScroll:null;return m["default"].createElement("div",{className:this.state.imgZoomed?"img-zoomed-in":null},m["default"].createElement("div",{className:"media-collection media-viewer-thumbs-container",ref:"thumbsContainer"},m["default"].createElement("div",{onScroll:o,style:{width:"100%"},dir:"ltr"},m["default"].createElement(Y["default"],{className:"media-viewer-thumbs",ref:"thumbs",transitionName:"thumb-scale"},i))),m["default"].createElement(U["default"],{msg:this.state.activeMsg,mediaData:this.state.activeMsg.mediaData,onBack:this.endFlow,onExitAnimation:this.willEndFlow,onNext:t,onPrev:n,onImgZoomIn:this.onImgZoomIn,getZoomNode:this.props.getZoomNode,startTime:this.props.startTime,zoomIn:this.zoomIn,onImageLoad:this.uiActionEvent?this.onImageLoad:null}))}}]),t}(m["default"].Component);t["default"]=(0,W["default"])((0,A["default"])($))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(12),g=n(v),_=a(1652),y=n(_),E=a(1410),M=n(E),S=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onClick=function(e,t){Store.Chat.find(t.id).then(g["default"].openChatFromUnread.bind(g["default"])),n.endFlow()},n.endFlow=function(){n.end()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.push(m["default"].createElement(y["default"],{title:l10n.t("new_chat_flow_title"),onBack:this.endFlow,onClick:this.onClick}))}}]),t}(M["default"]);t["default"]=S},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(13),g=n(v),_=a(1410),y=n(_),E=a(1673),M=n(E),S=a(1674),C=n(S),b=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.groupParticipants=function(e,t,a){n.push(m["default"].createElement(C["default"],{subject:e,thumb:t,full:a,onBack:n.participantsBack,onContinue:g["default"].once(n.createGroup)}))},n.createGroup=function(e,t,a,i){Store.Chat.createGroup(e,t,a,i),n.endFlow()},n.participantsBack=function(){n.pop()},n.endFlow=function(){n.end()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.push(m["default"].createElement(M["default"],{onBack:this.endFlow,onContinue:this.groupParticipants}))}}]),t}(y["default"]);t["default"]=b},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(13),y=n(_),E=a(1410),M=n(E),S=a(1404),C=(n(S),a(12)),b=n(C),k=a(14),T=n(k),w=a(1458),N=n(w),P=a(244),A=n(P),O=a(1531),R=n(O),D=a(160),x=n(D),I=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),n.handleForwardConfirmed=function(e){o["default"].map(e,function(e){var t=void 0;t=e.isUser&&e.contact.isBlocked()?e.contact.setBlock(!1):o["default"].resolve(!0),t.then(function(t){e.sendMessage(n.props.chat.groupMetadata.groupInviteLink,n.linkPreview)})}),n.end(),b["default"].openChatFromUnread(y["default"].head(e))},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){var e=this;this.push(g["default"].createElement(N["default"],{onChat:this.handleForwardConfirmed,title:x["default"].t("group_invite_send_link_title")}));var t=this.props.chat;this.linkPreview={canonicalUrl:T["default"].GROUP_INVITE_LINK_URL,description:x["default"].t("whatsapp_group_invite"),matchedText:t.groupMetadata.groupInviteLink,title:t.title(),thumbnail:null};var a=t.contact.profilePicThumb;a&&a.imgFull?A["default"].generateLinkPreview(a.imgFull).then(function(t){e.linkPreview.thumbnail=t}):(0,R["default"])(t.groupMetadata.groupInviteLink).then(function(t){t&&(e.linkPreview.thumbnail=t.data.thumbnail)})["catch"](y["default"].noop)}}]),t}(M["default"]);t["default"]=I},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(13),y=n(_),E=a(1458),M=n(E),S=a(12),C=n(S),b=a(1410),k=n(b),T=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),n.onForwardConfirmed=function(e){var t=n.props.msgText;1===e.length?!function(){var a=void 0,n=y["default"].head(e);a=n.isUser&&n.contact.isBlocked()?n.contact.setBlock(!1):o["default"].resolve(!0),a.then(function(e){return t&&n.setComposeContents({text:t}),C["default"].openChatFromUnread(n).then(function(e){e&&C["default"].focusChatTextInput(n)})})}():(o["default"].map(e,function(e){var a=void 0;a=e.isUser&&e.contact.isBlocked()?e.contact.setBlock(!1):o["default"].resolve(!0),a.then(function(a){e.sendMessage(t)})}),C["default"].openChatFromUnread(y["default"].head(e))),n.end()},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){this.push(g["default"].createElement(M["default"],{onChat:this.onForwardConfirmed,title:l10n.t("msg_send_title")}))}}]),t}(k["default"]);t["default"]=T},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1649),g=n(v),_=a(35),y=n(_),E=a(1410),M=n(E),S=a(1666),C=n(S),b=a(1675),k=n(b),T=a(1516),w=n(T),N=a(1678),P=n(N),A=a(1690),O=n(A),R=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.showWallpaperDrawer=function(){n.push(m["default"].createElement(O["default"],{onClose:n._pop}))},n.showBlockedDrawer=function(){n.push(m["default"].createElement(g["default"],{onClose:n._pop}))},n.showProfileDrawer=function(){var e=Store.Status.get(Store.Conn.me),t=Store.ProfilePicThumb.get(Store.Conn.me);n.push(m["default"].createElement(w["default"],{status:e,profilePicThumb:t,conn:Store.Conn,onClose:n._pop}))},n.showNotifications=function(){n.push(m["default"].createElement(k["default"],{onClose:n._pop}))},n.showHelp=function(){y["default"].upload("help-page-opened"),n.push(m["default"].createElement(C["default"],{onClose:n._pop}))},n._pop=function(){n.pop()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.push(m["default"].createElement(P["default"],{profileId:Store.Conn.me,onWallpaper:this.showWallpaperDrawer,onBlocked:this.showBlockedDrawer,onProfile:this.showProfileDrawer,onNotifications:this.showNotifications,onHelp:this.showHelp,onClose:this._pop}))}}]),t}(M["default"]);t["default"]=R},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1410),g=n(v),_=a(1681),y=n(_),E=a(1684),M=n(E),S=a(462),C=(n(S),a(1420)),b=(n(C),function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.openStatusViewer=function(e,t){n.push(m["default"].createElement(M["default"],{initialStatusV3:e,initialStatusMsg:t,closeStatusViewer:n.closeStatusViewer}),"status-v3-viewer")},n.closeStatusViewer=function(e){e?n.end():n.pop("status-v3-viewer")},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.push(m["default"].createElement(y["default"],{onOpenStatus:this.openStatusViewer,closeStatusViewer:this.closeStatusViewer}),"status-v3-modal")}}]),t}(g["default"]));e.exports=b},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(46),g=n(v),_=a(463),y=n(_),E=a(468),M=n(E),S=a(21),C=n(S),b=a(239),k=a(14),T=n(k),w=a(37),N=n(w),P=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){var e=g["default"].findDOMNode(this.img),t=g["default"].findDOMNode(this.txt);this.props.animate?((0,y["default"])(e,{scale:[1,0],opacity:[1,0]},{delay:1340,duration:180,easing:[.05,1.02,0,1.01]}),(0,y["default"])(t,{translateY:[0,80],opacity:[1,0]},{delay:1300,duration:140,easing:[.05,1.02,0,1.01]})):(e.style.opacity=1,t.style.opacity=1)}},{key:"render",value:function(){return m["default"].createElement("div",{className:(0,C["default"])("intro",this.props.className)},m["default"].createElement("div",{className:"intro-body"},m["default"].createElement("div",{ref:(0,b.GetRef)("img",this),className:"intro-image"}),m["default"].createElement("div",{ref:(0,b.GetRef)("txt",this),className:"intro-text-container"},m["default"].createElement("h1",{"data-a8n":M["default"].key("intro-title"),className:"intro-title"},l10n.t("intro_title")),m["default"].createElement("div",{"data-a8n":M["default"].key("intro-text"),className:"intro-text"},l10n.t("intro_connection")),m["default"].createElement(A,null))))}}]),t}(h.PureComponent),A=function(){var e=void 0;switch(N["default"].os){case T["default"].OS_TYPE.MAC:e=l10n.t("intro_native_mac");break;case T["default"].OS_TYPE.WINDOWS:e=l10n.t("intro_native_windows")}if(e){var t='<a href="https://www.whatsapp.com/download" target="_blank">'+l10n.t("intro_native_link")+"</a>";return e=e.replace("__get_it_here__",t),m["default"].createElement(O,null,m["default"].createElement("span",{className:"icon icon-laptop intro-secondary-icon"}),m["default"].createElement("span",{dangerouslySetInnerHTML:{__html:e}}))}return null},O=function(e){var t=e.children;return m["default"].createElement("div",{className:"intro-secondary"},m["default"].createElement("div",{className:"intro-divider"}),m["default"].createElement("div",{className:"intro-secondary-text"},t))};t["default"]=P},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(46),g=n(v),_=a(12),y=n(_),E=a(1405),M=n(E),S=a(1407),C=n(S),b=a(1406),k=n(b),T=a(1417),w=n(T),N=a(1412),P=n(N),A=a(1437),O=n(A),R=a(1411),D=n(R),x=a(95),I=n(x),L=a(96),F=n(L),U=a(116),j=n(U),G=a(78),B=n(G),V=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.selection=new D["default"]([],function(e){return e.id}),n.onClick=function(e,t){y["default"].openChatFromUnread(t).then(function(e){e&&y["default"].focusChatTextInput(t)}),n.onClose()},n.onClose=function(){n.context.uim.uie.requestDismiss()},n.getList=function(){return Store.Chat.filter("archive")},n.onNextChat=function(e){e.preventDefault(),e.stopPropagation(),n.selection.setNext()},n.onPrevChat=function(e){e.preventDefault(),e.stopPropagation(),n.selection.setPrev()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){this.props.listeners.add(Store.Chat,"change:archive add remove"),this.refs.list&&I["default"].focus(g["default"].findDOMNode(this.refs.list))}},{key:"render",value:function(){var e=this,t=void 0,a=this.getList();if(this.selection.init(a,!0),a.length>0){var n=a.map(function(t){return m["default"].createElement(O["default"],{chat:t,contact:t.contact,mode:A.Mode.LAST,key:t.id,active:e.selection,onClick:e.onClick})}),i={down:this.onNextChat,up:this.onPrevChat};t=m["default"].createElement(j["default"],{handlers:i,ref:"list",className:"archived-drawer-list chatlist","data-list-scroll-container":!0},m["default"].createElement(w["default"],{data:n,extraItems:4}))}else t=m["default"].createElement(P["default"].Archived,null);return m["default"].createElement(M["default"],{onCancel:this.onClose},m["default"].createElement(C["default"],{title:l10n.t("archived_flow_title"),onBack:this.onClose,type:S.DRAWER_HEADER_TYPE.LARGE}),m["default"].createElement(k["default"],null,t))}}]),t}(m["default"].Component);V.contextTypes={uim:m["default"].PropTypes.instanceOf(F["default"])},e.exports=(0,B["default"])(V)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(46),g=n(v),_=a(13),y=n(_),E=a(1480),M=n(E),S=a(1481),C=(n(S),a(1537)),b=n(C),k=a(1538),T=n(k),w=a(1463),N=n(w),P=a(1539),A=n(P),O=a(1540),R=n(O),D=a(1404),x=(n(D),a(12)),I=n(x),L=a(14),F=n(L),U=a(21),j=n(U),G=a(1447),B=n(G),V=a(1530),H=n(V),W=a(1405),z=n(W),Y=a(1406),q=n(Y),K=a(1407),Q=n(K),X=a(15),Z=n(X),J=a(63),$=n(J),ee=a(95),te=n(ee),ae=a(467),ne=n(ae),ie=a(116),oe=n(ie),re=a(78),se=n(re),le=a(119),ue=n(le),ce=a(462),de=n(ce),fe=a(1408),pe=n(fe),he=a(115),me=n(he),ve=a(161),ge=n(ve),_e=a(1435),ye=n(_e),Ee=a(465),Me=n(Ee),Se=de["default"].TYPE,Ce=Se.IMAGE,be=Se.VIDEO,ke=Se.DOCUMENT,Te=Se.AUDIO,we=y["default"].pickBy(ue["default"].MIMETYPES,function(e){return e.msgType===ke}),Ne=function(e){return 150+15*e},Pe=400,Ae=M["default"].STATE.PROCESSING;t["default"]=(0,pe["default"])((0,se["default"])(function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));return a.onProcessComplete=function(){if(!a.props.mediaCollection.some({state:Ae})){var e=a.props.mediaCollection.getValidMedias(),t=a.props.mediaCollection.uiProcessMsgs(),n=t.activeMedia,i=t.errorMsgs;i&&e.length>0&&I["default"].openToast(m["default"].createElement(Me["default"],{msg:i,id:Me["default"].genId()})),n?a.setState({activeMedia:n}):a.forceUpdate()}},a.showIgnoredToast=function(e){if(e>0){var t=l10n.t("too_many_files_uploaded",{number:e,_plural:e,max:F["default"].MAX_FILES});I["default"].openToast(m["default"].createElement(Me["default"],{msg:t,id:Me["default"].genId()}))}},a.onDragStart=function(){a.blockDrop=!0},a.onDragEnd=function(){a.blockDrop=!1},a.onDragOver=function(){a.state.isDragging||a.blockDrop||a.setState({isDragging:!0})},a.onWindowDrop=function(){y["default"].isEmpty(a.props.files)&&y["default"].isEmpty(a.props.mediaCollection)&&a.props.onBack()},a.onDrop=function(e){a.blockDrop||(a.setState({isDragging:!1}),a.onFilePick(e))},a.onDragLeave=function(){a.props.mediaCollection.length||a.props.onBack(),a.setState({isDragging:!1})},a.onKeyDown=function(e){if(a.state.activeMedia&&!e.repeat)if(37===e.keyCode){var t=a.state.activeMedia,n=a.refs.emojiInput&&a.refs.emojiInput.refs.inputLine;(t&&!t.caption||n&&(n.isAtBeginning()||null===n.getCursor()))&&a.onPrev()}else if(39===e.keyCode){var i=a.state.activeMedia,o=a.refs.emojiInput&&a.refs.emojiInput.refs.inputLine;(i&&!i.caption||o&&(o.isAtEnd()||null===o.getCursor()))&&a.onNext()}else 13===e.keyCode&&a.onSend()},a.onNext=function(){var e=a.props.mediaCollection.getAfter(a.state.activeMedia);e&&(a.refs.sendButton&&te["default"].focus(a.refs.sendButton),a.setState({activeMedia:e}))},a.onPrev=function(){var e=a.props.mediaCollection.getBefore(a.state.activeMedia);e&&(a.refs.sendButton&&te["default"].focus(a.refs.sendButton),a.setState({activeMedia:e}))},a.onSelectThumb=function(e){e!==a.state.activeMedia&&a.setState({activeMedia:e})},a.onSend=function(e){e&&e.preventDefault(),e&&e.shiftKey||a.props.onSendMedia(y["default"].map(a.props.mediaCollection.getValidMedias(),function(e){var t=e.caption;return t&&(t=y["default"].trim(e.caption)),t&&(t=ne["default"].emojify(t)),e.caption=t||void 0,e}))},a.onAddFileClick=function(){var e=a.refs.input;e.click()},a.onFilePick=function(e){H["default"].getFiles(e).then(function(e){return a.props.mediaCollection.processFiles(e,a.props.chat)}).checkpoint(a.props.rejectOnUnmount())["catch"](Z["default"].Unmount,y["default"].noop)["catch"](Z["default"].MediaDragDropError,function(e){if(a.props.mediaCollection.length)throw e;a.props.onDropText(e.src)}),e.target.value=""},a.onRemoveThumb=function(e,t){t.stopPropagation(),t.preventDefault();var n=a.props.mediaCollection.getBefore(e)||a.props.mediaCollection.getAfter(e);a.props.mediaCollection.remove(e),a.setState({activeMedia:n})},a.onCaptionChange=function(e){var t=a.state.activeMedia;t&&(t.caption=e,a.setState({}))},a.onPaste=function(e){e.preventDefault(),e.stopPropagation();var t=new B["default"](e.clipboardData);t.hasFiles()&&a.onFiles(t)},a.onFiles=function(e){var t=y["default"].filter(e.getFiles(),function(e){var t=$["default"].typeFromMimetype(e.type);return"image"===t||"video"===t});a.props.mediaCollection.processFiles(t,a.props.chat)},a.getMedia=function(e){var t=void 0,n=void 0;switch(e.media.type){case Ce:case be:var i=void 0;e.media.fullWidth&&e.media.fullHeight&&(i={width:e.media.fullWidth,height:e.media.fullHeight}),t=m["default"].createElement(A["default"],{mimeType:e.media.mimetype,url:e.url,isGif:!!e.media.isGif,size:i}),n=m["default"].createElement("div",{className:"media-caption"},m["default"].createElement(ye["default"],{ref:"emojiInput",editable:!0,value:e.caption,placeholder:l10n.t("add_a_caption"),maxLength:F["default"].MAX_CAPTION_LENGTH,showRemaining:!0,onEnter:a.onSend,onChange:a.onCaptionChange,onFiles:a.onFiles,supportsEmoji:!0}));break;case Te:t=m["default"].createElement(b["default"],{mimeType:e.media.mimetype,url:e.url});break;case ke:switch(ue["default"].previewType(e.media.mimetype)){case"pdf":t=m["default"].createElement(R["default"],{preview:e.generatedPreview,mimeType:e.media.mimetype,filename:e.media.filename});break;case"msoffice":t=m["default"].createElement(T["default"],{preview:e.generatedPreview,mimeType:e.media.mimetype,filename:e.media.filename});break;default:t=m["default"].createElement(N["default"],{mimeType:e.media.mimetype,filename:e.media.filename})}}return m["default"].createElement("div",{className:"media-body-container",key:e.id},t,n)},a.getThumbs=function(e){return e.map(function(e,t){var n=(0,j["default"])("media-thumb","stagger-delay",{active:e===a.state.activeMedia}),i=a.props.mediaCollection.indexOf(a.state.activeMedia),o=Math.max(a.props.mediaCollection.length-i-1,1),r=Ne(t)/o*Math.max(0,t-i)+"ms";return m["default"].createElement(Oe,{className:n,key:"media-"+e.id,media:e,onClick:a.onSelectThumb.bind(null,e),onClose:a.onRemoveThumb.bind(null,e),staggerDelay:r})})},a.transition="media-scale",a.blockDrop=!1,a.state={activeMedia:null,isDragging:!1},a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.props.listeners.add(window,"drop",this.onWindowDrop)}},{key:"componentDidMount",value:function(){var e=this.props,t=e.mediaCollection,a=e.listeners;a.add(t,"add remove reset"),a.add(t,"change:state",this.onProcessComplete),a.add(t,"max_upload_limit",this.showIgnoredToast)}},{key:"componentWillUpdate",value:function(e,t){var a=t.activeMedia,n=this.state.activeMedia;return n&&a&&n!==a?void(this.props.mediaCollection.indexOf(a)>this.props.mediaCollection.indexOf(n)?this.transition="media-slide-forward":this.transition="media-slide-back"):void(this.transition="media-scale")}},{key:"componentDidUpdate",value:function(e,t){!t.activeMedia&&this.state.activeMedia&&this.refs.emojiInput?this.refs.emojiInput.restoreFocus():!g["default"].findDOMNode(this).contains(document.activeElement)&&this.refs.sendButton&&te["default"].focus(this.refs.sendButton)}},{key:"render",value:function(){var e=void 0,t=void 0,a=void 0,n=0,i=this.props.mediaCollection.getValidMedias();i.length>F["default"].MAX_FILES&&(i=i.slice(0,F["default"].MAX_FILES)),this.props.mediaCollection.some({state:Ae})?e=m["default"].createElement(ge["default"],{key:"processing"}):this.state.activeMedia?e=this.getMedia(this.state.activeMedia):0===i.length&&this.props.mediaCollection.errorMsgs&&(e=m["default"].createElement("div",{className:"invalid-media-container",key:"pending"},m["default"].createElement("div",{className:"invalid-media"},this.props.mediaCollection.errorMsgs))),i.length>0&&(t=this.getThumbs(i),n=1===i.length?Pe:Pe+Ne(i.length),a=m["default"].createElement("div",{className:"drawer-controls",tabIndex:"-1",ref:"sendButton",onKeyPress:function(e){return e.preventDefault()}},m["default"].createElement("button",{className:"btn btn-round btn-l",onClick:this.onSend},m["default"].createElement("span",{className:"icon icon-send-light"}))));var o=this.state.isDragging?m["default"].createElement("div",{key:"container",className:"drag-drop"},m["default"].createElement("div",{className:"stitching"},l10n.t("drag_media_here"))):null,r=i.length<F["default"].MAX_FILES?m["default"].createElement("div",{key:"media-more",className:"media-thumb btn-add-media",onClick:this.onAddFileClick},m["default"].createElement("button",{className:"btn-fill"},m["default"].createElement("span",{className:"icon icon-add-alt"}),l10n.t("add_media"))):null,s={enter:this.onKeyDown,left:this.onKeyDown,right:this.onKeyDown},l="*"===ue["default"].DOC_MIMES?"*":[F["default"].IMAGE_MIMES,F["default"].VIDEO_MIMES,ue["default"].DOC_MIMES].join();return m["default"].createElement(oe["default"],{handlers:s},m["default"].createElement(z["default"],{key:"attach-image-modal",ref:"container",className:"drawer-media",variant:"noheader",onDrop:this.onDrop,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave},m["default"].createElement(Q["default"],{title:l10n.t("web_preview_msg"),type:K.DRAWER_HEADER_TYPE.OFFSET,onCancel:this.props.onBack}),m["default"].createElement(q["default"],{tabIndex:"-1",onDragStart:this.onDragStart,onPaste:this.onPaste,onDragEnd:this.onDragEnd},o,m["default"].createElement("div",{className:"media-body"},m["default"].createElement(me["default"],{transitionName:this.transition},e)),m["default"].createElement(me["default"],{transitionName:"thumb-scale",className:"media-collection"},t,r),m["default"].createElement(me["default"],{transitionName:"btn",delay:n},a),m["default"].createElement("input",{ref:"input",type:"file",accept:l,style:{display:"none"},onChange:this.onFilePick,
multiple:!0}))))}}]),t}(m["default"].Component)));var Oe=function(e){var t=e.media,n=e.className,i=e.onClick,o=e.onClose,r=void 0,s=void 0,l=void 0;switch(t.media.type){case Ce:l={backgroundImage:"url("+t.url+")"},r=m["default"].createElement("div",{className:"media-thumb-body",style:l});break;case be:l={backgroundImage:"url(data:image/jpeg;base64,"+t.preview+")"},r=m["default"].createElement("div",{className:"media-thumb-body",style:l});break;case Te:r=m["default"].createElement("div",{className:"attach-media-audio-thumb"});break;case ke:var u=a(1);if(u.log("media is",t)(),t.media.documentPreview&&t.media.documentPreview.thumbUrl){var c={backgroundImage:"url("+t.media.documentPreview.thumbUrl+")"};we[t.media.mimetype]&&(s=we[t.media.mimetype].icon),s=(0,j["default"])(s,"icon-doc","icon-doc-thumb-filetype"),r=m["default"].createElement("div",{className:"media-thumb-body",style:c},m["default"].createElement("div",{className:s}));break}we[t.media.mimetype]&&(s=we[t.media.mimetype].icon);default:s=(0,j["default"])(s,"icon-doc"),r=m["default"].createElement("div",{className:"media-thumb-body"},m["default"].createElement("div",{className:s}))}return m["default"].createElement("div",{className:n,onClick:i},m["default"].createElement("span",{className:"btn-delete icon icon-x-alt-light",onClick:o}),r)}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(13),g=n(v),_=a(12),y=n(_),E=a(238),M=n(E),S=a(1422),C=n(S),b=a(1512),k=n(b),T=a(1405),w=n(T),N=a(1406),P=n(N),A=a(1407),O=n(A),R=a(1430),D=n(R),x=a(1459),I=n(x),L=a(1412),F=n(L),U=a(1417),j=n(U),G=a(78),B=n(G);t["default"]=(0,B["default"])(function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onBlockConfirm=function(e){e.setBlock(!0)["catch"](g["default"].noop),y["default"].closeModal()},n.onBlock=function(){var e=function(e){return Store.Contact.isFilteredContact(e)?Store.Blocklist.get(e.id)?l10n.t("participant_already_blocked"):!0:!1};y["default"].openModal(m["default"].createElement(k["default"],{title:l10n.t("add_blocked_title"),filter:e,onCancel:y["default"].closeModal.bind(y["default"]),onSelect:g["default"].once(n.onBlockConfirm)}))},n.onUnblockConfirm=function(e){e.setBlock(!1)["catch"](g["default"].noop),y["default"].closeModal()},n.onUnblockCancel=function(){y["default"].closeModal()},n.onUnblock=function(e,t){y["default"].openModal(m["default"].createElement(M["default"],{okText:l10n.t("unblock_button"),onOK:n.onUnblockConfirm.bind(n,t),cancelText:l10n.t("web_cancel"),onCancel:n.onUnblockCancel},l10n.t("unblock_confirmation",{contact:t.formattedName})))},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.props.listeners.add(Store.Blocklist,"add remove")}},{key:"render",value:function(){var e=this,t=void 0,a=void 0;if(Store.Blocklist.length>0){var n=Store.Blocklist.map(function(t){return m["default"].createElement(C["default"],{contact:t.contact,key:t.contact.id,onClick:e.onUnblock,onDelete:e.onUnblock})});t=m["default"].createElement("div",{className:"blocked-drawer-list chatlist","data-list-scroll-container":!0},m["default"].createElement(j["default"],{data:n,extraItems:4})),a=m["default"].createElement("div",{className:"drawer-blocked-hint"},l10n.t("add_blocked_description"))}else t=m["default"].createElement(F["default"].Blocked,null);return m["default"].createElement(w["default"],{onCancel:this.props.onClose},m["default"].createElement(O["default"],{title:l10n.t("blocked_flow_title"),onBack:this.props.onClose,type:A.DRAWER_HEADER_TYPE.LARGE}),m["default"].createElement(I["default"],{className:"drawer-blocked-button-add"},m["default"].createElement(D["default"],{onClick:this.onBlock,a8n:"li-add-blocked",iconClass:"icon-add-user"},l10n.t("add_blocked_title"))),m["default"].createElement(P["default"],null,t,a))}}]),t}(m["default"].Component))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(79),g=n(v),_=a(12),y=n(_),E=a(1422),M=n(E),S=a(1409),C=n(S),b=a(1405),k=n(b),T=a(1406),w=n(T),N=a(1430),P=n(N),A=a(1431),O=n(A),R=a(61),D=n(R),x=a(1417),I=n(x),L=a(78),F=n(L),U=a(1451),j=n(U),G=a(1402),B=n(G),V=a(96),H=n(V),W=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onParticipantClick=function(e,t){Store.Conn.me!==t.id&&Store.Chat.find(t.id).then(function(e){y["default"].openChatFromUnread(e).then(function(t){t&&y["default"].focusChatTextInput(e)})})},n.onClose=function(){n.props.onClose?n.props.onClose():n.context.uim.uie.requestDismiss()},n.onDelete=function(){y["default"].deleteOrExitChat((0,G.unproxy)(n.props.chat))},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props.chat.groupMetadata;this.props.listeners.add(e.participants,"add remove sort reset")}},{key:"render",value:function(){var e=this.props.chat,t=e.groupMetadata,a=this.onParticipantClick,n=t.participants.map(function(e){var t=Store.Contact.get(e.id)||Store.Contact.add({id:e.id});return m["default"].createElement(M["default"],{contact:t,admin:!!e.isAdmin,onClick:a,key:e.id})}),i=null;if(this.props.onMediaGallery){var o=m["default"].createElement("span",{className:"icon icon-chevron-right-alt"}),r=D["default"].supportsFeature(D["default"].F.LINK_DOC_GALLERY)?l10n.t("media_links_docs"):l10n.t("media");i=m["default"].createElement(O["default"],{title:r,titleOnClick:this.props.onMediaGallery,subtitle:o,classes:"animate-enter2",noContainer:!0},m["default"].createElement(j["default"],{chat:(0,G.unproxy)(e),mediaMsgs:e.getMediaMsgs()}))}var s=null,l=n.length?m["default"].createElement(O["default"],{classes:"animate-enter1 well-simple-body",title:l10n.t("web_recipients_title"),subtitle:l10n.n(n.length),"data-list-scroll-offset":!0},m["default"].createElement("div",{className:"drawer-section-body chatlist"},m["default"].createElement(I["default"],{data:n,height:72,extraItems:4}))):null,u=void 0;e.canDelete()&&(u=m["default"].createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},m["default"].createElement(P["default"],{iconClass:"icon-delete-danger",a8n:"li-delete-broadcast",className:"danger first",onClick:this.onDelete},l10n.t("web_delete_list"))));var c=void 0;e.groupMetadata.creation?(c=g["default"].timeStr(e.groupMetadata.creation),c=m["default"].createElement("div",{className:"header-secondary"},l10n.t("web_group_creation_time",{when:c}))):c=null;var d=null,f=null;return(s||d)&&(f=m["default"].createElement(O["default"],{classes:"well-simple animate-enter2"},s,d)),m["default"].createElement(k["default"],{key:"contact-info-modal",className:"drawer-info",variant:"panel",onCancel:this.onClose},m["default"].createElement("header",{className:"pane-header"},m["default"].createElement("div",{className:"header-close"},m["default"].createElement("button",{onClick:this.onClose},m["default"].createElement("span",{className:"icon icon-x"}))),m["default"].createElement("div",{className:"header-body"},m["default"].createElement("div",{className:"header-main"},m["default"].createElement("div",{className:"header-title"},l10n.t("broadcast_list_info")),c))),m["default"].createElement(w["default"],{expands:!!n.length,"data-list-scroll-container":!0},m["default"].createElement(O["default"],{classes:"drawer-scale drawer-section-photo"},m["default"].createElement(C["default"],{id:e.id,size:C["default"].Size.LARGE})),i,f,l,u))}}]),t}(m["default"].Component);W.contextTypes={uim:m["default"].PropTypes.instanceOf(H["default"])},W.CONCERNS={chat:["id","groupMetadata"],contact:["plaintextDisabled"]},t["default"]=(0,F["default"])((0,B["default"])(W))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(468),g=n(v),_=a(1404),y=n(_),E=a(12),M=n(E),S=a(61),C=n(S),b=a(1428),k=n(b),T=a(1403),w=n(T),N=a(238),P=n(N),A=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={keepStarred:!0},n.onCancel=function(){M["default"].closeModal()},n.onClear=function(){var e=n.props.chat;e.pendingAction++,e.sendClear(C["default"].supportsFeature(C["default"].F.STARRED)&&C["default"].supportsFeature(C["default"].F.CHAT_CLEAR_STARRED)&&n.state.keepStarred)["finally"](function(){e.pendingAction--}),M["default"].closeModal()},n.onToggleStarred=function(){n.setState({keepStarred:!n.state.keepStarred})},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"getText",value:function(){var e=this.props.chat;switch(e.kind){case y["default"].KIND.GROUP:return l10n.t("clear_chat_group",{name:e.title()});case y["default"].KIND.CHAT:return l10n.t("clear_chat_chat",{name:e.title()});case y["default"].KIND.BROADCAST:return l10n.t("clear_chat_broadcast");default:return""}}},{key:"render",value:function(){var e=void 0;return C["default"].supportsFeature(C["default"].F.STARRED)&&C["default"].supportsFeature(C["default"].F.CHAT_CLEAR_STARRED)&&(e=m["default"].createElement("div",{className:"controls-section controls-section-popup",onClick:this.onToggleStarred},m["default"].createElement("div",{"data-a8n":g["default"].key("menu-icon-clear-chat"),className:"control"},m["default"].createElement(k["default"],{onChange:this.onToggleStarred,checked:this.state.keepStarred})),m["default"].createElement("div",{className:"label"},l10n.t("keep_starred")))),m["default"].createElement(P["default"],{onOK:this.onClear,okText:l10n.t("clear_button"),onCancel:this.onCancel},m["default"].createElement("div",null,m["default"].createElement(w["default"],{text:this.getText()}),e))}}]),t}(m["default"].Component);t["default"]=A},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(13),g=n(v),_=a(1489),y=n(_),E=a(1405),M=n(E),S=a(1406),C=n(S),b=a(1407),k=n(b),T=a(1412),w=n(T),N=a(95),P=n(N),A=a(116),O=n(A),R=a(1434),D=n(R),x=a(117),I=n(x);t["default"]=(0,I["default"])(function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={searchText:"",active:!1},n.setSearch=function(e){return n.search=e},n.onSearch=function(e){n.setState({searchText:e})},n.onFocusList=function(e){n.refs.list&&(e.preventDefault(),e.stopPropagation(),O["default"].flashFocus=Date.now(),n.refs.list.focusFirst())},n.onSelectFirst=function(e){e.preventDefault(),e.stopPropagation();var t=g["default"].head(n.getFilteredContacts());t&&(O["default"].flashFocus=Date.now(),n.props.onClick(e,t))},n.onFocusSearch=function(){O["default"].flashFocus=Date.now(),P["default"].focus(n.search)},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){var e=this;this.props.setTimeout(function(){e.setState({active:!0})},0)}},{key:"getFilteredContacts",value:function(){var e=Store.Contact.getFilteredContacts(),t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e}},{key:"render",value:function(){var e=void 0;if(this.state.active){var t=this.getFilteredContacts();e=0===t.length?m["default"].createElement(w["default"].SearchContacts,null):m["default"].createElement(y["default"],{ref:"list",contacts:t,onFocusSearch:this.onFocusSearch,onClick:this.props.onClick,profileClick:!0})}else e=null;var a={down:this.onFocusList,enter:this.onSelectFirst};return m["default"].createElement(M["default"],{key:"contact-modal",onCancel:this.props.onBack},m["default"].createElement(k["default"],{title:this.props.title,type:b.DRAWER_HEADER_TYPE.LARGE,onBack:this.props.onBack}),m["default"].createElement(O["default"],{handlers:a},m["default"].createElement(D["default"],{ref:this.setSearch,onSearch:this.onSearch,placeholder:l10n.t("search_contacts")})),m["default"].createElement(C["default"],{"data-list-scroll-container":!0},e))}}]),t}(m["default"].Component))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(13),g=n(v),_=a(1437),y=n(_),E=a(12),M=n(E),S=a(238),C=n(S),b=a(14),k=n(b),T=a(1462),w=n(T),N=a(1409),P=n(N),A=a(1405),O=n(A),R=a(1406),D=n(R),x=a(1430),I=n(x),L=a(1431),F=n(L),U=a(15),j=n(U),G=a(1403),B=n(G),V=a(61),H=n(V),W=a(1563),z=n(W),Y=a(1417),q=n(Y),K=a(78),Q=n(K),X=a(1),Z=n(X),J=a(1451),$=n(J),ee=a(1496),te=n(ee),ae=a(1478),ne=n(ae),ie=a(1408),oe=n(ie),re=a(1469),se=n(re),le=a(1402),ue=n(le),ce=a(96),de=n(ce),fe=a(1470),pe=n(fe),he=a(22),me=n(he),ve=function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));return a._init=function(){a.props.contact.findCommonGroups().checkpoint(a.props.rejectOnUnmount()).then(function(e){a.setState({commonGroups:e}),a.props.listeners.add(Store.GroupMetadata,"group_participant_change",a.commonGroupsUpdate)})["catch"](j["default"].Unmount,g["default"].noop)["catch"](j["default"].WapDrop,g["default"].noop)["catch"](g["default"].noop),H["default"].supportsFeature(H["default"].F.QUERY_IDENTITY)&&a.props.contact.queryIdentity()["catch"](function(e){Z["default"].error("contactInfoDrawer:queryIdentity error: "+e)()})},a.onBlocklistChange=function(){a.state.contactIsBlocked!==!!Store.Blocklist.get(a.props.contact.id)&&a.setState({contactIsBlocked:!!Store.Blocklist.get(a.props.contact.id)})},a.commonGroupsUpdate=function(e){var t=a.state.commonGroups,n=a.props.contact.updateCommonGroups(t,e);n&&a.setState({commonGroups:n})},a.onDeleteChat=function(){var e=Store.Chat.get(a.props.contact.id);M["default"].deleteOrExitChat(e)},a.onBlockContact=function(){var e=a.props.contact;M["default"].openModal(m["default"].createElement(C["default"],{title:l10n.t("block"),onOK:a.blockContact,okText:l10n.t("block"),onCancel:M["default"].closeModal.bind(M["default"]),cancelText:l10n.t("web_cancel")},l10n.t("block_confirmation",{contact:e.formattedName})))},a.onUnblockContact=function(){var e=a.props.contact;M["default"].openModal(m["default"].createElement(C["default"],{okText:l10n.t("unblock_button"),onOK:a.unblockContact,cancelText:l10n.t("web_cancel"),onCancel:M["default"].closeModal.bind(M["default"])},l10n.t("unblock_confirmation",{contact:e.formattedName})))},a.blockContact=function(){a.props.contact.setBlock(!0),M["default"].closeModal()},a.unblockContact=function(){a.props.contact.setBlock(!1),M["default"].closeModal()},a.onClose=function(){a.props.onClose?a.props.onClose():a.context.uim.uie.requestDismiss()},a.onCopy=function(e){var t=w["default"].extractIsolatedBlocks(window.getSelection());e.clipboardData.setData("text/plain",t),e.stopPropagation(),e.preventDefault()},a.onViewPicture=function(e){if(a.canViewPicture){var t=e.target,n=function(e){e(t)};M["default"].openModalMedia(m["default"].createElement(ne["default"],{contact:a.props.contact,profilePicThumb:a.props.contact.profilePicThumb,animateBorderRadius:!0,getZoomNode:n}),"profile-viewer")}},a.onDetailImageLoad=function(e){a.canViewPicture=!0},a.onClick=function(e,t){M["default"].openChatFromUnread(t).then(function(e){e&&M["default"].focusChatTextInput(t)}),a.onClose()},a.canViewPicture=!1,a.state={commonGroups:void 0,contactIsBlocked:!!Store.Blocklist.get(e.contact.id)},a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){this.props.listeners.add(Store.Blocklist,"add remove reset sync",this.onBlocklistChange),this.props.listeners.uiIdle(this._init)}},{key:"render",value:function(){var e,t,a=this,n=this.props.contact,i=this.state.commonGroups;i=g["default"].compact(g["default"].values(i)),g["default"].isArray(i)&&i.length&&(e=i.map(function(e){return m["default"].createElement(y["default"],{chat:e,contact:e.contact,mode:_.Mode.INFO,onClick:a.onClick,key:e.id})}),e=m["default"].createElement(F["default"],{classes:"animate-enter well-simple-body",title:l10n.t("web_groups_participation_you_and_name"),subtitle:l10n.n(i.length),"data-list-scroll-offset":!0,noContainer:!0},m["default"].createElement("div",{className:"drawer-section-body chatlist"},m["default"].createElement(q["default"],{data:e,height:72,extraItems:4}))));var o=Store.Chat.get(n.id);g["default"].isArray(i)&&o&&o.canDelete()&&(t=m["default"].createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},m["default"].createElement(I["default"],{iconClass:"icon-delete-danger",className:"danger first",a8n:"li-delete-chat",onClick:this.onDeleteChat},l10n.t("delete_chat"))));var r=null;this.props.contact.canBlock()&&(r=this.state.contactIsBlocked?m["default"].createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},m["default"].createElement(I["default"],{className:"success first",a8n:"li-unblock",iconClass:"icon-settings-blocked-success",onClick:this.onUnblockContact},l10n.t("unblock_contact"))):m["default"].createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},m["default"].createElement(I["default"],{className:"first",a8n:"li-block",iconClass:"icon-settings-blocked",onClick:this.onBlockContact},l10n.t("block_contact"))));var s=null;if(this.props.onMediaGallery&&o){var l=m["default"].createElement("span",{className:"icon icon-chevron-right-alt"}),u=H["default"].supportsFeature(H["default"].F.LINK_DOC_GALLERY)?l10n.t("media_links_docs"):l10n.t("media");s=m["default"].createElement(F["default"],{title:u,titleOnClick:this.props.onMediaGallery,subtitle:l,classes:"animate-enter2",noContainer:!0},m["default"].createElement($["default"],{chat:o,mediaMsgs:o.getMediaMsgs()}))}var c=null,d=o&&o.mute.canMute()?m["default"].createElement(te["default"],{chat:o,mute:o.mute}):null,f=null;if(this.props.onStarred){var p=m["default"].createElement("span",{className:"icon icon-chevron-right-alt"});f=m["default"].createElement(se["default"],{classes:"row-drawer-item",side:p,onClick:this.props.onStarred,ellipsify:!0},m["default"].createElement("span",{className:"title"},l10n.t("chat_starred_msgs")))}var h=null,v=null;(d||f||h)&&(v=m["default"].createElement(F["default"],{classes:"well-simple animate-enter2"},d,f,h));var E=this.props.status,M=k["default"].STATUS_V2&&E.status?m["default"].createElement(se["default"],{classes:"row-drawer-item"},m["default"].createElement(z["default"],{dir:"auto"},m["default"].createElement(B["default"],{className:"title",selectable:!0,direction:"auto",text:E.status}))):null,S=m["default"].createElement(se["default"],{classes:"row-drawer-item last"},m["default"].createElement(z["default"],{className:"selectable-text title",dir:"auto"},me["default"].formattedUser(n.id))),C=l10n.t("contact_info_status_phone"),b=l10n.t("contact_info_phone_number"),T=m["default"].createElement(F["default"],{classes:"animate-enter2 well-simple-body",title:k["default"].STATUS_V2?C:b},M,S),w=o&&o.presence?m["default"].createElement(pe["default"],{presence:o.presence,chatstate:o.presence.chatstate,location:"list"}):null;return m["default"].createElement(O["default"],{key:"contact-info-modal",className:"drawer-info",variant:"panel"},m["default"].createElement("header",{className:"pane-header"},m["default"].createElement("div",{className:"header-close"},m["default"].createElement("button",{onClick:this.onClose},m["default"].createElement("span",{className:"icon icon-x"}))),m["default"].createElement("div",{className:"header-body"},m["default"].createElement("div",{className:"header-main"},m["default"].createElement("div",{className:"header-title"},l10n.t("web_contact_info"))))),m["default"].createElement(D["default"],{"data-list-scroll-container":!0,onCopy:this.onCopy},m["default"].createElement("div",{className:"well well-chat"},m["default"].createElement(P["default"],{id:n.id,size:P["default"].Size.LARGE,loader:!0,className:"drawer-scale well-chat-avatar",onLoad:this.onDetailImageLoad,onClick:this.onViewPicture,quality:P["default"].Quality.HIGH}),m["default"].createElement("div",{className:"well-chat-name"},m["default"].createElement(z["default"],{dir:"auto"},m["default"].createElement(B["default"],{selectable:!0,text:n.formattedUser}))),m["default"].createElement("div",{className:"well-chat-secondary"},w)),s,v,T,c,e,r,t))}}]),t}(m["default"].Component);ve.contextTypes={uim:m["default"].PropTypes.instanceOf(de["default"])},ve.CONCERNS={contact:["id","plaintextDisabled","formattedName","formattedUser","formattedShortName","profilePicThumb"],status:["status"]},t["default"]=(0,oe["default"])((0,Q["default"])((0,ue["default"])(ve)))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(13),g=n(v),_=a(12),y=n(_),E=a(14),M=n(E),S=a(1543),C=n(S),b=a(21),k=n(b),T=a(1405),w=n(T),N=a(1406),P=n(N),A=a(1407),O=n(A),R=a(1431),D=n(R),x=a(15),I=n(x),L=a(78),F=n(L),U=a(462),j=n(U),G=a(1444),B=(n(G),a(32)),V=(n(B),a(1408)),H=n(V),W=a(161),z=n(W),Y=a(1402),q=n(Y),K=a(470),Q=n(K),X=a(465),Z=n(X),J=a(96),$=n(J),ee=a(1457),te=n(ee),ae=a(239),ne=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={msgInfo:void 0,unimplemented:!1},n.wrapper=null,n.isMsgVisible=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1;return e===n.props.msg.id&&(t?!0:n.getMsgComponent())},n.onClose=function(){n.context.uim.uie.requestDismiss()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){var e=this;Store.MsgInfo.find(this.props.msg.id).checkpoint(this.props.rejectOnUnmount()).then(function(t){e.setState({msgInfo:t}),e.props.listeners.add(t,"change:playedRemaining change:readRemaining change:deliveryRemaining")})["catch"](I["default"].Unmount,g["default"].noop)["catch"](function(){e.setState({unimplemented:!0}),y["default"].openToast(m["default"].createElement(Z["default"],{msg:l10n.t("msg_info_failed"),id:Z["default"].genId("msg_info_failed")}))})}},{key:"componentDidMount",value:function(){if(this.props.msg.type===j["default"].TYPE.IMAGE&&(this.refs.scrollable.scrollTop=this.refs.scrollable.scrollHeight),this.props.msg.isGif){var e=this.getMsgComponent();e.play()}}},{key:"getMsgComponent",value:function(){var e=this.wrapper;return e?e.refMsgComponent&&e.refMsgComponent.ref:void 0}},{key:"render",value:function(){var e=this.props.msg,t=this.state,a=t.msgInfo,n=t.unimplemented,i=void 0,o=void 0;if(a){var r=[],s=void 0,l=void 0,u=void 0;a.isPTT&&(o=l10n.t("message_info_seen"),s=a.played.head(),l=s&&s.t,u=m["default"].createElement("span",{className:"contact-msg-info-title-icon"},m["default"].createElement("span",{className:"icon icon-status-ptt-blue"})),r.push(m["default"].createElement(C["default"],{title:l10n.t("message_info_played"),t:l,icon:u,key:"played"}))),s=a.read.head(),l=s&&s.t,u=m["default"].createElement(Q["default"],{name:"status-dblcheck-ack",className:"icon contact-msg-info-title-icon icon-status-dblcheck-ack"}),o=o||l10n.t("message_info_read"),r.push(m["default"].createElement(C["default"],{title:o,t:l,icon:u,key:"read"})),s=a.delivery.head(),l=s&&s.t,u=m["default"].createElement(Q["default"],{name:"status-dblcheck",className:"icon contact-msg-info-title-icon icon-status-dblcheck"}),r.push(m["default"].createElement(C["default"],{title:l10n.t("message_info_delivered"),t:l,icon:u,key:"delivery"})),i=m["default"].createElement(D["default"],{classes:"drawer-section-info well animate-enter"},r)}var c=void 0;a||n||(c=m["default"].createElement(D["default"],{classes:"drawer-section-spinner",key:"spinner"},m["default"].createElement(z["default"],{size:50,stroke:4})));var d=(0,k["default"])("pane-preview-wrapper","pane-preview-wrapper-bg",{"pane-preview-resize":e.type===j["default"].TYPE.PTT||e.type===j["default"].TYPE.IMAGE||e.type===j["default"].TYPE.LOCATION||e.type===j["default"].TYPE.VCARD||e.isGif});return m["default"].createElement(w["default"],{key:"message-info-modal",className:"drawer-info",variant:"panel",onCancel:this.onClose},m["default"].createElement(O["default"],{title:l10n.t("message_info"),type:A.DRAWER_HEADER_TYPE.SMALL,onCancel:this.onClose}),m["default"].createElement("div",{className:d,ref:"scrollable"},m["default"].createElement("div",{className:"pane-preview"},m["default"].createElement("div",{className:"pane-chat-tile"}),m["default"].createElement(te["default"],{msg:e,key:"star-"+e.star.toString(),ref:(0,ae.GetRef)("wrapper",this),displayType:M["default"].DISP_TYPE.MSG_INFO,isMsgVisible:this.isMsgVisible,position:ee.MsgPosition.END}))),m["default"].createElement(P["default"],{classes:"drawer-body-msg-info"},c,i))}}]),t}(m["default"].Component);ne.CONCERNS={msg:["id","star","type","isGif"]},ne.contextTypes={uim:m["default"].PropTypes.instanceOf($["default"])},t["default"]=(0,H["default"])((0,F["default"])((0,q["default"])(ne)))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(5),o=n(i),r=a(462),s=(n(r),a(12)),l=n(s),u=a(1421),c=n(u),d=a(1405),f=n(d),p=a(1407),h=n(p),m=a(1406),v=n(m),g=a(116),_=n(g),y=a(1479),E=n(y),M=a(469),S=n(M);t["default"]=function(e){var t=e.msg;return t.vcard?o["default"].createElement(c["default"],{type:u.BoxModalType},o["default"].createElement(f["default"],{key:"vcard-modal",onCancel:function(){return l["default"].closeModal()}},o["default"].createElement(h["default"],{title:l10n.t("contact_viewer"),type:p.DRAWER_HEADER_TYPE.POPUP,onCancel:function(){return l["default"].closeModal()}}),o["default"].createElement(v["default"],null,o["default"].createElement(_["default"],null,o["default"].createElement(E["default"],{parsedVCard:t.vcard,thumbnail:S["default"].thumbnail(t.body),className:"chatlist column"}))))):null}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(1486),m=n(h),v=a(12),g=n(v),_=a(1458),y=n(_),E=a(5),M=a(13),S=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onChat=function(){n.props.onChat(n.selectedChats.getSelected())},n.onCancel=n.props.onCancel?n.props.onCancel:function(){return g["default"].closeModal()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"getFilteredData",value:function(){return this.filteredData?this.filteredData:(this.filteredData={contactsData:this.getFilteredContacts(),chatsData:[],frequentContactsData:[]},this.filteredData)}},{key:"getFilteredItems",value:function(){var e=this,t=[];return M.forEach(this.getFilteredData().contactsData,function(a){t.push(E.createElement(m["default"],{key:a.id,chat:a,active:e.active,selections:e.selectedChats,onSelect:e.handleSelect}))}),t}},{key:"getData",value:function(){return this.getFilteredData().contactsData}}]),t}(y["default"]);e.exports=S},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(13),y=n(_),E=a(1404),M=(n(E),a(12)),S=n(M),C=a(1676),b=n(C),k=a(1403),T=n(k),w=a(1),N=n(w),P=a(1402),A=n(P);t["default"]=(0,A["default"])((o=i=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(r))),n.getText=function(){var e=n.props.chat,t=e.title();return e.isGroup?e.isReadOnly?l10n.t("web_delete_group_dialog_title",{groupName:t}):l10n.t("web_exit_group_dialog_title",{groupName:t}):e.isUser?l10n.t("delete_chat_dialog_title",{name:t}):e.isBroadcast?l10n.t("delete_list_dialog_title"):void 0},n.getButton=function(){var e=n.props.chat;return e.isGroup?e.isReadOnly?l10n.t("web_delete"):l10n.t("web_exit"):e.isUser||e.isBroadcast?l10n.t("web_delete"):void 0},n.onCancel=function(){S["default"].closeModal();var e=n.props.onCancel;e&&y["default"].isFunction(e)&&e()},n.onDelete=function(){var e=n.props.chat,t=void 0;e.isGroup?t=e.isReadOnly?e.sendDelete():e.sendExit():e.isUser||e.isBroadcast?t=e.sendDelete():N["default"].error("deleteChatPopup:onDelete Unsupported chat type")(),y["default"].isFunction(n.props.onDeleteOrExit)&&t&&n.props.onDeleteOrExit(t),S["default"].closeModal()},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){return g["default"].createElement(b["default"],{onOK:this.onDelete,okText:this.getButton(),onCancel:this.onCancel},g["default"].createElement(T["default"],{text:this.getText()}))}}]),t}(g["default"].PureComponent),i.CONCERNS={chat:["isReadOnly","isGroup","isUser","isBroadcast"]},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(468),m=n(h),v=a(1428),g=n(v),_=a(12),y=n(_),E=a(21),M=n(E),S=a(1),C=n(S),b=a(0),k=n(b),T=a(5),w=n(T),N=a(465),P=n(N),A={title:0,hour:1,day:24,week:168},O=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={notifications:Store.Mute.getGlobalNotifications(),sounds:Store.Mute.getGlobalSounds(),previews:Store.Mute.getGlobalPreviews(),dnd:A.title},n.onSounds=function(){var e=!n.state.sounds;n.setState({sounds:e}),Store.Mute.setGlobalSounds(e)},n.onNotifications=function(){var e=!n.state.notifications;n.setState({notifications:e}),Store.Mute.setGlobalNotifications(e)},n.onPreviews=function(){var e=!n.state.previews;n.setState({previews:e}),Store.Mute.setGlobalPreviews(e)},n.onDND=function(e){if(e.target&&e.target.value){var t=parseInt(e.target.value,10);if(0===t)return n.setState({dnd:A.title}),void Store.Mute.globalMute().unmute();n.setState({dnd:t});var a=(0,k["default"])().unix()+60*t*60;Store.Mute.globalMute().mute(a)}},n.onClose=function(){y["default"].closeModal()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillUnmount",value:function(){this.state.dnd!==A.title&&y["default"].openToast(w["default"].createElement(P["default"],{msg:this.globalMuteDurationLabel(this.state.dnd),id:P["default"].genId()}))}},{key:"globalMuteDurationLabel",value:function(e){switch(this.state.dnd){case 1:return l10n.t("global_muted_1hour");case 24:return l10n.t("global_muted_1day");
case 168:return l10n.t("global_muted_1week");default:return C["default"].log("DoNotDisturbSettings:globalMuteDurationLabel non standard global mute duration:"+e)(),l10n.t("global_muted")}}},{key:"render",value:function(){var e=[];if(window.Notification){e.push(w["default"].createElement("div",{className:"controls-section",onClick:this.onNotifications,key:0},w["default"].createElement("div",{"data-a8n":m["default"].key("menu-icon-notifications"),className:"control"},w["default"].createElement(g["default"],{onChange:this.onNotifications,checked:this.state.notifications})),w["default"].createElement("div",{className:"label"},l10n.t("option_desktop_notifications"))));var t=(0,M["default"])("controls-section",{disabled:!this.state.notifications});e.push(w["default"].createElement("div",{className:t,onClick:this.onPreviews,key:1},w["default"].createElement("div",{"data-a8n":m["default"].key("menu-icon-notifications"),className:"control"},w["default"].createElement(g["default"],{onChange:this.onPreviews,checked:this.state.previews})),w["default"].createElement("div",{className:"label"},l10n.t("option_msg_previews"),w["default"].createElement("div",{className:"hint"},l10n.t("option_msg_previews_hint_text")))))}return w["default"].createElement("div",{className:"controls-container drawer-section"},w["default"].createElement("div",{className:"controls-section",onClick:this.onSounds},w["default"].createElement("div",{"data-a8n":m["default"].key("menu-icon-notifications"),className:"control"},w["default"].createElement(g["default"],{onChange:this.onSounds,checked:this.state.sounds})),w["default"].createElement("div",{className:"label"},l10n.t("option_sounds"))),e,w["default"].createElement("div",{className:"controls-section controls-section-wide"},w["default"].createElement("div",{className:"select"},w["default"].createElement("select",{value:this.state.dnd,onChange:this.onDND},w["default"].createElement("option",{value:A.title},l10n.t("option_select_mute")),w["default"].createElement("option",{value:A.hour},l10n.t("mute_1hour")),w["default"].createElement("option",{value:A.day},l10n.t("mute_1day")),w["default"].createElement("option",{value:A.week},l10n.t("mute_1week"))))))}}]),t}(T.Component);t["default"]=O},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(5),o=n(i),r=function(e){var t=e.children;return o["default"].createElement("div",{className:"drawer-section-footer"},t)};t["default"]=r},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(12),g=n(v),_=a(238),y=n(_),E=a(14),M=n(E),S=a(96),C=n(S),b=a(48),k=n(b),T=a(22),w=n(T),N=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onVerificationClick=function(){g["default"].closeModal(),g["default"].verificationDrawer(n.props.jid)},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=void 0,t=void 0,a=null,n=null,i=g["default"].closeModal.bind(g["default"]),o=l10n.t("web_ok");switch(this.props.e2eSubtype){case"info_encrypted":w["default"].isGroup(this.props.chatId)?e=l10n.t("web_group_info_encrypted_description"):w["default"].isBroadcast(this.props.chatId)&&(e=l10n.t("web_broadcast_info_encrypted_description")),t=M["default"].E2E_FAQ_LINK;break;case"info_unencrypted":e=w["default"].isGroup(this.props.chatId)?l10n.t("web_group_info_unencrypted_description"):w["default"].isBroadcast(this.props.chatId)?l10n.t("web_broadcast_info_unencrypted_description"):l10n.t("web_contact_info_unencrypted_description",{contact:this.props.unencryptedContact}),t=M["default"].E2E_FAQ_LINK;break;case"identity":var r=Store.Contact.get(this.props.jid),s=r?r.formattedName:"";e=l10n.t("web_security_code_change_description",{name:s}),a=i,n=o,i=this.onVerificationClick,o=l10n.t("web_verify_button"),t=M["default"].CODE_CHANGE_FAQ_LINK;break;case"encrypt":default:e=w["default"].isGroup(this.props.chatId)?l10n.t("web_group_encryption_state_change_description"):w["default"].isBroadcast(this.props.chatId)?l10n.t("web_broadcast_encryption_state_change_description"):l10n.t("web_individual_chat_encryption_state_change_description"),t=M["default"].SECURITY_LINK}var l=k["default"].build(t,{lg:Store.Conn.lg,lc:Store.Conn.lc}),u=m["default"].createElement("a",{target:"_blank",href:l},l10n.t("learn_more"));return m["default"].createElement(y["default"],{onOK:i,okText:o,onCancel:a,cancelText:n},e,"Â ",u)}}]),t}(m["default"].Component);N.contextTypes={uim:m["default"].PropTypes.instanceOf(C["default"])},t["default"]=N},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(13),g=n(v),_=a(12),y=n(_),E=a(1404),M=(n(E),a(79)),S=n(M),C=a(1417),b=n(C),k=a(1422),T=n(k),w=a(1451),N=n(w),P=a(1405),A=n(P),O=a(1406),R=n(O),D=a(1431),x=n(D),I=a(1430),L=n(I),F=a(1466),U=n(F),j=a(1403),G=n(j),B=a(1415),V=n(B),H=a(238),W=n(H),z=a(1631),Y=n(z),q=a(465),K=n(q),Q=a(15),X=n(Q),Z=a(467),J=n(Z),$=a(1435),ee=n($),te=a(1429),ae=n(te),ne=a(240),ie=n(ne),oe=a(96),re=n(oe),se=a(1496),le=n(se),ue=a(61),ce=n(ue),de=a(1433),fe=(n(de),a(78)),pe=n(fe),he=a(1402),me=n(he),ve=a(14),ge=n(ve),_e=K["default"].genId("max_participant_toast"),ye=function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));return a.onImageSet=function(e,t){var n=Store.ProfilePicThumb.get(a.props.chat.id);a.setState({pendingPhoto:!0});var i=void 0;i=e&&t?n.setPicture(e,t):n.deletePicture(),i.then(function(){a.setState({pendingPhoto:!1})})["catch"](X["default"].Unmount,g["default"].noop)},a.onParticipantClick=function(e,t){Store.Conn.me!==t.id&&Store.Chat.find(t.id).then(function(e){y["default"].openChatFromUnread(e).then(function(t){t&&y["default"].focusChatTextInput(e)})})},a.menuEnabled=function(e){var t=a.props.chat.groupMetadata.participants,n=t.get(e.id);return n&&(t.canPromote(n)||t.canRemove(n)||t.canVerifyIdentity(n))},a.onParticipantMenu=function(e,t){var n=a.props.chat.groupMetadata.participants,i=n.get(t.id);if(a.menuEnabled(t)){var o=[];if(n.canPromote(i)){var r=a.confirmParticipantPromote.bind(a,i);o.push(m["default"].createElement(V["default"],{a8n:"mi-grp-promote-admin",key:"promote",action:r},l10n.t("menuitem_make_group_admin")))}if(n.canRemove(i)){var s=a.confirmParticipantRemove.bind(a,i);o.push(m["default"].createElement(V["default"],{a8n:"mi-grp-remove-participant",key:"remove",action:s,shortcut:"d"},l10n.t("menuitem_remove")))}e.event&&e.event.persist(),a.setState({contextMenu:{contactId:t.id,menu:o,anchor:e.anchor,event:e.event}})}},a.contextClose=function(){a.setState({contextMenu:null})},a.confirmParticipantRemove=function(e){var t=a.onParticipantRemove.bind(a,e),n=l10n.t("confirm_remove_group_participant",{participant:e.contact.formattedName,subject:a.props.contact.name});y["default"].openModal(m["default"].createElement(W["default"],{onOK:t,okText:l10n.t("remove"),onCancel:y["default"].closeModal.bind(y["default"]),cancelText:l10n.t("web_cancel")},m["default"].createElement(G["default"],{text:n})))},a.onParticipantRemove=function(e){e.contact.pendingAction++,a.props.chat.groupMetadata.participants.removeParticipant(e).then(function(){e.contact.pendingAction--}),y["default"].closeModal()},a.confirmParticipantPromote=function(e){var t=a.onParticipantPromote.bind(a,e),n=l10n.t("confirm_promote_group_participant",{participant:e.contact.formattedName,subject:a.props.contact.name});y["default"].openModal(m["default"].createElement(W["default"],{onOK:t,okText:l10n.t("menuitem_make_group_admin"),onCancel:y["default"].closeModal.bind(y["default"]),cancelText:l10n.t("web_cancel")},m["default"].createElement(G["default"],{text:n})))},a.onParticipantPromote=function(e){e.contact.pendingAction++,a.props.chat.groupMetadata.participants.promoteParticipant(e).then(function(){e.contact.pendingAction--}),y["default"].closeModal()},a.onVerifyIdentity=function(e){a.props.onVerification(e.contact)},a.openAddGroupParticipantFlow=function(){if(a.props.chat.groupMetadata.participants.length>=ge["default"].MAX_GROUP_SIZE){var e=l10n.t("action_group_create_failed_participant",{max:ge["default"].MAX_GROUP_SIZE});y["default"].openToast(m["default"].createElement(K["default"],{msg:e,id:_e}))}else{var t=m["default"].createElement(Y["default"],{chat:(0,he.unproxy)(a.props.chat),pushTransition:"none",popTransition:"none"});y["default"].openModal(t,"modal-flow")}},a.onClose=function(){a.props.onClose?a.props.onClose():a.context.uim.uie.requestDismiss()},a.onExitOrDeleteGroup=function(){y["default"].deleteOrExitChat(a.props.chat)},a.onSubjectChange=function(e){a.setState({name:e})},a.validateSubject=function(e){return!(!e||!e.trim())},a.onSetSubjectError=function(){y["default"].openModal(m["default"].createElement(W["default"],{onOK:y["default"].closeModal.bind(y["default"]),okText:l10n.t("web_ok")},l10n.t("action_group_subject_empty")))},a.onSetSubject=function(e){var t=a.props.chat,n=t.groupMetadata;if(n.canSetSubject()){var i=J["default"].emojify(a.state.name||"");if(i===a.props.contact.name)return a.setState({name:i});a.setState({pendingSubject:!0}),t.setSubject(i).then(function(){a.setState({name:a.props.contact.name,pendingSubject:!1})})["catch"](X["default"].Unmount,g["default"].noop)}},a.onCancelSubject=function(){a.setState({name:a.props.contact.name})},a.state={pendingSubject:!1,pendingPhoto:!1,contextMenu:null,name:e.contact.name},a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){var e=this,t=this.props.chat.groupMetadata;this.props.listeners.add(t.participants,"add remove reset sort change:isAdmin",function(){e.forceUpdate()})}},{key:"render",value:function(){var e,t,a=this.props.chat,n=a.groupMetadata,i=this,o=n.participants.map(function(e){var t=e.contact,a=!!i.state.contextMenu&&t.id===i.state.contextMenu.contactId;return m["default"].createElement(T["default"],{contact:t,key:e.id,admin:!!e.isAdmin,onClick:i.onParticipantClick,contextEnabled:i.menuEnabled.bind(i,t),contextMenu:a,onContext:function(e){return i.onParticipantMenu(e,t)},profileClick:!0,showNotifyName:!0})});a.canDelete()&&(t=m["default"].createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},m["default"].createElement(L["default"],{iconClass:"icon-exit",a8n:"li-delete-group",className:"danger first",onClick:this.onExitOrDeleteGroup},a.isReadOnly?l10n.t("web_delete_group"):l10n.t("web_exit_group")))),n.participants.canAdd()&&(e=m["default"].createElement("div",{className:"list-action list-action-alt",title:l10n.t("add_group_participant"),onClick:this.openAddGroupParticipantFlow},m["default"].createElement("div",{className:"list-action-icon"},m["default"].createElement("span",{className:"icon icon-add-user-light"})),m["default"].createElement("div",{className:"list-action-body ellipsify"},l10n.t("add_group_participant"))));var r=void 0;n.participants.iAmAdmin()&&this.props.onGroupInviteLink&&(r=m["default"].createElement("div",{className:"list-action list-action-alt",title:l10n.t("group_invite_link"),onClick:this.props.onGroupInviteLink},m["default"].createElement("div",{className:"list-action-icon"},m["default"].createElement("span",{className:"icon icon-link"})),m["default"].createElement("div",{className:"list-action-body ellipsify"},l10n.t("group_invite_link"))));var s=o.length?m["default"].createElement(x["default"],{title:l10n.t("web_participants_title"),subtitle:l10n.t("web_participants_count",{count:o.length,max:ge["default"].MAX_GROUP_SIZE}),"data-list-scroll-offset":!0,classes:"animate-enter2 well-simple-body",noContainer:!0},e,r,m["default"].createElement("div",{className:"drawer-section-body chatlist"},m["default"].createElement(b["default"],{data:o,extraItems:4}))):null,l=null;if(this.props.onMediaGallery){var u=m["default"].createElement("span",{className:"icon icon-chevron-right-alt"}),c=ce["default"].supportsFeature(ce["default"].F.LINK_DOC_GALLERY)?l10n.t("media_links_docs"):l10n.t("media");l=m["default"].createElement(x["default"],{title:c,titleOnClick:this.props.onMediaGallery,subtitle:u,classes:"animate-enter2",noContainer:!0},m["default"].createElement(N["default"],{chat:(0,he.unproxy)(a),mediaMsgs:a.getMediaMsgs()}))}var d=this.props.contact.profilePicThumb,f=F.Type.GROUP,p=a.isReadOnly||!d.canDelete()&&!d.canSet(),h=m["default"].createElement(U["default"],{className:"well-chat-avatar",type:f,id:this.props.contact.id,pending:this.state.pendingPhoto,startImage:this.props.profilePicThumb.imgFull,readOnly:p,onImageSet:this.onImageSet}),v=null;a.groupMetadata.creation&&(v=m["default"].createElement("div",{className:"well-chat-secondary well-chat-secondary-group"},l10n.t("web_group_creation_time",{when:S["default"].relativeDateAndTimeStr(a.groupMetadata.creation)})));var g=null,_=a.mute.canMute()?m["default"].createElement(le["default"],{chat:a,mute:a.mute}):null,y=null,E=void 0;this.state.contextMenu&&(E=m["default"].createElement(ie["default"],{displayName:"ChatContextMenu",escapable:!0,popable:!0,requestDismiss:this.contextClose},m["default"].createElement(ae["default"],{contextMenu:this.state.contextMenu})));var M=null;return(_||y||g)&&(M=m["default"].createElement(x["default"],{classes:"well-simple animate-enter2"},_,y,g)),m["default"].createElement(A["default"],{key:"contact-info-modal",className:"drawer-info",variant:"panel",onCancel:this.onClose},m["default"].createElement("header",{className:"pane-header"},m["default"].createElement("div",{className:"header-close"},m["default"].createElement("button",{onClick:this.onClose},m["default"].createElement("span",{className:"icon icon-x"}))),m["default"].createElement("div",{className:"header-body"},m["default"].createElement("div",{className:"header-main"},m["default"].createElement("div",{className:"header-title"},l10n.t("web_group_info"))))),m["default"].createElement(R["default"],{"data-list-scroll-container":!0},m["default"].createElement("div",{className:"well well-chat"},h,m["default"].createElement("div",{className:"well-chat-name"},m["default"].createElement(ee["default"],{value:this.state.name||"",editable:n.canSetSubject(),pending:this.state.pendingSubject,showRemaining:!0,validate:this.validateSubject,maxLength:ge["default"].MAX_SUBJECT_LENGTH,onChange:this.onSubjectChange,onSave:this.onSetSubject,onError:this.onSetSubjectError,onCancel:this.onCancelSubject,supportsEmoji:!0,lockable:!0,lowProfile:!0,className:"text-input-large"})),v),l,M,s,t),E)}}]),t}(m["default"].Component);ye.contextTypes={uim:m["default"].PropTypes.instanceOf(re["default"])},ye.CONCERNS={chat:["isReadOnly","mute","groupMetadata","id","pendingAction"],contact:["name","plaintextDisabled","id","profilePicThumb","pendingAction"],profilePicThumb:["imgFull"]},t["default"]=(0,pe["default"])((0,me["default"])(ye))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(98),o=n(i),r=a(2),s=n(r),l=a(6),u=n(l),c=a(3),d=n(c),f=a(4),p=n(f),h=a(8),m=n(h),v=a(7),g=n(v),_=a(5),y=n(_),E=a(13),M=n(E),S=a(238),C=n(S),b=a(1409),k=n(b),T=a(1423),w=n(T),N=a(1412),P=n(N),A=a(12),O=n(A),R=a(15),D=n(R),x=a(14),I=n(x),L=a(47),F=n(L),U=a(1443),j=n(U),G=a(1408),B=n(G),V={LOADING:0,SUCCESS:1,ACCEPT_ERROR:2,QUERY_ERROR:3};t["default"]=(0,B["default"])(function(e){function t(){var e,a,n,i;(0,d["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,m["default"])(this,(e=t.__proto__||(0,u["default"])(t)).call.apply(e,[this].concat(r))),n.state={state:V.LOADING,status:void 0,groupMetadata:void 0},n.onViewGroup=function(){n.state.groupMetadata&&O["default"].openChatFromUnread(Store.Chat.get(n.state.groupMetadata.id)),O["default"].closeModal()},n.onJoinGroup=function(){F["default"].acceptGroupInvite(n.props.groupCode).then(function(e){var t=e.status,a=e.gid;return 200===t?Store.Chat.find(a):s["default"].reject(t)}).then(function(e){O["default"].openChatFromUnread(e).then(function(t){t&&O["default"].focusChatTextInput(e)}),O["default"].closeModal()}).checkpoint(n.props.rejectOnUnmount)["catch"](D["default"].Unmount,M["default"].noop)["catch"](function(e){n.setState({state:V.ACCEPT_ERROR,status:e})})},n.onCancel=function(){O["default"].closeModal()},i=a,(0,m["default"])(n,i)}return(0,g["default"])(t,e),(0,p["default"])(t,[{key:"componentWillMount",value:function(){var e=this;F["default"].groupInviteInfo(this.props.groupCode).checkpoint(this.props.rejectOnUnmount).then(function(t){var a=t.status,n=(0,o["default"])(t,["status"]);if(200===a){var i=new j["default"](n);Store.Contact.gadd(n.id),e.setState({status:a,groupMetadata:i,state:V.SUCCESS})}else e.setState({status:a,state:V.QUERY_ERROR})})["catch"](D["default"].Unmount,M["default"].noop)}},{key:"render",value:function(){var e=this.state,t=e.state,a=e.status,n=e.groupMetadata,i={cancelText:l10n.t("group_invite_cancel"),onCancel:this.onCancel,onOK:void 0,okText:void 0},o=void 0;if(t!==V.LOADING&&n)if(t===V.SUCCESS){var r=n.participants.map(function(e){return y["default"].createElement("div",{key:e.id,className:"participant-wrapper"},y["default"].createElement(k["default"],{className:"participant-image",size:50,id:e.id}),y["default"].createElement("span",{className:"participant-text"},e.contact.formattedName))}),s=Store.Contact.gadd(n.owner).formattedName,l=""+I["default"].GROUP_INVITE_URL+this.props.groupCode;o=y["default"].createElement("div",{className:"group-invite-modal"},y["default"].createElement("div",{className:"metadata-container"},y["default"].createElement("div",{className:"metadata-icon"},y["default"].createElement("div",{className:"icon-group-default"}),y["default"].createElement(w["default"],{src:l})),y["default"].createElement("div",{className:"metadata-text"},y["default"].createElement("span",{className:"metadata-title"},n.subject),y["default"].createElement("span",{className:"metadata-subtitle"},l10n.t("group_invite_created_by",{participant:s})))),y["default"].createElement("span",{className:"participants-title"},l10n.t("group_invite_participants",{count:r.length,_plural:r.length})),y["default"].createElement("div",{className:"participants-container"},r));var u=Store.Chat.get(n.id),c=!!u&&!u.isReadOnly;i.onOK=c?this.onViewGroup:this.onJoinGroup,i.okText=c?l10n.t("group_invite_view"):l10n.t("group_invite_join")}else{var d=void 0;if(t===V.QUERY_ERROR)switch(a){case 401:d=l10n.t("group_invite_query_401");break;case 403:d=l10n.t("group_invite_query_403");break;case 404:d=l10n.t("group_invite_query_404");break;case 406:d=l10n.t("group_invite_query_406");break;case 410:d=l10n.t("group_invite_query_410");break;default:d=l10n.t("group_invite_query_500")}else if(t===V.ACCEPT_ERROR)switch(a){case 401:d=l10n.t("group_invite_accept_401");break;case 404:d=l10n.t("group_invite_accept_404");break;case 410:d=l10n.t("group_invite_accept_410");break;case 419:d=l10n.t("group_invite_accept_419");break;default:d=l10n.t("group_invite_accept_500")}i.cancelText=l10n.t("web_ok"),o=y["default"].createElement("div",null,d)}else o=y["default"].createElement(P["default"].LoadingWithText,{text:l10n.t("group_invite_check_link")});return y["default"].createElement(C["default"],i,o)}}]),t}(y["default"].Component))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(238),g=n(v),_=a(1404),y=(n(_),a(12)),E=n(y),M=a(160),S=n(M),C=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.handleCancel=function(){E["default"].closeModal()},n.handleOK=function(){n.props.onConfirm(),E["default"].closeModal()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){return m["default"].createElement(g["default"],{title:S["default"].t("group_invite_drawer_revoke_link"),onOK:this.handleOK,okText:S["default"].t("group_invite_drawer_revoke_link"),onCancel:this.handleCancel,cancelText:S["default"].t("web_cancel")},m["default"].createElement("div",{className:"textfield-static"},S["default"].t("group_invite_revoke_confirmation_text",{groupName:this.props.chat.contact.name})))}}]),t}(m["default"].Component);t["default"]=C},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(13),g=n(v),_=a(12),y=n(_),E=a(14),M=n(E),S=a(21),C=n(S),b=a(1405),k=n(b),T=a(1406),w=n(T),N=a(1407),P=n(N),A=a(1431),O=n(A),R=a(1659),D=n(R),x=a(15),I=n(x),L=a(1544),F=n(L),U=a(78),j=n(U),G=a(1724),B=n(G),V=a(462),H=n(V),W=a(1444),z=(n(W),a(32)),Y=(n(z),a(1408)),q=n(Y),K=a(161),Q=n(K),X=a(1402),Z=n(X),J=a(470),$=n(J),ee=a(465),te=n(ee),ae=a(96),ne=n(ae),ie=a(1457),oe=n(ie),re=a(239),se=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={msgInfo:void 0,unimplemented:!1},n.wrapper=null,n.isMsgVisible=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1;return e===n.props.msg.id&&(t?!0:n.getMsgComponent())},n.onClose=function(){n.context.uim.uie.requestDismiss()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){var e=this;Store.MsgInfo.find(this.props.msg.id).checkpoint(this.props.rejectOnUnmount()).then(function(t){e.setState({msgInfo:t}),e.props.listeners.add(t.played,"add remove"),e.props.listeners.add(t.read,"add remove"),e.props.listeners.add(t.delivery,"add remove"),e.props.listeners.add(t,"change:playedRemaining change:readRemaining change:deliveryRemaining")})["catch"](I["default"].Unmount,g["default"].noop)["catch"](function(){e.setState({unimplemented:!0}),y["default"].openToast(m["default"].createElement(te["default"],{msg:l10n.t("msg_info_failed"),id:te["default"].genId("msg_info_failed")}))})}},{key:"componentDidMount",value:function(){if(this.props.msg.type===H["default"].TYPE.IMAGE&&(this.refs.scrollable.scrollTop=this.refs.scrollable.scrollHeight),this.props.msg.isGif){var e=this.getMsgComponent();e.play()}}},{key:"getAnimateEnterClass",value:function(e){return"animate-enter"+(-1===e?"":e)}},{key:"getMsgComponent",value:function(){var e=this.wrapper;return e?e.refMsgComponent&&e.refMsgComponent.ref:void 0}},{key:"render",value:function(){var e,t=this.props.msg,a=this.state,n=a.msgInfo,i=a.unimplemented,o=-1,r=24,s=26,l=void 0,u=void 0;if(n&&n.isPTT){var c=m["default"].createElement("span",{className:"group-msg-info-title-icon"},m["default"].createElement("span",{className:"icon icon-status-ptt-blue"})),d=n.played.map(function(e){return m["default"].createElement(F["default"],{msgInfoParticipant:e,contact:e.contact,key:e.id})}),f=d.length>0?m["default"].createElement("div",{className:"chatlist chatlist-plain"},d):null,p=n.playedRemaining>0?m["default"].createElement(D["default"],null,l10n.t("message_info_remaining",{count:n.playedRemaining,_plural:n.playedRemaining})):null,h=(0,C["default"])(this.getAnimateEnterClass(o),"well-simple-body");u=l10n.t("message_info_seen_by"),e=p?r+s:r,b=B["default"].minHeight(d,e),l=m["default"].createElement(O["default"],{classes:h,key:"played-section",style:b,title:l10n.t("message_info_played_by"),subtitle:c,footer:p},f)}var v=void 0;if(n&&(n.read.length>0||n.playedRemaining>0)){var g=m["default"].createElement($["default"],{name:"status-dblcheck-ack",className:"icon group-msg-info-title-icon icon-status-dblcheck-ack"}),_=n.read.map(function(e){return m["default"].createElement(F["default"],{msgInfoParticipant:e,contact:e.contact,key:e.id})}),y=_.length>0?m["default"].createElement("div",{className:"chatlist chatlist-plain"},_):null,E=n.readRemaining>0?m["default"].createElement(D["default"],null,l10n.t("message_info_remaining",{count:n.readRemaining,_plural:n.readRemaining})):null,S=(0,C["default"])(this.getAnimateEnterClass(o),"well-simple-body");u=u||l10n.t("message_info_read_by"),e=E?r+s:r;var b=B["default"].minHeight(_,e);v=m["default"].createElement(O["default"],{classes:S,key:"read-section",title:u,style:b,subtitle:g,footer:E},y)}var T=void 0;if(n&&(n.delivery.length>0||n.deliveryRemaining>0)){var A=m["default"].createElement($["default"],{name:"status-dblcheck",className:"icon group-msg-info-title-icon icon-status-dblcheck"}),R=n.delivery.map(function(e){return m["default"].createElement(F["default"],{msgInfoParticipant:e,contact:e.contact,key:e.id})}),x=R.length>0?m["default"].createElement("div",{className:"chatlist chatlist-plain"},R):null,I=n.deliveryRemaining>0?m["default"].createElement(D["default"],null,l10n.t("message_info_remaining",{count:n.deliveryRemaining,_plural:n.deliveryRemaining})):null,L=(0,C["default"])(this.getAnimateEnterClass(o),"well-simple-body");e=I?r+s:r,b=B["default"].minHeight(R,e),T=m["default"].createElement(O["default"],{classes:L,key:"delivered-section",style:b,title:l10n.t("message_info_delivered_to"),subtitle:A,footer:I},x)}var U=void 0;n||i||(U=m["default"].createElement(O["default"],{classes:"drawer-section-spinner",key:"spinner"},m["default"].createElement(Q["default"],{size:50,stroke:4})));var j=(0,C["default"])("pane-preview-wrapper","pane-preview-wrapper-bg",{"pane-preview-resize":t.type===H["default"].TYPE.PTT||t.type===H["default"].TYPE.IMAGE||t.type===H["default"].TYPE.LOCATION||t.type===H["default"].TYPE.VCARD||t.isGif});return m["default"].createElement(k["default"],{key:"message-info-modal",className:"drawer-info",variant:"panel",onCancel:this.onClose},m["default"].createElement(P["default"],{title:l10n.t("message_info"),type:N.DRAWER_HEADER_TYPE.SMALL,onCancel:this.onClose}),m["default"].createElement("div",{className:j,ref:"scrollable"},m["default"].createElement("div",{className:"pane-preview"},m["default"].createElement("div",{className:"pane-chat-tile"}),m["default"].createElement(oe["default"],{msg:t,key:"star-"+t.star.toString(),ref:(0,re.GetRef)("wrapper",this),displayType:M["default"].DISP_TYPE.MSG_INFO,isMsgVisible:this.isMsgVisible,position:ie.MsgPosition.END}))),m["default"].createElement(w["default"],{classes:"drawer-body-msg-info"},U,l,v,T))}}]),t}(m["default"].Component);se.CONCERNS={msg:["id","star","type","isGif"]},se.contextTypes={uim:m["default"].PropTypes.instanceOf(ne["default"])},t["default"]=(0,q["default"])((0,j["default"])((0,Z["default"])(se)))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(13),y=n(_),E=a(1437),M=n(E),S=a(1412),C=n(S),b=a(1515),k=n(b),T=a(1411),w=n(T),N=function(e){function t(e){(0,u["default"])(this,t);var a=(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this,e));return a.onSelect=function(e,t){if(t instanceof E.Mode){var n=t.props.chat;a.props.filter(n)===!0&&a.props.onGroup(t.props.chat)}},a.onSearch=function(e){a.setState({searchFilter:e})},a.selection=new w["default"],a.state={loading:!0,searchFilter:void 0},a}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){var e=this,t=this.props.chats;o["default"].delay(300).then(function(){return o["default"].all(y["default"].map(y["default"].filter(t,function(e){return e.groupMetadata.stale}),function(e){return e.groupMetadata.update()["catch"](y["default"].noop)}))}).then(function(){return e.setState({loading:!1})})}},{key:"render",value:function(){var e=this,t=this.props,a=t.chats,n=t.onGroup,i=t.filter,o=t.onCancel,r=void 0;return this.state.loading?r=g["default"].createElement(C["default"].Loading,null):!function(){var t=l10n.accentFold(e.state.searchFilter),o=a.filter(function(e){return i(e)&&(!t||t&&e.contact.searchMatch(t))});o.length?(e.selection.init(y["default"].map(o.filter(function(e){return i(e)===!0}),"id")),r=o.map(function(t){var a=void 0,o=void 0,r=i(t),s=!y["default"].isBoolean(r);return s&&(a=g["default"].createElement("div",{className:"chat-status ellipsify",title:r},r),o="member"),g["default"].createElement(M["default"],{chat:t,contact:t.contact,mode:E.Mode.INFO,active:e.selection,secondary:a,noContext:!0,className:o,onClick:s?void 0:n.bind(null,t),key:t.id})})):r=g["default"].createElement(C["default"].SearchGroups,null)}(),g["default"].createElement(k["default"],{title:l10n.t("web_groups"),selection:this.selection,onSearch:this.onSearch,searchPlaceholder:l10n.t("search_groups"),onSelect:this.onSelect,onCancel:o},r)}}]),t}(g["default"].Component);N.defaultProps={filter:function(){return!0}},t["default"]=N},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1405),g=n(v),_=a(1407),y=n(_),E=a(1406),M=n(E),S=a(1459),C=n(S),b=a(1430),k=n(b),T=a(1677),w=n(T),N=a(12),P=n(N),A=a(252),O=n(A),R=a(48),D=n(R),x=a(14),I=n(x),L="animated-doodle",F=a(1734),U={"class":".drawer-help-animation",low:{"default":F},high:{"default":F}},j=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onTOS=function(){var e="https://www.whatsapp.com/legal/";e=D["default"].build(e,{lg:l10n.getLocale()}),window.open(e,"_blank")},n.onFAQ=function(){var e="http://www.whatsapp.com/faq/web";e=e=D["default"].build(e,{lg:l10n.getLocale()}),window.open(e,"_blank")},n.onContactUs=function(){P["default"].openModal(m["default"].createElement(w["default"],null))},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){O["default"].isAssetLoaded(L)||O["default"].loadAsset(U,L)}},{key:"render",value:function(){return m["default"].createElement(g["default"],{className:"drawer-help"},m["default"].createElement(y["default"],{a8n:"drawer-title-help",title:l10n.t("help_drawer_title"),onBack:this.props.onClose,type:_.DRAWER_HEADER_TYPE.LARGE}),m["default"].createElement(M["default"],null,m["default"].createElement("div",{className:"drawer-help-animation"}),m["default"].createElement("div",{className:"drawer-help-version selectable-text"},l10n.t("version",{version:I["default"].VERSION_STR})),m["default"].createElement(C["default"],null,m["default"].createElement(k["default"],{className:"drawer-list-item",a8n:"li-faq",onClick:this.onFAQ},l10n.t("web_settings_faq")),m["default"].createElement(k["default"],{className:"drawer-list-item",a8n:"li-contact-us",onClick:this.onContactUs},l10n.t("send_logs_title")),m["default"].createElement(k["default"],{className:"drawer-list-item",a8n:"li-tos",onClick:this.onTOS},l10n.t("terms_and_privacy_link")))))}}]),t}(m["default"].Component);t["default"]=j},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var o=a(2),r=i(o),s=a(6),l=i(s),u=a(3),c=i(u),d=a(4),f=i(d),p=a(8),h=i(p),m=a(7),v=i(m),g=a(14),_=i(g),y=a(12),E=i(y),M=a(1405),S=i(M),C=a(1407),b=i(C),k=a(1406),T=i(k),w=a(95),N=i(w),P=a(116),A=i(P),O=a(1562),R=i(O),D=a(1434),x=i(D),I=a(1),L=i(I),F=a(1408),U=i(F),j=a(117),G=i(j),B=a(465),V=i(B),H=a(463),W=i(H),z=a(99),Y=i(z),q=a(257),K=i(q),Q=a(13),X=n(Q),Z=a(15),J=n(Z),$=a(1449),ee=n($),te=a(5),ae=n(te),ne=a(46),ie=n(ne),oe=a(37),re=n(oe),se=a(47),le=n(se),ue=a(1719),ce=n(ue),de=a(1412),fe=a(239),pe=_["default"].MIN_CHARS_FOR_FTS,he=function(e){
function t(e){(0,c["default"])(this,t);var a=(0,h["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this,e));return a._search=function(e,t){a._hasPendingSearch=!1;var n=ce.search(e,t).cancellable().then(function(t){n===a._searchPromise&&(a._addSearchResults(e,t),a.setState({isSearching:!1}))})["catch"](r["default"].CancellationError,X.noop)["catch"](function(e){L["default"].errorVerbose("Image search failed")(e),E["default"].openToast(ae.createElement(V["default"],{msg:l10n.t("image_search_failed"),id:V["default"].genId()})),n===a._searchPromise&&a.setState({isSearching:!1})})["finally"](function(){n===a._searchPromise&&(a._searchPromise=null)});a._searchPromise=n,a.setState({isSearching:!0})},a.handleUserInput=function(e){var t=X.trim(e||"");return t?void(ee.multibyteLength(t)<pe||t!==a.state.query&&(a._cancelSearch(),a._resetState(),a._requestSearch(t))):(a._cancelSearch(),void a._resetState())},a.handleRequestMoreImages=function(){a._hasPendingSearch||a._searchPromise||!a.state.totalEstimatedMatches||a.state.nextOffset>=a.state.totalEstimatedMatches||a._requestSearch(a.state.query,a.state.nextOffset)},a.handleImageClick=function(e){var t=a.state.imageData[e];if(t){var n=t.contentUrl,i=void 0;i=re.isElectron?K["default"].getRetry(n,Y["default"].RESP_TYPE.BLOB).then(function(e){if(200!==e.status)throw new J.ServerStatusError(null,n,e.status);return e.response}):le.downloadImage(n),i.checkpoint(a.props.rejectOnUnmount()).then(function(e){if(!(e instanceof Blob))throw new J.ImageError("Server did not respond with image bytes",n);a.props.onImageSelected(e,t.hostPageUrl)})["catch"](J.Unmount,X.noop)["catch"](function(e){L["default"].errorVerbose("Image search failed")(e),E["default"].openToast(ae.createElement(V["default"],{msg:l10n.t("image_download_failed"),id:V["default"].genId()}))})}},a.focusSearch=function(){A["default"].flashFocus=Date.now(),N["default"].focus(a.searchRef)},a.focusGallery=function(e){if(!e.repeat&&a.galleryRef&&a.searchRef&&a.searchRef.isAtEnd()){var t=a.galleryRef;e.preventDefault(),e.stopPropagation(),A["default"].flashFocus=Date.now(),N["default"].focus(ie.findDOMNode(t))}},a.handleSearchFocus=function(e){if(!(Date.now()-(A["default"].flashFocus||0)>200)){var t=ie.findDOMNode(a.refs.search_hotkeys);(0,W["default"])(t,"stop"),(0,W["default"])(t,{backgroundColor:["#fbfbfb","#D9F3FF"]},{duration:1600,easing:[.19,.69,.01,.99]})}},a.state={imageData:{},isSearching:!1,nextOffset:0,query:"",thumbnails:[],totalEstimatedMatches:0},a._hasPendingSearch=!1,a._searchPromise=null,a._debouncedSearch=a.props.debounce(a._search,750),a}return(0,v["default"])(t,e),(0,f["default"])(t,[{key:"componentWillUnmount",value:function(){this._cancelSearch()}},{key:"_requestSearch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._hasPendingSearch=!0,this._debouncedSearch(e,t)}},{key:"_cancelSearch",value:function(){this._hasPendingSearch&&(this._debouncedSearch.cancel(),this._hasPendingSearch=!1),this._searchPromise&&this._searchPromise.cancel()}},{key:"_resetState",value:function(){this.setState({imageData:{},isSearching:!1,nextOffset:0,query:"",thumbnails:[],totalEstimatedMatches:0})}},{key:"_addSearchResults",value:function(e,t){this.setState(function(a,n){var i=X.keyBy(t.value,function(e){return e.thumbnailUrl}),o=X.map(t.value,function(e){return{id:e.imageId,thumbUrl:e.thumbnailUrl}}),r=t.value.length,s={};return a.query===e?(s.nextOffset=t.nextOffset?t.nextOffset:a.nextOffset+r,s.thumbnails=X.concat(a.thumbnails,o),s.totalEstimatedMatches=t.totalEstimatedMatches,s.imageData=X.assign(i,a.imageData)):(s.imageData=i,s.nextOffset=t.nextOffset?t.nextOffset:r,s.query=e,s.thumbnails=o,s.totalEstimatedMatches=t.totalEstimatedMatches),s})}},{key:"render",value:function(){var e=C.DRAWER_HEADER_TYPE.POPUP,t={down:this.focusGallery},a=void 0;return a=0===this.state.thumbnails.length?this.state.isSearching?ae.createElement(de.SearchingImages,null):this.state.query?ae.createElement(de.ImageSearchEmpty,null):ae.createElement(de.BeforeImageSearch,null):ae.createElement(R["default"],{ref:(0,fe.GetRef)("galleryRef",this),classes:"image-search-drawer-results",canLoadMore:this.state.nextOffset<this.state.totalEstimatedMatches,isLoadingMore:this.state.isSearching,thumbnails:this.state.thumbnails,onFocusPrev:this.focusSearch,onImageClick:this.handleImageClick,onRequestMoreImages:this.handleRequestMoreImages}),ae.createElement(S["default"],null,ae.createElement(b["default"],{title:l10n.t("image_search_title"),type:e,onBack:this.props.onBack,onCancel:this.props.onCancel}),ae.createElement(T["default"],null,ae.createElement(A["default"],{ref:"search_hotkeys",handlers:t,onFocus:this.handleSearchFocus},ae.createElement(x["default"],{ref:(0,fe.GetRef)("searchRef",this),placeholder:l10n.t("image_search_hint"),onSearch:this.handleUserInput,loading:this.state.isSearching})),a))}}]),t}(ae.Component);t.Component=he;t["default"]=(0,G["default"])((0,U["default"])(he))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(1404),m=(n(h),a(462)),v=(n(m),a(243)),g=a(1405),_=n(g),y=a(1407),E=n(y),M=a(1406),S=n(M),C=a(1527),b=n(C),k=a(115),T=n(k),w=a(5),N=a(1451),P=a(1564),A=a(1558),O=a(240),R=a(1416),D=a(160),x=a(61),I=a(13),L=a(21),F={MEDIA:"media",DOCS:"docs",LINKS:"links"},U=function(e){function t(){(0,s["default"])(this,t);var e=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments));return e.onSelectMessages=function(){e.state.selectable||e.setState({selectable:!0})},e.onCancelSelection=function(){e.state.selectable&&(e.selectedMessages.unsetAll(),e.setState({selectable:!1}))},e.onMessageSelect=function(t,a){e.onSelectMessages(),e.selectedMessages.setVal(t,a)},e.selectedMessages=new R([],function(e){return e.id.toString()}),e.state={selected:F.MEDIA,direction:null,selectable:!1},e}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"onSelectTab",value:function(e){var t=I.values(F).indexOf(this.state.selected),a=I.values(F).indexOf(e);t!==a&&this.selectedMessages.unsetAll();var n=a>t?"right":"left";this.setState({selected:e,direction:n,selectable:!1})}},{key:"getTabs",value:function(){var e=this;if(!x.supportsFeature(x.F.LINK_DOC_GALLERY))return null;var t=[{tab:F.MEDIA,title:D.t("media")},{tab:F.DOCS,title:D.t("docs")},{tab:F.LINKS,title:D.t("links")}].map(function(t){var a=L("menu-item",{active:e.state.selected===t.tab});return w.createElement("button",{className:a,onClick:e.onSelectTab.bind(e,t.tab),key:t.tab,title:t.title},t.title)});return w.createElement("div",{className:"menu-tabs menu-tabs-lists","data-active-tab":this.state.selected},t)}},{key:"getContent",value:function(){var e=this.props.chat;if(!x.supportsFeature(x.F.LINK_DOC_GALLERY))return w.createElement(N,{chat:e,mediaMsgs:e.getMediaMsgs(),selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,selectedMessages:this.selectedMessages,fullCollection:!0});var t=void 0;switch(this.state.selected){case F.MEDIA:t=w.createElement(N,{chat:e,mediaMsgs:e.getMediaMsgs(),selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,selectedMessages:this.selectedMessages,fullCollection:!0});break;case F.LINKS:t=w.createElement(P,{chat:e,linkMsgs:e.getLinkMsgs(),selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,selectedMessages:this.selectedMessages});break;case F.DOCS:t=w.createElement(A,{chat:e,docMsgs:e.getDocMsgs(),selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,selectedMessages:this.selectedMessages})}return t}},{key:"render",value:function(){var e=this.props.chat,t=this.getTabs(),a=this.getContent(),n=this.state.selectable?w.createElement(O,{displayName:"MediaMultiSelect",escapable:!0,requestDismiss:this.onCancelSelection},w.createElement(b["default"],{className:"multi-controls-drawer",chat:e,disableRevoke:!0,noSortOnForward:!0,toastPosition:v.ToastPosition.RIGHT,downloadButton:this.state.selected!==F.LINKS,selectedMessages:this.selectedMessages,onCancel:this.onCancelSelection})):null,i="right"===this.state.direction?"slide-forward":"slide-back",o=x.supportsFeature(x.F.LINK_DOC_GALLERY)?" ":D.t("media");return w.createElement(_["default"],{className:"drawer-multimedia-gallery",onCancel:this.props.onBack},w.createElement(E["default"],{title:o,onBack:this.props.onBack,type:y.DRAWER_HEADER_TYPE.LARGE}),n,t,w.createElement(S["default"],{"data-list-scroll-container":!0},w.createElement(T["default"],{transitionName:i,className:"column"},w.createElement("div",{className:"multimedia-gallery",key:this.state.selected},w.createElement("div",{className:"column"},a)))))}}]),t}(w.Component);e.exports=U},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(79),y=n(_),E=a(21),M=n(E),S=a(1409),C=n(S),b=a(1403),k=n(b),T=a(61),w=n(T),N=a(242),P=(n(N),a(1402)),A=n(P),O=a(470),R=n(O),D=a(462);n(D);t["default"]=(0,A["default"])((o=i=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(r))),n.getMenuBtns=function(){var e=n.props,t=e.msg,a=e.mediaData,i=null,o=null,r=null,s=null,l=null,u="menu-item menu-item-hover";if(i=g["default"].createElement("div",{className:u,onClick:n.props.onGoToMsgClick},g["default"].createElement("span",{className:"icon icon-bubble",title:l10n.t("go_to_message")})),w["default"].supportsFeature(w["default"].F.STARRED)){var c=void 0,d=void 0,f=void 0,p=void 0;t.star?(c=n.props.onUnstarClick,d="icon icon-unstar-btn",f="unstar-btn",p=l10n.t("unstar_message")):(c=n.props.onStarClick,d="icon icon-star-btn",f="star-btn",p=l10n.t("star_message")),o=g["default"].createElement("div",{className:u,onClick:c},g["default"].createElement(R["default"],{name:f,className:d,title:p}))}return r=g["default"].createElement("div",{className:u,onClick:n.props.openForwardFlow},g["default"].createElement(R["default"],{name:"forward",className:"icon btn-media-forward icon-forward",title:l10n.t("forward")})),s=g["default"].createElement("div",{className:(0,M["default"])(u,{disabled:!a.renderableUrl}),onClick:n.props.onDownloadClick},g["default"].createElement(R["default"],{name:"download",className:"icon icon-download",title:l10n.t("web_button_download")})),{btnGoToMsg:i,btnStar:o,btnForward:r,btnDownload:s,btnMinimize:l}},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props.msg,t=e.displayName(!0,!0);e.isGroupMsg&&(t+=" @ "+e.chat.title());var a=this.getMenuBtns(),n=a.btnGoToMsg,i=a.btnStar,o=a.btnForward,r=a.btnDownload,s=a.btnMinimize,l=(0,M["default"])("media-panel-header",{});return g["default"].createElement("div",{className:l},g["default"].createElement("div",{className:"chat media-chat"},g["default"].createElement("div",{className:"chat-avatar"},g["default"].createElement(C["default"],{id:e.sender,size:40})),g["default"].createElement("div",{className:"chat-body"},g["default"].createElement("div",{className:"chat-main"},g["default"].createElement(k["default"],{ellipsify:!0,text:t})),g["default"].createElement("div",{className:"chat-secondary"},g["default"].createElement("div",{className:"chat-status ellipsify"},y["default"].relativeDateAndTimeStr(e.t))))),g["default"].createElement("div",{className:"menu menu-horizontal media-panel-tools"},s,n,i,o,r,g["default"].createElement("div",{className:"menu-item menu-item-hover"},g["default"].createElement("button",{className:"icon icon-x-viewer",title:l10n.t("web_close"),onClick:this.props.onClose}))))}}]),t}(g["default"].PureComponent),i.CONCERNS={msg:["star","isGroupMsg","chat","type","isGif","sender","t"],mediaData:["renderableUrl"]},o))},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o,r,s,l,u,c,d,f,p=a(473),h=i(p),m=a(6),v=i(m),g=a(3),_=i(g),y=a(4),E=i(y),M=a(8),S=i(M),C=a(7),b=i(C),k=a(5),T=i(k),w=a(46),N=i(w),P=a(13),A=i(P),O=a(1490),R=i(O),D=a(12),x=i(D),I=a(1529),L=i(I),F=a(238),U=i(F),j=a(21),G=i(j),B=a(471),V=i(B),H=a(1403),W=i(H),z=a(1476),Y=i(z),q=a(1423),K=i(q),Q=a(242),X=i(Q),Z=a(1669),J=i(Z),$=a(1439),ee=n($),te=a(1418),ae=i(te),ne=a(1402),ie=i(ne),oe=a(240),re=i(oe),se=a(463),le=i(se),ue=a(1455),ce=i(ue),de=a(1471),fe=i(de),pe=a(485),he=a(466),me=a(239),ve=500,ge=2;t["default"]=(0,ie["default"])((r=o=function(e){function t(e){(0,_["default"])(this,t);var a=(0,S["default"])(this,(t.__proto__||(0,v["default"])(t)).call(this,e));return a.setMediaImage=function(e){return a.mediaImage=e},a.setMediaVideo=function(e){return a.mediaVideo=e},a.onImageLoad=function(e){if(a.props.onImageLoad&&a.props.onImageLoad(),!a.zoomed){a.zoomed=!0;var t=a.state.zoomElement;t&&e&&a.props.zoomIn&&a.animateZoom(t,e)}},a.animateZoom=function(e,t){var n=t.getBoundingClientRect(),i=e.getBoundingClientRect(),o=i.top-n.top,r=i.left-n.left,s=e.clientWidth/t.clientWidth,l=(t.clientHeight-e.clientHeight)/2,u=(t.clientWidth-e.clientWidth)/2;o-=l,r-=u,(0,le["default"])(t,{opacity:[1,0],translateX:[0,r],translateY:[0,o],scale:[1,s]},{duration:ve,easing:[.1,.82,.25,1]});var c=N["default"].findDOMNode(a.caption);c&&(0,le["default"])(c,{opacity:[1,0]},{duration:ve})},a.openForwardFlow=function(e){e.stopPropagation();var t=a.props.msg;t.isUnsentMedia?x["default"].openModal(T["default"].createElement(U["default"],{title:l10n.t("err_unsent_forward_title"),onOK:x["default"].closeModal.bind(x["default"]),okText:l10n.t("web_ok")},l10n.t("err_unsent_forward_text"))):x["default"].openModal(T["default"].createElement(Y["default"],{msgs:[(0,ne.unproxy)(t)]}),"modal-flow")},a.onScroll=function(e){Math.abs(e.deltaY)>7&&a.onClose()},a.onImgZoomIn=function(e){var t=a.mediaImage;e&&t&&(a.listenToMouseMove=t.heightOverflow>0||t.widthOverflow>0),a.setState({imgZoomed:e}),a.props.onImgZoomIn(e)},a.onZoomOut=function(e){var t=a.mediaImage;t&&a.state.imgZoomed&&t.onImageClick(e)},a.onMouseMove=function(e){a.handleMouseMove(e.pageX,e.pageY)},a._handleMouseMove=function(e,t){var n=a.mediaImage;if(n){var i=n.image;if(i){var o=N["default"].findDOMNode(i);if(o){var r=o.parentNode,s=r.parentNode,l=n.getTranslatePosition(s,e,t),u=l.translateX,c=l.translateY;(0,le["default"])(r,"stop"),(0,le["default"])(r,{translateX:u,translateY:c,scale:ge},{duration:0})}}}},a.onDownloadClick=function(e){e.stopPropagation(),V["default"].initDownload((0,ne.unproxy)(a.props.msg))},a.onStarClick=function(e){e.stopPropagation();var t=a.props.msg;x["default"].sendStarMsgs(t.chat,[(0,ne.unproxy)(t)])},a.onUnstarClick=function(e){e.stopPropagation();var t=a.props.msg;x["default"].sendUnstarMsgs(t.chat,[(0,ne.unproxy)(t)])},a.onGoToMsgClick=function(e){e.stopPropagation(),a.onClose(),x["default"].existsDrawerRight(function(e){e&&2===L["default"].column&&x["default"].closeDrawerRight()});var t=a.props.msg;x["default"].openChatAt(t.chat,t.chat.getSearchContext((0,ne.unproxy)(t)))},a.onClose=function(){if(!a.closing){a.closing=!0,A["default"].isFunction(a.props.onExitAnimation)&&a.props.onExitAnimation();var e=a.props.getZoomNode(a.props.msg.id);if(!e)return a.props.onBack();var t=void 0,n=a.props.mediaData.type;if(n===X["default"].TYPE.IMAGE&&a.mediaImage?t=a.mediaImage.image:a.props.mediaData.isGif&&a.mediaVideo&&(t=a.mediaVideo.player),!t)return a.props.onBack();t=N["default"].findDOMNode(t);var i=t.getBoundingClientRect(),o=e.getBoundingClientRect(),r=o.top-i.top,s=o.left-i.left,l=e.clientWidth/t.clientWidth,u=(t.clientHeight-e.clientHeight)/2,c=(t.clientWidth-e.clientWidth)/2;r-=u,s-=c,(0,le["default"])(t,{translateX:[s,0],translateY:[r,0],scale:[l,1]},{duration:200,easing:[.1,.82,.25,1]}).then(function(){a.props.onBack()});var d=N["default"].findDOMNode(a.caption);d&&(0,le["default"])(d,{opacity:[0,1]},{duration:200,easing:[.1,.82,.25,1]})}},a.onMinimizeClick=function(){var e=a.props,t=e.msg,n=e.getZoomNode,i=a.mediaVideo;if(i){var o=N["default"].findDOMNode(i).querySelector("video"),r=o.currentTime;x["default"].videoPlayerFloater((0,ne.unproxy)(t),n,r)}a.onClose()},a.handleMouseMove=A["default"].throttle(a._handleMouseMove,42),a.zoomed=!1,a.closing=!1,a.listenToMouseMove=!1,a.state={imgZoomed:!1,zoomElement:null},a}return(0,b["default"])(t,e),(0,E["default"])(t,[{key:"componentWillMount",value:function(){if(this.props.mediaData.mediaStage===X["default"].STAGE.RESOLVED&&this.props.zoomIn){var e=this.props.getZoomNode(this.props.msg.id);this.setState({zoomElement:e}),this.transparentStyle={opacity:0}}}},{key:"componentDidMount",value:function(){this.transparentStyle={}}},{key:"componentWillUnmount",value:function(){this.handleMouseMove.cancel()}},{key:"render",value:function(){var e=this.props,t=e.msg,a=e.mediaData,n=void 0;switch(a.type){case X["default"].TYPE.IMAGE:n=T["default"].createElement(ye,{msg:t,mediaData:a,key:t.id,style:this.transparentStyle,onLoad:this.onImageLoad,onImgZoomIn:this.onImgZoomIn,ref:this.setMediaImage});break;case X["default"].TYPE.VIDEO:n=T["default"].createElement(Me,{msg:t,mediaData:a,key:t.id,onLoad:a.isGif?this.onImageLoad:null,startTime:this.props.startTime,ref:this.setMediaVideo});break;case X["default"].TYPE.AUDIO:n=T["default"].createElement(Ce,{mediaData:a,key:t.id})}var i=void 0;if(t.caption){var o=t.mentionMap(),r=this.props.zoomIn&&(a.isGif||a.type===X["default"].TYPE.IMAGE);i=T["default"].createElement(W["default"],{ref:(0,me.GetRef)("caption",this),className:{"media-caption":!0,"caption-hidden":r},formatters:he.Configuration.TrustedConversation(o),text:t.caption})}var s=(0,G["default"])("media",{"media-with-caption":!!i}),l=T["default"].createElement("span",{className:"icon icon-chevron-right icon-l",title:l10n.t("next_button")}),u=(0,G["default"])("btn btn-round btn-media-next",{"disabled-btn":!this.props.onNext}),c=T["default"].createElement("div",{role:"button",className:u,onClick:this.props.onNext||function(e){return e.stopPropagation()}},l),d=T["default"].createElement("span",{className:"icon icon-chevron-left icon-l",title:l10n.t("previous_button")}),f=(0,G["default"])("btn btn-round btn-media-prev",{"disabled-btn":!this.props.onPrev}),p=T["default"].createElement("div",{role:"button",className:f,onClick:this.props.onPrev||function(e){return e.stopPropagation()}},d),h=(0,G["default"])("media-viewer",{"media-viewer-animate":this.props.zoomIn,"cursor-zoom-out":this.state.imgZoomed}),m=this.state.imgZoomed?null:this.onScroll,v=this.state.imgZoomed?null:this.onClose,g=this.state.imgZoomed&&this.listenToMouseMove?this.onMouseMove:null,_=this.state.imgZoomed?this.onZoomOut:null;return T["default"].createElement(re["default"],{displayName:"MediaViewer",escapable:!0,requestDismiss:this.onClose},T["default"].createElement("div",{className:h,onClick:_,onMouseMove:g},T["default"].createElement(J["default"],{msg:t,mediaData:a,onGoToMsgClick:this.onGoToMsgClick,onUnstarClick:this.onUnstarClick,onStarClick:this.onStarClick,openForwardFlow:this.openForwardFlow,onDownloadClick:this.onDownloadClick,onMinimizeClick:this.onMinimizeClick,onClose:this.onClose}),T["default"].createElement("div",{className:"media-content",dir:"ltr",ref:"container",onWheel:m,onClick:v},p,T["default"].createElement("div",{className:s},T["default"].createElement(be,{msg:t,mediaData:a}),n,i),c)))}}]),t}(T["default"].PureComponent),o.CONCERNS={msg:["id","star","isUnsentMedia","chat","caption"],mediaData:["mediaStage","type","isGif"]},o.defaultProps={getZoomNode:A["default"].noop},r));var _e=function(e){function t(){var e,a,n,i;(0,_["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,S["default"])(this,(e=t.__proto__||(0,v["default"])(t)).call.apply(e,[this].concat(r))),n.state={zoomIn:null},n.onImageClick=function(e){if(e.stopPropagation(),n.state.zoomIn)return void n.cancelZoomIn();var t=N["default"].findDOMNode(n.image),a=t.parentNode,i=a.parentNode;n.heightOverflow=a.clientHeight*ge-i.clientHeight,n.widthOverflow=a.clientWidth*ge-i.clientWidth;var o=n.getTranslatePosition(i,e.pageX,e.pageY),r=o.translateX,s=o.translateY;n.props.onImgZoomIn(!0),n.setState({zoomIn:{factor:ge,translateX:r,translateY:s}})},n.cancelZoomIn=function(){n.props.onImgZoomIn(!1),n.setState({zoomIn:null})},n.getTranslatePosition=function(e,t,a){var i=window.innerWidth/2-t,o=window.innerHeight/2-a,r=n.widthOverflow>0?Math.round(1.5*i*n.widthOverflow/e.clientWidth):0,s=n.heightOverflow>0?Math.round(1.5*o*n.heightOverflow/e.clientHeight):0;return{translateX:r,translateY:s}},i=a,(0,S["default"])(n,i)}return(0,b["default"])(t,e),(0,E["default"])(t,[{key:"componentDidMount",value:function(){this.props.msg.forceDownloadMedia()}},{key:"render",value:function(){var e=this.props.mediaData,t=this.state.zoomIn,a=(0,G["default"])("media-viewer-img",{"cursor-zoom-in":!t});if(e.mediaStage===X["default"].STAGE.RESOLVED){var n={width:e.fullWidth,height:e.fullHeight},i=T["default"].createElement(K["default"],{src:e.renderableUrl,ref:(0,me.GetRef)("image",this),onClick:this.onImageClick,style:this.props.style,className:a});return t&&(i=T["default"].createElement(re["default"],{displayName:"ZoomInImage",ref:(0,me.GetRef)("image",this),escapable:!0,requestDismiss:this.cancelZoomIn},i)),T["default"].createElement(ae["default"],{type:"zoomIn",size:n,zoomIn:this.state.zoomIn,onObjectLoad:this.props.onLoad},i)}return T["default"].createElement(Se,{mediaData:e})}}]),t}(T["default"].PureComponent);_e.CONCERNS={mediaData:["mediaStage","fullWidth","fullHeight","renderableUrl"]};var ye=function(e){function t(){return(0,_["default"])(this,t),(0,S["default"])(this,(t.__proto__||(0,v["default"])(t)).apply(this,arguments))}return(0,b["default"])(t,e),(0,E["default"])(t,[{key:"onImageClick",value:function(e){return(0,h["default"])(t.prototype.__proto__||(0,v["default"])(t.prototype),"getComponent",this).call(this).onImageClick(e)}},{key:"getTranslatePosition",value:function(e,a,n){return(0,h["default"])(t.prototype.__proto__||(0,v["default"])(t.prototype),"getComponent",this).call(this).getTranslatePosition(e,a,n)}},{key:"heightOverflow",get:function(){return(0,h["default"])(t.prototype.__proto__||(0,v["default"])(t.prototype),"getComponent",this).call(this).heightOverflow}},{key:"widthOverflow",get:function(){return(0,h["default"])(t.prototype.__proto__||(0,v["default"])(t.prototype),"getComponent",this).call(this).widthOverflow}},{key:"image",get:function(){return(0,h["default"])(t.prototype.__proto__||(0,v["default"])(t.prototype),"getComponent",this).call(this).image}}]),t}((0,ie["default"])(_e)),Ee=function(e){function t(){var e,a,n,i;(0,_["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,S["default"])(this,(e=t.__proto__||(0,v["default"])(t)).call.apply(e,[this].concat(r))),n.state={played:!1,size:{width:0,height:0}},n.updateSize=function(){var e=n.props.mediaData;e.mediaStage===X["default"].STAGE.RESOLVED&&e.fullWidth&&e.fullHeight&&n.setState({size:n.getSize()})},n.onPlayerError=function(e){},n.onPlayerClick=function(e){e.stopPropagation();var t=N["default"].findDOMNode(n.player);e.clientY>t.clientHeight+t.offsetTop-44||(t.paused?t.play():t.pause())},n.stopPropagation=function(e){e.stopPropagation()},n.getSize=function(){var e=n.props.mediaData,t=330;return!e.isGif||e.fullWidth>=t?{width:e.fullWidth,height:e.fullHeight}:{width:t,height:e.fullHeight*t/e.fullWidth}},i=a,(0,S["default"])(n,i)}return(0,b["default"])(t,e),(0,E["default"])(t,[{key:"componentWillMount",value:function(){this.updateSize()}},{key:"componentWillReceiveProps",value:function(){this.updateSize()}},{key:"componentDidMount",value:function(){this.props.msg.forceDownloadMedia()}},{key:"render",value:function(){var e=this.props,t=e.msg,a=e.mediaData,n=a.isGif,i=a.mediaStage===X["default"].STAGE.RESOLVED;if(i){var o=l10n.t("video_playback_not_supported"),r=void 0;return r=n?T["default"].createElement(ce["default"],{src:a.renderableUrl,className:"media-viewer-img",onClick:this.stopPropagation,autoPlay:!0,loop:!0},o):T["default"].createElement(fe["default"],{msg:t,mediaData:a,ref:(0,me.GetRef)("player",this),className:"media-viewer-img",onClick:this.onPlayerClick,autoPlay:!0,controls:!0,startTime:this.props.startTime},o),T["default"].createElement(ae["default"],{type:"scaleDown",size:this.state.size,onObjectLoad:this.props.onLoad},r)}return T["default"].createElement(Se,{mediaData:a})}}]),t}(T["default"].PureComponent);Ee.CONCERNS={mediaData:["mediaStage","fullWidth","fullHeight","isGif","renderableUrl"]};var Me=function(e){function t(){return(0,_["default"])(this,t),(0,S["default"])(this,(t.__proto__||(0,v["default"])(t)).apply(this,arguments))}return(0,b["default"])(t,e),(0,E["default"])(t,[{key:"player",get:function(){return(0,h["default"])(t.prototype.__proto__||(0,v["default"])(t.prototype),"getComponent",this).call(this).player}}]),t}((0,ie["default"])(Ee)),Se=(0,ie["default"])((l=s=function(e){function t(){var e,a,n,i;(0,_["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,S["default"])(this,(e=t.__proto__||(0,v["default"])(t)).call.apply(e,[this].concat(r))),n.stopPropagation=function(e){e.stopPropagation()},i=a,(0,S["default"])(n,i)}return(0,b["default"])(t,e),(0,E["default"])(t,[{key:"render",value:function(){var e=this.props.mediaData,t=e.preview&&e.preview.url(),a=(0,pe.aspectRatioScaled)(e.aspectRatio,500);return T["default"].createElement("div",{className:"media-viewer-blur-crop",style:a,onClick:this.stopPropagation},T["default"].createElement("img",{className:"media-viewer-blur-img",src:t}))}}]),t}(T["default"].PureComponent),s.CONCERNS={mediaData:["preview","aspectRatio"]},l)),Ce=(0,ie["default"])((c=u=function(e){function t(){return(0,_["default"])(this,t),(0,S["default"])(this,(t.__proto__||(0,v["default"])(t)).apply(this,arguments))}return(0,b["default"])(t,e),(0,E["default"])(t,[{key:"render",value:function(){var e=this.props.mediaData;return e.mediaStage===X["default"].STAGE.RESOLVED?T["default"].createElement(R["default"],{url:e.renderableUrl,className:"media-viewer-img media-viewer-audio",autoPlay:!0,controls:!0},l10n.t("audio_playback_not_supported")):T["default"].createElement("div",{className:"image-audio"})}}]),t}(T["default"].PureComponent),u.CONCERNS={mediaData:["mediaStage","renderableUrl"]},c)),be=(0,ie["default"])((f=d=function(e){function t(){var e,a,n,i;(0,_["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,S["default"])(this,(e=t.__proto__||(0,v["default"])(t)).call.apply(e,[this].concat(r))),n.onUnsupportedDownloadClick=function(e){e.stopPropagation(),x["default"].openModal(T["default"].createElement(U["default"],{onCancel:x["default"].closeModal.bind(x["default"]),onOK:function(){x["default"].closeModal(),V["default"].initDownload((0,ne.unproxy)(n.props.msg))},okText:l10n.t("web_button_download"),cancelText:l10n.t("web_cancel"),title:l10n.t("download_unsupported_media_title")},l10n.t("download_unsupported_media_prompt")))},n.downloadMedia=function(e){e.stopPropagation(),n.props.msg.forceDownloadMedia()},n.stopPropagation=function(e){e.stopPropagation()},i=a,(0,S["default"])(n,i)}return(0,b["default"])(t,e),(0,E["default"])(t,[{key:"render",value:function(){var e=this.props.mediaData,t=null;switch(e.mediaStage){case X["default"].STAGE.RESOLVED:case X["default"].STAGE.ERROR_MISSING:return null;case X["default"].STAGE.ERROR_UNSUPPORTED:return t=this.onUnsupportedDownloadClick,T["default"].createElement(ee.Download,{filesize:e.size,onClick:t});case X["default"].STAGE.NEED_POKE:return t=this.downloadMedia,T["default"].createElement(ee.Download,{filesize:e.size,onClick:t});default:return t=this.stopPropagation,T["default"].createElement("div",{onClick:t},T["default"].createElement(ee.Pending,null))}}}]),t}(T["default"].PureComponent),d.CONCERNS={mediaData:["mediaStage","size"]},f))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(12),g=n(v),_=a(1405),y=n(_),E=a(1406),M=n(E),S=a(1407),C=n(S),b=a(116),k=n(b),T=a(160),w=n(T),N=a(1421),P=n(N),A=a(462),O=(n(A),a(5)),R=n(O),D=a(1402),x=n(D),I=a(1479),L=n(I),F=a(469),U=n(F);t["default"]=(0,x["default"])((o=i=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this,t=this.props.msg;return R["default"].createElement(P["default"],{type:N.BoxModalType},R["default"].createElement(y["default"],{onCancel:function(){return g["default"].closeModal()}},R["default"].createElement(C["default"],{title:w["default"].t("multi_vcard_number_of_contacts",{count:t.vcardList.length,_plural:t.vcardList.length}),type:S.DRAWER_HEADER_TYPE.POPUP,onCancel:function(){return g["default"].closeModal()}}),R["default"].createElement(M["default"],null,R["default"].createElement(k["default"],null,R["default"].createElement("div",{className:"multi-vcard-dialog-body"},t.vcardList.map(function(t,a){return e.renderVCard(t,a)}))))))}},{key:"renderVCard",value:function(e,t){var a=U["default"].parse(e.vcard);return a?R["default"].createElement(L["default"],{key:t,parsedVCard:a,thumbnail:U["default"].thumbnail(e.vcard),className:"multi-vcard-dialog-contact"}):null}}]),t}(O.Component),i.CONCERNS={msg:["vcardList"]},o))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){_["default"].closeModal()}Object.defineProperty(t,"__esModule",{value:!0});var o,r,s=a(6),l=n(s),u=a(3),c=n(u),d=a(4),f=n(d),p=a(8),h=n(p),m=a(7),v=n(m),g=a(12),_=n(g),y=a(1403),E=n(y),M=a(95),S=n(M),C=a(160),b=n(C),k=a(0),T=n(k),w=a(5),N=n(w),P=a(46),A=n(P),O=a(1402),R=n(O),D=function(){return[{label:b["default"].t("web_mute_8hours"),duration:8},{label:b["default"].t("web_mute_1week"),duration:168},{label:b["default"].t("web_mute_1year"),duration:8760}]};t["default"]=(0,R["default"])((r=o=function(e){function t(){var e,a,n,i;(0,c["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,h["default"])(this,(e=t.__proto__||(0,l["default"])(t)).call.apply(e,[this].concat(r))),n.state={mute:8},n.onChange=function(e){var t=e.target;t instanceof HTMLInputElement&&n.setState({mute:parseInt(t.value,10)})},n.onMute=function(e){e.stopPropagation(),_["default"].closeModal(),n.props.onMute(3600*n.state.mute+(0,T["default"])().unix(),!0)},i=a,(0,h["default"])(n,i)}return(0,v["default"])(t,e),(0,f["default"])(t,[{key:"componentDidMount",value:function(){S["default"].focus(A["default"].findDOMNode(this.refs.button))}},{key:"render",value:function(){var e=this,t=this.props.onCancel||i,a=this.state.mute,n=D().map(function(t){var n=t.duration;return N["default"].createElement("li",{key:"mute-"+n},N["default"].createElement("label",null,N["default"].createElement("input",{type:"radio",name:"duration",value:t.duration,checked:a===n,onChange:e.onChange}),t.label))});return N["default"].createElement("div",{className:"backdrop"},N["default"].createElement("div",{className:"popup-container"},N["default"].createElement("div",{className:"popup"},N["default"].createElement("div",{className:"popup-body"},N["default"].createElement("div",{className:"popup-title",dir:"auto"},N["default"].createElement(E["default"],{text:b["default"].t("mute_time",{name:this.props.chat.title()})})),N["default"].createElement("div",{className:"popup-contents"},N["default"].createElement("form",{ref:"form"},N["default"].createElement("ol",{
className:"choices"},n)))),N["default"].createElement("div",{className:"popup-controls"},N["default"].createElement("button",{className:"btn-plain popup-controls-item",onClick:t},b["default"].t("web_cancel")),N["default"].createElement("button",{ref:"button",className:"btn-plain btn-default popup-controls-item",onClick:this.onMute},b["default"].t("web_menuitem_mute"))))))}}]),t}(w.PureComponent),o.CONCERNS={chat:["id","formattedTitle"]},r))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(13),g=n(v),_=a(1405),y=n(_),E=a(1406),M=n(E),S=a(1407),C=n(S),b=a(467),k=n(b),T=a(160),w=n(T),N=a(1466),P=n(N),A=a(115),O=n(A),R=a(1435),D=n(R),x=function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));return a.onPreventBlur=function(e){e.preventDefault(),e.stopPropagation(),a.refs.emojiInput&&a.refs.emojiInput.restoreFocus()},a.onImageSet=function(e,t){a.setState({thumb:e,full:t})},a.onContinue=function(){var e=k["default"].emojify(a.state.text.trim());a.props.onContinue(e,a.state.thumb,a.state.full)},a.onSubjectChange=function(e){e&&a.setState({text:e})},a.state={text:e.subject||"",thumb:e.thumb,full:e.full},a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){this.refs.emojiInput.restoreFocus()}},{key:"render",value:function(){var e=this.state.text.trim().length>0,t=e?m["default"].createElement("div",{className:"drawer-section drawer-controls"},m["default"].createElement("button",{className:"btn btn-round",onClick:this.onContinue},m["default"].createElement("span",{className:"icon icon-forward-light icon-l"}))):null;return m["default"].createElement(y["default"],{className:"drawer-new-group",onCancel:this.props.onBack},m["default"].createElement(C["default"],{title:w["default"].t("new_group_flow_title"),type:S.DRAWER_HEADER_TYPE.LARGE,onBack:this.props.onBack}),m["default"].createElement(M["default"],{wide:!0},m["default"].createElement("div",{className:"drawer-section"},m["default"].createElement(P["default"],{type:N.Type.GROUP,startImage:this.state.full,onImageSet:this.onImageSet,ref:"photoPicker"})),m["default"].createElement("div",{className:"drawer-section",onMouseDown:this.onPreventBlur},m["default"].createElement(D["default"],{ref:"emojiInput",value:this.state.text,maxLength:25,showRemaining:!0,onChange:this.onSubjectChange,placeholder:w["default"].t("group_subject"),onEnter:e?this.onContinue:g["default"].noop,supportsEmoji:!0})),m["default"].createElement(O["default"],{transitionName:"btn"},t)))}}]),t}(h.Component);t["default"]=x},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(13),m=n(h),v=a(12),g=n(v),_=a(238),y=n(_),E=a(14),M=n(E),S=a(1489),C=n(S),b=a(1405),k=n(b),T=a(1406),w=n(T),N=a(1407),P=n(N),A=a(15),O=n(A),R=a(95),D=n(R),x=a(116),I=n(x),L=a(160),F=n(L),U=a(1553),j=n(U),G=a(1408),B=n(G),V=a(5),H=n(V),W=a(115),z=n(W),Y=a(161),q=n(Y),K=a(465),Q=n(K),X=Q["default"].genId("max_participant_toast");t["default"]=(0,B["default"])(function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={searchText:"",participants:[],shouldFocus:!0,isBusy:!1},n.onKeyDown=function(e){if("Backspace"!==e.key||n.state.searchText||m["default"].isEmpty(n.state.participants))"Enter"===e.key&&m["default"].size(n.state.participants)&&n.onContinue();else{e.preventDefault();var t=n.state.participants;n.setState({participants:t.slice(0,t.length-1),shouldFocus:!0})}},n.onInput=function(e){n.setState({searchText:e.target.value})},n.onReset=function(){n.setState({searchText:"",shouldFocus:!0})},n.focus=function(){D["default"].focus(n.refs.input)},n.onBack=function(){var e=n.props;e.onBack()},n.onContinue=function(){var e=n.props;e.onContinue(e.subject,e.thumb,e.full,n.state.participants)},n.onDelete=function(e,t){var a=m["default"].without(n.state.participants,t);n.setState({participants:a,shouldFocus:!a.length})},n.onContactClick=function(e,t){var a=m["default"].includes(n.state.participants,t);a?n.removeContact(t):t.isBlocked()?g["default"].openModal(H["default"].createElement(y["default"],{title:F["default"].t("add_blocked_title"),onOK:function(){n.unblockAndAddContact(t),g["default"].closeModal()},onCancel:g["default"].closeModal.bind(g["default"]),okText:F["default"].t("web_yes"),cancelText:F["default"].t("web_no")},F["default"].t("add_blocked_contact_to_group"))):n.addContact(t)},n.onFocusList=function(e){n.refs.list&&(e.preventDefault(),e.stopPropagation(),I["default"].flashFocus=Date.now(),n.refs.list.focusFirst())},n.onFocusParticipants=function(e){e.repeat||0!==n.refs.input.selectionStart||n.refs.participantList&&(e.preventDefault(),e.stopPropagation(),I["default"].flashFocus=0,n.refs.participantList.focusLast())},n.onSelectFirst=function(e){e.preventDefault(),e.stopPropagation();var t=m["default"].head(n.getFilteredContacts());t&&n.onContactClick(e,t)},n.onFocusSearch=function(e){I["default"].flashFocus=Date.now(),D["default"].focus(n.refs.input)},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){this.focus()}},{key:"componentDidUpdate",value:function(){this.adjustInput()}},{key:"getFilteredContacts",value:function(){var e=m["default"].difference(Store.Contact.getFilteredContacts(),this.state.participants),t=this.state.searchText;return t?(t=F["default"].accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e}},{key:"adjustInput",value:function(){var e=this.refs.input.offsetParent.offsetWidth-10,t=this.refs.sizer.offsetWidth,a=t>e?e:t;this.refs.input.style.width=a+"px";var n;n=e-this.refs.input.offsetLeft-a>0?e-this.refs.input.offsetLeft:e,this.refs.input.style.width=n+"px",this.state.shouldFocus&&this.focus()}},{key:"addContact",value:function(e){var t=this.state.participants;if(t.length>=M["default"].MAX_GROUP_SIZE){var a=F["default"].t("action_group_create_failed_participant",{max:M["default"].MAX_GROUP_SIZE});g["default"].openToast(H["default"].createElement(Q["default"],{msg:a,id:X}))}else this.setState({participants:t.concat(e),searchText:"",shouldFocus:!0})}},{key:"removeContact",value:function(e){var t=this.state.participants;this.setState({participants:m["default"].without(t,e),shouldFocus:!0})}},{key:"unblockAndAddContact",value:function(e){var t=this;this.setState({isBusy:!0}),e.setBlock(!1).checkpoint(this.props.rejectOnUnmount()).then(function(){t.addContact(e),t.setState({isBusy:!1})})["catch"](O["default"].Unmount,m["default"].noop)["catch"](function(e){t.setState({isBusy:!1})})}},{key:"render",value:function(){var e=void 0;this.state.isBusy?e=H["default"].createElement(q["default"],null):m["default"].size(this.state.participants)&&(e=H["default"].createElement("button",{className:"btn btn-round",onClick:this.onContinue},H["default"].createElement("span",{className:"icon icon-checkmark-light"})));var t=m["default"].size(this.state.participants)?" ":F["default"].t("group_participant_hint"),a={down:this.onFocusList,enter:this.state.searchText?this.onSelectFirst:m["default"].size(this.state.participants)?this.onContinue:m["default"].noop,up:this.onFocusParticipants};return a[F["default"].LR("left","right")]=this.onFocusParticipants,H["default"].createElement(k["default"],{className:"drawer-new-group",onCancel:this.onBack},H["default"].createElement(P["default"],{title:F["default"].t("add_group_participants_title"),type:N.DRAWER_HEADER_TYPE.LARGE,onBack:this.onBack}),H["default"].createElement(w["default"],null,H["default"].createElement("div",{className:"drawer-section new-group-search"},H["default"].createElement("div",{className:"input-clear input-ext"},H["default"].createElement(I["default"],{handlers:a,className:"input input-line"},H["default"].createElement("div",{className:"list-names list-deletable new-group-preview"},H["default"].createElement("div",{className:"new-group-participants","data-list-scroll-container":!0},H["default"].createElement(j["default"],{ref:"participantList",contacts:this.state.participants,onDelete:this.onDelete,onFocusSearch:this.onFocusSearch}))),H["default"].createElement("input",{className:"inputarea",ref:"input",placeholder:t,onKeyDown:this.onKeyDown,onChange:this.onInput,value:this.state.searchText}),H["default"].createElement("span",{className:"inputarea-sizer",ref:"sizer"},this.state.searchText)))),H["default"].createElement("div",{className:"new-group-contacts","data-list-scroll-container":!0},H["default"].createElement(C["default"],{ref:"list",contacts:this.getFilteredContacts(),onFocusSearch:this.onFocusSearch,onClick:this.onContactClick})),H["default"].createElement(z["default"],{transitionName:"btn",className:"drawer-section drawer-controls"},e)))}}]),t}(V.Component))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(1658),o=n(i),r=a(1405),s=n(r),l=a(1406),u=n(l),c=a(1407),d=n(c),f=a(160),p=n(f),h=a(5),m=n(h);t["default"]=function(e){return m["default"].createElement(s["default"],{className:"drawer-notifications"},m["default"].createElement(d["default"],{a8n:"drawer-title-notifications",title:p["default"].t("notifications_drawer_title"),onBack:e.onClose,type:c.DRAWER_HEADER_TYPE.LARGE}),m["default"].createElement(u["default"],{wide:!0},m["default"].createElement(o["default"],{key:"notifications"})))}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(46),g=n(v),_=a(468),y=n(_),E=a(21),M=n(E),S=a(95),C=n(S),b=a(116),k=n(b),T=a(1421),w=n(T),N=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onOK=function(e){e.stopPropagation(),e.preventDefault(),n.props.onOK(e)},n.onCancel=function(e){e.stopPropagation(),e.preventDefault(),n.props.onCancel(e)},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){C["default"].focus(g["default"].findDOMNode(this))}},{key:"render",value:function(){var e=[],t={};if(this.props.onCancel){var a=(0,M["default"])("btn-plain","popup-controls-item",{"btn-default":!this.props.onOK});e.push(m["default"].createElement("button",{className:a,onClick:this.onCancel,key:"button-cancel"},this.props.cancelText||l10n.t("web_cancel"))),t.escape=this.onCancel}return this.props.onOK&&(e.push(m["default"].createElement("button",{"data-a8n":y["default"].key("popup-controls-ok"),className:"btn-plain btn-default popup-controls-item",onClick:this.onOK,key:"button-ok"},this.props.okText||l10n.t("web_ok"))),t.enter=this.onOK),m["default"].createElement(k["default"],{handlers:t},m["default"].createElement(w["default"],{className:this.props.classes,title:this.props.title,actions:e},this.props.children))}}]),t}(m["default"].Component);N.defaultProps={classes:""},t["default"]=N},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(13),g=n(v),_=a(238),y=n(_),E=a(12),M=n(E),S=a(249),C=n(S),b=a(489),k=n(b),T=a(35),w=n(T),N=a(1435),P=n(N),A=a(465),O=n(A),R=a(116),D=n(R),x=a(160),I=n(x),L=a(239),F=320,U=50,j=10,G=500,B=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={email:"",emailError:void 0,confirmEmail:"",confirmEmailError:void 0,subject:I["default"].t("send_logs_default_subject"),subjectError:void 0,description:"",descriptionError:void 0},n.onSend=function(){var e={},t=n.state.email.trim(),a=n.state.confirmEmail.trim();if(n.validateEmail(t)||(e.emailError=I["default"].t("send_logs_email_invalid")),n.validateConfirmEmail(a)||(e.confirmEmailError=I["default"].t("send_logs_email_nomatch")),n.validateDescription(n.state.description)||(e.descriptionError=I["default"].t("send_logs_too_short")),n.validateSubject(n.state.subject)||(e.subjectError=I["default"].t("send_logs_subject_error")),g["default"].isEmpty(e)){n.setState({email:t,confirmEmail:a,emailError:void 0,confirmEmailError:void 0,descriptionError:void 0,subjectError:void 0});var i=Store.Conn.me?k["default"].format(Store.Conn.me.split("@")[0]):null,o=n.state.subject.trim()||I["default"].t("send_logs_default_subject");w["default"].uploadUserReport(i,t,o,n.state.description),M["default"].closeModal(),M["default"].openToast(m["default"].createElement(O["default"],{msg:I["default"].t("send_logs_sent"),id:O["default"].genId()}))}else e.email=t,e.confirmEmail=a,n.setState(e)},n.onCancel=function(){M["default"].closeModal()},n.onSubjectChange=function(e){var t={subject:e,subjectError:n.state.subjectError};n.state.subjectError&&n.validateSubject(t.subject)&&(t.subjectError=void 0),n.setState(t)},n.onSubjectBlur=function(){var e=void 0;n.validateSubject(n.state.subject)||(e=I["default"].t("send_logs_subject_error")),n.state.subjectError!==e&&n.setState({subjectError:e})},n.onDescriptionChange=function(e){var t={description:e,descriptionError:n.state.descriptionError};n.state.descriptionError&&n.validateDescription(t.description)&&(t.descriptionError=void 0),n.setState(t)},n.onDescriptionBlur=function(){var e=void 0;!n.state.description&&!n.state.descriptionError||n.validateDescription(n.state.description)||(e=I["default"].t("send_logs_too_short")),n.state.descriptionError!==e&&n.setState({descriptionError:e})},n.onEmailChange=function(e){var t={email:e,emailError:n.state.emailError};n.state.emailError&&n.validateEmail(t.email)&&(t.emailError=void 0),n.setState(t)},n.onEmailBlur=function(){var e=void 0,t=n.state.email.trim(),a={};!n.state.email&&!n.state.emailError||n.validateEmail(t)||(e=I["default"].t("send_logs_email_invalid")),n.state.emailError!==e&&(a.emailError=e),n.state.email!==t&&(a.email=t),g["default"].isEmpty(a)||n.setState(a)},n.onConfirmEmailChange=function(e){var t={confirmEmail:e,confirmEmailError:n.state.confirmEmailError};n.state.confirmEmailError&&n.validateConfirmEmail(t.confirmEmail)&&(t.confirmEmailError=void 0),n.setState(t)},n.onConfirmEmailBlur=function(){var e=void 0,t=n.state.confirmEmail.trim(),a={};!n.state.confirmEmail&&!n.state.confirmEmailError||n.validateConfirmEmail(t)||(e=I["default"].t("send_logs_email_nomatch")),n.state.confirmEmailError!==e&&(a.confirmEmailError=e),n.state.confirmEmail!==t&&(a.confirmEmail=t),g["default"].isEmpty(a)||n.setState(a)},n.validateEmail=function(e){return C["default"].validateEmail(e)},n.validateConfirmEmail=function(e){return n.state.email===e},n.validateDescription=function(e){return e.length>j},n.validateSubject=function(e){return!0},n.stopPropagation=function(e){e.stopPropagation()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){this.emailAddr&&this.emailAddr.restoreFocus()}},{key:"render",value:function(){var e={enter:this.stopPropagation};return m["default"].createElement(y["default"],{title:I["default"].t("send_logs_title"),okText:I["default"].t("send_logs_confirm"),onOK:this.onSend,onCancel:this.onCancel},m["default"].createElement(D["default"],{handlers:e},m["default"].createElement(P["default"],{className:"send-logs-input",ref:(0,L.GetRef)("emailAddr",this),value:this.state.email,error:this.state.emailError,maxLength:F,onChange:this.onEmailChange,onBlur:this.onEmailBlur,placeholder:I["default"].t("send_logs_email_address")}),m["default"].createElement(P["default"],{className:"send-logs-input",editable:!0,value:this.state.confirmEmail,error:this.state.confirmEmailError,maxLength:F,onChange:this.onConfirmEmailChange,onBlur:this.onConfirmEmailBlur,placeholder:I["default"].t("send_logs_email_confirm")}),m["default"].createElement(P["default"],{className:"send-logs-input",value:this.state.subject,error:this.state.subjectError,maxLength:U,onChange:this.onSubjectChange,onBlur:this.onSubjectBlur,placeholder:I["default"].t("send_logs_email_subject")}),m["default"].createElement(P["default"],{className:"send-logs-input",value:this.state.description,error:this.state.descriptionError,maxLength:G,onChange:this.onDescriptionChange,onBlur:this.onDescriptionBlur,placeholder:I["default"].t("describe_logs"),multiline:!0})))}}]),t}(m["default"].Component);t["default"]=B},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(1405),m=n(h),v=a(1407),g=n(v),_=a(1406),y=n(_),E=a(1430),M=n(E),S=a(1459),C=n(S),b=a(1446),k=(n(b),a(78)),T=n(k),w=a(1403),N=n(w),P=a(5),A=a(160),O=a(1409),R=a(14),D=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.status=window.Store.Status.gaddUp(n.props.profileId),i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.props.listeners.add(this.status,"change:status")}},{key:"render",value:function(){var e=R.STATUS_V2?P.createElement("div",{className:"chat-status"},P.createElement("span",{className:"emojitext ellipsify",dir:"auto"},P.createElement(N["default"],{text:this.status.status||A.t("contact_status_loading"),direction:"auto"}))):null;return P.createElement(m["default"],{className:"drawer-settings",onCancel:this.props.onClose},P.createElement(g["default"],{title:A.t("settings_flow_title"),onBack:this.props.onClose,type:v.DRAWER_HEADER_TYPE.LARGE}),P.createElement(y["default"],null,P.createElement("div",{className:"chatlist list-identity"},P.createElement("div",{className:"chat",onClick:this.props.onProfile,"data-ignore-capture":"any"},P.createElement("div",{className:"chat-avatar"},P.createElement(O,{id:window.Store.Conn.me,size:82,quality:O.Quality.HIGH})),P.createElement("div",{className:"chat-body"},P.createElement("div",{className:"chat-main"},P.createElement("div",{className:"chat-title"},P.createElement("span",{className:"emojitext ellipsify",dir:"auto"},P.createElement(N["default"],{text:window.Store.Conn.pushname,direction:"auto"})))),e))),P.createElement(C["default"],null,P.createElement(M["default"],{a8n:"li-notifications",iconClass:"icon-settings-notifications",onClick:this.props.onNotifications},A.t("menuitem_notifications")),P.createElement(M["default"],{a8n:"li-chat_wallpaper",iconClass:"icon-settings-wallpaper",onClick:this.props.onWallpaper},A.t("menuitem_wallpaper")),P.createElement(M["default"],{a8n:"li-blocked",iconClass:"icon-settings-blocked",onClick:this.props.onBlocked},A.t("menuitem_blocked")),P.createElement(M["default"],{a8n:"li-help",iconClass:"icon-settings-help",onClick:this.props.onHelp},A.t("menuitem_help")))))}}]),t}(P.Component);t["default"]=(0,T["default"])(D)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(467),g=n(v),_=a(1408),y=n(_),E=a(13),M=n(E),S=a(1506),C=n(S),b=a(1475),k=n(b),T=a(240),w=n(T),N=a(1429),P=n(N),A=a(1473),O=n(A),R=a(115),D=n(R),x=a(472),I=a(21),L=n(I),F=a(160),U=n(F),j=a(462),G=(n(j),a(239)),B=function(e){function t(){(0,s["default"])(this,t);var e=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments));return e.onReplyCaptionChange=function(t){e.setState({replyCaption:t})},e.onSend=function(t){if(t.preventDefault(),e.state.replyCaption){var a=e.state.replyCaption.trim();a.length&&(Store.Chat.find(e.props.msg.sender).then(function(t){t.sendMessage(g["default"].emojify(a),{},e.props.msg)}),e.setState({replyCaption:""}),e.props.dismissReply())}},e.onFocus=function(t){e.setState({focused:!0})},e.onBlur=function(t){e.setState({focused:!1}),console.log("compose box blur")},e.isFocused=function(){return e.state.focused},e.onEmojiPicker=function(t){t&&(t.preventDefault(),t.stopPropagation());var a=m["default"].createElement(k["default"],{onEmoji:e.onEmoji,onFocusRelease:e.restoreFocus});e.setState({emojiPicker:{menu:a,dirY:x.DirY.TOP,type:"emoji_picker",anchor:t.target}})},e.onEmoji=function(t){e.inputLine.restoreFocus(!1),e.inputLine.replaceSelection(t)},e.restoreFocus=function(){e.inputLine&&e.inputLine.restoreFocus()},e.restoreEmojiPickerFocus=function(){e.refs.emojiPickerUIE&&e.refs.emojiPickerUIE.getRef()&&e.refs.emojiPickerUIE.getRef().getElement()&&e.refs.emojiPickerUIE.getRef().getElement().component.restoreFocus()},e.emojiPickerClose=function(){e.setState({emojiPicker:void 0})},e.state={replyCaption:"",focused:!1,emojiPicker:void 0,chat:void 0},Store.Chat.find(e.props.msg.sender).checkpoint(e.props.rejectOnUnmount()).then(function(t){e.setState({chat:t})}),e}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidUpdate",value:function(e,t){this.shouldPausePlayback(t)&&!this.shouldPausePlayback(this.state)?this.props.playbackController.resume():!this.shouldPausePlayback(t)&&this.shouldPausePlayback(this.state)&&this.props.playbackController.pause()}},{key:"shouldPausePlayback",value:function(e,t){return e.emojiPicker||e.focused}},{key:"render",value:function(){var e=(0,L["default"])("status-v3-compose-box-wrapper",{focused:this.state.focused}),t=void 0;M["default"].isEmpty(this.state.replyCaption)&&(t=U["default"].t("type_a_reply"));var a=void 0,n=void 0;this.state.emojiPicker&&(a=m["default"].createElement(w["default"],{displayName:"EmojiPicker",escapable:!0,popable:!0,ref:"emojiPickerUIE",requestDismiss:this.emojiPickerClose,requestFocus:this.restoreEmojiPickerFocus},m["default"].createElement(P["default"],{contextMenu:this.state.emojiPicker})),n=m["default"].createElement(w["default"],{displayName:"EmojiPicker",escapable:!0,requestFocus:this.restoreEmojiPickerFocus},m["default"].createElement("div",null,a)));var i=void 0;return this.state.chat&&this.state.focused&&!this.state.emojiPicker&&(i=m["default"].createElement(w["default"],{displayName:"StatusV3Reply",escapable:!0,requestDismiss:this.props.dismissReply},m["default"].createElement("div",{className:"compose-popup-panel"},m["default"].createElement(O["default"],{msg:this.props.msg,key:this.props.msg.id.toString(),chat:this.state.chat})))),m["default"].createElement("div",null,m["default"].createElement(D["default"],{transitionName:"status-v3-quoted-msg",transitionAppear:!0},i),m["default"].createElement("div",{className:e},m["default"].createElement("button",{className:"icon icon-emoji icon-status-v3-smiley",onClick:this.onEmojiPicker}),m["default"].createElement("div",{className:"status-v3-input-line-wrapper"},m["default"].createElement(C["default"],{ref:(0,G.GetRef)("inputLine",this),value:this.state.replyCaption,className:"input-text",spellCheck:!0,onFocus:this.onFocus,onBlur:this.onBlur,onChange:this.onReplyCaptionChange,onEnter:this.onSend,editable:!0,focusOnMount:!1,focusOnChange:!1}),m["default"].createElement("span",{className:"status-v3-input-placeholder"},t)),m["default"].createElement("button",{className:"icon btn-icon icon-send-light",onClick:this.onSend}),n))}}]),t}(m["default"].Component);t["default"]=(0,y["default"])(B)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(81),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(1493),y=n(_),E=a(1713),M=n(E),S=a(1420),C=(n(S),a(462)),b=(n(C),a(78)),k=n(b),T=a(1528),w=n(T),N=a(160),P=n(N),A=a(79),O=n(A),R=a(1),D=n(R),x=a(13),I=n(x),L=a(21),F=n(L),U=0,j=1,G=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),n.state={statusList:[].concat((0,o["default"])(n.getStatusList(!0)),(0,o["default"])(n.getStatusList(!1))),myStatus:Store.StatusV3.getMyStatus()},n.getSections=function(){var e=[U];return n.state.statusList.length&&e.push(j),e},n.numberOfSections=function(){return n.getSections().length},n.numberOfRowsInSection=function(e){var t=n.getSections();switch(t[e]){case U:return 1;case j:return n.state.statusList.length;default:D["default"].error("Unknown section "+t[e])()}},n.sectionForSection=function(e){var t=n.getSections();switch(t[e]){case U:return;case j:return g["default"].createElement("div",{className:"status-v3-list-section-sep"},g["default"].createElement("hr",null),g["default"].createElement("div",{className:"status-v3-list-section-text"},g["default"].createElement("span",null,P["default"].t("status_v3_updates"))))}},n.heightForItem=function(e){var t=e.section,a=n.getSections();switch(a[t]){case U:return 122;case j:return 64}return 0},n.heightForSection=function(e){var t=n.getSections();switch(t[e]){case j:return 42;case U:return 0}},n.keyForRowAtIndexPath=function(e){var t=e.row,a=e.section,i=n.getSections();switch(i[a]){case U:return"STATUS_V3_HEADER "+(n.state.myStatus?n.state.myStatus.t:"");case j:return n.state.statusList[t].id}},n.itemForRowAtIndexPath=function(e){var t=e.row,a=e.section,i=n.getSections();switch(i[a]){case U:var o=void 0,r=void 0;n.state.myStatus?(r=g["default"].createElement("span",{className:"secondary"},O["default"].relativeDateAndTimeStr(n.state.myStatus.t)),o=g["default"].createElement(w["default"],{statusV3:n.state.myStatus,onClick:function(){n.props.onOpenStatus(n.state.myStatus,n.state.myStatus.msgs.at(0))}})):o=g["default"].createElement("button",{className:"icon icon-status-v3-create-l"});var s=g["default"].createElement("div",{className:"status-v3-list-panel-header"},g["default"].createElement("div",{className:"status-v3-list-panel-header-buttons-primary"},o),g["default"].createElement("div",{className:"status-v3-list-panel-header-text"},g["default"].createElement("span",{className:"primary"},P["default"].t("status_v3_my_status")),r),g["default"].createElement("div",{className:"status-v3-list-panel-header-buttons-secondary"},g["default"].createElement("button",{className:"icon icon-status-v3-create"}),g["default"].createElement("button",{className:"icon icon-menu-white"})));return s;case j:var l=function(){var e=n.state.statusList[t],a=(0,F["default"])({dimmed:0===e.unreadCount}),i=g["default"].createElement("div",{className:a},g["default"].createElement(M["default"],{statusV3:e,onClick:function(){return n.props.onOpenStatus(e)},contact:e.contact}));return{v:i}}();if("object"==typeof l)return l.v}},n.onStatusAddRemove=function(){n.setState({statusList:I["default"].concat(n.getStatusList(!0),n.getStatusList(!1)),myStatus:Store.StatusV3.getMyStatus()})},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){this.props.listeners.add(Store.StatusV3,"add remove change:unreadCount change:expiredCount",this.onStatusAddRemove)}},{key:"getStatusList",value:function(e){return Store.StatusV3.getUnexpired(e)}},{key:"render",value:function(){return g["default"].createElement("div",{className:"status-v3-list-panel","data-list-scroll-container":!0},g["default"].createElement("div",{className:"status-v3-list-body"},g["default"].createElement(y["default"],{className:"statuslist",itemForRowAtIndexPath:this.itemForRowAtIndexPath,keyForRowAtIndexPath:this.keyForRowAtIndexPath,sectionForSection:this.sectionForSection,numberOfRowsInSection:this.numberOfRowsInSection,numberOfSections:this.numberOfSections,heightForSection:this.heightForSection,heightForItem:this.heightForItem})))}}]),t}(g["default"].Component);t["default"]=(0,k["default"])(G)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(1680),m=n(h),v=a(1682),g=n(v),_=a(1420),y=(n(_),a(462)),E=(n(y),a(78)),M=n(E),S=a(5),C=function(e){function t(e){(0,s["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));return a.onStatusAddRemove=function(){a.setState({status:Store.StatusV3.getMyStatus()})},a.state={status:Store.StatusV3.getMyStatus()},a}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"shouldComponentUpdate",value:function(e,t){return t.status!==this.state.status}},{key:"componentWillMount",value:function(){this.props.listeners.add(Store.StatusV3,"add remove change:unreadCount",this.onStatusAddRemove)}},{key:"render",value:function(){var e=this,t=this.props.onOpenStatus;return S.createElement("div",{className:"status-v3-modal-background"},S.createElement("div",{className:"status-v3-main-wrapper"},S.createElement(m["default"],{onOpenStatus:t}),S.createElement(g["default"],{status:this.state.status,onOpenStatus:t}),S.createElement("button",{className:"icon icon-status-v3-x",onClick:function(){return e.props.closeStatusViewer(!0)}})))}}]),t}(S.Component);t["default"]=(0,M["default"])(C)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(160),m=n(h),v=a(13),g=n(v),_=a(14),y=n(_),E=a(1420),M=(n(E),a(462)),S=n(M),C=a(78),b=n(C),k=a(1408),T=n(k),w=a(79),N=n(w),P=a(5),A=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=void 0;return this.props.status&&(e=P.createElement(R,{statusV3:this.props.status,onOpenStatus:this.props.onOpenStatus})),P.createElement("div",{className:"status-v3-out-status-panel"},P.createElement("div",{className:"status-v3-update-wrapper"},P.createElement("div",{className:"status-v3-update-title"},m["default"].t("status_v3_update_status")),P.createElement("div",{className:"status-v3-upload-buttons"},P.createElement("div",{className:"status-v3-button-container"},P.createElement("button",{className:"icon icon-status-v3-upload"}),P.createElement("p",null,m["default"].t("status_v3_upload"))),P.createElement("div",{className:"status-v3-button-container"},P.createElement("button",{className:"icon icon-status-v3-camera"}),P.createElement("p",null,m["default"].t("status_v3_camera"))))),P.createElement("hr",null),e)}}]),t}(P.Component),O=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.props.listeners.add(this.props.statusV3.msgs,"add remove bulk_add"),this.props.listeners.add(this.props.statusV3.msgs,"change:last")}},{key:"render",value:function(){var e=this,t=void 0,a=this.props.statusV3;if(a&&a.msgs){var n=g["default"].reverse(g["default"].takeRight(a.msgs.models,a.totalCount));t=g["default"].map(n,function(t){return P.createElement(x,{key:t.id,msg:t,status:a,onOpenStatus:e.props.onOpenStatus})})}return P.createElement("div",{className:"status-v3-view-wrapper"},P.createElement("div",{className:"status-v3-view-title"},m["default"].t("status_v3_view_status")),P.createElement("div",{className:"status-v3-view-updates"
},t))}}]),t}(P.Component),R=(0,b["default"])(O),D=function(e){function t(){(0,s["default"])(this,t);var e=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments));return e.state={},e}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){var e=this;Store.MsgInfo.find(this.props.msg.id).checkpoint(this.props.rejectOnUnmount).then(function(t){e.props.listeners.add(t.read,"add remove",function(){e.setState({seenCount:t.read.length})}),e.setState({seenCount:t.read.length})})}},{key:"render",value:function(){var e=this,t=this.props,a=t.msg,n=t.status,i=a.mediaData,o=void 0;if(i&&i.preview)o={backgroundImage:"url("+i.preview.url()+")"};else if(a.type===S["default"].TYPE.CHAT){for(var r=a.id.toString(),s=0,l=0;l<r.length;++l)s+=r.charCodeAt(l);var u=y["default"].STATUS_V3_TEXT_BACKGROUND_COLORS,c=u.length;s=(s%c+c)%c,o={backgroundColor:u[s]}}return P.createElement("div",{className:"status-v3-out-detail"},P.createElement("div",{className:"status-image",style:o,onClick:function(){return e.props.onOpenStatus(n,a)}}),P.createElement("div",{className:"status-v3-seen"},P.createElement("button",{className:"icon icon-status-v3-seen"}),P.createElement("div",{className:"status-v3-seen-count"},this.state.seenCount)),P.createElement("div",{className:"status-v3-timestamp"},N["default"].relativeDateAndTimeStr(a.t)))}}]),t}(P.Component),x=(0,T["default"])((0,b["default"])(D));t["default"]=A},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1402),g=n(v),_=a(239),y=a(14),E=n(y),M=a(1679),S=n(M),C=a(1423),b=n(C),k=a(1471),T=n(k),w=a(1403),N=n(w),P=a(1717),A=n(P),O=a(1716),R=a(116),D=n(R),x=a(161),I=n(x),L=a(1418),F=n(L),U=a(462),j=n(U),G=a(1420),B=(n(G),a(1404)),V=(n(B),a(46)),H=a(21),W=a(1409),z=a(240),Y=a(96),q=a(242),K=a(79),Q=a(1),X=function(e){function t(){(0,s["default"])(this,t);var e=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments));e.onTab=function(t){if(t&&(t.stopPropagation(),t.preventDefault()),!e.props.statusV3.contact.isMe){var a=e.composeBox;a.isFocused()?e.dismissReply():e.startReply()}},e.dismissReply=function(){var t=V.findDOMNode(e.refs.wrapper);t.focus()},e.startReply=function(){var t=e.composeBox;t.restoreFocus()},e.state={chat:void 0};var a=e.props.mediaData;return a?a.type===q.TYPE.IMAGE?e.playbackController=new O.StatusV3CountdownController(3750):a.type===q.TYPE.VIDEO&&(e.props.msg.isGif?e.playbackController=new O.StatusV3GifController:e.playbackController=new O.StatusV3VideoController):e.props.msg.type===j["default"].TYPE.CHAT&&(e.playbackController=new O.StatusV3CountdownController(3750)),e}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){var e=this,t=this.refs.progressBar;this.playbackController.addListeners(t.onStart.bind(t),t.onPause.bind(t),function(){t.onEnded()["finally"](function(){e.props.onNext()})});var a=this.props.mediaData;a&&a.mediaStage===q.STAGE.RESOLVED?(this.playbackController.play(),this.props.markRead(this.props.statusV3,this.props.msg)):this.props.msg.type===j["default"].TYPE.CHAT&&(this.playbackController.play(),this.props.markRead(this.props.statusV3,this.props.msg));var n=V.findDOMNode(this.refs.wrapper);n.focus()}},{key:"render",value:function(){var e,t=this,a=this.props,n=a.msg,i=a.mediaData,o=a.statusV3;if(i&&i.preview)e={backgroundImage:"url("+i.preview.url()+")"};else if(n.type===j["default"].TYPE.CHAT){for(var r=n.id.toString(),s=0,l=0;l<r.length;++l)s+=r.charCodeAt(l);var u=E["default"].STATUS_V3_TEXT_BACKGROUND_COLORS,c=u.length;s=(s%c+c)%c,e={backgroundColor:u[s]}}var d;if(i)switch(i.type){case q.TYPE.IMAGE:d=m["default"].createElement(J,{ref:"media",msg:n,statusV3:o,mediaData:i,markRead:this.props.markRead,playbackController:this.playbackController});break;case q.TYPE.VIDEO:d=m["default"].createElement(ee,{ref:"media",msg:n,statusV3:o,mediaData:i,markRead:this.props.markRead,playbackController:this.playbackController});break;default:Q.error("Invalid status v3 image type: "+i.type)()}else n.type===j["default"].TYPE.CHAT&&(d=m["default"].createElement(te,{ref:"media",msg:n,statusV3:o,markRead:this.props.markRead,playbackController:this.playbackController}));var f=m["default"].createElement(A["default"],{ref:"progressBar",current:this.props.msgIdx,total:this.props.totalMsgs}),p=m["default"].createElement(N["default"],{ref:"caption",className:"media-caption",text:n.caption}),h=function(e){e||t.props.closeStatusViewer()},v=H("status-v3-profile",{}),g=m["default"].createElement("div",{className:v},m["default"].createElement("button",{className:"icon icon-back-light",onClick:function(){return t.props.closeStatusViewer()}}),m["default"].createElement(W,{id:o.contact.id,size:40}),m["default"].createElement("div",{className:"status-v3-msg-info"},m["default"].createElement(N["default"],{text:o.contact.formattedName}),m["default"].createElement("div",{className:"status-v3-timestamp"},K.relativeDateAndTimeStr(n.t)))),y=m["default"].createElement("button",{className:"icon icon-status-v3-x",onClick:function(){return t.props.closeStatusViewer(!0)}}),M={tab:this.onTab,"shift+tab":this.onTab},C=function(e){return e.stopPropagation()},b={left:C,right:C},k=void 0;i&&(k=m["default"].createElement(ne,{mediaData:i}));var T=void 0;this.props.statusV3.contact.isMe||(T=m["default"].createElement(D["default"],{handlers:b},m["default"].createElement(S["default"],{msg:this.props.msg,dismissReply:this.dismissReply,playbackController:this.playbackController,ref:(0,_.GetRef)("composeBox",this)})));var w=H("status-v3-player-background",{media:i});return m["default"].createElement(z,{displayName:"StatusV3Player",escapable:!0,requestDismiss:h,requestFocus:this.dismissReply},m["default"].createElement(D["default"],{handlers:M},m["default"].createElement("div",{className:"status-v3-player-wrapper",key:n.id,tabIndex:-1,ref:"wrapper"},g,y,m["default"].createElement("div",{className:"progress-bar-backdrop"}),f,m["default"].createElement("div",{className:"caption-backdrop"},p),m["default"].createElement("div",{className:w,style:e}),d,k,T)))}}]),t}(m["default"].Component);X.contextTypes={uim:m["default"].PropTypes.instanceOf(Y)};var Z=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props.mediaData;e.mediaStage!==q.STAGE.RESOLVED&&this.props.msg.forceDownloadMedia()}},{key:"componentDidUpdate",value:function(){var e=this.props.mediaData;e.mediaStage===q.STAGE.RESOLVED&&(this.props.playbackController.play(),this.props.markRead(this.props.statusV3,this.props.msg))}},{key:"componentWillUnmount",value:function(){this.props.playbackController.stop()}},{key:"render",value:function(){var e=this.props.mediaData,t=e.mediaStage!==q.STAGE.RESOLVED,a=H("status-v3-player-content",{loading:t});return e.mediaStage===q.STAGE.RESOLVED?m["default"].createElement("div",{className:a},m["default"].createElement(F["default"],{type:L.FIT_TYPE.CONTAIN,size:{width:e.fullWidth,height:e.fullHeight}},m["default"].createElement(b["default"],{src:e.renderableUrl}))):m["default"].createElement("div",{className:a},m["default"].createElement(F["default"],{type:L.FIT_TYPE.CONTAIN,size:{width:e.aspectRatio,height:1}},m["default"].createElement(b["default"],{src:e.preview.url()})))}}]),t}(m["default"].PureComponent);Z.CONCERNS={mediaData:["mediaStage","renderableUrl","preview","fullWidth","fullHeight","aspectRatio"]};var J=(0,g["default"])(Z),$=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props.mediaData;e.mediaStage!==q.STAGE.RESOLVED&&this.props.msg.forceDownloadMedia()}},{key:"componentDidUpdate",value:function(){var e=this.props.mediaData;e.mediaStage===q.STAGE.RESOLVED&&(this.props.playbackController.play(),this.props.markRead(this.props.statusV3,this.props.msg))}},{key:"componentWillUnmount",value:function(){this.props.playbackController.stop()}},{key:"render",value:function(){var e=this.props.mediaData,t=e.mediaStage!==q.STAGE.RESOLVED,a=H("status-v3-player-content",{loading:t}),n=e.preview?e.preview.url():void 0;return m["default"].createElement("div",{className:a},m["default"].createElement(T["default"],{msg:this.props.msg,mediaData:this.props.mediaData,ref:"player",poster:n}))}},{key:"componentDidMount",value:function(){var e=V.findDOMNode(this.refs.player),t=this.props.playbackController;t.setVideo(e)}}]),t}(m["default"].PureComponent);$.CONCERNS={mediaData:["preview","mediaStage"]};var ee=(0,g["default"])($),te=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillUnmount",value:function(){this.props.playbackController.stop()}},{key:"render",value:function(){return m["default"].createElement("div",{className:"status-v3-player-content"},m["default"].createElement("div",{className:"status-v3-text"},this.props.msg.body))}}]),t}(m["default"].PureComponent),ae=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props.mediaData,t=e.mediaStage!==q.STAGE.RESOLVED;return t?m["default"].createElement("div",{className:"media-state-controls"},m["default"].createElement("button",{className:"icon-media icon-media-disabled"},m["default"].createElement(I["default"],{size:50,stroke:4}))):null}}]),t}(m["default"].Component);ae.CONCERNS={mediaData:["mediaStage"]};var ne=(0,g["default"])(ae);e.exports=X},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(115),g=n(v),_=a(1),y=n(_),E=a(116),M=n(E),S=a(1683),C=n(S),b=a(1420),k=(n(b),a(462)),T=(n(k),a(13)),w=a(242),N=function(e){function t(){(0,s["default"])(this,t);var e=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments));e.preloadNextStatus=function(){var t=e.getNext();if(t){var a=e.statusSnapshot[t.statusIdx],n=a.msgs[t.msgIdx],i=n.mediaData;i&&i.mediaStage!==w.STAGE.RESOLVED&&n.forceDownloadMedia()}},e.getStatusSnapshot=function(e){if(!(e.unreadCount>0)||e.contact.isMe){var t=T.takeRight(e.msgs.models,e.totalCount),a=T.map(t,function(e){return e.id}),n=[{statusV3:e,msgs:t,readMsgKeys:a}];return n}var i=function(){var e=Store.StatusV3.getUnexpired(!0),t=[];return T.forEach(e,function(e){var a=e.totalCount-e.expiredCount,n=T.takeRight(e.msgs.models,a),i=T.take(n,a-e.unreadCount),o=T.map(i,function(e){return e.id});t.push({statusV3:e,msgs:n,readMsgKeys:o})}),{v:t}}();return"object"==typeof i?i.v:void 0},e.getFirstUnread=function(t,a,n){var i=T.findIndex(e.statusSnapshot,{statusV3:t});if(-1===i)return y["default"].error("StatusV3 object not found in playback session")(),null;var o=function(){var t=e.statusSnapshot[i],o=t.readMsgKeys,r=void 0;return r=n?T.findIndex(t.msgs,function(e){return e===n}):T.findIndex(t.msgs,function(e){return-1===o.indexOf(e.id)}),-1===r&&(r=a?0:t.msgs.length-1),{v:{statusIdx:i,msgIdx:r}}}();return"object"==typeof o?o.v:void 0},e.markRead=function(t,a){t.sendReadStatus(a.id,a.author);var n=T.find(e.statusSnapshot,{statusV3:t});n&&n.readMsgKeys.push(a.id)},e.getNext=function(){var t=e.statusSnapshot[e.state.statusIdx];if(e.state.msgIdx+1<t.msgs.length)return{statusIdx:e.state.statusIdx,msgIdx:e.state.msgIdx+1};if(e.state.statusIdx+1<e.statusSnapshot.length){var a=e.statusSnapshot[e.state.statusIdx+1],n=e.getFirstUnread(a.statusV3,!0);return n}return null},e.onNext=function(){var t=e.getNext();t?e.setState(t):e.props.closeStatusViewer()},e.getPrev=function(){if(e.state.msgIdx>0)return{statusIdx:e.state.statusIdx,msgIdx:e.state.msgIdx-1};if(e.state.statusIdx>0){var t=e.statusSnapshot[e.state.statusIdx-1],a=e.getFirstUnread(t.statusV3,!1);return a}return null},e.onPrev=function(){var t=e.getPrev();t&&e.setState(t)},e.statusSnapshot=e.getStatusSnapshot(e.props.initialStatusV3);var a=e.getFirstUnread(e.props.initialStatusV3,!0,e.props.initialStatusMsg);return a?e.state=a:y["default"].error("Status viewer initialization failed: getFirstUnread for initial status v3 returned null"),e}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){this.preloadNextStatus()}},{key:"componentDidUpdate",value:function(){this.preloadNextStatus()}},{key:"render",value:function(){var e=this,t=this.statusSnapshot[this.state.statusIdx],a=t.statusV3,n=t.msgs[this.state.msgIdx],i=void 0,o=void 0;this.getPrev()&&(i=m["default"].createElement("button",{className:"icon icon-chevron-left"}),o=m["default"].createElement("div",{className:"icon-chevron-left-bg",onClick:this.onPrev}));var r=void 0,s=void 0;this.getNext()&&(r=m["default"].createElement("button",{className:"icon icon-chevron-right"}),s=m["default"].createElement("div",{className:"icon-chevron-right-bg",onClick:function(){e.onNext(),e.markRead(a,n)}}));var l={left:this.onPrev,right:this.onNext};return m["default"].createElement(M["default"],{handlers:l},m["default"].createElement("div",{className:"status-v3-viewer"},o,i,s,r,m["default"].createElement(g["default"],{transitionName:"status-v3-player",transitionAppear:!0},m["default"].createElement("div",{className:"status-v3-player-container",key:a.id},m["default"].createElement(C["default"],{key:n.id,statusV3:a,msg:n,mediaData:n.mediaData,msgIdx:this.state.msgIdx,totalMsgs:t.msgs.length,markRead:this.markRead,closeStatusViewer:this.props.closeStatusViewer,onNext:this.onNext,onPrev:this.onPrev})))))}}]),t}(m["default"].Component);e.exports=N},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(12),g=n(v),_=a(23),y=n(_),E=a(78),M=n(E);t["default"]=(0,M["default"])(function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.close=function(){0===Store.Conn.tos&&g["default"].closeModal()},n.logout=function(){g["default"].closeModal(),y["default"].logout()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){this.props.listeners.add(Store.Conn,"change:tos",this.close)}},{key:"render",value:function(){var e,t=null;switch(Store.Conn.tos){default:case 1:e=l10n.t("web_terms_of_service_1"),t=m["default"].createElement("div",{className:"popup-controls"},m["default"].createElement("button",{className:"btn-plain btn-default popup-controls-item",onClick:g["default"].closeModal.bind(g["default"])},l10n.t("ok_got_it")));break;case 2:e=l10n.t("web_terms_of_service_2"),t=m["default"].createElement("div",{className:"popup-controls"},m["default"].createElement("button",{className:"btn-plain popup-controls-item",onClick:this.logout},l10n.t("menuitem_logout")))}return m["default"].createElement("div",{className:"backdrop"},m["default"].createElement("div",{className:"popup-container"},m["default"].createElement("div",{className:"popup"},m["default"].createElement("div",{className:"popup-body"},m["default"].createElement("div",{className:"popup-contents"},e)),t)))}}]),t}(m["default"].Component))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1404),g=(n(v),a(462)),_=(n(g),a(12)),y=n(_),E=a(1403),M=n(E),S=a(238),C=n(S),b=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.onCancel=function(){y["default"].closeModal()},n.onUnstar=function(){var e=n.props.chat,t=n.props.msgs;e&&e.pendingAction++,Store.Chat.unstarAllMessages(t,e)["finally"](function(){e&&e.pendingAction--}),y["default"].closeModal()},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){return m["default"].createElement(C["default"],{onOK:this.onUnstar,okText:l10n.t("unstar_all_button"),onCancel:this.onCancel},m["default"].createElement("div",null,m["default"].createElement(M["default"],{text:l10n.t("unstar_all_confirm")})))}}]),t}(m["default"].Component);t["default"]=b},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(241),m=(n(h),a(1405)),v=n(m),g=a(1406),_=n(g),y=a(1407),E=n(y),M=a(116),S=n(M),C=a(160),b=n(C),k=a(1421),T=n(k),w=a(5),N=n(w),P=a(1479),A=n(P),O=a(469),R=n(O),D=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.contactList,n=t.onSend,i=t.onBack,o=t.chatName,r=1===a.length?b["default"].t("confirm_sending_contact",{chat:o}):b["default"].t("confirm_sending_contact_plural",{chat:o,count:a.length});return N["default"].createElement(T["default"],{type:k.BoxModalType},N["default"].createElement(v["default"],null,N["default"].createElement(E["default"],{title:r,type:y.DRAWER_HEADER_TYPE.POPUP,onBack:i}),N["default"].createElement(_["default"],null,N["default"].createElement(S["default"],null,N["default"].createElement("div",{className:"multi-vcard-dialog-body"},a.map(function(t,a){return e.renderVCard(R["default"].fromContactModel(t),a.toString())})))),N["default"].createElement("span",{className:"drawer-controls-container"},N["default"].createElement("div",{className:"drawer-controls-summary"},N["default"].createElement("button",{className:"btn btn-round btn-l btn-active",onClick:n},N["default"].createElement("span",{className:"icon icon-send-light"}))))))}},{key:"renderVCard",value:function(e,t){var a=R["default"].parse(e.vcard);return a?N["default"].createElement(A["default"],{key:t,parsedVCard:a,thumbnail:R["default"].thumbnail(e.vcard),className:"multi-vcard-dialog-contact"}):null}}]),t}(w.Component);t["default"]=D},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(1421),m=n(h),v=a(1405),g=n(v),_=a(1407),y=n(_),E=a(1406),M=n(E),S=a(1513),C=n(S),b=a(5),k=a(22),T=a(469),w=window._,N=window.l10n,P=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"renderContacts",value:function(){var e=this,t=w.filter(this.props.vCard.TEL,function(e){return e.properties.waid});return t.map(function(t){var a=k.numberToWid(w.first(t.properties.waid));return b.createElement(C["default"],{title:k.formattedUser(a),onClick:function(){return e.onSelect(a)},icon:b.createElement("span",{className:e.props.iconClass}),key:"vCard-"+t.index},T.getType(t))})}},{key:"onSelect",value:function(e){this.props.onSelect(e)}},{key:"render",value:function(){return b.createElement(m["default"],{type:h.BoxModalType},b.createElement(g["default"],null,b.createElement(y["default"],{onCancel:this.props.onCancel,type:_.DRAWER_HEADER_TYPE.POPUP,title:N.t("choose_phone_number")}),b.createElement(M["default"],null,b.createElement("div",{className:"chatlist column"},b.createElement("div",{className:"drawer-item-container-compact"},this.renderContacts())))))}}]),t}(b.Component);P.defaultProps={iconClass:"icon icon-chat",onCancel:w.noop,onSelect:w.noop},e.exports=P},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}function o(e){var t=e.visible,a=null;return t&&(a=Z["default"].createElement("div",{className:"verification-circle"},Z["default"].createElement("div",{className:"spinner"},Z["default"].createElement(te["default"],{size:40,stroke:4})))),a}function r(e){var t=e.binary,a=e.contact,n=e.visible,i=null;return n&&(i=Z["default"].createElement("div",{className:"verification-circle-container"},Z["default"].createElement(me,{visible:!!t,binary:t,contact:a}),Z["default"].createElement(o,{visible:!t}))),i}function s(e){var t=e.visible,a=null;return t&&(a=Z["default"].createElement("div",{className:"verification-checkmark-container"},Z["default"].createElement("div",{className:"verification-checkmark"},"âœ“ "))),a}function l(e){var t=e.visible,a=null;return t&&(a=Z["default"].createElement("div",{className:"verification-error-container"},Z["default"].createElement("div",{className:"verification-error"},"!"))),a}function u(e){var t=e.children;return Z["default"].createElement("div",{className:"error-banner"},t)}function c(e,t){var a=new Uint8Array(e),n=new Uint8Array(t),i=a.length,o=n.length;if(i!==o)return!1;for(var r=0;i>r;r++)if(a[r]!==n[r])return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0});var d=a(2),f=i(d),p=a(6),h=i(p),m=a(3),v=i(m),g=a(4),_=i(g),y=a(8),E=i(y),M=a(7),S=i(M),C=a(13),b=i(C),k=a(14),T=i(k),w=a(12),N=i(w),P=a(241),A=(i(P),a(1405)),O=i(A),R=a(1406),D=i(R),x=a(1431),I=i(x),L=a(15),F=i(L),U=a(1436),j=i(U),G=a(78),B=i(G),V=a(1),H=i(V),W=a(1408),z=i(W),Y=a(1399),q=i(Y),K=a(487),Q=i(K),X=a(5),Z=i(X),J=a(46),$=i(J),ee=a(161),te=i(ee),ae=a(1402),ne=i(ae),ie=a(117),oe=i(ie),re=a(96),se=i(re),le=a(1455),ue=i(le),ce=a(1448),de=n(ce),fe=a(1712),pe=a(239),he=function(e){function t(){var e,a,n,i;(0,v["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,E["default"])(this,(e=t.__proto__||(0,h["default"])(t)).call.apply(e,[this].concat(r))),n.stopPropagation=function(e){e.stopPropagation()},i=a,(0,E["default"])(n,i)}return(0,S["default"])(t,e),(0,_["default"])(t,[{key:"render",value:function(){return Z["default"].createElement("input",{accept:this.props.mime,type:"file",style:{display:"none"},onChange:this.props.onPick,onClick:this.stopPropagation})}}]),t}(Z["default"].Component),me=function(e){function t(){var e,a,n,i;(0,v["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,E["default"])(this,(e=t.__proto__||(0,h["default"])(t)).call.apply(e,[this].concat(r))),n.state={hover:!1,currentQRBinary:null,currentQRDataURL:null},n.onMouseOver=function(e){n.state.hover||n.setState({hover:!0})},n.onMouseEnter=function(e){n.state.hover||n.setState({hover:!0})},n.onMouseLeave=function(e){n.state.hover&&n.setState({hover:!1})},i=a,(0,E["default"])(n,i)}return(0,S["default"])(t,e),(0,_["default"])(t,[{key:"componentDidMount",value:function(){this.props.binary&&this.generateQRCode()}},{key:"componentDidUpdate",value:function(e,t){this.generateQRCode()}},{key:"shouldComponentUpdate",value:function(e,t){return!(this.compareBinary(e.binary,this.props.binary)&&this.compareBinary(t.currentQRBinary,this.state.currentQRBinary)&&e.visible===this.props.visible&&t.hover===this.state.hover&&t.currentQRDataURL===this.state.currentQRDataURL)}},{key:"fingerprintsMatched",value:function(e,t){return c(e.publicKey,t.publicKey)&&c(e.identifier,t.identifier)}},{key:"compareBinary",value:function(e,t){if(!e&&!t)return!0;var a=fe.CombinedFingerprint.parse(e),n=fe.CombinedFingerprint.parse(t);if(!a&&!n)return!0;if(!(a.version||n.version||a.localFingerprint||n.localFingerprint||a.remoteFingerprint||n.remoteFingerprint))return!0;if(a.version!==n.version)return!1;var i=this.fingerprintsMatched(a.localFingerprint,n.localFingerprint),o=this.fingerprintsMatched(a.remoteFingerprint,n.remoteFingerprint);return i&&o}},{key:"generateQRCode",value:function(){var e=$["default"].findDOMNode(this.refs.QRCodeContainer),t=this.props.binary;if(!e||!t)return void this.setState({currentQRBinary:null,currentQRDataURL:null});if(!this.compareBinary(this.state.currentQRBinary,t)){this.qr&&delete this.qr,this.qr=new Q["default"](e,{text:t,width:T["default"].QR_EDGE/2,height:T["default"].QR_EDGE/2,correctLevel:Q["default"].CorrectLevel.L}),this.setState({currentQRBinary:t});var a=e.getElementsByTagName("canvas")[0];if(!a)return void this.setState({currentQRDataURL:null});var n=a.toDataURL("image/png");this.setState({currentQRDataURL:n})}}},{key:"render",value:function(){var e=null;if(this.props.visible){var t=null;if(this.state.hover&&this.state.currentQRDataURL){var a=this.props.contact.formattedUser,n=Store.Contact.get(Store.Conn.me).formattedUser,i="Verification Code between "+n+" and "+a+".png";t=Z["default"].createElement("a",{href:this.state.currentQRDataURL,download:i},Z["default"].createElement("div",{className:"avatar-overlay",key:"avatar-overlay"},Z["default"].createElement("div",{className:"avatar-overlay-text"},l10n.t("web_verify_download_code"))))}e=Z["default"].createElement("div",{onMouseOver:this.onMouseOver,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},t,Z["default"].createElement("div",{className:"verification-circle",ref:"QRCodeContainer"}))}return e}}]),t}(Z["default"].Component);me.defaultProps={binary:null};var ve=3,ge=4,_e=5,ye=function(e){function t(){return(0,v["default"])(this,t),(0,E["default"])(this,(t.__proto__||(0,h["default"])(t)).apply(this,arguments))}return(0,S["default"])(t,e),(0,_["default"])(t,[{key:"shouldComponentUpdate",value:function(e){return e.string!==this.props.string}},{key:"numDigitsInVerificationString",value:function(){return ve*ge*_e}},{key:"render",value:function(){if(!this.props.string)return Z["default"].createElement("div",null,l10n.t("loading"));var e=this.props.string;if(e.length!==this.numDigitsInVerificationString())return H["default"].error("verificationString:render this.props.string"+("should be "+this.numDigitsInVerificationString()+" ")+("characters long instead of "+e.length+"."))(),Z["default"].createElement("div",null,l10n.t("web_verify_string_error"));for(var t=[],a=0;ve>a;a++){for(var n=[],i=0;ge>i;i++){for(var o=[],r=0;_e>r;r++){var s=e.charAt(a*_e*ge+i*_e+r);o.push(Z["default"].createElement("span",{className:"digit",key:r},s))}n.push(Z["default"].createElement("span",{className:"block",key:i},o," "))}t.push(Z["default"].createElement("div",{className:"code-row",key:a},n))}return Z["default"].createElement("div",{className:"textfield-static selectable-text"},t)}}]),t}(Z["default"].Component);ye.defaultProps={string:null};var Ee=200,Me=function(e){function t(){var e,a,n,i;(0,v["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,E["default"])(this,(e=t.__proto__||(0,h["default"])(t)).call.apply(e,[this].concat(r))),n.state={videoURL:window.URL.createObjectURL(n.props.stream)},n.onVideoLoaded=function(){n.captureInterval||(n.adjustOverlayPosition(),n.captureInterval=n.props.setInterval(n.capture,Ee))},n.capture=function(){if(n.verificationVideo){var e=n.verificationVideo.underlyingVideo();if(e){var t=document.createElement("canvas");t.width=e.videoWidth/2,t.height=e.videoHeight/2;var a=t.getContext("2d");a.drawImage(e,t.width/2,t.height/2,t.width,t.height,0,0,t.width,t.height),t.toBlob(function(e){var t=window.URL.createObjectURL(e);H["default"].log(t),n.props.onCapture(t)},"image/jpeg",1)}}},n.adjustOverlayPosition=function(){var e=n.verificationVideo.underlyingVideo(),t=$["default"].findDOMNode(n.refs.verificationOverlay);if(e&&t){var a=e.offsetHeight,i=e.offsetWidth,o=i/3,r=o,s=(i-o)/2,l=(a-r)/2;t.style.width=o+"px",t.style.height=r+"px",t.style.margin=l+"px "+s+"px"}},i=a,(0,E["default"])(n,i)}return(0,S["default"])(t,e),(0,_["default"])(t,[{key:"componentDidMount",value:function(){this.props.listeners.add(window,"resize",this.adjustOverlayPosition)}},{key:"componentWillUnmount",value:function(){if(this.captureInterval&&this.props.clearInterval(this.captureInterval),this.state.videoURL){var e=this.props.stream;de.stop(e),window.URL.revokeObjectURL(this.state.videoURL)}}},{key:"render",value:function(){var e=null;return this.state.videoURL&&(e=Z["default"].createElement("div",{className:"webcam"},Z["default"].createElement(ue["default"],{autoPlay:!0,ref:(0,pe.GetRef)("verificationVideo",this),onPlay:this.onVideoLoaded,src:this.state.videoURL}),Z["default"].createElement("div",{className:"overlay",ref:"verificationOverlay"}),Z["default"].createElement("button",{onClick:this.props.onClose},Z["default"].createElement("span",{className:"icon icon-x-alt"})))),e}}]),t}(Z["default"].Component),Se=(0,B["default"])((0,oe["default"])(Me)),Ce=3e3,be=5e3,ke=7e3,Te={CORRECT:0,PUBLIC_KEY_MISMATCHED:1,REMOTE_MISMATCHED:2,LOCAL_MISMATCHED:3,BOTH_MISMATCHED:4,INVALID_QR_CODE:5},we=function(e){function t(){var e,a,n,i;(0,v["default"])(this,t);for(var o=arguments.length,r=Array(o),s=0;o>s;s++)r[s]=arguments[s];return a=n=(0,E["default"])(this,(e=t.__proto__||(0,h["default"])(t)).call.apply(e,[this].concat(r))),n.state={circleVisible:!0,checkmarkVisible:!1,errorIconVisible:!1,webcamVisible:!1,bannerVisible:!1,bannerText:null,stream:null,isDragging:!1},n.onDragStart=function(){n.blockDrop=!0},n.onDragEnd=function(){n.blockDrop=!1},n.onDragOver=function(){n.state.isDragging||n.blockDrop||n.setState({isDragging:!0})},n.onDrop=function(e){n.blockDrop||(n.setState({isDragging:!1}),n.props.contact.verificationBinary&&n.props.contact.verificationString&&n.onUploadSelect(e))},n.onDragLeave=function(e){n.setState({isDragging:!1})},n.showWebcamHint=function(){n.state.webcamVisible&&!n.state.bannerVisible&&n.showBanner(l10n.t("web_verify_webcam_hint"))},n.onWebcamOpen=function(e){var t=de.start("camera");f["default"].race([t,n.props.rejectOnUnmount()]).checkpoint(n.props.rejectOnUnmount()).then(function(e){return n.showWebcamStream(e)})["catch"](F["default"].Unmount,function(){t.then(function(e){return de.stop(e)})["catch"](b["default"].noop)})["catch"](F["default"].GUM.PermissionDeniedError,function(){N["default"].openModal(Z["default"].createElement(j["default"],{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:j["default"].TYPE.GUIDE_UNBLOCK}))})["catch"](F["default"].GUM.GUMError,function(){N["default"].openModal(Z["default"].createElement(j["default"],{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:j["default"].TYPE.GUIDE_NONE}))})},n.onWebcamClose=function(){n.setState({webcamVisible:!1,bannerVisible:!1,stream:null})},n.onWebcamCapture=function(e){n.verifyImage(e,!0)},n.onUploadClick=function(){$["default"].findDOMNode(n.refs.verificationFilePicker).click()},n.onUploadSelect=function(e){e.stopPropagation();var t=e.target.files||e.dataTransfer.files;if(t&&t[0]){var a=t[0],i=URL.createObjectURL(a);n.verifyImage(i,!1);var o=$["default"].findDOMNode(n.refs.verificationFilePickerForm);o&&o.reset()}},n.onClose=function(e){n.props.onClose?n.props.onClose():n.context.uim.uie.requestDismiss()},n.hideCheckmark=function(){n.state.errorIconVisible||n.setState({circleVisible:!0}),n.setState({checkmarkVisible:!1})},n.hideError=function(){n.state.checkmarkVisible||n.setState({circleVisible:!0}),n.setState({errorIconVisible:!1})},n.hideBanner=function(){n.setState({bannerVisible:!1})},i=a,(0,E["default"])(n,i)}return(0,S["default"])(t,e),(0,_["default"])(t,[{key:"componentDidUpdate",value:function(e,t){e.contact!==this.props.contact&&this.props.contact.queryIdentity()["catch"](function(e){
H["default"].error("VerificationDrawer:queryIdentity error: "+e)()})}},{key:"componentWillMount",value:function(){this.props.contact.queryIdentity()["catch"](function(e){H["default"].error("verificationDrawer:queryIdentity error: "+e)()})}},{key:"componentWillUnmount",value:function(){this.props.clearTimeout(this.iconTimer),this.props.clearTimeout(this.bannerTimer),this.props.clearTimeout(this.hintTimer)}},{key:"showWebcamStream",value:function(e){this.setState({webcamVisible:!0,circleVisible:!0,checkmarkVisible:!1,errorIconVisible:!1,stream:e}),this.hintTimer&&(this.props.clearTimeout(this.hintTimer),delete this.hintTimer),this.hintTimer=this.props.setTimeout(this.showWebcamHint,ke)}},{key:"getErrorBannerText",value:function(e){var t=void 0,a=this.props.contact.formattedShortName;switch(e){case Te.REMOTE_MISMATCHED:t=l10n.t("web_verify_error_remote_mismatched",{contact:a});break;case Te.LOCAL_MISMATCHED:case Te.BOTH_MISMATCHED:t=l10n.t("web_verify_error_local_mismatched",{contact:a});break;case Te.INVALID_QR_CODE:default:t=l10n.t("web_verify_error_invalid_upload")}return t}},{key:"showCheckmark",value:function(){this.onWebcamClose(),this.setState({circleVisible:!1,checkmarkVisible:!0,errorIconVisible:!1,bannerVisible:!1}),this.iconTimer&&(this.props.clearTimeout(this.iconTimer),delete this.iconTimer),this.iconTimer=this.props.setTimeout(this.hideCheckmark,Ce)}},{key:"showErrorIcon",value:function(){this.onWebcamClose(),this.setState({circleVisible:!1,checkmarkVisible:!1,errorIconVisible:!0,bannerVisible:!1}),this.iconTimer&&(this.props.clearTimeout(this.iconTimer),delete this.iconTimer),this.iconTimer=this.props.setTimeout(this.hideError,Ce)}},{key:"showErrorBanner",value:function(e){var t=this.getErrorBannerText(e);this.showBanner(t)}},{key:"showBanner",value:function(e){this.setState({circleVisible:!0,checkmarkVisible:!1,errorIconVisible:!1,bannerVisible:!0,bannerText:e}),this.bannerTimer&&(this.props.clearTimeout(this.bannerTimer),delete this.bannerTimer),this.bannerTimer=this.props.setTimeout(this.hideBanner,be)}},{key:"validateFingerprint",value:function(e){if(!e||0===!e.version||!e.localFingerprint||!e.remoteFingerprint)return Te.INVALID_QR_CODE;var t=fe.CombinedFingerprint.parse(this.props.contact.verificationBinary),a=c(e.remoteFingerprint.identifier,t.localFingerprint.identifier),n=c(e.localFingerprint.identifier,t.remoteFingerprint.identifier);if(!a&&!n)return Te.BOTH_MISMATCHED;if(!a)return Te.REMOTE_MISMATCHED;if(!n)return Te.LOCAL_MISMATCHED;var i=c(e.remoteFingerprint.publicKey,t.localFingerprint.publicKey),o=c(e.localFingerprint.publicKey,t.remoteFingerprint.publicKey);return i&&o?Te.CORRECT:Te.PUBLIC_KEY_MISMATCHED}},{key:"decodeQRCode",value:function(e){return new f["default"](function(t,a){q["default"].callback=function(e,n){if(n)a(n);else if(e.length<1)a("QR decoder did not return decoded binary");else{var i=new Uint8Array(e[0]);t(i)}},q["default"].decode(e)})}},{key:"verifyImage",value:function(e,t){var a=this;this.decodeQRCode(e).then(fe.CombinedFingerprint.parse).then(function(e){var n=a.validateFingerprint(e);n?t&&n===Te.INVALID_QR_CODE||(a.setState({errorType:n}),n===Te.PUBLIC_KEY_MISMATCHED?a.showErrorIcon():a.showErrorBanner(n)):a.showCheckmark()})["catch"](function(e){t||(a.setState({errorType:Te.INVALID_QR_CODE}),a.showErrorBanner(Te.INVALID_QR_CODE))})["finally"](function(){window.URL.revokeObjectURL(e)})}},{key:"render",value:function(){var e=null,t=null,a=null;this.props.contact.verificationBinary&&(navigator.getUserMedia&&(e=Z["default"].createElement(I["default"],{classes:"animate-enter2"},Z["default"].createElement("button",{className:"btn btn-info",onClick:this.state.webcamVisible?this.onWebcamClose:this.onWebcamOpen},this.state.webcamVisible?l10n.t("web_verify_webcam_close_button"):l10n.t("web_verify_webcam_open_button")))),t=Z["default"].createElement(I["default"],{classes:"animate-enter2"},Z["default"].createElement("button",{className:"btn btn-info",onClick:this.onUploadClick},l10n.t("web_verify_upload_button")),Z["default"].createElement("p",{className:"drag-and-drop-explanation"},this.state.isDragging?l10n.t("web_verify_drag_and_drop_dragging"):null)),a=Z["default"].createElement("form",{ref:"verificationFilePickerForm"},Z["default"].createElement(he,{mime:"image/*",onPick:this.onUploadSelect,ref:"verificationFilePicker"})));var n=null;this.state.webcamVisible&&this.state.stream&&(n=Z["default"].createElement(Se,{stream:this.state.stream,onCapture:this.onWebcamCapture,onClose:this.onWebcamClose}));var i=null;this.state.bannerVisible&&(i=Z["default"].createElement(u,null,this.state.bannerText));var o="icon icon-";return o+=this.props.isFirstLevel?"x":"back",Z["default"].createElement(O["default"],{className:"drawer-verification",onDrop:this.onDrop,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onCancel:this.onClose},Z["default"].createElement("header",{className:"pane-header"},Z["default"].createElement("div",{className:"header-close"},Z["default"].createElement("button",{onClick:this.onClose},Z["default"].createElement("span",{className:o}))),Z["default"].createElement("div",{className:"header-body"},Z["default"].createElement("div",{className:"header-main"},Z["default"].createElement("div",{className:"header-title"},l10n.t("web_verify_title"))),Z["default"].createElement("div",{className:"header-secondary"},l10n.t("web_you"),", ",this.props.contact.formattedUser))),n,i,Z["default"].createElement(D["default"],{classes:this.state.webcamVisible?"webcam-visible":"",info:!0,onDragStart:this.onDragStart,onDragEnd:this.onDragEnd},Z["default"].createElement(I["default"],{classes:"drawer-scale drawer-section-photo"},Z["default"].createElement(r,{binary:this.props.contact.verificationBinary,contact:this.props.contact,visible:this.state.circleVisible}),Z["default"].createElement(s,{visible:this.state.checkmarkVisible}),Z["default"].createElement(l,{visible:this.state.errorIconVisible})),Z["default"].createElement(I["default"],{classes:"animate-enter2"},Z["default"].createElement("div",{className:"verification-string"},Z["default"].createElement(ye,{string:this.props.contact.verificationString}))),Z["default"].createElement(I["default"],{classes:"animate-enter2"},Z["default"].createElement("p",{className:"verification-explanation"},Z["default"].createElement("span",null,l10n.t("web_verify_explanation"),"Â "),Z["default"].createElement("a",{target:"_blank",href:T["default"].E2E_FAQ_LINK},l10n.t("learn_more")))),e,t,a))}}]),t}(Z["default"].Component);we.CONCERNS={contact:["verificationBinary","verificationString","formattedUser","formattedShortName"]},we.contextTypes={uim:Z["default"].PropTypes.instanceOf(se["default"])},t["default"]=(0,z["default"])((0,oe["default"])((0,ne["default"])(we)))},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(1405),y=n(_),E=a(1407),M=n(E),S=a(1406),C=n(S),b=a(12),k=n(b),T=a(465),w=n(T),N=a(14),P=n(N),A=a(160),O=n(A),R=a(1460),D=(n(R),a(1402)),x=n(D),I=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(r))),n.state={hover:!1},n.onClick=function(e){var t=n.encodeColor(n.props.colorHex);t!==Store.ChatPreference.get("defaultPreference").wallpaperColor&&(Store.ChatPreference.get("defaultPreference").set("wallpaperColor",t),k["default"].openToast(g["default"].createElement(w["default"],{msg:O["default"].t("wallpaper_color_set"),id:w["default"].genId()})))},n.onMouseOver=function(e){n.state.hover||(n.setState({hover:!0}),Store.ChatPreference.trigger("wallpaper_color_preview",n.encodeColor(n.props.colorHex)))},n.onMouseEnter=function(e){n.state.hover||(n.setState({hover:!0}),Store.ChatPreference.trigger("wallpaper_color_preview",n.encodeColor(n.props.colorHex)))},n.onMouseLeave=function(e){n.state.hover&&(n.setState({hover:!1}),Store.ChatPreference.trigger("wallpaper_color_preview"))},n.encodeColor=function(e){return"#ede9e4"===e?P["default"].DEFAULT_CHAT_WALLPAPER:e},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e="wallpaper-color-canvas";this.state.hover&&(e+=" canvas-hover"),this.props.isSelected&&(e+=" canvas-active");var t=this.props.isDefault?g["default"].createElement("span",{className:"wallpaper-default-title"},O["default"].t("default_wallpaper")):null;return g["default"].createElement("span",{className:e,style:{backgroundColor:this.props.colorHex},onMouseOver:this.onMouseOver,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:this.onClick},t)}}]),t}(g["default"].Component),L=(0,x["default"])((o=i=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){for(var e=this.props,t=e.chatPreference,a=e.colors,n=!0,i=t.wallpaperColor,o=a.map(function(e){var t=!1,a=!1;return(i===e||i===P["default"].DEFAULT_CHAT_WALLPAPER&&n)&&(t=!0),n&&(a=!0,n=!1),g["default"].createElement(I,{colorHex:e,isSelected:t,isDefault:a,key:e})}),r=0;2>r;r++)o.push(g["default"].createElement("div",{key:"emptyEl"+r,className:"wallpaper-color-empty"}));return g["default"].createElement("div",{className:"wallpaper-color-grid"},o)}}]),t}(g["default"].Component),i.CONCERNS={chatPreference:["wallpaperColor"]},o)),F=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillUnmount",value:function(){Store.ChatPreference.trigger("wallpaper_color_preview")}},{key:"render",value:function(){return g["default"].createElement(y["default"],{className:"drawer-wallpaper",onCancel:this.props.onClose},g["default"].createElement(M["default"],{title:O["default"].t("wallpaper_flow_title"),onBack:this.props.onClose,type:E.DRAWER_HEADER_TYPE.LARGE}),g["default"].createElement(C["default"],null,g["default"].createElement(L,{colors:P["default"].WALLPAPER_COLOR,chatPreference:Store.ChatPreference.get("defaultPreference")})))}}]),t}(g["default"].Component);t["default"]=F},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(1519),o=n(i),r=a(464),s=r.extend({model:o["default"],handle:function(e){var t=e.shift(),a=t.blocklist,n=_.map(a,function(e){return{id:e}});this.set(n)}});e.exports=new s},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(1520),o=n(i),r=a(475),s=n(r),l=a(464),u=l.extend({model:o["default"],handle:function(e){var t=e.shift();switch(t.type){case"offer":case"offer_video":case"accept":case"reject":case"terminate":s["default"].tosShowCallNotification&&this.add(t,{merge:!0})}}});e.exports=new u},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(27),o=n(i),r=a(2),s=n(r),l=a(1404),u=n(l),c=a(243),d=a(467),f=n(d),p=a(5),h=a(14),m=a(1),v=a(464),g=a(47),y=a(42),E=a(32),M=a(12),S=a(15),C=a(22),b=a(23),k=a(61),T=v.extend({model:u["default"],comparator:function(e,t){if(k.supportsFeature(k.F.PIN)){if(e.pin&&!t.pin)return-1;if(t.pin&&!e.pin)return 1;if(e.pin&&t.pin)return""+e.pin+e.id>""+t.pin+t.id?-1:1}return e.t?t.t?""+e.t+e.id>""+t.t+t.id?-1:1:-1:1},initialize:function(){var e=this;v.prototype.initialize.call(this),this.notSpam={},this.promises={sendUnstarAll:null},this.enableSortListener(),this.listenTo(b,"change:stream",function(){b.stream===b.STREAM.RESUMING&&e.forEach(function(e){e.pendingMsgs=!1})})},enableSortListener:function(e){this[e?"listenToAndRun":"listenTo"](this,"change:t change:pin change:isVisible",this.sort)},disableSortListener:function(){this.stopListening(null,null,this.sort)},active:function w(){var w=_.head(this.filter("active"));return w?w.id:void 0},_find:function(e){return s["default"].resolve({id:e,createdLocally:!0})},_findQuery:function(e){var t=this;return g.chatFindQuery(!!e.retry).then(function(e){return"preempted"===e?s["default"].reject("chats preempted"):(Store.Conn.platform===Store.Conn.PLATFORMS.IPHONE&&(_.isEmpty(e)?Store.Msg.trigger(h.COLLECTION_HAS_SYNCED):setTimeout(function(){Store.Msg.trigger(h.COLLECTION_HAS_SYNCED)},2500)),t.trigger(h.COLLECTION_HAS_SYNCED),s["default"].resolve(e))})},handle:function(e){var t=e.shift(),a=this;if(_.isArray(t)){var n=[],i=[];t.forEach(function(e){if("c.us"===e.id)i.push(e);else{var t=!!a.get(e.id),r=["delete","clear","archive","unarchive","star","unstar","spam","modify_tag","pin"].indexOf(e.type)>-1;r?t&&r?i.push(e):m.log("Model:chat:handle received junk chat record: "+(0,o["default"])(e))():n.push(e)}});var r=_.findIndex(n,function(e){return C.isPSA(e.id)});r>-1&&(n[r].name=l10n.t("whatsapp_psa_contact_name")),a.add(n,{merge:!0}),i.forEach(function(e){var t=e.type;if("c.us"===e.id)switch(t){case"clear":m.log("Model:chat:handle:clear:all before:"+e.before+" kind:"+e.kind)(),a.forEach(function(t){"number"==typeof e.before?t.deleteMsgsOlderThan(e.before,e.star,e.kind):t.deleteMsgs(e.star,e.kind)});break;case"delete":m.log("Model:chat:handle:delete:all")(),a.forEach(function(e){e["delete"]()});break;case"archive":m.log("Model:chat:handle:archive:all")(),a.forEach(function(e){e.archive=!0});break;case"unarchive":m.log("Model:chat:handle:unarchive:all")(),a.forEach(function(e){e.archive=!1});break;case"unstar":m.log("Model:chat:handle:unstar:all")(),Store.AllStarredMsgs["delete"](),a.forEach(function(e){e.unstarAll()});break;default:m.error("Model:chat:handle unknown "+(0,o["default"])(e),e)()}else{var n=a.get(e.id);if(!n)return;switch(t){case"clear":case"star":case"unstar":if(e.keys){for(var i=e.keys.length,r="star"===t,s=[],l=[],u=[],c=!1,d=0;i>d;d++){var f,p,h,v,g,y=e.keys[d];_.isArray(y)?(f=y[0],p=y[1],h=y[2],v=new E({fromMe:p,remote:e.id,id:f,participant:h}),g=Store.Msg.get(v),g?"clear"===t?g["delete"]():(g.star=r,r&&u.push(g)):r&&(c=!0)):_.isObject(y)&&"star"===t&&(v=y.id,g=Store.Msg.get(y.id),g?(g.star=!0,u.push(g)):l.push(y)),s.push(v.toString())}"star"!==t&&"unstar"!==t||Store.AllStarredMsgs.process(r,l,u,c),m.log("model:Chat:handle:messages:"+[t,e.id,s.join(),e.modifyTag].join())()}else"clear"===t?("number"==typeof e.before?n.deleteMsgsOlderThan(e.before,e.star,e.kind):n.deleteMsgs(e.star,e.kind),m.log("model:Chat:handle cleared chat:"+[e.id,e.before,e.modifyTag,e.kind].join())()):"unstar"===t&&(n.unstarAll(),m.log("model:Chat:handle unstarred chat: "+e.id)());isNaN(e.modifyTag)||(n.modifyTag=e.modifyTag);break;case"delete":n["delete"](),m.log("model:Chat:handle deleted chat for "+e.id)();break;case"archive":n.archive=!0;break;case"unarchive":n.archive=!1;break;case"spam":n.notSpam=e.notSpam;break;case"modify_tag":n.modifyTag=e.modifyTag;break;case"pin":n.pin=e.pin}}})}else if("leave"===t.cmd)t.gids.forEach(function(e){var t=a.get(e);t&&t.exit()});else if("preempt"===t.cmd)Store.Chat.add(t.response,{merge:!0}),Store.Conn.platform===Store.Conn.PLATFORMS.IPHONE&&(_.isEmpty(t.response)?Store.Msg.trigger(h.COLLECTION_HAS_SYNCED):setTimeout(function(){Store.Msg.trigger(h.COLLECTION_HAS_SYNCED)},2500)),this.trigger(h.COLLECTION_HAS_SYNCED);else if("action"===t.cmd){var s=t.id,l=t.data;if("create"===l[0]||"introduce"===l[0]){var u=l[1],c=l[2],d=_.map(c.admins,function(e){return{id:e,isAdmin:!0}}).concat(_.map(c.regulars,function(e){return{id:e,isAdmin:!1}}));Store.GroupMetadata.add({id:s,creation:c.creation,owner:u,participants:d,stale:!1},{merge:!0}),Store.Contact.add({id:s,name:c.subject},{merge:!0});var f=Store.Chat.get(s);if(!f)return;var p=f.msgs.last();if(!p)return;"gp2"===p.type&&"add"===p.subtype&&_.head(p.recipients)===Store.Conn.me&&M.alertNewMsg(p)}else{var v=Store.Chat.get(t.id);v?v.handleGroupAction.apply(v,t.data):m.error("model:chat: unknown chat for action "+(0,o["default"])(t))()}}else m.error("model:chat: unknown payload: "+(0,o["default"])(t))()},createGroup:function(e,t,a,n,i){var o=this,r=_.map(n,"id"),s=g.createGroup(e,r),l=new c.ActionType(l10n.t("action_group_creating"));i=i||(0,c.genId)();var u=s.then(function(e){return 200===e.status?new c.ActionType(l10n.t("action_group_created")):406===e.status?new c.ActionType(l10n.t("action_group_create_failed")+" "+l10n.t("action_group_create_failed_406")):void 0})["catch"](function(r){return m.error("models:chatCollection:createGroup dropped")(r),new c.ActionType(l10n.t("action_group_create_failed"),l10n.t("action_try_again"),o.createGroup.bind(o,e,t,a,n,i))});return M.openToast(p.createElement(c.ActionToast,{id:i,initialAction:l,pendingAction:u})),s.then(function(e){if(200===e.status&&e.gid&&Store.Chat.find(e.gid).then(function(e){M.openChatBottom(e).then(function(t){t&&M.focusChatTextInput(e)})}),200===e.status&&!e._duplicate&&t&&a){var n=Store.ProfilePicThumb.gadd(e.gid);return n.setPicture(t,a)}200===e.status&&e._duplicate&&m.error("createGroup failed to set picture.")()})},sync:function(){return this.findQuery({})["catch"](S.WapDrop,_.noop),s["default"].all([y.waitForBBEvent(this,h.COLLECTION_HAS_SYNCED),Store.Msg._hasSynced()])},resyncMessages:function(){var e=this;m.log("ChatStore:resyncMessages")();var t=Store.Chat.filter(function(e){return e.isVisible}),a=t.map(function(e){var t=e.getAckedPhoneProps(),a=e.lastReceivedKey;return a&&(t.id=a.id,t.fromMe=a.fromMe.toString(),t.participant=a.participant),t});return g.resyncMessages(a).then(function(t){return t.status>=400?(m.error("ChatStore:resyncMessages resume error "+t.status)(),s["default"].reject(new Error("ChatStore:resyncMessages resume error "+t.status))):(m.log("ChatStore:resyncMessages resume success")(),t.checksum&&Store.Contact.resyncContacts(t.checksum),t.statusChecksum&&Store.StatusV3.sync(t.statusChecksum),e.disableSortListener(),t.data.forEach(function(e){if(e.disableUnreadAnchor=!1,"delete"!==e.type&&!C.isPSA(e.id)){var t=Store.Contact.get(e.id);t?e.name&&(t.name=e.name):Store.Contact.add({id:e.id,name:e.name})}var a=Store.Chat.get(e.id);return a?void("clear"===e.type?!function(){a.resetMediaMsgs();var t=[];a.msgs.forEach(function(e){return t.push(e)}),a.msgChunks.length&&a.msgChunks.forEach(function(e){e.models.forEach(function(e){return t.push(e)})}),a.set({t:e.t,unreadCount:e.unreadCount,createdLocally:!1,archive:e.archive,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,msgs:[],notSpam:e.notSpam,unreadMsgAnchor:void 0,disableUnreadAnchor:e.disableUnreadAnchor,pendingMsgs:e.pendingMsgs,pin:e.pin}),a.mute.setMute(e.muteExpiration),_.each(t,function(e){e["delete"]()}),m.log("model:chat:resume: cleared chat for "+e.id)()}():"delete"===e.type?(a["delete"](),m.log("model:chat:resume: deleted chat for "+e.id)()):(a.set(e,{merge:!0}),a.mute.setMute(e.muteExpiration))):void Store.Chat.add(e)}),e.enableSortListener(!0),s["default"].resolve())})["catch"](S.WapDrop,function(e){return m.error("ChatStore:resyncMessages resume dropped")(),s["default"].reject(e)})},unstarAllMessages:function(e,t){var a=this,n=t?t.promises:this.promises,i=t?t.id:void 0;if(n.sendUnstarAll)return n.sendUnstarAll;n.sendUnstarAll=g.sendUnstarAll(i);var o=new c.ActionType(l10n.t("action_message_unstarring_all")),r=n.sendUnstarAll.then(function(e){return 200===e.status?new c.ActionType(l10n.t("action_message_unstarred_all")):e.status>=400?new c.ActionType(l10n.t("action_message_unstar_all_failed")):void 0})["catch"](function(n){return m.error("models:chat:sendUnstarAll dropped")(n),new c.ActionType(l10n.t("action_message_unstar_all_failed"),l10n.t("action_try_again"),function(){return a.unstarAllMessages(e,t)})});return M.openToast(p.createElement(c.ActionToast,{id:(0,c.genId)(),initialAction:o,pendingAction:r})),n.sendUnstarAll.then(function(a){200===a.status&&(_.forEach(e,function(e){e.set("star",!1)}),t?Store.AllStarredMsgs.remove(e):(Store.AllStarredMsgs.reset(),Store.StarredGifMsgs.reset()))})["finally"](function(){n.sendUnstarAll=null})},forwardMessagesToChats:function(e,t){var a=s["default"].map(e,function(e){return s["default"].props({message:e,canForward:e.canForward()})});return s["default"].map(t,function(e){var t=void 0;return t=e.isUser&&e.contact.isBlocked()?e.contact.setBlock(!1):s["default"].resolve(!0),s["default"].all([a,t]).spread(function(t,a){var n=_.map(_.filter(t,{canForward:!0}),"message"),i=_.map(_.filter(t,{canForward:!1}),"message");return s["default"].props({chat:e,undelivered:e.forwardMessages(n),canForward:n,cannotForward:i})})}).then(function(e){var t=_.compact(e.map(function(e){var t=e.chat,a=e.undelivered,n=e.canForward,i=e.cannotForward,o=null;return(a.length||i.length)&&(o=f["default"].formatForwardError(t,a,n,i)),o?{chat:t,reason:o}:null}));if(t.length)throw new S.ForwardError("Forward Messages Error",t);return!0})}});e.exports=new T},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(1460),o=n(i),r=a(464),s=a(14),l=r.extend({model:o["default"],initialize:function(){r.prototype.initialize.call(this,{CachePolicy:{id:"chat_preference",policy:r.CACHE_POLICY.LOAD,delay:1e3}})},initializeFromCache:function(){this.get("defaultPreference")||this.add({id:"defaultPreference",wallpaperColor:s.DEFAULT_CHAT_WALLPAPER})},get:function(e,t){return r.prototype.get.call(this,e,t)||r.prototype.get.call(this,"defaultPreference")}});e.exports=new l},function(e,t,a){"use strict";var n=a(14),i=a(1),o=a(35),r=a(15),s={handle:function(e){var t=e.shift();switch(t.type){case"const":n[t.key]=t.value;break;case"read":if(t.isStatus){Store.StatusV3.handle([t]);break}case"unread":var a=Store.Chat.get(t.jid);a&&("read"===t.type?a.markSeen():"unread"===t.type&&a.markUnseen());break;case"picture":Store.ProfilePicThumb.imageChanged(t.jid,t.tag);break;case"log":o.upload("server-requested",!0,!0);break;case"privacy":t.jid?(Store.Presence.update(t.jid)["catch"](r.WapDrop,_.noop),Store.ProfilePicThumb.update(t.jid)["catch"](r.WapDrop,_.noop),Store.Status.update(t.jid)["catch"](r.WapDrop,_.noop)):i.error("Store:Cmd:handle:privacy no jid",t)();break;case"identity":if(t.jid){var s=Store.Contact.get(t.jid);s?s.updateIdentity(t):i.error("Store:Cmd:handle:identity no contact",t)()}else i.error("Store:Cmd:handle:identity no jid",t)();break;default:i.warn("Store.Cmd:handle:unknown "+t.type,t)()}}};e.exports=s},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(1524),o=n(i),r=a(464),s=a(118),l=r.extend({model:o["default"],initialize:function(){r.prototype.initialize.call(this,{CachePolicy:{id:"emoji_variant_collection",policy:r.CACHE_POLICY.LOAD,delay:1e3}})},setVariant:function(e,t){var a=s.skinToneEmojis[e];if(!a)throw new Error("attempt to store variantless emoji");this.gadd({id:a,"char":a,variant:t})},getVariant:function(e){if(s.skinToneEmojis[e]){var t=this.get(e);return t?t.variant:null}throw new Error("attempt to get variantless emoji")}});e.exports=new l},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(1443),s=n(r),l=a(1),u=a(464),c=a(47),d=a(15),f=a(22),p=u.extend({model:s["default"],initialize:function(){u.prototype.initialize.call(this,{staleCollection:!0})},onResume:function(){_.union(Store.Chat.where({active:!0}).filter(function(e){return e.isGroup||e.isBroadcast}),Store.Chat.where({isBroadcast:!0})).forEach(function(e){Store.GroupMetadata.find(e.id)["catch"](d.WapDrop,_.noop)})},_find:function(e){var t=this;if(f.isGroup(e)){var a=Store.Chat.get(e);return a&&a.isReadOnly?c.groupMetadataFindFromPhone(e).then(function(t){return"ok"===t.status?t.data:"missing"===t.status?void _.defer(function(){Store.Chat.get(e)["delete"]()}):"error"===t.status?(l.error("model:GroupMetadata:find error "+t.info)(),o["default"].reject(new Error("model:GroupMetadata:find error"))):void 0}):c.groupMetadataFind(e).then(function(a){if(a.status>=400)return{id:e,stale:!1};var n=[],i=t.get(e);return i?i.participants.set(a.participants):n=a.participants,t.updateSubject(e,a.subject),{id:a.id,owner:a.owner,creation:a.creation,participants:n}})}return f.isBroadcast(e)?c.contactFindBroadcast(e).then(function(t){if(200===t.status){var a=Store.GroupMetadata.get(e);if(a&&!a.stale)return o["default"].resolve(a);var n=[];return a?a.participants.set(t.recipients):n=t.recipients,{id:e,participants:n}}return 404===t.status?o["default"].reject("False broadcast list query."):(l.error("models:GroupMetadataCollection:_find:bclist error: "+t.status)(),o["default"].reject(new Error("models:GroupMetadataCollection:_find:bclist error: "+t.status)))}):(l.log("groupMetadata:find trying to fetch non-group/bclist wid "+e)(),o["default"].reject(new Error("groupMetadata:find trying to fetch non-group/bclist wid "+e)))},_handle:function(e){return e},updateSubject:function(e,t){_.isString(t)&&Store.Contact.find(e).then(function(e){e.name||(e.name=t)})}});e.exports=new p},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(!k.supportsFeature(k.F.CONTACT_HAS_PUSHNAME)&&e.notifyName){var t=Store.Contact.get(e.sender);t&&!t.isMe&&(!t._notifyName||t._notifyName.t<e.t)&&(t._notifyName={name:e.notifyName,t:e.t},t.trigger("change:_notifyName",e.notifyName))}}function o(e,t,a,n){var o=[],r=[],s=[];t.forEach(function(t,l){t.id instanceof N||(M.error("msgCollection:_processMultipleMessages: el.id is not a MsgKey"+(new Error).stack)(),R.upload("forgot-to-create-msgkey"),t.id=new N({from:t.from,to:t.to,id:t.id,participant:t.participant,self:t.self})),_.isString(e)&&b.isBroadcast(e)&&delete t.broadcast,"ptt"===t.type&&!t.id.fromMe&&t.ack<0&&(t.ack=0);var u=Store.Msg.get(t.id);if(t.type===y["default"].TYPE.PROTOCOL)switch(t.subtype){case"revoke":if(u=Store.Msg.get(t.protocolMessageKey)){var d=new y["default"](t);u.sender===d.sender?u.revoke(d.id):M.warn("model:Msg:processMM revoke sender mismatch "+d.id.toString()+", "+u.id.toString())()}break;default:M.info("unknown protocolMessage "+t.id.toString())(t)}else if(u){var f;!function(){t.ack<u.ack&&delete t.ack;for(f in t)t.hasOwnProperty(f)&&"undefined"==typeof t[f]&&delete t[f];t.id.fromMe&&!u.clientUrl&&t.clientUrl&&(t.phoneUploading=!1),a.isHistory&&(t.isNewMsg=!1);var e=["t","id","from","to"],l=u.t?_.omit(t,e):t,d=u.applyUpdate(l)["return"](u);if(s.push(d),b.isBroadcast(u.id.remote)){var p=c(u);p&&p.forEach(function(e){var t=Store.Msg.get(e);t&&s.push(t.applyUpdate(l)["return"](u))})}a.isHistory&&(u.recvFresh||n)&&!u.search?(M.warn("model:Msg:handle:processMM:"+(u.recvFresh?"dup:":"overlap:")+u.id)(),r.push(u)):a.isHistory&&u.search?(u.search=!1,M.warn("model:Msg:handle:processMM load search as history "+u.id)(),o.push({id:u.id})):"search"!==a.add&&"resync"!==a.add||o.push({id:u.id}),i(u)}()}else y["default"].typeIsMMS(t.type)&&!t.clientUrl&&(t.phoneUploading=t.id.fromMe&&0===t.ack),"search"===a.add&&(t.search=!0),a.update||o.push(t)});var u=s.length?v["default"].all(s):v["default"].resolve();return u.then(function(){if(0===o.length&&0===r.length){if(e&&a.pendingMsgsDone){var s=Store.Chat.get(e);s&&(s.pendingMsgs=!1)}return t.map(function(e){return Store.Msg.get(e.id)})}var u=Store.Msg.add(o,{merge:!0}),c=v["default"].map(u,function(e){return i(e),e.waitForPrep()["catch"](function(e){M.assert(!1,"bad-msg-prep",""+e)(e)})});if(e){var f;if(b.isStatusV3(e)){var p=t[0],h=p.id.fromMe?Store.Conn.me:p.author;f=Store.StatusV3.find(h)}else f=Store.Chat.find(e);return c["return"](f).then(function(i){var o,s,c="after"===a.add||"last"===a.add,f=!a.isHistory,p=!1;if("unread"===a.add?(o=n,i.msgChunks.push(o),s=a.firstUnreadKey):"last"===a.add&&a.resume?(o=n,p=!0):o="function"==typeof n?n():n,l(t,u,r,i,c,o||i.msgs,s,p),a.pendingMsgsDone&&(i.pendingMsgs=!1),f&&b.isBroadcast(e)&&!b.isStatusV3(e)&&u.forEach(function(t){if("broadcast_notification"===t.type){var a=Store.GroupMetadata.get(e);"add"===t.subtype?a.participants.add({id:t.body},{merge:!0}):"remove"===t.subtype&&a.participants.remove(t.body),i.groupMetadata.stale=!1}else t.recvFresh&&!t.isNotification&&d(t)}),k.supportsFeature(k.F.RECENT_EMOJI_SYNC)&&!Store.RecentEmoji.syncDue)for(var h=0;h<u.length;h++){var m=u[h];if(m.isNewMsg&&m.isSentByMe&&m.containsEmoji){Store.RecentEmoji.periodicSync();break}}return t.map(function(e){return Store.Msg.get(e.id)})})}return c["return"](t.map(function(e){return Store.Msg.get(e.id)}).filter(function(e){return!!e.chat}))})}function r(e,t,a,n,i,o){var r=n||t.msgs;if(e=_.isArray(e)?e:[e],0!==e.length){var s=r===t.msgs;if(o){s&&M.error("models:msg:store:resetMostRecentMsgs .msgs === cmc !")(),s=!0,t.lastReceivedKey=_.last(e).id,r.add(e);var l=new O;l.replace(t.msgs),t.msgChunks.push(l),t.replaceMsgsCollection(r),t.msgs.trigger("change:last",t.msgs.last())}else a?(s&&(t.lastReceivedKey=_.last(e).id),r.add(e)):r.add(e,{at:0,silent:_.every(e,f)});if(a&&s||!Store.Msg.lastReceivedReceipt[t.id])for(var u=e.length,c=u-1;c>=0;c--){var d=e[c],p=d.id;if(p.fromMe&&!d.isNotification){Store.Msg.updateLastReceipt(p.remote,d.t);break}}i&&!t.unreadMsgAnchor&&(t.disableUnreadAnchor?t.disableUnreadAnchor=!1:t.unreadMsgAnchor=_.find(e,function(e){return e.id.toString()===i.toString()}))}}function s(e,t,a,n,i){var o,r,s,l={},u={},c=a.length,d=i;if(0===c)return{msgs:t,collection:d};for(o=0;c>o;o++)r=a[o],u[r.id]=r;for(c=t.length,o=0;c>o;o++)r=t[o],l[r.id]=r;var f=[];for(c=e.length,o=0;c>o;o++)if(r=e[o],s=l[r.id],s&&f.push(s),s=u[r.id])if(s.recvFresh)f.push(s),n.removeMsg(s),s.unset("recvFresh");else{var p=n.getAllCMCs(),h=_.find(p,function(e){return e.get(r.id)});i&&h===i||(h?(h.forEach(function(e){f.push(e),delete u[e.id]}),h===n.msgs?(n.replaceMsgsCollection(i),d=n.msgs):(n.notifyMsgCollectionMerge(i,h,i),n.removeMsgsCollection(h))):(M.error("models:Msg:reorder trying to merge CMC of orphaned message "+r.id,r)(),f.push(u[r.id])))}return{msgs:f,collection:d}}function l(e,t,a,n,i,o,l,u){var c=s(e,t,a,n,o);r(c.msgs,n,i,c.collection,l,u)}function u(e){return _.isObject(e)?JSON.parse((0,h["default"])(e)):e}function c(e){var t=void 0,a=void 0,n=void 0;if(e instanceof y["default"])a=e,n=e.id;else{if(!(e instanceof N))return void M.error("model:msgs:broadcastFanout: unknown msgOrKey: "+e)(e);n=e}if(a&&a.recipients&&0!==a.recipients.length)t=a.recipients;else{var i=Store.GroupMetadata.get(n.remote);i?t=_.map(u(i.participants),"id"):M.log("model:msgs:broadcastFanout no group_metadata rec for bclist, cant fanout: "+n.remote)()}return t?t.map(function(e){return new N({fromMe:n.fromMe,remote:e,id:n.id})}):void 0}function d(e){var t=void 0;if(!e.invis){var a=c(e);a&&(t=a.map(function(e){return e.remote}),a.forEach(function(t){Store.Msg.some(_.matches({id:t}))||!function(){var a=u(e);a.to=t.remote,a.id=t,a.broadcast=!0;var n=Store.Msg.add(a,{merge:!0});Store.Chat.find(t.remote).then(function(e){r(n,e,!0)})}()}))}return t}function f(e){return"i"===e.eventType}var p=a(27),h=n(p),m=a(2),v=n(m),g=a(462),y=n(g),E=a(14),M=a(1),S=a(464),C=a(15),b=a(22),k=a(61),T=a(42),w=a(48),N=a(32),P=a(23),A=a(47),O=a(1425),R=a(35),D=6e4,x=S.extend({model:y["default"],initialize:function(){S.prototype.initialize.call(this),this.lastReceivedReceipt={},this.preAck={},this.pendingAdd={},this.ftsCache={},this.listenTo(P,"change:stream",function(){P.stream===P.STREAM.DISCONNECTED&&(this.preAck={})}),this.listenTo(this,"remove",this.removeFromCollection)},removeFromCollection:function(e){e.chat&&e.chat.removeFromCollection(e)},_findQuery:function(e){var t,a=this;switch(e.direction){case"before":case"after":t=e.direction;break;default:t="before"}return A.msgFindQuery(t,e).then(function(n){if(n.status>=400)return M.error("model:Msg:findQuery error "+n.status)(),v["default"].reject(n.status);var i=function(){var t=a.get(e),n=Store.Chat.get(e.remote);return t?t.msgChunk:n?n.msgs:void 0};return n.forEach(function(e){e.invis=!0}),M.log("model:Msg:findQuery:got:"+n.length+":"+e.direction)(),a.processMultipleMessages(e.remote,n,{add:t,isHistory:!0},i)})},resyncChatMsgs:function(e,t){var a=this,n="number"!=typeof t||isNaN(t)?E.PAGE_SIZE:t;
return A.msgFindQuery("before",{remote:e,count:n}).then(function(e){return e.status>=400?(M.error("model:Msg:resyncChatMsgs error "+e.status)(),v["default"].reject(e.status)):a.processMultipleMessages(void 0,e,{add:"resync"})})},getStarred:function(e,t,a,n){var i=this,o={count:"number"!=typeof t||isNaN(t)?E.PAGE_SIZE:t,chat:e&&_.isString(e)?e:void 0,remote:a&&a.remote,id:a&&a.id,fromMe:a&&a.fromMe,participant:a&&a.participant,media:n?"gif":void 0};return A.msgFindQuery("star",o).then(function(e){var t=e.status;return e.status>=400?(499===t?M.log("model:Msg:getStarred error 499 (unimplemented)")():M.error("model:Msg:getStarred error "+t)(),v["default"].reject(t)):i.processMultipleMessages(void 0,e,{add:"search"})})},incrementalStarredUpdate:function(e){return this.processMultipleMessages(void 0,e,{add:"search"})},search:function I(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=this,n=arguments[2],i=arguments[3];if(1!==t||i)return this._search(e,t,n,i);var o=this.ftsCache[e];if(o)return o;var I=this._search(e,t,n,i);this.ftsCache[e]=I;var r=function(){a.ftsCache[e]=null};return _.delay(r,D),I["catch"](r),I},_search:function(e,t,a,n){var i=this,o={searchTerm:e,page:t&&_.isNumber(t)?t:1,count:a&&_.isNumber(a)?a:E.PAGE_SIZE,remote:n};return A.msgFindQuery("search",o).then(function(e){if(e.status>=400)return M.error("model:Msg:search error "+e.status)(),v["default"].reject(e.status);var t=_.isArray(e)?e:e.messages,a=_.isArray(e)?!0:e.eof;return v["default"].props({messages:i.processMultipleMessages(void 0,t,{add:"search"}),eof:a})})},queryMedia:function(e,t,a,n,i){var o=this,r={remote:e,count:t&&_.isNumber(t)?t:E.PAGE_SIZE,id:n&&n.id,fromMe:n&&n.fromMe,participant:n&&n.participant,direction:a||"before",media:i};return A.msgFindQuery("media",r).then(function(e){return e.status>=400?(M.error("model:Msg:media error "+e.status)(),v["default"].reject(e.status)):i?o.processMultipleMessages(void 0,e,{add:"search"}):v["default"].props({docCount:e.docCount,linkCount:e.linkCount,mediaCount:e.mediaCount,messages:o.processMultipleMessages(void 0,e.messages,{add:"search"})})})},getContext:function(e,t){var a=this,n=this.get(e);return n?v["default"].all([A.msgFindQuery("before",e),A.msgFindQuery("after",e)]).spread(function(i,o){return _.isArray(i)&&_.isArray(o)?(n.search=!1,v["default"].all([a.processMultipleMessages(e.remote,i,{add:"before",isHistory:!0},t),a.processMultipleMessages(e.remote,o,{add:"after",isHistory:!0},t)])):(M.error("model:msg:getContext fetch error",i,o)(),v["default"].reject(i.status||o.status))}):A.msgFindQuery("after",e).then(function(n){return _.isArray(n)?b.isStatusV3(n[0].id.remote)?v["default"].reject("statusV3, stop querying before the msg"):a.processMultipleMessages(e.remote,n,{add:"after",isHistory:!0},t):(M.error("model:msg:getContext:after fetch error",n)(),v["default"].reject(n.status))}).then(function(t){var n=t[0],i=n.id.clone();return i.count=e.count+1,v["default"].all([A.msgFindQuery("before",i).then(function(t){if(!_.isArray(t))return M.error("model:msg:getContext:before fetch error",t)(),v["default"].reject(t.status);var i=t[t.length-1],o=i.id;if(!o.equals(e))return M.error("model:msg:getContext:before ctx message mismatch",t)(),v["default"].reject(405);var r=function(){return n.msgChunk};return a.processMultipleMessages(e.remote,t,{add:"before",isHistory:!0},r)}),v["default"].resolve(t)])})},handle:function(e){function t(e,t){var a=new N({from:r.from,to:e,id:t,participant:r.participant,selfDir:r.self||"out"}),n=o.get(a);if(n){n.updateAck(r.ack),o.updateLastReceipt(a.remote,r.t);var i=a.remote;b.isUser(i)&&(Store.MsgInfo.update(t,r.from,e,r.ack,i,r.t),b.isBroadcast(r.broadcast)&&Store.MsgInfo.update(t,r.from,r.broadcast,r.ack,i,r.t))}else M.log("Msg:out of order ack",r)(),o.preAck[a]=r}var a,n,i,o=this,r=e.shift();if("ack"===r.cmd){var s=[r.to];if(b.isBroadcast(r.to)&&1===r.ack){var l=Store.GroupMetadata.get(r.to);l&&Array.prototype.push.apply(s,_.map(l.participants.toArray(),"id"))}return s.forEach(function(e){t(e,r.id)}),!0}if("acks"===r.cmd)return r.id.forEach(function(e){t(r.to,e)}),!0;if(r.msg){var u="update"===r.meta.add;return b.isStatusV3(r.chat)&&!Store.StatusV3.handleUpdate(r.msg,r.meta.checksum,u)||(r.msg.recvFresh=!0,r.msg.isNewMsg=!0,this.processMultipleMessages(r.chat,[r.msg],{add:"after",update:u,isHistory:!1})["catch"](C.LogoutDrop,_.noop)),!0}if(r.msgs){var c=r.msgs.length;if(!c)return!1;n=r.meta,n.isHistory=!0,"unread"===n.add&&(n.firstUnreadKey=new N({fromMe:n.unreadFromMe,remote:r.chat,id:n.unreadId,participant:n.unreadParticipant}),i=new O);for(var d=0;c>d;d++)a=r.msgs[d],a.invis=!0;return Store.Conn.platform===Store.Conn.PLATFORMS.IPHONE&&this.trigger(E.COLLECTION_HAS_SYNCED),this.processMultipleMessages(r.chat,r.msgs,n,i)["catch"](C.LogoutDrop,_.noop),!0}if(r.recent){n=r.meta,delete r.recent,delete r.meta,this.trigger(E.COLLECTION_HAS_SYNCED),n.isHistory=!0;for(var f in r)"last"===n.add&&n.resume&&(i=new O),a=r[f],a.invis=!0,this.processMultipleMessages(f,[a],n,i)["catch"](C.LogoutDrop,_.noop)}else M.log("************** Msg else clause. something strange is going on")()},_hasSynced:function(){return T.waitForBBEvent(this,E.COLLECTION_HAS_SYNCED)},"delete":function(){S.prototype["delete"].call(this),this.lastReceivedReceipt={},this.preAck={}},send:function(e){return v["default"].callSynchronously(function(){var t=e.id,a=e.toJSON();if(k.supportsFeature(k.F.SPAM)&&Store.Chat.find(e.id.remote).then(function(e){e.isTrusted()||e.sendNotSpam()["catch"](_.noop)}),e.isNewMsg=!0,!e.isGroupMsg&&Store.Blocklist.get(e.to))return v["default"].reject(new C.ContactBlocked("Contact is blocked"));if(b.isBroadcast(a.to))var n=d(e);delete a.status,delete a.mimetype,delete a.height,delete a.width,delete a.recipients,delete a.chat,delete a.broadcast,delete a.ack,delete a.invis,delete a.filehash,delete a.recvFresh,delete a.mediaData,w.isHttp(e.url)||delete a.url,w.isHttp(e.clientUrl)||delete a.clientUrl;for(var i in a)null!==a[i]&&"undefined"!=typeof a[i]||delete a[i];return e.isMMS&&(a.avparams=e.isUnsentPhoneMsg()?{type:e.type}:e.avParams()),"chat"!==a.type||"url"!==a.subtype||k.supportsFeature(k.F.URL)||delete a.subtype,a.quotedMsg&&!k.supportsFeature(k.F.REPLIES_OUT)&&(delete a.quotedMsg,delete a.quotedStanzaID,delete a.quotedRemoteJid,delete a.quotedParticipant),a.mentionedJidList&&!k.supportsFeature(k.F.MENTIONS_OUT)&&delete a.mentionedJidList,Store.Chat.find(e.id.remote).then(function(t){return t.sendSeen(),v["default"].props({reply:A.msgCreateRecord(a,e.local),chat:t})}).then(function(a){var i=a.reply,o=a.chat;if(200===i.status){var r=t.remote,s=t.fromMe&&t.remote===Store.Conn.me?3:i.data?i.data.ack:1;return e.updateAck(s),e.type!==y["default"].TYPE.PROTOCOL&&(o.lastReceivedKey=t),Store.Msg.updateLastReceipt(r,i.t),b.isBroadcast(r)&&(n?n.forEach(function(e){var a=new N({from:Store.Conn.me,to:e,id:t.id}),n=Store.Msg.get(a);n&&(n.ack=1,Store.Msg.updateLastReceipt(e,n.t),Store.Chat.find(e).then(function(e){e.lastReceivedKey=a}))}):M.log("model:msg:createRecord bclist server ack, no recipients")()),"success"}return 408!==i.status&&M.assert(!1,"send-not-200","Phone responded "+i.status)(),"dropped"})["catch"](function(e){return M.error("model:msg:createRecord dropped msg: "+a.id)(a.type),M.assert(!1,"send-msg-error","Got error "+e)(e),"dropped"})})["finally"](function(){e.promises.sendPromise&&e.promises.sendPromise.control.settled()})},resyncReceipts:function(){M.log("Msg:resyncReceipts")();var e=[];for(var t in Store.Msg.lastReceivedReceipt){var a,n=Store.Chat.get(t);if(a=n?k.gte([0,5])?n.getFirstMsgWithStatus():n.getFirstMsgFromMe():void 0){var i=a.id;i.t=Store.Msg.lastReceivedReceipt[t]||a.t||0,e.push(i)}else M.error("Msg:resyncReceipts wid in lastReceivedReceipt, but no msg: "+t)()}return 0===e.length?v["default"].resolve():A.resyncReceipts(e).then(function(e){_.isArray(e)?(M.log("Msg:resyncReceipts success")(),e.forEach(function(e){Store.Msg.updateLastReceipt(e.id,e.t),e.acks.forEach(function(t){if(4===t.length){var a=new N({fromMe:t[1],remote:e.id,id:t[0],participant:t[2]}),n=Store.Msg.get(a);n&&n.updateAck(t[3])}else M.error("Msg:resyncReceipts invalid response: "+(0,h["default"])(t))()})})):M.error("Msg:resyncReceipts error",e)()})["catch"](C.LogoutDrop,C.EphemeralDrop,C.BrowserReplacedDrop,_.noop)["catch"](function(e){throw M.error("Msg:resyncReceipts dropped "+e+" "+(e?e.stack:"no stack"))(),new Error("Msg:resyncReceipts dropped")})},updateLastReceipt:function(e,t){var a=this.lastReceivedReceipt[e];(!a||t>a)&&(this.lastReceivedReceipt[e]=t)},processMultipleMessages:function(e,t,a,n){var i=this,r=function(){return o.call(i,e,t,a,n)};if(e){var s,l=this.pendingAdd[e];return s=l?l.then(r):r(),s["finally"](function(){i.pendingAdd[e]===s&&(i.pendingAdd[e]=null)})["catch"](_.noop),this.pendingAdd[e]=s}return r()},getBroadcastFanoutKeys:c});e.exports=new x},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(462),s=n(r),l=a(1444),u=n(l),c=a(1),d=a(22),f=a(32),p=a(464),h=a(23),m=a(47),v=p.extend({model:u["default"],initialize:function(){p.prototype.initialize.call(this,{staleCollection:!0})},_initializeStaleCollection:function(){var e=this;this.listenTo(h,"change:stream",function(){h.stream===h.STREAM.DISCONNECTED&&e.forEach(function(e){e.settled||e.set("stale",!0)})})},_find:function(e){var t=Store.Msg.get(e);return t?t.isSentByMe?m.queryMsgInfo(t.id).then(function(e){return e.status>=400?(c.log("model:MsgInfo:findQuery error "+e.status)(),o["default"].reject(e.status)):(e.id=t.id,e.isPTT=t.type===s["default"].TYPE.PTT,o["default"].resolve(e))}):o["default"].reject("message not sent by me"):o["default"].reject("No message found for id: "+e)},update:function(e,t,a,n,i,o){var r=new f({from:t,to:a,id:e,participant:i}),s=new f({from:t,to:a,id:e}),l=this.get(r)?this.get(r):this.get(s),u=d.isUser(s.remote),p=void 0,h=void 0;if(l)switch(n){case 4:if(p=l.played.get(i),p||(l.played.add({id:i,t:o}),l.playedRemaining-=1),u)break;case 3:if(h=l.read.filter(function(e){return e.id===i}),l.read.remove(h),3===n&&(l.read.add({id:i,t:o}),0===h.length&&(l.readRemaining-=1)),u)break;case 2:h=l.delivery.filter(function(e){return e.id===i}),l.delivery.remove(h),2===n&&(l.delivery.add({id:i,t:o}),0===h.length&&(l.deliveryRemaining-=1));break;default:c.error("model:MsgInfo:handle ack err: "+n,arguments)()}},handle:function(e){var t=this,a=e.shift();switch(a.cmd){case"ack":this.update(a.id,a.from,a.to,a.ack,a.participant,a.t);break;case"acks":a.id.forEach(function(e){t.update(e,a.from,a.to,a.ack,a.participant,a.t)})}}});e.exports=new v},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(1445),o=n(i),r=a(1),s=a(464),l=a(31),u="global_mute",c=!0,d=!0,f=!0,p=s.extend({model:o["default"],initialize:function(){s.prototype.initialize.call(this,{CachePolicy:{id:"mute",policy:s.CACHE_POLICY.LOAD,delay:1e3}})},initializeFromCache:function(){var e=l.getGlobalSounds();this.setGlobalSounds(e);var t=l.getGlobalNotifications();this.setGlobalNotifications(t);var a=l.getGlobalPreviews();this.setGlobalPreviews(a)},saveToCache:function(){if(Store.Conn.me){var e=this._config.CachePolicy.id;r.log("models:mute:cache-save: "+e)(),l.setCollection(e,[this.globalMute().toJSON()])}},globalMute:function(){var e=this.get(u);return e?e:this.add({id:u})},getGlobalSounds:function(){return c},setGlobalSounds:function(e){c=e,l.setGlobalSounds(e)},getGlobalNotifications:function(){return d},setGlobalNotifications:function(e){d=e,l.setGlobalNotifications(e)},getGlobalPreviews:function(){return f},setGlobalPreviews:function(e){f=e,l.setGlobalPreviews(e)},handle:function(e){for(var t=0;t<e.length;t++){var a=e[t],n=Store.Chat.get(a.id);n&&"mute"===a.type&&n.mute.setMute(a.muteExpiration)}}});e.exports=new p},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(1461),s=n(r),l=a(1),u=a(464),c=a(47),d=a(15),f=u.extend({model:s["default"],initialize:function(){u.prototype.initialize.call(this,{staleCollection:!0}),this.listenTo(Store.Stream,"change:phoneActive",this.onPresenceSubscribabilityChange)},_find:function(e){var t=this.gadd(e);return t.isUser?(t.isSubscribed=!0,c.presenceSubscribe(e)["catch"](function(e){return t.isSubscribed=!1,o["default"].reject(e)})["catch"](d.WapDrop,_.noop),c.lastseenFind(e).then(function(a){return 423===a.status?{id:e,stale:!0,hasData:!1}:401===a.status?(t.handle({id:e,deny:!0}),{id:e}):(a.id=e,t.handle(a),{id:e})})):o["default"].resolve({id:e})},handle:function(e){var t=e.shift();if(t.id===Store.Conn.me)"unavailable"===t.type?this.forEach(function(e){"unavailable"===e.type||e.stale||this.add({id:e.id,type:"unavailable",t:t.t,stale:!1},{merge:!0})}.bind(this)):l.log('models:presence:handle for self is not "unavailable" !')();else{var a=this.get(t.id);a&&("unsubscribe"===t.type?a.set({isSubscribed:!1,stale:!0}):(a.handle(t),a.stale=!1))}},onPresenceSubscribabilityChange:function(){Store.Stream.phoneActive?Store.Chat.forEach(function(e){e.active&&e.presence.isUser&&e.presence.update()["catch"](d.WapDrop,_.noop)}):this.forEach(function(e){e.reset(),e.set({stale:!0,isSubscribed:!1})})}});e.exports=new f},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(1433),s=n(r),l=a(97),u=n(l),c=a(1),d=a(464),f=a(31),p=a(47),h=a(15),m=a(22),v=a(486),g=a(23),y=d.extend({model:s["default"],initialize:function(){d.prototype.initialize.call(this,{staleCollection:!0,resumeOnAvailable:!0,CachePolicy:{id:"profile_pic_thumb",trigger:"change:tag change:raw",policy:d.CACHE_POLICY.LOAD,delay:5e3}}),this.listenTo(u["default"],"change:phoneActive",function(){u["default"].phoneActive&&this.onPhoneActive()})},get:function(e){var t=d.prototype.get.call(this,e);if(!_.isString(e))return t;var a=d.prototype.get.call(this,v(e));if(a){if(this.remove(a,{silent:!0}),t)return t;var n=a.toJSON();return n.id=e,this.add(n,{silent:!0})}return t?t:void 0},saveToCache:function(){if(Store.Conn.me){var e=this._config.CachePolicy.id,t=this.models.filter(function(e){return m.isWid(e.id)});t=t.map(function(e){return e=e.toJSON(),e.id=v(e.id),e}),c.log("models:profilePic:cache-save: "+e)(),f.setCollection(e,t)}},onPhoneActive:function(){g.stream===g.STREAM.CONNECTED&&this._onResume()},onResume:function(){var e=this.filter(function(e){var t=Store.Chat.get(e.id);return e._uiObservers&&e.stale&&(m.isUser(e.id)||m.isGroup(e.id))&&!(t&&t.isReadOnly)}).map(function(e){return e.tag||e.unset("tag",{silent:!0}),e});this.resyncPictures(e)},_find:function(e){var t=Store.Chat.get(e);return t&&t.isReadOnly?p.profilePicFindThumbFromPhone(e,this.get(e)):m.isUser(e)||m.isGroup(e)?p.profilePicFind(e).then(function(t){var a={id:e};switch(t.status){case 401:a.tag="",a.raw=void 0;break;case 423:a.stale=!0;break;case 429:a.stale=!0;break;default:"undefined"==typeof t.status?(a.tag=t.tag,a.raw=null,a.eurl=t.eurl):a.tag=null}return a})["catch"](h.WapDrop,function(){return{id:e,stale:!0}}):o["default"].resolve({id:e,tag:null})},imageChanged:function(e,t){var a=Store.ProfilePicThumb.get(e);a&&("remove"===t?a.unset("tag"):a.tag!==t&&a.update()["catch"](h.WapDrop,_.noop))},resyncPictures:function(e){return 0===e.length?o["default"].resolve():p.resyncPictures(e.map(function(e){return{id:e.id,tag:e.tag}})).then(function(t){if(423===t.status||429===t.status)c.warn("ProfilePicThumbStore:resyncPictures blocked "+t.status)();else{if(t.status>=400)throw c.error("ProfilePicThumbStore:resyncPictures error "+t.status)(t),new Error("ProfilePicThumbStore:resyncPictures error");if(!_.isArray(t))throw c.error("ProfilePicThumbStore:resyncPictures unknown reply",t)(),new Error("ProfilePicThumbStore:resyncPictures unknown reply");c.log("ProfilePicThumbStore:resyncPictures success")(),t.forEach(function(e){var t=Store.ProfilePicThumb.get(e.id);t&&t.set({tag:e.tag,raw:void 0,stale:!1})}),e.forEach(function(e){e.stale=!1})}})["catch"](h.WapDrop,_.noop)["catch"](function(e){c.error("ProfilePicThumbStore:resyncPictures dropped: "+e)()})}});e.exports=new y},function(e,t,a){"use strict";function n(e){return"number"==typeof e&&e>0?e-1:u.MAX_GROUP_SIZE}function i(e){return"number"==typeof e&&e>0?1024*e*1024:u.MAX_MEDIA_UPLOAD_SIZE}function o(e){return"number"==typeof e&&e>0?1024*e*1024:u.MAX_FILE_SIZE}function r(e){return"number"==typeof e&&e>0?1024*e:u.IMG_MAX_BYTES}function s(e){return d.updateDocMimes(e),e}function l(e){var t;c.Global.webcBucket=e.bucket||null;for(t in h)if("undefined"!=typeof e[t]){var a,n,i=h[t];_.isArray(i)?(a=i[0],n=i[1](e[t])):(a=i,n=e[t]),a&&(u[a]=n)}for(t in p.F)"undefined"!=typeof e[t]&&p.setFeature(t,e[t])}var u=a(14),c=a(43),d=a(119),f=a(47),p=a(61),h={bucket:null,gifSearch:"SHOW_GIF_SEARCH",imageMaxEdge:"IMG_MAX_EDGE",imageMaxKBytes:["IMG_MAX_BYTES",r],maxParticipants:["MAX_GROUP_SIZE",n],maxSubject:"MAX_SUBJECT_LENGTH",media:["MAX_MEDIA_UPLOAD_SIZE",i],maxFileSize:["MAX_FILE_SIZE",o],statusV2:"STATUS_V2",statusV3:"STATUS_V3",docTypes:["DOC_TYPES",s]},m={handle:function(e){var t=e.shift();"number"==typeof t.status&&t.status>=400||l(t)},fetch:function(){return f.queryServerProps().then(function(e){"number"==typeof e.status&&e.status>=400||l(e)})}};e.exports=m},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MediaDataProxy=t.MsgLoadProxy=t.StatusV3Proxy=t.ContactProxy=t.StreamProxy=t.ConnProxy=t.ChatPreferenceProxy=t.StatusProxy=t.EmojiVariantProxy=t.RecentEmojiProxy=t.ProfilePicThumbProxy=t.ChatstateProxy=t.PresenceProxy=t.MuteProxy=t.MsgInfoParticipantProxy=t.MsgInfoProxy=t.MsgProxy=t.GroupMetadataProxy=t.ChatProxy=t.CallProxy=t.BlocklistProxy=void 0;var i=a(1519);Object.defineProperty(t,"BlocklistProxy",{enumerable:!0,get:function(){return i.BlocklistProxy}});var o=a(1520);Object.defineProperty(t,"CallProxy",{enumerable:!0,get:function(){return o.CallProxy}});var r=a(1404);Object.defineProperty(t,"ChatProxy",{enumerable:!0,get:function(){return r.ChatProxy}});var s=a(1443);Object.defineProperty(t,"GroupMetadataProxy",{enumerable:!0,get:function(){return s.GroupMetadataProxy}});var l=a(462);Object.defineProperty(t,"MsgProxy",{enumerable:!0,get:function(){return l.MsgProxy}});var u=a(1444);Object.defineProperty(t,"MsgInfoProxy",{enumerable:!0,get:function(){return u.MsgInfoProxy}}),Object.defineProperty(t,"MsgInfoParticipantProxy",{enumerable:!0,get:function(){return u.MsgInfoParticipantProxy}});var c=a(1445);Object.defineProperty(t,"MuteProxy",{enumerable:!0,get:function(){return c.MuteProxy}});var d=a(1461);Object.defineProperty(t,"PresenceProxy",{enumerable:!0,get:function(){return d.PresenceProxy}}),Object.defineProperty(t,"ChatstateProxy",{enumerable:!0,get:function(){return d.ChatstateProxy}});var f=a(1433);Object.defineProperty(t,"ProfilePicThumbProxy",{enumerable:!0,get:function(){return f.ProfilePicThumbProxy}});var p=a(1526);Object.defineProperty(t,"RecentEmojiProxy",{enumerable:!0,get:function(){return p.RecentEmojiProxy}});var h=a(1524);Object.defineProperty(t,"EmojiVariantProxy",{enumerable:!0,get:function(){return h.EmojiVariantProxy}});var m=a(1446);Object.defineProperty(t,"StatusProxy",{enumerable:!0,get:function(){return m.StatusProxy}});var v=a(1460);Object.defineProperty(t,"ChatPreferenceProxy",{enumerable:!0,get:function(){return v.ChatPreferenceProxy}});var g=a(475);Object.defineProperty(t,"ConnProxy",{enumerable:!0,get:function(){return g.ConnProxy}});var _=a(97);Object.defineProperty(t,"StreamProxy",{enumerable:!0,get:function(){return _.StreamProxy}});var y=a(241);Object.defineProperty(t,"ContactProxy",{enumerable:!0,get:function(){return y.ContactProxy}});var E=a(1420);Object.defineProperty(t,"StatusV3Proxy",{enumerable:!0,get:function(){return E.StatusV3Proxy}});var M=a(1425);Object.defineProperty(t,"MsgLoadProxy",{enumerable:!0,get:function(){return M.MsgLoadProxy}});var S=a(242),C=n(S);t.MediaDataProxy=C["default"].Proxy},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(1526),s=n(r),l=a(14),u=a(1),c=a(464),d=a(47),f=a(15),p=a(118),h=a(61),m=c.extend({model:s["default"],comparator:function(e,t){return e.weight>t.weight?-1:1},initialize:function(){c.prototype.initialize.call(this,{CachePolicy:{id:"recent_emoji_collection",policy:c.CACHE_POLICY.LOAD,delay:2e3}}),this.listenTo(this,"change:weight change:length",this.sortTrimScale),this.dirty=!1,this.syncDue=!1},"delete":function(){c.prototype["delete"].call(this),this.dirty=!1,this.syncDue=!1},_findQuery:function(e){return h.supportsFeature(h.F.RECENT_EMOJI_SYNC)?d.recentEmojiQuery(e?this.toArray():void 0).then(function(e){return _.isArray(e)?(e.forEach(function(e){e["char"]=p.normalizeEmoji(e["char"]),e.id=e["char"]}),o["default"].resolve(e)):(u.error("models:recentEmoji:findQuery error",e)(),o["default"].reject("recent emoji fetch error"))}):o["default"].reject("gk recent emoji sync unsupported")},sync:function(){var e=this;return this.findQuery(this.dirty)["finally"](function(){e.dirty=!1})["catch"](f.WapDrop,_.isString,_.noop)},_sync:_.throttle(function(e,t){e.sync()["finally"](t)},l.EMOJI_SYNC_DELAY,{leading:!1}),periodicSync:function(){h.supportsFeature(h.F.RECENT_EMOJI_SYNC)&&(u.log("models:recentEmoji:periodicSync due:"+this.syncDue+" dirty: "+this.dirty)(),this.syncDue=!0,this._sync(this,function(){this.syncDue=!1}.bind(this)))},sortTrimScale:function(){var e=this.length;e&&(this.sort(),e>30&&this.remove(this.models.slice(30)),_.head(this.models).weight<10&&_.last(this.models).weight>.01||this.forEach(function(t,a){t.weight=1+3*((e-a)/e)}))},increment:function(e){this.forEach(function(t){t["char"]===e?t.weight+=1:t.weight*=.9,t.weight=Math.round(1e3*t.weight)/1e3}),this.get(e)||this.add({id:e,"char":e,weight:1}),this.dirty=!0,this.periodicSync()}});e.exports=new m},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(462),s=n(r),l=a(464),u=a(23),c=a(61),d=a(1),f=l.extend({model:s["default"],initialize:function(){var e=this;this.syncPromise=null,this.isSynced=!1,this.listenTo(u,"change:stream",function(){u.stream===u.STREAM.DISCONNECTED&&(e.isSynced=!1)})},comparator:function(e,t){return t.t-e.t},onResume:function(){this.isSynced=!1,this.sync()},sync:function(){var e=this;return this.isSynced?o["default"].resolve():this.syncPromise?this.syncPromise:c.supportsFeature(c.F.STARRED_GIFS)?(this.syncPromise=Store.Msg.getStarred(void 0,void 0,void 0,!0).then(function(t){var a=[];t&&t.length&&(a=_.filter(t,function(e){return e.isGif&&!e.isUnsentMedia})),e.set(a)})["catch"](function(e){499!==e&&d.error("starred gif msgs sync error: ",e)()})["finally"](function(){e.syncPromise=null,e.isSynced=!0}),this.syncPromise):o["default"].resolve()},add:function(e,t){if(e&&c.supportsFeature(c.F.STARRED_GIFS)&&(!this.isModel(e)||e.isGif&&!this.get(e))){var a=_.filter(e,function(e){return e.isGif});return l.prototype.add.call(this,a,t)}},remove:function(e,t){if(e&&c.supportsFeature(c.F.STARRED_GIFS)&&(!this.isModel(e)||e.isGif&&this.get(e))){var a=_.filter(e,function(e){return e.isGif});l.prototype.remove.call(this,a,t)}}});e.exports=f},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(1446),s=n(r),l=a(97),u=n(l),c=a(243),d=a(5),f=a(1),p=a(464),h=a(47),m=a(15),v=a(23),g=a(12),y=a(61),E=a(14),M=p.extend({model:s["default"],initialize:function(){p.prototype.initialize.call(this,{staleCollection:!0,resumeOnAvailable:!0}),this.listenTo(u["default"],"change:phoneActive",function(){u["default"].phoneActive&&this.onPhoneActive()})},onPhoneActive:function(){v.stream===v.STREAM.CONNECTED&&this._onResume()},onResume:function(){this.filter(_.property("_uiObservers")).forEach(function(e){Store.Status.find(e.id)["catch"](m.WapDrop,_.noop)})},_find:function(e){var t=this,a=E.STATUS_V2?h.statusFind(e).then(function(a){var n={id:e};if(_.isNumber(a.status))switch(a.status){case 423:n.stale=!0,n.status="";break;case 429:n.stale=!0,_.isString(t.get(e).status)||(n.status="");break;default:n.status=""}else n.status=a.status;return n})["catch"](m.WapDrop,function(){return{id:e,stale:!0,status:""}}):o["default"].resolve({id:e,status:""});return a},_handle:function(e){return e},canSetMyStatus:function(){return y.supportsFeature(y.F.SET_STATUS)&&!!E.STATUS_V2},setMyStatus:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments[1];if(t=t.trim(),!t)return o["default"].reject(new m.ActionError);if(!this.canSetMyStatus())return o["default"].reject(new m.ActionError);var n=h.sendSetStatus(t),i=new c.ActionType(l10n.t("action_status_setting")),r=this.get(Store.Conn.me).status;a=a||(0,c.genId)();var s=n.then(function(t){return 200===t.status?new c.ActionType(l10n.t("action_status_set"),l10n.t("action_undo"),e.setMyStatus.bind(e,r,a)):t.status>=400?new c.ActionType(l10n.t("action_status_set_failed")):void 0})["catch"](function(n){throw f.error("models:statusCollection:setMyStatus dropped")(n),new c.ActionType(l10n.t("action_status_set_failed"),l10n.t("action_try_again"),e.setMyStatus.bind(e,t,a))});return g.openToast(d.createElement(c.ActionToast,{id:a,initialAction:i,pendingAction:s})),n.bind(this).then(function(e){200!==e.status||e._duplicate||(this.get(Store.Conn.me).status=t)})}});e.exports=new M},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(1420),s=n(r),l=a(79),u=n(l),c=a(64),d=n(c),f=a(464),p=a(14),h=a(15),m=a(1),v=a(47),g=86400,y=f.extend({model:s["default"],initialize:function(){f.prototype.initialize.call(this)},"delete":function(){f.prototype["delete"].call(this),delete this.checksum},_find:function(e){return o["default"].resolve({id:e})},_findQuery:function(e){var t=this;return v.statusQuery().then(function(e){return t.checksum=e.checksum,o["default"].map(e.statuses,function(e){var t=e.pic;return t?d["default"].createFromData(t,"image/jpeg").then(function(t){return e.pic=t,e}):e})})},loadMore:function(e,t,a){return v.statusQuery(e,t,a&&a.id,"after").then(function(e){return e.status>=400?(m.error("model:statusv3:findQuery error "+e.status)(),o["default"].reject(e.status)):(e.forEach(function(e){e.invis=!0}),m.log("model:statusv3:loadMore:"+e.length)(),Store.Msg.processMultipleMessages(p.STATUS_WID,e,{add:"after",isHistory:!0}))})},sync:function(e){return!e||this.checksum&&this.checksum!==e?this.findQuery({},{set:this.hasSynced()})["catch"](h.WapDrop,_.noop):o["default"].resolve(void 0)},hasSynced:function(){return!!this.checksum},handleUpdate:function(e,t,a){var n=e.id.fromMe?Store.Conn.me:e.author;if(this.updateChecksum(t),this.hasSynced()){if(a)return!0;var i=this.get(n);if(i){var o=i.totalCount===i.msgs.length;return e.invis||i.unreadCount++,i.totalCount++,i.t=e.t,!o&&e.body&&d["default"].createFromBase64Jpeg(e.body).then(function(e){i.pic=e}),o}return this.add({id:n,t:e.t,unreadCount:e.invis?0:1,totalCount:1,_msgs:[e]}),!1}return!1},updateChecksum:function(e){e?this.hasSynced()&&(this.checksum=e):m.info("models:statusV3:no_checksum")()},handle:function(e){var t=e.shift();if(_.isArray(t))m.warn("models:statusV3:unexpected update")(t);else switch(t.type){case"read":this.updateChecksum(t.checksum);var a=this.get(t.chat);a?a.handleReadStatus(t.key):m.log("models:statusV3:read:no_status:"+[t.chat,t.key].join())(t);break;case"privacy":Store.StatusV3Privacy.update(t);break;default:m.warn("models:statusV3:unknown:"+t.type,t)()}},addStatusMessages:function(e,t){return Store.Msg.processMultipleMessages(p.STATUS_WID,t,{add:"after",isHistory:!0})},getUnexpired:function(e){var t=this.filter(function(e){return e.totalCount>0&&u["default"].globalUnixTime()-e.t<=g&&!e.contact.isMe});if(e){var a=_.sortBy(_.filter(t,function(e){return e.unreadCount>0}),function(e){return e.t});return a.reverse(),a}var n=_.sortBy(_.filter(t,function(e){return 0===e.unreadCount}),function(e){return e.t});return n.reverse(),n},getMyStatus:function(){var e=this.filter(function(e){return e.contact.isMe});return _.isEmpty(e)?void 0:u["default"].globalUnixTime()-e[0].t>g?void 0:e[0]}});e.exports=new y},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(80),s=n(r),l=a(1),u=a(23),c=a(47),d=a(22),f=(0,r.defineState)("StatusPrivacy",{props:{id:"number",blacklist:{type:"array","default":function(){return[]}},whitelist:{type:"array","default":function(){return[]}},type:"string"},session:{isValid:"boolean"},initialize:function(){var e=this;s["default"].prototype.initialize.call(this),this.isValid=!1,this.listenTo(u,"change:stream",function(){u.stream===u.STREAM.RESUMING&&(e.isValid=!1)})},query:function(){var e=this;return c.getStatusPrivacy().then(function(t){switch(t.status){case 200:e.set({blacklist:t.blacklist,whitelist:t.whitelist,type:t["default"],isValid:!0});break;case 404:e.set({type:"contacts",isValid:!0});break;default:return l.error("statusV3Privacy:query:error:"+t.status,t)(),o["default"].reject(t.status)}})},update:function(e){this.isValid&&(e.whitelist&&this.set({type:"whitelist",whitelist:e.whitelist}),e.blacklist&&this.set({type:"blacklist",blacklist:e.blacklist}),e.contacts&&(this.type="contacts"))},sendSetPrivacy:function(e,t){var a=this;if(!this.isValid)return o["default"].reject("called setPrivacy when isValid false");var n;switch(e){case"blacklist":case"whitelist":if(n=_.isArray(t)?t.filter(function(e){return d.isUser(e)}):void 0,!_.isArray(n)||0===n.length)return o["default"].reject("called setPrivacy blacklist/whitelist with no valid jids");break;case"contacts":break;default:e="contacts"}return c.setStatusPrivacy(e,n).then(function(t){if(200===t.status){var i={};i[e]=n,a.update(i)}return t})["catch"](function(e){})}}),p=f.StatusPrivacy;e.exports=new p({id:1})},function(e,t){"use strict";e.exports={Action:"keyboard_action",Event:"keyboard_event",Events:{LOGGED_IN:"logged_in",LOGGED_OUT:"logged_out",ARCHIVE:"archived",MUTE:"muted",READ:"read",READ_ONLY:"read_only",CHAT_KIND:"chat_kind",ZOOM:"zoom",LAUNCH:"launch"},Actions:{PREFERENCES:"preferences",NEW_CHAT:"new_chat",NEW_GROUP:"new_group",PROFILE_STATUS:"profile_status",LOGOUT:"logout",SEARCH:"search",ZOOM_IN:"zoom_in",ZOOM_OUT:"zoom_out",ZOOM_RESET:"zoom_reset",TOGGLE_UNREAD:"toggle_unread",DELETE_CHAT:"delete_chat",DELETE_GROUP:"delete_group",EXIT_GROUP:"exit_group",TOGGLE_ARCHIVE:"toggle_archive",TOGGLE_MUTE:"toggle_mute",SEARCH_CHAT:"search_chat",NEXT_CHAT:"next_chat",PREV_CHAT:"prev_chat",CONTACT_US:"contact_us",METRIC_UPDATE:"metric_update"},Metrics:{BETA_UPDATES:"beta_updates"}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(12),y=n(_),E=a(14),M=n(E),S=a(15),C=n(S),b=a(467),k=n(b),T=a(78),w=n(T),N=a(1729),P=n(N),A=a(256),O=a(97),R=n(O),D=a(22),x=n(D);t["default"]=(0,w["default"])(function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),n.tone=new window.Audio(M["default"].NOTIFICATION_TONE_PATH),n.count=0,n.closeNotifications=function(e,t){t||P["default"].closeChatNotifications(e.id)},n.updateUnreadCount=function(){var e;e=R["default"].displayInfo===R["default"].INFO.OFFLINE?-1:R["default"].displayInfo===R["default"].INFO.TIMEOUT?-1:Store.Chat.filter(function(e){return!e.archive&&e.isDirty()}).length,n.count!==e&&(n.count=e,(0,A.setTitleAndIcon)(e))},n.alertNewMsg=function(e){var t=e.chat;if(!(document.hasFocus()&&t.get("active")||Store.Mute.globalMute().isMuted)){if(t.mute.isMuted){if(!e.isGroupMsg)return;if(!e.isMentioned(Store.Conn.me)&&!e.isQuoted(Store.Conn.me))return;var a=Store.Chat.get(e.sender);if(a&&a.mute.isMuted)return}if(!n.matchesFilter(e)&&(Store.Mute.getGlobalNotifications()&&n.showDesktopNotification(e),Store.Mute.getGlobalSounds()))if(t.isGroup){
var i=Date.now(),o=t.squelch||0;i>o&&(n.playAudioNotification(),Store.GroupMetadata.find(t.id).then(function(e){var a=e.participants.length,n=1e3*Math.min(120,30+5*a);t.squelch=i+n})["catch"](C["default"].WapDrop,function(){t.squelch=i+6e4}))}else n.playAudioNotification()}},n.showCallNotification=function(e,t,a){if(window.Notification&&window.Notification.permission===M["default"].PERMISSION_ALLOWED){var i=Store.Contact.get(t),r=i?i.get("formattedName"):x["default"].formattedUser(t),s=a?l10n.t("incoming_video_call_notification_title",{name:r}):l10n.t("incoming_voice_call_notification_title",{name:r}),l=l10n.t("incoming_call_notification_text");Store.ProfilePicThumb.find(t).timeout(1e3,"showCallNotificationTimeout").then(function(a){var n=a&&a.img?a.img:M["default"].USER_DEFAULT_ICON;P["default"].showNotification(t,e,s,l,n,!0)})["catch"](C["default"].WapDrop,o["default"].TimeoutError,function(a){P["default"].showNotification(t,e,s,l,M["default"].USER_DEFAULT_ICON,!0)}),Store.Mute.getGlobalSounds()&&n.playAudioNotification()}},n.cancelCallNotification=function(e){P["default"].closeNotification(e),Store.Call.remove(Store.Call.get(e))},n.showDesktopNotification=function(e){if(window.Notification&&window.Notification.permission===M["default"].PERMISSION_ALLOWED){var t=e.get("chat"),a=t.get("id"),n=k["default"].asDesktopNotification(e);n&&n.charCodeAt(0)>=128&&(n=" "+n);var i=t.isGroup?M["default"].GROUP_DEFAULT_ICON:M["default"].USER_DEFAULT_ICON,r=t.isGroup?l10n.t("default_group_message_notification_title"):l10n.t("default_contact_message_notification_title");Store.ProfilePicThumb.find(a).timeout(1500,"showDesktopNotificationTimeout").then(function(o){var s=t.contact.formattedName||r,l=o?o.img:"";P["default"].showNotification(a,e.id,s,n,l||i,!1)})["catch"](C["default"].WapDrop,o["default"].TimeoutError,function(o){var s=t.contact.formattedName||r;P["default"].showNotification(a,e.id,s,n,i,!1)})}},n.playAudioNotification=function(){n.tone.play()},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentDidMount",value:function(){var e=this.props.listeners;e.add(y["default"],"alert_new_msg",this.alertNewMsg),e.add(y["default"],"alert_call",this.showCallNotification),e.add(y["default"],"cancel_call",this.cancelCallNotification),e.add(Store.Chat,"add remove reset change:archive change:unreadCount",this.updateUnreadCount),e.add(Store.Chat,"change:hasUnread",this.closeNotifications),e.add(R["default"],"change:displayInfo",this.updateUnreadCount),this.updateUnreadCount()}},{key:"componentWillUnmount",value:function(){(0,A.setTitleAndIcon)(0),P["default"].closeAllNotifications()}},{key:"matchesFilter",value:function(e){return!1}},{key:"render",value:function(){return null}}]),t}(g["default"].Component))},function(e,t,a){"use strict";function n(e){s(this,n,e)}function i(e){s(this,i,e)}var o=a(123),r=o.defineProtobufClass,s=o.construct,l=3,u=13,c=14;r(n,{publicKey:[1,u],identifier:[2,u]}),r(i,{version:[1,l],localFingerprint:[2,c,n],remoteFingerprint:[3,c,n]}),e.exports={FingerprintData:n,CombinedFingerprint:i}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(1402),g=n(v),_=a(1427),y=n(_),E=a(1528),M=n(E),S=a(1420),C=(n(S),a(241)),b=(n(C),a(79)),k=n(b),T=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.statusV3,a=e.contact;return m["default"].createElement(y["default"],{id:t.id,key:t.id,customImage:!0,image:m["default"].createElement(M["default"],{statusV3:t}),primary:a.formattedName,secondary:k["default"].relativeDateAndTimeStr(t.t),onClick:this.props.onClick,contextEnabled:function(){return!1}})}}]),t}(h.PureComponent);T.CONCERNS={statusV3:["id","t"],contact:["formattedName"]},t["default"]=(0,g["default"])(T)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(62),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(1402),y=n(_),E=a(1420),M=(n(E),a(21)),S=n(M),C=50,b=10,k=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"genCircle",value:function(e){var t=2*C+this.props.stroke;return g["default"].createElement("circle",(0,o["default"])({cx:t/2,cy:t/2,r:C,fill:"none",strokeLinecap:"round",strokeWidth:this.props.stroke},e))}},{key:"genDasharray",value:function(e,t,a){for(var n="",i=0;e>i;i++)n+=i===e-1?t+" "+(a-e*(b+t)+b)+" ":t+" "+b+" ";return n}},{key:"render",value:function(){var e=this.props,t=e.statusV3,a=e.stroke,n=e.size,i=2*C+a,o="0 0 "+i+" "+i,r=t.totalCount-t.expiredCount,s=Math.PI*C*2,l=(s-b*r)/r,u=s/4-b/2,c=void 0,d=r-t.unreadCount;if(d){var f=u+r*(b+l),p=void 0;1!==r&&(p=this.genDasharray(d,l,s)),c=this.genCircle({strokeDashoffset:f,strokeDasharray:p,className:"image-ring-read"})}var h=void 0;if(t.unreadCount){var m=u+t.unreadCount*(b+l),v=void 0;1!==r&&(v=this.genDasharray(t.unreadCount,l,s)),h=this.genCircle({strokeDashoffset:m,strokeDasharray:v,className:"image-ring-unread"})}return g["default"].createElement("svg",{className:(0,S["default"])("status-image-ring",this.props.className),width:n,height:n,viewBox:o},c,h)}}]),t}(v.PureComponent);k.CONCERNS={statusV3:["unreadCount","totalCount","expiredCount"]},k.defaultProps={size:48,stroke:4},t["default"]=(0,y["default"])(k)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(5),m=n(h),v=a(78),g=n(v),_=a(160),y=n(_),E=a(1645),M=n(E),S=a(12),C=n(S),b=a(13),k=n(b),T=a(1440),w=T.MenuBarItem,N=function(e){function t(){var e,a,n,i;(0,s["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return a=n=(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),n.state={hasUnread:!1},n.onUnreadChange=function(){var e=k["default"].some(Store.StatusV3.getUnexpired(!0),function(e){return e.unreadCount>0});e!==n.state.hasUnread&&n.setState({hasUnread:e})},i=a,(0,d["default"])(n,i)}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.props.listeners.add(Store.StatusV3,"add remove change:unreadCount",this.onUnreadChange)}},{key:"onStatus",value:function(e){e.preventDefault(),C["default"].openModalMedia(m["default"].createElement(M["default"],{removeTopDrawer:!1}),"status-v3-modal")}},{key:"render",value:function(){var e=this.state.hasUnread?"icon-status-v3-unread":"icon-status-v3";return m["default"].createElement(w,{icon:e,a8n:"menu-bar-status",title:y["default"].t("web_menuitem_status"),onClick:this.onStatus})}}]),t}(h.PureComponent);N.CONCERNS={statusV3:["unreadCount"]},t["default"]=(0,g["default"])(N)},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.StatusV3GifController=t.StatusV3CountdownController=t.StatusV3VideoController=void 0;var i=a(4),o=n(i),r=a(3),s=n(r),l=a(1),u=t.StatusV3VideoController=function p(){var e=this;(0,s["default"])(this,p),this.addListeners=function(t,a,n){e._onStart=t,e._onPause=a,e._onEnded=n},this.setVideo=function(t){e._video=t,e._video.addEventListener("playing",e._onPlayingHandler),e._video.addEventListener("pause",e._onPauseHandler),e._video.addEventListener("ended",e._onEndedHandler)},this.play=function(){e._video&&e._video.play()},this.pause=function(){e._video&&!e._video.paused&&e._video.pause()},this.resume=function(){e._video&&e._video.play()},this.stop=function(){e._video&&!e._video.paused&&e._video.pause()},this._onPlayingHandler=function(){var t=e._onStart;t&&t(1e3*(e._video.duration-e._video.currentTime),1e3*e._video.duration)},this._onPauseHandler=function(){var t=e._onPause;t&&t()},this._onEndedHandler=function(){var t=e._onEnded;t&&t()}},c=t.StatusV3CountdownController=function h(e){var t=this;(0,s["default"])(this,h),this.addListeners=function(e,a,n){t._onStart=e,t._onPause=a,t._onEnded=n},this.play=function(){if(t._timer)return void l.error("Duplicate timer start")();t._timer=setTimeout(t._onTimeup,t._timeout),t._start=(new Date).getTime();var e=t._onStart;e&&e(t._timeout,t._duration)},this.stop=function(){if(t._timer){clearTimeout(t._timer),t._timer=null;var e=(new Date).getTime();t._timeout-=e-t._start;var a=t._onPause;a&&a()}else l.error("Timer stop called on stopped timer")()},this.resume=function(){t.play()},this.pause=function(){t.stop()},this._onTimeup=function(){var e=t._onEnded;e&&e()},this._duration=e,this._timeout=this._duration,this._start=0},d=6e3,f=3;t.StatusV3GifController=function(){function e(){var t=this;(0,s["default"])(this,e),this.setVideo=function(e){t._video=e,t._videoController.setVideo(e)},this._onVideoStartHandler=function(){var e=t._onStart,a=Math.max(f*t._video.duration*1e3,d);e&&e(a-1e3*t._video.duration*t._playCounter-1e3*t._video.currentTime,a)},this._onVideoPauseHandler=function(){var e=t._onPause;e&&e()},this._onVideoEndedHandler=function(){t._playCounter++;var e=t._onEnded;t._playCounter===f&&(t._videoEnded=!0,t._timerEnded&&e&&e()),t._video.currentTime=0,t._videoEnded&&t._timerEnded||setTimeout(function(){t._videoController.play()},0)},this._onTimerEndedHandler=function(){var e=t._onEnded;t._timerEnded=!0,e&&t._videoEnded&&e()},this.play=function(){t._videoController.play(),t._countdownController.play()},this.stop=function(){t._videoController.stop(),t._countdownController.stop()},this.resume=function(){t._videoController.resume(),t._countdownController.resume()},this.pause=function(){t._videoController.pause(),t._countdownController.pause()},this._playCounter=0,this._timerEnded=!1,this._videoEnded=!1,this._videoController=new u,this._countdownController=new c(d),this._videoController.addListeners(this._onVideoStartHandler,this._onVideoPauseHandler,this._onVideoEndedHandler),this._countdownController.addListeners(void 0,void 0,this._onTimerEndedHandler)}return(0,o["default"])(e,[{key:"addListeners",value:function(e,t,a){this._onStart=e,this._onPause=t,this._onEnded=a}}]),e}()},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(463),y=n(_),E=a(46),M=a(21),S=function(e){function t(){(0,u["default"])(this,t);var e=(0,p["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments));return e.onStart=function(t,a){var n=E.findDOMNode(e.refs.bar),i="-"+t/a*100+"%";(0,y["default"])(n,"stop"),e.barAnimation=(0,y["default"])(n,{translateX:["0%",i]},{duration:t,easing:"linear"})},e.onPause=function(){var t=E.findDOMNode(e.refs.bar);(0,y["default"])(t,"stop")},e.onEnded=function(){return e.barAnimation?e.barAnimation:o["default"].resolve()},e}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){for(var e=[],t=100/this.props.total+"%",a=0;a<this.props.total;++a){var n=M("progress-bar-fg",{"v3-pgbar-filled":a<this.props.current,"v3-pgbar-empty":a>this.props.current,"v3-pgbar-active":a===this.props.current}),i={width:t},o=void 0;a===this.props.current&&(o="bar");var r=g["default"].createElement("div",{className:"progress-bar-wrapper",style:i,key:a},g["default"].createElement("div",{className:"progress-bar-bg"}),g["default"].createElement("div",{className:"progress-bar-mask"},g["default"].createElement("div",{className:n,ref:o})));e.push(r)}return g["default"].createElement("div",{className:"progress-bar-container"},e)}}]),t}(g["default"].Component);e.exports=S},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(3),o=n(i),r=a(4),s=n(r),l=function(){function e(){(0,o["default"])(this,e),this.activeNotifications={}}return(0,s["default"])(e,[{key:"showNotification",value:function(e,t,a){this.activeNotifications[e]||(this.activeNotifications[e]={});var n=this.activeNotifications[e][t];n&&n.close&&n.close(),this.activeNotifications[e][t]=a}},{key:"closeNotification",value:function(e){var t=_.findKey(this.activeNotifications,function(t){return!!t[e]});if(t){var a=this.activeNotifications[t][e];a.close&&a.close(),delete this.activeNotifications[t][e],_.isEmpty(this.activeNotifications[t])&&delete this.activeNotifications[t]}}},{key:"closeChatNotifications",value:function(e){_.forEach(this.activeNotifications[e],function(e,t){e&&e.close&&e.close()}),delete this.activeNotifications[e]}},{key:"closeAllNotifications",value:function(){_.forEach(this.activeNotifications,function(e,t){_.forEach(e,function(e,t){e&&e.close&&e.close()})}),this.activeNotifications={}}}]),e}();e.exports=l},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y,n={q:e,SafeSearch:"Strict",appid:m,mkt:_[l10n.getLocale()]||_.en,size:g.MEDIUM,aspect:v.SQUARE,count:a,offset:t},i=p.build(h,n);return u["default"].get(i,u["default"].RESP_TYPE.JSON).then(function(t){if(!t.response.hasOwnProperty("_type"))throw new d.InvalidServerResponseError(i,status,"Not a valid Bing response: "+(0,s["default"])(t.response));if("ErrorResponse"===t.response._type){var a=t.response;throw new d.BingServerError(e,t.status,a)}if("Images"!==t.response._type)throw new d.InvalidServerResponseError(i,status,"Did not receive an image search response, potentially malformed query "+(0,s["default"])(t.response));return t.response})}Object.defineProperty(t,"__esModule",{value:!0});var r=a(27),s=i(r);t.search=o;var l=a(99),u=i(l),c=a(15),d=n(c),f=a(48),p=n(f),h="https://www.bingapis.com/api/v6/images/search",m="D41D8CD98F00B204E9800998ECF8427E4F4A7492",v={SQUARE:"Square",WIDE:"Wide",TALL:"Tall",ALL:"All"},g={SMALL:"Small",MEDIUM:"Medium",LARGE:"Large",WALLPAPER:"Wallpaper",ALL:"All"},_={ar:"ar-SA",da:"da-DK",de:"de-DE",en:"en-US",es:"es-US",fi:"fi-FI",fr:"fr-FR",it:"it-IT",ko:"ko-KR",nl:"nl-NL",pl:"pl-PL","pt-BR":"pt-BR",ru:"ru-RU",sv:"sv-SE",tr:"tr-TR","zh-CN":"zh-CN","zh-TW":"zh-TW"},y=30},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(2),o=n(i),r=a(1731),s=a(119),l=a(1),u={enrich:function(e){switch(s.previewType(e.mimetype)){case"pdf":return this.enrichPdf(e);case"msoffice":return this.enrichDoc(e);default:return o["default"].resolve({media:e})}},enrichPdf:function(e){var t,a=e.mediaBlob;return r.fileToPdf(a).then(function(a){return t=a,r.pdfToImg(a,1).then(function(t){var n=t;return n.pdfPages=a.numPages,{media:e,documentPreview:n}})})["catch"](function(t){return l.log("pdf preview generation failed",t)(),{media:e}})["finally"](function(){t&&r.releasePdf(t)})},enrichDoc:function(e){return o["default"].resolve({media:e})}};e.exports=u},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return d["default"].loop(function(t,n,i){var o=d["default"].delay(S["default"].expBackoff(i,12e4,1e3,.1));return a(1534)("./"+e+"/translation.json")().then(t)["catch"](function(){return o})})["catch"](function(){return{}})}function o(){var e=["en"],t=l10n.getLocale();"en"!==t&&_.indexOf(k,t)>=0&&e.push(t),P=d["default"].map(e,function(e){return i(e)}).then(function(e){var t=e[0];e.length>1&&(t=_.assign({},t,e[1]));var a=_.map(t,function(e,t){var a=t.substring(0,5);return{value:e,keyword:t,shortKeyword:a}});N=(0,p["default"])(a,"shortKeyword")})["catch"](_.noop)["finally"](function(){P=null})}function r(e){if(!N)return[];if(e.length<=5)return N.getMatches(e);var t=e.substring(0,5),a=N.getMatches(t);return a=_.filter(a,function(t){return _.startsWith(t.keyword,e)})}function s(e){var t=[];if(e){var a=l(e.toLowerCase());t=_.uniq(a)}return t}function l(e){var t=r(e),a=_.flatMap(_.filter(t,{keyword:e}),"value");t=_.flatMap(t,"value");var n=_.intersection(_.map(Store.RecentEmoji.models,"char"),t),i=_.intersection(T,t),o=_.intersection(_.union(n,i),a);return o=_.compact(_.map(o,function(e){return m["default"].emojiMap[e]})),a=_.compact(_.map(a,function(e){return m["default"].emojiMap[e]})),a=u(a),n=_.compact(_.map(n,function(e){return m["default"].emojiMap[e]})),i=_.compact(_.map(i,function(e){return m["default"].emojiMap[e]})),t=_.compact(_.map(t,function(e){return m["default"].emojiMap[e]})),t=_.difference(t,_.union(a,n,i)),t=u(t),_.union(o,a,n,i,t)}function u(e){var t={};return _.forEach(w,function(e){t[e]=[]}),_.forEach(e,function(e){var a=m["default"].getCategoryString(e);t[a].push(e)}),_.forEach(t,function(e,a){e.length>0&&(t[a]=_.intersection(g["default"][a],e))}),_.flatMap(t)}Object.defineProperty(t,"__esModule",{value:!0});var c=a(2),d=n(c);t["default"]=s;var f=a(1312),p=n(f),h=a(118),m=n(h),v=a(483),g=n(v),y=a(12),E=n(y),M=a(56),S=n(M),C=a(42),b=n(C),k=["en","de","es","it","pt","ru"],T=["ðŸ˜‚","ðŸ˜","ðŸ˜˜","ðŸ¤£","ðŸ˜€","â¤ï¸","ðŸ˜‰","ðŸ˜Š","ðŸ¤”","ðŸ˜­","ðŸ˜","ðŸ˜œ","ðŸ‘","ðŸ˜Ž","ðŸ‘","ðŸ˜¬","ðŸ˜†","ðŸ™‚","ðŸ˜‡","ðŸ˜ ","ðŸ˜…","â˜ºï¸","ðŸ¤—","ðŸ˜„","ðŸ˜’","ðŸ˜ƒ","ðŸ˜","ðŸ˜Œ","ðŸ‘Œ","ðŸ˜","ðŸ™ƒ","ðŸ˜‹","ðŸŽ‚","ðŸ˜¡","ðŸ˜±","ðŸ™","ðŸ˜”","ðŸ˜¢","ðŸ˜³","ðŸ˜ž","ðŸ¤¤","ðŸ‘Š","ðŸ˜›","ðŸ˜š","ðŸ™„","ðŸ’•","âœŒï¸","ðŸ’ª","ðŸ’ž","ðŸŒ¹"],w=["SMILEYS_PEOPLE","ANIMALS_NATURE","FOOD_DRINK","ACTIVITY","TRAVEL_PLACES","OBJECTS","SYMBOLS","FLAGS","VARIATION"],N=null,P=null;E["default"].on("locale_change",function(){P&&P.cancel(),o()}),b["default"].waitForBBEvent(Store.Stream,"change:mode",function(){return Store.Stream.mode===Store.Stream.MODE.MAIN}).then(function(){P||o()})},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(3),o=n(i),r=a(4),s=n(r),l=function(){function e(){(0,o["default"])(this,e)}return(0,s["default"])(e,[{key:"on",value:function(e,t,a){throw new Error("Unimplemented!")}},{key:"once",value:function(e,t,a){throw new Error("Unimplemented!")}},{key:"off",value:function(e,t,a){throw new Error("Unimplemented!")}},{key:"trigger",value:function(e){throw new Error("Unimplemented!")}},{key:"stopListening",value:function(e,t,a){throw new Error("Unimplemented!")}},{key:"listenTo",value:function(){throw new Error("Unimplemented!")}},{key:"listenToOnce",value:function(){throw new Error("Unimplemented!")}},{key:"listenToAndRun",value:function(e,t,a){throw new Error("Unimplemented!")}}]),e}();t["default"]=l},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(3),o=n(i),r=a(4),s=n(r),l=function(){function e(){(0,o["default"])(this,e)}return(0,s["default"])(e,[{key:"trigger",value:function(e){}}]),e}();e.exports=new l},function(e,t,a){"use strict";var n=a(1417),i=3;e.exports={minHeight:function(e,t){return{minHeight:e.length>i?i*n.DEFAULT_HEIGHT+t:e.length*n.DEFAULT_HEIGHT+t}}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(1728),m=function(e){function t(e,a,n){(0,s["default"])(this,t);var i=(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this));return i._delimiter=e,i._regex=a,i._group=n,i}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"match",value:function a(e){for(var t=[],a=void 0;a=this._regex.exec(e);){var n=this._delimiter.length,i=2*n+a[this._group].length;if(a[0].length!==i){var o=a[0].length-i;a.index+=o,a[0]=a[0].slice(o)}this._regex.lastIndex--,t.push(a)}return t}},{key:"group",get:function(){return this._group}},{key:"isFormatter",get:function(){return!0}}]),t}(h);e.exports=m},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(7),p=n(f),h=a(1725),m=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,"```",/```([\s\S]+?)```/g,1))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"formatResult",get:function(){return!1}}]),t}(h);e.exports=m},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(121),o=n(i),r=a(120),s=n(r),l=a(62),u=n(l);e.exports={},e.exports.matchAll=function(e,t,a){for(var n=[],i=void 0;i=e.exec(t);){var o=a?a(i,e):i;o&&n.push(o)}return n};var c=a(21),d=a(5),f=d.createElement,p=0,h=function(e){return function(t,a,n){return f(e,(0,u["default"])({key:"k-"+p++},n),a)}},m=function(){for(var e=arguments.length,t=Array(e),a=0;e>a;a++)t[a]=arguments[a];var n=t.filter(function(e){return!!e});return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new s["default"],t=arguments[1],a=arguments[2];return n.reduce(function(n,i){var r=i(e,t,a)||{},s=c(n.className,r.className);return(0,o["default"])(n,r,s?{className:s}:{})},{})}},v=function(e,t){return function(a,n,i){return e(a,n,t(i,a,n))}},g=function(e,t){return m(function(e){return e.get("default")},function(t){return t.get(e)},t)},_=function(e,t,a){return v(h(e),g(t,a))};e.exports.jsx={make:_}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(3),o=n(i),r=a(4),s=n(r),l=a(166),u=function(){function e(){(0,o["default"])(this,e)}return(0,s["default"])(e,[{key:"match",value:function(e){l(!1,"Subclasses of `Mutator` must implement `match(text)`")}},{key:"mutate",value:function(e,t){return e}},{key:"group",get:function(){return 0}},{key:"isFragment",get:function(){return!1}},{key:"isFormatter",get:function(){return!1}},{key:"alwaysApply",get:function(){return!1}},{key:"formatResult",get:function(){return!0}},{key:"mutates",get:function(){return this.mutate!==e.prototype.mutate}}]),e}();e.exports=u},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(6),o=n(i),r=a(3),s=n(r),l=a(4),u=n(l),c=a(8),d=n(c),f=a(473),p=n(f),h=a(7),m=n(h),v=a(1),g=a(14),y=a(118),E=a(1718),M=a(48),S=a(12),C=function(e){function t(){var e;(0,s["default"])(this,t);for(var a=arguments.length,n=Array(a),i=0;a>i;i++)n[i]=arguments[i];return(0,d["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(n)))}return(0,m["default"])(t,e),(0,u["default"])(t,[{key:"showNotification",value:function(e,a,n,i,r,s){var l,u=this;try{l=new window.Notification(y.normalizeEmoji(n),{body:y.normalizeEmoji(i),tag:s?a:e,icon:M.relToAbs(r),dir:"auto",lang:l10n.lng(),silent:!0})}catch(c){window.Notification=void 0}if(!l)return void v.log("notificationManager:showDesktopNotification: could not create Notification")();(0,p["default"])(t.prototype.__proto__||(0,o["default"])(t.prototype),"showNotification",this).call(this,e,a,l);var d=function f(){window.removeEventListener("unload",f),u.closeNotification(a)};l.onclick=function(){window.focus();var t=Store.Chat.get(e),n=s?void 0:Store.Msg.get(a);if(t){var i=n&&n!==t.msgs.last()?t.getSearchContext(n):void 0;S.openChatAt(t,i).then(function(e){e&&S.focusChatTextInput(t)}),d()}},l.onclose=d,l.onshow=function(){_.delay(d,s?g.CALL_NOTIFICATION_TIMEOUT:g.NOTIFICATION_TIMEOUT)},_.delay(d,s?g.CALL_NOTIFICATION_TIMEOUT:5*g.NOTIFICATION_TIMEOUT),window.addEventListener("unload",d)}}]),t}(E);e.exports=new C},function(e,t,a){"use strict";var n=a(495),i=function o(e){if(!o.isRecordingSupported())throw"Recording is not supported in this browser";this.audioContext=new window.AudioContext,this.config=e=e||{},this.config.command="encode-init",this.config.bufferLength=e.bufferLength||4096,this.config.monitorGain=e.monitorGain||0,this.config.numberOfChannels=e.numberOfChannels||1,this.config.originalSampleRate=this.audioContext.sampleRate,this.config.encoderSampleRate=e.encoderSampleRate||48e3,this.config.streamPages=e.streamPages||!1,this.config.leaveStreamOpen=e.leaveStreamOpen||!1,this.config.maxBuffersPerPage=e.maxBuffersPerPage||40,this.config.encoderApplication=e.encoderApplication||2049,this.config.encoderFrameSize=e.encoderFrameSize||20,this.config.streamOptions=e.streamOptions||{optional:[],mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1}},this.storePage=this._storePage.bind(this),this.streamPage=this._streamPage.bind(this),this.state="inactive",this.eventTarget=document.createDocumentFragment(),this.createAudioNodes()};i.isRecordingSupported=function(){return window.AudioContext&&navigator.getUserMedia},i.prototype.addEventListener=function(e,t,a){this.eventTarget.addEventListener(e,t,a)},i.prototype.clearStream=function(){this.stream&&(this.stream.getTracks().forEach(function(e){e.stop()}),delete this.stream)},i.prototype.createAudioNodes=function(){var e=this;this.scriptProcessorNode=this.audioContext.createScriptProcessor(this.config.bufferLength,this.config.numberOfChannels,this.config.numberOfChannels),this.scriptProcessorNode.onaudioprocess=function(t){e.encodeBuffers(t.inputBuffer)},this.monitorNode=this.audioContext.createGain(),this.setMonitorGain(this.config.monitorGain),this.config.sampleRate<this.audioContext.sampleRate&&this.createButterworthFilter()},i.prototype.createButterworthFilter=function(){this.filterNode=this.audioContext.createBiquadFilter(),this.filterNode2=this.audioContext.createBiquadFilter(),this.filterNode3=this.audioContext.createBiquadFilter(),this.filterNode.type=this.filterNode2.type=this.filterNode3.type="lowpass";var e=this.config.sampleRate/2;this.filterNode.frequency.value=this.filterNode2.frequency.value=this.filterNode3.frequency.value=e-e/3.5355,this.filterNode.Q.value=.51764,this.filterNode2.Q.value=.70711,this.filterNode3.Q.value=1.93184,this.filterNode.connect(this.filterNode2),this.filterNode2.connect(this.filterNode3),this.filterNode3.connect(this.scriptProcessorNode)},i.prototype.encodeBuffers=function(e){if("recording"===this.state){for(var t=[],a=0;a<e.numberOfChannels;a++)t[a]=e.getChannelData(a);this.encoder.postMessage({command:"encode",buffers:t}),this.duration+=e.duration,this.eventTarget.dispatchEvent(new CustomEvent("duration",{detail:this.duration}))}},i.prototype.initStream=function(e){if(this.stream)return void this.eventTarget.dispatchEvent(new Event("streamReady"));if(e)return this.stream=e,this.sourceNode=this.audioContext.createMediaStreamSource(e),this.sourceNode.connect(this.filterNode||this.scriptProcessorNode),this.sourceNode.connect(this.monitorNode),void this.eventTarget.dispatchEvent(new Event("streamReady"));var t=this;navigator.getUserMedia({audio:this.config.streamOptions},function(e){t.stream=e,t.sourceNode=t.audioContext.createMediaStreamSource(e),t.sourceNode.connect(t.filterNode||t.scriptProcessorNode),t.sourceNode.connect(t.monitorNode),t.eventTarget.dispatchEvent(new Event("streamReady"))},function(e){t.eventTarget.dispatchEvent(new ErrorEvent("streamError",{error:e}))})},i.prototype.pause=function(){"recording"===this.state&&(this.state="paused",this.eventTarget.dispatchEvent(new Event("pause")))},i.prototype.removeEventListener=function(e,t,a){this.eventTarget.removeEventListener(e,t,a)},i.prototype.resume=function(){"paused"===this.state&&(this.state="recording",this.eventTarget.dispatchEvent(new Event("resume")))},i.prototype.setMonitorGain=function(e){this.monitorNode.gain.value=e},i.prototype.start=function(){"inactive"===this.state&&this.stream&&(this.encoder=new n,this.config.streamPages?this.encoder.addEventListener("message",this.streamPage):(this.recordedPages=[],this.totalLength=0,this.encoder.addEventListener("message",this.storePage)),this.encodeBuffers=function(){delete this.encodeBuffers},this.duration=0,this.state="recording",this.monitorNode.connect(this.audioContext.destination),this.scriptProcessorNode.connect(this.audioContext.destination),this.eventTarget.dispatchEvent(new Event("start")),this.eventTarget.dispatchEvent(new CustomEvent("duration",{detail:this.duration})),this.encoder.postMessage(this.config))},i.prototype.stop=function(){"inactive"!==this.state&&(this.state="inactive",this.audioContext.close&&this.audioContext.close(),this.monitorNode.disconnect(),this.scriptProcessorNode.disconnect(),this.config.leaveStreamOpen||this.clearStream(),this.encoder.postMessage({command:"encode-done"}))},i.prototype._storePage=function(e){var t=e.data;if(this.recordedPages.push(t),this.totalLength+=t.length,4&t[5]){this.encoder.removeEventListener("message",this.storePage);for(var a=new Uint8Array(this.totalLength),n=0,i=0;i<this.recordedPages.length;i++)a.set(this.recordedPages[i],n),n+=this.recordedPages[i].length;this.eventTarget.dispatchEvent(new CustomEvent("dataAvailable",{detail:new Blob([a],{type:"audio/ogg; codecs=opus"})})),this.recordedPages=[],this.eventTarget.dispatchEvent(new Event("stop"))}},i.prototype._streamPage=function(e){var t=e.data;this.eventTarget.dispatchEvent(new CustomEvent("dataAvailable",{detail:new Blob([t],{type:"audio/ogg; codecs=opus"})})),4&t[5]&&(this.encoder.removeEventListener("message",this.streamPage),this.eventTarget.dispatchEvent(new Event("stop")))},e.exports=i},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){return c["default"].loop(function(e,t,n){var i=c["default"].delay(f.expBackoff(n,12e4,0,0));return new c["default"](function(t,n){a.e(92).then(function(n){var i=a(1485);i.PDFJS.workerSrc="./pdf.worker.js",e(i),t(i)}.bind(null,a))["catch"](function(e){a.oe(e)})})["catch"](function(e){return i})})}var o=a(3),r=n(o),s=a(4),l=n(s),u=a(2),c=n(u),d=a(244),f=a(56);a(1741);var p=function(){function e(){(0,r["default"])(this,e)}return(0,l["default"])(e,null,[{key:"fileToPdf",value:function(e){var t=URL.createObjectURL(e);return i().then(function(e){return e.PDFJS.getDocument(t)})}},{key:"releasePdf",value:function(e){return e.destroy()}},{key:"pdfToImg",value:function(e,t){var a=document.createElement("canvas");return e.getPage(t).then(function(e){var t=e.getViewport(1),n=a.getContext("2d");a.height=t.height,a.width=t.width;var i={canvasContext:n,viewport:t};return e.render(i)}).then(function(){return d.canvasToBlob(a)}).then(function(e){var t=a.height,n=a.width,i=URL.createObjectURL(e);return{url:i,thumbUrl:i,width:n,height:t}})}}]),e}();e.exports=p},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=a(24),o=n(i),r=a(4),s=n(r),l=a(3),u=n(l),c=function f(e){(0,u["default"])(this,f),this.promise=e,this.lastUsedTime=this.createdTime=+Date.now()},d=function(){function e(t,a){var n=a.maxCached,i=void 0===n?10:n,o=a.maxAge,r=void 0===o?1/0:o,s=a.shouldCache;(0,u["default"])(this,e),this._cache={},this._maxCached=i,this._maxAge=r,this._createPromiseFunc=t,this._shouldCacheFunc=s}return(0,s["default"])(e,[{key:"getOrRun",value:function(){for(var e=this,t=arguments.length,a=Array(t),n=0;t>n;n++)a[n]=arguments[n];var i=a[0],r=this._cache;if(this._maxAge!==1/0)for(var s=Date.now()-this._maxAge,l=(0,o["default"])(r),u=0;u<l.length;u++){var d=l[u];r[d].createdTime<s&&delete r[d]}var f=r[i];if(f)return f.lastUsedTime=+Date.now(),f.promise;var p=(0,o["default"])(r);if(p.length>=this._maxCached){for(var h=void 0,m=void 0,v=0;v<p.length;v++){var g=p[v],_=r[g];(!m||_.lastUsedTime<m)&&(m=_.lastUsedTime,h=g)}delete r[h]}var y=this._createPromiseFunc.apply(void 0,a);return r[i]=new c(y),y.then(function(t){var a=e._shouldCacheFunc;a&&e._cache[i]===y&&!a(t)&&delete e._cache[i]})["catch"](function(){e._cache[i]===y&&delete e._cache[i]}),y}}]),e}();e.exports=d},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,o,r=a(6),s=n(r),l=a(3),u=n(l),c=a(4),d=n(c),f=a(8),p=n(f),h=a(7),m=n(h),v=a(5),g=n(v),_=a(46),y=a(161),E=n(y),M=a(1471),S=n(M),C=a(12),b=n(C),k=a(78),T=n(k),w=a(1402),N=n(w),P=a(242),A=n(P),O=a(485),R=a(160),D=n(R),x=a(115),I=n(x),L=(0,N["default"])((o=i=function(e){
function t(){var e,a,n,i;(0,u["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(r))),n.handleFullscreen=function(){var e=n.props.onFullscreen;e&&e(n.getCurrentTime())},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"getCurrentTime",value:function(){var e=(0,_.findDOMNode)(this.refs.player);return e.currentTime}},{key:"getMediaDimensions",value:function(){return(0,O.aspectRatioScaled)(this.props.mediaData.aspectRatio,240)}},{key:"renderMedia",value:function(){var e=this.props;if(e.mediaData.mediaStage===A["default"].STAGE.RESOLVED)return g["default"].createElement(S["default"],{msg:e.msg,mediaData:e.mediaData,autoPlay:!0,className:"media-viewer-img",ref:"player",startTime:e.startTime},D["default"].t("video_playback_not_supported"));var t=e.mediaData.preview;return t?g["default"].createElement("div",null,g["default"].createElement(E["default"],{size:50,stroke:3}),g["default"].createElement("img",{src:t.url()})):null}},{key:"render",value:function(){return g["default"].createElement("div",{className:"video-floater"},g["default"].createElement("button",{className:"video-floater-close",onClick:this.props.onClose},D["default"].t("web_close")),g["default"].createElement("button",{className:"video-floater-fullscreen",onClick:this.handleFullscreen},g["default"].createElement("i",{className:"icon icon-search-light"})),g["default"].createElement("div",{className:"video-floater-media",style:this.getMediaDimensions()},this.renderMedia()))}}]),t}(v.Component),i.CONCERNS={msg:["id"],mediaData:["mediaStage","aspectRatio","preview"]},o));L.displayName="VideoPlayer";var F=function(e){function t(){var e,a,n,i;(0,u["default"])(this,t);for(var o=arguments.length,r=Array(o),l=0;o>l;l++)r[l]=arguments[l];return a=n=(0,p["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(r))),n.state={msg:null,getZoomNode:null,startTime:null},n.handleMediaRequest=function(e,t,a){e.forceDownloadMedia(),n.setState({msg:e,getZoomNode:t,startTime:a})},n.handleClose=function(){n.setState({msg:null,getZoomNode:null,startTime:null})},n.handleFullscreen=function(e){var t=n.state,a=t.msg,i=t.getZoomNode;n.handleClose(),b["default"].mediaViewerModal(a,i,e)},i=a,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentDidMount",value:function(){this.props.listeners.add(b["default"],"media_viewer_modal",this.handleClose),this.props.listeners.add(b["default"],"video_player_floater",this.handleMediaRequest)}},{key:"renderVideoPlayer",value:function(){return this.state.msg?g["default"].createElement(L,{key:this.state.msg.id,msg:this.state.msg,mediaData:this.state.msg.mediaData,startTime:this.state.startTime,onClose:this.handleClose,onFullscreen:this.handleFullscreen}):null}},{key:"render",value:function(){return g["default"].createElement(I["default"],{transitionName:"pop"},this.renderVideoPlayer())}}]),t}(v.Component);t["default"]=(0,T["default"])(F)},function(e,t,a){e.exports=a.p+"img/600127bdb5f7627ede5cd4ef320f55b0.png"},,,,,,,function(e,t,a){e.exports=function(){return new Worker(a.p+"pdf.worker.js")}},function(e,t,a){e.exports=function(){return new Promise(function(e,t){a.e(4).then(function(t){e(a(1735))}.bind(null,a))["catch"](function(e){a.oe(e)})["catch"](function(){t()})})}},function(e,t,a){e.exports=function(){return new Promise(function(e,t){a.e(5).then(function(t){e(a(1736))}.bind(null,a))["catch"](function(e){a.oe(e)})["catch"](function(){t()})})}},function(e,t,a){e.exports=function(){return new Promise(function(e,t){a.e(3).then(function(t){e(a(1737))}.bind(null,a))["catch"](function(e){a.oe(e)})["catch"](function(){t()})})}},function(e,t,a){e.exports=function(){return new Promise(function(e,t){a.e(2).then(function(t){e(a(1738))}.bind(null,a))["catch"](function(e){a.oe(e)})["catch"](function(){t()})})}},function(e,t,a){e.exports=function(){return new Promise(function(e,t){a.e(1).then(function(t){e(a(1739))}.bind(null,a))["catch"](function(e){a.oe(e)})["catch"](function(){t()})})}},function(e,t,a){e.exports=function(){return new Promise(function(e,t){a.e(0).then(function(t){e(a(1740))}.bind(null,a))["catch"](function(e){a.oe(e)})["catch"](function(){t()})})}}]));